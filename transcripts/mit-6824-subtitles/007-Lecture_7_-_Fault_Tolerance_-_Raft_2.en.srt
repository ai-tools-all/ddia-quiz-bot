1
00:00:01,000 --> 00:00:07,060

let's imagine three servers with logs

2
00:00:07,060 --> 00:00:07,070
let's imagine three servers with logs
 

3
00:00:07,070 --> 00:00:13,390
let's imagine three servers with logs
that looked like this where the numbers

4
00:00:13,390 --> 00:00:13,400
that looked like this where the numbers
 

5
00:00:13,400 --> 00:00:15,310
that looked like this where the numbers
I'm writing are the term numbers of the

6
00:00:15,310 --> 00:00:15,320
I'm writing are the term numbers of the
 

7
00:00:15,320 --> 00:00:17,050
I'm writing are the term numbers of the
command that's in that log entry so we

8
00:00:17,050 --> 00:00:17,060
command that's in that log entry so we
 

9
00:00:17,060 --> 00:00:18,490
command that's in that log entry so we
don't really care what the actual

10
00:00:18,490 --> 00:00:18,500
don't really care what the actual
 

11
00:00:18,500 --> 00:00:20,769
don't really care what the actual
commands are then I got a number the log

12
00:00:20,769 --> 00:00:20,779
commands are then I got a number the log
 

13
00:00:20,779 --> 00:00:35,280
commands are then I got a number the log
slots and so let's imagine that the

14
00:00:35,280 --> 00:00:35,290
slots and so let's imagine that the
 

15
00:00:35,290 --> 00:00:38,830
slots and so let's imagine that the
presumably the the next term is term six

16
00:00:38,830 --> 00:00:38,840
presumably the the next term is term six
 

17
00:00:38,840 --> 00:00:40,810
presumably the the next term is term six
although you can't actually tell that

18
00:00:40,810 --> 00:00:40,820
although you can't actually tell that
 

19
00:00:40,820 --> 00:00:42,490
although you can't actually tell that
from looking the evidence on the board

20
00:00:42,490 --> 00:00:42,500
from looking the evidence on the board
 

21
00:00:42,500 --> 00:00:44,760
from looking the evidence on the board
but it must be at least six or greater

22
00:00:44,760 --> 00:00:44,770
but it must be at least six or greater
 

23
00:00:44,770 --> 00:00:47,470
but it must be at least six or greater
let's imagine that server s3 is chosen

24
00:00:47,470 --> 00:00:47,480
let's imagine that server s3 is chosen
 

25
00:00:47,480 --> 00:00:52,569
let's imagine that server s3 is chosen
as the leader for term six and at some

26
00:00:52,569 --> 00:00:52,579
as the leader for term six and at some
 

27
00:00:52,579 --> 00:00:56,110
as the leader for term six and at some
point s3 the new leader is going to want

28
00:00:56,110 --> 00:00:56,120
point s3 the new leader is going to want
 

29
00:00:56,120 --> 00:00:58,299
point s3 the new leader is going to want
to send out a new log entry so let's

30
00:00:58,299 --> 00:00:58,309
to send out a new log entry so let's
 

31
00:00:58,309 --> 00:01:00,100
to send out a new log entry so let's
suppose it wants to send out its first

32
00:01:00,100 --> 00:01:00,110
suppose it wants to send out its first
 

33
00:01:00,110 --> 00:01:02,979
suppose it wants to send out its first
log entry per term six so we're sort of

34
00:01:02,979 --> 00:01:02,989
log entry per term six so we're sort of
 

35
00:01:02,989 --> 00:01:04,450
log entry per term six so we're sort of
thinking about the append entries our

36
00:01:04,450 --> 00:01:04,460
thinking about the append entries our
 

37
00:01:04,460 --> 00:01:06,190
thinking about the append entries our
PCs that the leader is going to send out

38
00:01:06,190 --> 00:01:06,200
PCs that the leader is going to send out
 

39
00:01:06,200 --> 00:01:11,289
PCs that the leader is going to send out
to carry the first log entry for term

40
00:01:11,289 --> 00:01:11,299
to carry the first log entry for term
 

41
00:01:11,299 --> 00:01:13,889
to carry the first log entry for term
six really should be under slot thirteen

42
00:01:13,889 --> 00:01:13,899
six really should be under slot thirteen
 

43
00:01:13,899 --> 00:01:16,449
six really should be under slot thirteen
the rules in Figure two say that an

44
00:01:16,449 --> 00:01:16,459
the rules in Figure two say that an
 

45
00:01:16,459 --> 00:01:18,910
the rules in Figure two say that an
append entries are bc actually as - as

46
00:01:18,910 --> 00:01:18,920
append entries are bc actually as - as
 

47
00:01:18,920 --> 00:01:22,089
append entries are bc actually as - as
well as the command that the client sent

48
00:01:22,089 --> 00:01:22,099
well as the command that the client sent
 

49
00:01:22,099 --> 00:01:23,109
well as the command that the client sent
in to the leader that we want to

50
00:01:23,109 --> 00:01:23,119
in to the leader that we want to
 

51
00:01:23,119 --> 00:01:25,029
in to the leader that we want to
replicate on the logs of all the

52
00:01:25,029 --> 00:01:25,039
replicate on the logs of all the
 

53
00:01:25,039 --> 00:01:28,120
replicate on the logs of all the
followers there's this append entries

54
00:01:28,120 --> 00:01:28,130
followers there's this append entries
 

55
00:01:28,130 --> 00:01:33,269
followers there's this append entries
RPC also contains this previous log

56
00:01:33,269 --> 00:01:33,279
RPC also contains this previous log
 

57
00:01:33,279 --> 00:01:39,459
RPC also contains this previous log
index field and a previous log term

58
00:01:39,459 --> 00:01:39,469
index field and a previous log term
 

59
00:01:39,469 --> 00:01:44,260
index field and a previous log term
field and when we're sending out an end

60
00:01:44,260 --> 00:01:44,270
field and when we're sending out an end
 

61
00:01:44,270 --> 00:01:46,419
field and when we're sending out an end
pend entries for where this is the first

62
00:01:46,419 --> 00:01:46,429
pend entries for where this is the first
 

63
00:01:46,429 --> 00:01:48,849
pend entries for where this is the first
entry we're leaders supposed to put

64
00:01:48,849 --> 00:01:48,859
entry we're leaders supposed to put
 

65
00:01:48,859 --> 00:01:51,370
entry we're leaders supposed to put
information about the previous slot the

66
00:01:51,370 --> 00:01:51,380
information about the previous slot the
 

67
00:01:51,380 --> 00:01:54,669
information about the previous slot the
slot before the new information sending

68
00:01:54,669 --> 00:01:54,679
slot before the new information sending
 

69
00:01:54,679 --> 00:01:57,159
slot before the new information sending
out so in this case the log index of the

70
00:01:57,159 --> 00:01:57,169
out so in this case the log index of the
 

71
00:01:57,169 --> 00:02:04,019
out so in this case the log index of the
previous entry is 12 and the term of the

72
00:02:04,019 --> 00:02:04,029
previous entry is 12 and the term of the
 

73
00:02:04,029 --> 00:02:06,699
previous entry is 12 and the term of the
command in the leaders log for the

74
00:02:06,699 --> 00:02:06,709
command in the leaders log for the
 

75
00:02:06,709 --> 00:02:10,749
command in the leaders log for the
previous entry is by so sends out this

76
00:02:10,749 --> 00:02:10,759
previous entry is by so sends out this
 

77
00:02:10,759 --> 00:02:13,390
previous entry is by so sends out this
information to the followers

78
00:02:13,390 --> 00:02:13,400
information to the followers
 

79
00:02:13,400 --> 00:02:16,399
information to the followers
and the followers before they accept a

80
00:02:16,399 --> 00:02:16,409
and the followers before they accept a
 

81
00:02:16,409 --> 00:02:18,949
and the followers before they accept a
upend entries are supposed to check you

82
00:02:18,949 --> 00:02:18,959
upend entries are supposed to check you
 

83
00:02:18,959 --> 00:02:19,880
upend entries are supposed to check you
know they know they've received an

84
00:02:19,880 --> 00:02:19,890
know they know they've received an
 

85
00:02:19,890 --> 00:02:23,899
know they know they've received an
append entries that for some log entries

86
00:02:23,899 --> 00:02:23,909
append entries that for some log entries
 

87
00:02:23,909 --> 00:02:26,839
append entries that for some log entries
that start here and the first thing they

88
00:02:26,839 --> 00:02:26,849
that start here and the first thing they
 

89
00:02:26,849 --> 00:02:29,300
that start here and the first thing they
do is check that there are previous the

90
00:02:29,300 --> 00:02:29,310
do is check that there are previous the
 

91
00:02:29,310 --> 00:02:30,920
do is check that there are previous the
receiving followers check that their

92
00:02:30,920 --> 00:02:30,930
receiving followers check that their
 

93
00:02:30,930 --> 00:02:34,190
receiving followers check that their
previous log entry matches the previous

94
00:02:34,190 --> 00:02:34,200
previous log entry matches the previous
 

95
00:02:34,200 --> 00:02:36,110
previous log entry matches the previous
information that follow that the leader

96
00:02:36,110 --> 00:02:36,120
information that follow that the leader
 

97
00:02:36,120 --> 00:02:38,300
information that follow that the leader
sent out so for a server to of course it

98
00:02:38,300 --> 00:02:38,310
sent out so for a server to of course it
 

99
00:02:38,310 --> 00:02:42,350
sent out so for a server to of course it
doesn't match the server to has a entry

100
00:02:42,350 --> 00:02:42,360
doesn't match the server to has a entry
 

101
00:02:42,360 --> 00:02:43,940
doesn't match the server to has a entry
here all right but it's an entry from

102
00:02:43,940 --> 00:02:43,950
here all right but it's an entry from
 

103
00:02:43,950 --> 00:02:46,789
here all right but it's an entry from
term for not from turn five and so the

104
00:02:46,789 --> 00:02:46,799
term for not from turn five and so the
 

105
00:02:46,799 --> 00:02:49,339
term for not from turn five and so the
server twos going to reject this append

106
00:02:49,339 --> 00:02:49,349
server twos going to reject this append
 

107
00:02:49,349 --> 00:02:51,050
server twos going to reject this append
entries and sort of send a false reply

108
00:02:51,050 --> 00:02:51,060
entries and sort of send a false reply
 

109
00:02:51,060 --> 00:02:54,680
entries and sort of send a false reply
back leader and server one doesn't even

110
00:02:54,680 --> 00:02:54,690
back leader and server one doesn't even
 

111
00:02:54,690 --> 00:02:56,690
back leader and server one doesn't even
have anything here so server ones gonna

112
00:02:56,690 --> 00:02:56,700
have anything here so server ones gonna
 

113
00:02:56,700 --> 00:02:59,990
have anything here so server ones gonna
also reject the append entries in the

114
00:02:59,990 --> 00:03:00,000
also reject the append entries in the
 

115
00:03:00,000 --> 00:03:03,470
also reject the append entries in the
leader and so so far so good right the

116
00:03:03,470 --> 00:03:03,480
leader and so so far so good right the
 

117
00:03:03,480 --> 00:03:05,809
leader and so so far so good right the
terrible thing that that has been

118
00:03:05,809 --> 00:03:05,819
terrible thing that that has been
 

119
00:03:05,819 --> 00:03:08,210
terrible thing that that has been
averted at this point is you know the

120
00:03:08,210 --> 00:03:08,220
averted at this point is you know the
 

121
00:03:08,220 --> 00:03:09,979
averted at this point is you know the
bad thing we absolutely don't want to

122
00:03:09,979 --> 00:03:09,989
bad thing we absolutely don't want to
 

123
00:03:09,989 --> 00:03:12,020
bad thing we absolutely don't want to
see is that server to actually stuck the

124
00:03:12,020 --> 00:03:12,030
see is that server to actually stuck the
 

125
00:03:12,030 --> 00:03:15,199
see is that server to actually stuck the
new blog entry in here which would break

126
00:03:15,199 --> 00:03:15,209
new blog entry in here which would break
 

127
00:03:15,209 --> 00:03:20,270
new blog entry in here which would break
sort of inductive proofs essentially

128
00:03:20,270 --> 00:03:20,280
sort of inductive proofs essentially
 

129
00:03:20,280 --> 00:03:24,589
sort of inductive proofs essentially
that the figure to scheme relies on and

130
00:03:24,589 --> 00:03:24,599
that the figure to scheme relies on and
 

131
00:03:24,599 --> 00:03:27,349
that the figure to scheme relies on and
hide the fact that server two actually

132
00:03:27,349 --> 00:03:27,359
hide the fact that server two actually
 

133
00:03:27,359 --> 00:03:28,789
hide the fact that server two actually
had a different log so instead of

134
00:03:28,789 --> 00:03:28,799
had a different log so instead of
 

135
00:03:28,799 --> 00:03:30,289
had a different log so instead of
accepting log entry server two projects

136
00:03:30,289 --> 00:03:30,299
accepting log entry server two projects
 

137
00:03:30,299 --> 00:03:34,430
accepting log entry server two projects
this RPC the leader sees is two

138
00:03:34,430 --> 00:03:34,440
this RPC the leader sees is two
 

139
00:03:34,440 --> 00:03:36,140
this RPC the leader sees is two
rejections and leader is maintaining

140
00:03:36,140 --> 00:03:36,150
rejections and leader is maintaining
 

141
00:03:36,150 --> 00:03:38,319
rejections and leader is maintaining
this next index field one for each

142
00:03:38,319 --> 00:03:38,329
this next index field one for each
 

143
00:03:38,329 --> 00:03:45,189
this next index field one for each
follower so it has a next index for

144
00:03:45,189 --> 00:03:45,199
follower so it has a next index for
 

145
00:03:45,199 --> 00:03:48,619
follower so it has a next index for
server two and the leader has a next

146
00:03:48,619 --> 00:03:48,629
server two and the leader has a next
 

147
00:03:48,629 --> 00:03:54,650
server two and the leader has a next
index for server one presumably if the

148
00:03:54,650 --> 00:03:54,660
index for server one presumably if the
 

149
00:03:54,660 --> 00:03:56,119
index for server one presumably if the
should have said this before if the

150
00:03:56,119 --> 00:03:56,129
should have said this before if the
 

151
00:03:56,129 --> 00:03:58,420
should have said this before if the
server sending out information about

152
00:03:58,420 --> 00:03:58,430
server sending out information about
 

153
00:03:58,430 --> 00:04:01,879
server sending out information about
slot thirteen here that must mean that

154
00:04:01,879 --> 00:04:01,889
slot thirteen here that must mean that
 

155
00:04:01,889 --> 00:04:03,860
slot thirteen here that must mean that
the server's next index is for both of

156
00:04:03,860 --> 00:04:03,870
the server's next index is for both of
 

157
00:04:03,870 --> 00:04:09,080
the server's next index is for both of
these other servers this started out as

158
00:04:09,080 --> 00:04:09,090
these other servers this started out as
 

159
00:04:09,090 --> 00:04:11,089
these other servers this started out as
thirteen and that would be the case at

160
00:04:11,089 --> 00:04:11,099
thirteen and that would be the case at
 

161
00:04:11,099 --> 00:04:13,220
thirteen and that would be the case at
the server if this leader had just

162
00:04:13,220 --> 00:04:13,230
the server if this leader had just
 

163
00:04:13,230 --> 00:04:14,930
the server if this leader had just
restarted because the figure two rules

164
00:04:14,930 --> 00:04:14,940
restarted because the figure two rules
 

165
00:04:14,940 --> 00:04:16,640
restarted because the figure two rules
say that next index starts out at the

166
00:04:16,640 --> 00:04:16,650
say that next index starts out at the
 

167
00:04:16,650 --> 00:04:21,229
say that next index starts out at the
end of the new leaders log and so in

168
00:04:21,229 --> 00:04:21,239
end of the new leaders log and so in
 

169
00:04:21,239 --> 00:04:23,750
end of the new leaders log and so in
response to errors the leaders supposed

170
00:04:23,750 --> 00:04:23,760
response to errors the leaders supposed
 

171
00:04:23,760 --> 00:04:25,970
response to errors the leaders supposed
to decrement its next in

172
00:04:25,970 --> 00:04:25,980
to decrement its next in
 

173
00:04:25,980 --> 00:04:28,460
to decrement its next in
steal so it does that for both got

174
00:04:28,460 --> 00:04:28,470
steal so it does that for both got
 

175
00:04:28,470 --> 00:04:34,700
steal so it does that for both got
errors from boat deca mr. Calvin resends

176
00:04:34,700 --> 00:04:34,710
errors from boat deca mr. Calvin resends
 

177
00:04:34,710 --> 00:04:36,290
errors from boat deca mr. Calvin resends
and this time the server is going to

178
00:04:36,290 --> 00:04:36,300
and this time the server is going to
 

179
00:04:36,300 --> 00:04:39,440
and this time the server is going to
send out append entries with previous

180
00:04:39,440 --> 00:04:39,450
send out append entries with previous
 

181
00:04:39,450 --> 00:04:41,770
send out append entries with previous
log index equals 11

182
00:04:41,770 --> 00:04:41,780
log index equals 11
 

183
00:04:41,780 --> 00:04:47,420
log index equals 11
and previous log term equals 3 and this

184
00:04:47,420 --> 00:04:47,430
and previous log term equals 3 and this
 

185
00:04:47,430 --> 00:04:50,330
and previous log term equals 3 and this
new append entries has it has a

186
00:04:50,330 --> 00:04:50,340
new append entries has it has a
 

187
00:04:50,340 --> 00:04:53,240
new append entries has it has a
different previous log index but it's

188
00:04:53,240 --> 00:04:53,250
different previous log index but it's
 

189
00:04:53,250 --> 00:04:55,790
different previous log index but it's
the content in the log entries that the

190
00:04:55,790 --> 00:04:55,800
the content in the log entries that the
 

191
00:04:55,800 --> 00:04:58,130
the content in the log entries that the
server is going to send out this time

192
00:04:58,130 --> 00:04:58,140
server is going to send out this time
 

193
00:04:58,140 --> 00:05:01,400
server is going to send out this time
include you know all the entries after

194
00:05:01,400 --> 00:05:01,410
include you know all the entries after
 

195
00:05:01,410 --> 00:05:03,410
include you know all the entries after
that the new previous log index is

196
00:05:03,410 --> 00:05:03,420
that the new previous log index is
 

197
00:05:03,420 --> 00:05:06,230
that the new previous log index is
sending out so server 2 now the previous

198
00:05:06,230 --> 00:05:06,240
sending out so server 2 now the previous
 

199
00:05:06,240 --> 00:05:10,700
sending out so server 2 now the previous
log index 11 it looks there and it sees

200
00:05:10,700 --> 00:05:10,710
log index 11 it looks there and it sees
 

201
00:05:10,710 --> 00:05:12,950
log index 11 it looks there and it sees
a ha you know the term is 3 same as what

202
00:05:12,950 --> 00:05:12,960
a ha you know the term is 3 same as what
 

203
00:05:12,960 --> 00:05:15,500
a ha you know the term is 3 same as what
the reader is sending me so server 2 is

204
00:05:15,500 --> 00:05:15,510
the reader is sending me so server 2 is
 

205
00:05:15,510 --> 00:05:17,210
the reader is sending me so server 2 is
actually going to accept this append

206
00:05:17,210 --> 00:05:17,220
actually going to accept this append
 

207
00:05:17,220 --> 00:05:20,510
actually going to accept this append
entries and figure 2 rules say oh if you

208
00:05:20,510 --> 00:05:20,520
entries and figure 2 rules say oh if you
 

209
00:05:20,520 --> 00:05:22,430
entries and figure 2 rules say oh if you
accept a pendent we supposed to delete

210
00:05:22,430 --> 00:05:22,440
accept a pendent we supposed to delete
 

211
00:05:22,440 --> 00:05:24,020
accept a pendent we supposed to delete
everything in your log after where the

212
00:05:24,020 --> 00:05:24,030
everything in your log after where the
 

213
00:05:24,030 --> 00:05:26,030
everything in your log after where the
append entry starts and replace it with

214
00:05:26,030 --> 00:05:26,040
append entry starts and replace it with
 

215
00:05:26,040 --> 00:05:28,330
append entry starts and replace it with
whatever's in the append entries so

216
00:05:28,330 --> 00:05:28,340
whatever's in the append entries so
 

217
00:05:28,340 --> 00:05:32,800
whatever's in the append entries so
server tune is going to do that now it's

218
00:05:32,800 --> 00:05:32,810

 

219
00:05:32,810 --> 00:05:35,750

he just went to 5 6 server 1 still has a

220
00:05:35,750 --> 00:05:35,760
he just went to 5 6 server 1 still has a
 

221
00:05:35,760 --> 00:05:38,570
he just went to 5 6 server 1 still has a
problem cuz it has nothing at slot 11

222
00:05:38,570 --> 00:05:38,580
problem cuz it has nothing at slot 11
 

223
00:05:38,580 --> 00:05:41,720
problem cuz it has nothing at slot 11
middle would return another error the

224
00:05:41,720 --> 00:05:41,730
middle would return another error the
 

225
00:05:41,730 --> 00:05:47,720
middle would return another error the
server will now backup its server 1 next

226
00:05:47,720 --> 00:05:47,730
server will now backup its server 1 next
 

227
00:05:47,730 --> 00:05:51,230
server will now backup its server 1 next
index 2 11 it'll send out its log

228
00:05:51,230 --> 00:05:51,240
index 2 11 it'll send out its log
 

229
00:05:51,240 --> 00:05:54,320
index 2 11 it'll send out its log
starting here with the previous index

230
00:05:54,320 --> 00:05:54,330
starting here with the previous index
 

231
00:05:54,330 --> 00:05:56,330
starting here with the previous index
and term referring now to this slot and

232
00:05:56,330 --> 00:05:56,340
and term referring now to this slot and
 

233
00:05:56,340 --> 00:05:58,240
and term referring now to this slot and
this one's actually acceptable server 1

234
00:05:58,240 --> 00:05:58,250
this one's actually acceptable server 1
 

235
00:05:58,250 --> 00:06:00,980
this one's actually acceptable server 1
it'll adopt it'll accept the new log

236
00:06:00,980 --> 00:06:00,990
it'll adopt it'll accept the new log
 

237
00:06:00,990 --> 00:06:03,110
it'll adopt it'll accept the new log
entries and send a positive response

238
00:06:03,110 --> 00:06:03,120
entries and send a positive response
 

239
00:06:03,120 --> 00:06:07,660
entries and send a positive response
back to the server and now they're all

240
00:06:07,660 --> 00:06:07,670

 

241
00:06:07,670 --> 00:06:14,710

now they're all caught up and the

242
00:06:14,710 --> 00:06:14,720

 

243
00:06:14,720 --> 00:06:17,870

presumably the server also when it sees

244
00:06:17,870 --> 00:06:17,880
presumably the server also when it sees
 

245
00:06:17,880 --> 00:06:21,410
presumably the server also when it sees
that followers accepted and append

246
00:06:21,410 --> 00:06:21,420
that followers accepted and append
 

247
00:06:21,420 --> 00:06:22,910
that followers accepted and append
entries that had a certain number of log

248
00:06:22,910 --> 00:06:22,920
entries that had a certain number of log
 

249
00:06:22,920 --> 00:06:24,350
entries that had a certain number of log
entries it actually increments this next

250
00:06:24,350 --> 00:06:24,360
entries it actually increments this next
 

251
00:06:24,360 --> 00:06:29,060
entries it actually increments this next
index could be 14 4 alright so the net

252
00:06:29,060 --> 00:06:29,070
index could be 14 4 alright so the net
 

253
00:06:29,070 --> 00:06:31,010
index could be 14 4 alright so the net
effect of all this backing up is that

254
00:06:31,010 --> 00:06:31,020
effect of all this backing up is that
 

255
00:06:31,020 --> 00:06:33,080
effect of all this backing up is that
the server has used a backup mechanism

256
00:06:33,080 --> 00:06:33,090
the server has used a backup mechanism
 

257
00:06:33,090 --> 00:06:36,760
the server has used a backup mechanism
to detect the point at which the

258
00:06:36,760 --> 00:06:36,770
to detect the point at which the
 

259
00:06:36,770 --> 00:06:38,360
to detect the point at which the
followers logs

260
00:06:38,360 --> 00:06:38,370
followers logs
 

261
00:06:38,370 --> 00:06:39,750
followers logs
started to be equal to this

262
00:06:39,750 --> 00:06:39,760
started to be equal to this
 

263
00:06:39,760 --> 00:06:42,420
started to be equal to this
servers and then sent each of the

264
00:06:42,420 --> 00:06:42,430
servers and then sent each of the
 

265
00:06:42,430 --> 00:06:43,890
servers and then sent each of the
followers starting from that point that

266
00:06:43,890 --> 00:06:43,900
followers starting from that point that
 

267
00:06:43,900 --> 00:06:47,270
followers starting from that point that
a complete remainder of the server's log

268
00:06:47,270 --> 00:06:47,280
a complete remainder of the server's log
 

269
00:06:47,280 --> 00:06:49,800
a complete remainder of the server's log
after that last point at which they were

270
00:06:49,800 --> 00:06:49,810
after that last point at which they were
 

271
00:06:49,810 --> 00:07:01,910
after that last point at which they were
equal any questions all right

272
00:07:01,910 --> 00:07:01,920

 

273
00:07:01,920 --> 00:07:05,730

just to repeat discussion we've had

274
00:07:05,730 --> 00:07:05,740
just to repeat discussion we've had
 

275
00:07:05,740 --> 00:07:07,980
just to repeat discussion we've had
before and we'll probably have again you

276
00:07:07,980 --> 00:07:07,990
before and we'll probably have again you
 

277
00:07:07,990 --> 00:07:09,780
before and we'll probably have again you
notice that we erased some blog entries

278
00:07:09,780 --> 00:07:09,790
notice that we erased some blog entries
 

279
00:07:09,790 --> 00:07:11,730
notice that we erased some blog entries
here which are now su erase that I

280
00:07:11,730 --> 00:07:11,740
here which are now su erase that I
 

281
00:07:11,740 --> 00:07:15,000
here which are now su erase that I
forget what they were 4 & 5 so there

282
00:07:15,000 --> 00:07:15,010
forget what they were 4 & 5 so there
 

283
00:07:15,010 --> 00:07:18,560
forget what they were 4 & 5 so there
were some well actually that was mostly

284
00:07:18,560 --> 00:07:18,570
were some well actually that was mostly
 

285
00:07:18,570 --> 00:07:21,300
were some well actually that was mostly
remember we erased this log entry here

286
00:07:21,300 --> 00:07:21,310
remember we erased this log entry here
 

287
00:07:21,310 --> 00:07:24,750
remember we erased this log entry here
this used to say for um server - the

288
00:07:24,750 --> 00:07:24,760
this used to say for um server - the
 

289
00:07:24,760 --> 00:07:27,450
this used to say for um server - the
question is why was it ok for the system

290
00:07:27,450 --> 00:07:27,460
question is why was it ok for the system
 

291
00:07:27,460 --> 00:07:29,430
question is why was it ok for the system
to forget about this client command

292
00:07:29,430 --> 00:07:29,440
to forget about this client command
 

293
00:07:29,440 --> 00:07:32,160
to forget about this client command
right this thing we erased corresponds

294
00:07:32,160 --> 00:07:32,170
right this thing we erased corresponds
 

295
00:07:32,170 --> 00:07:33,360
right this thing we erased corresponds
to some client command which are now

296
00:07:33,360 --> 00:07:33,370
to some client command which are now
 

297
00:07:33,370 --> 00:07:36,960
to some client command which are now
throwing away I talked about this

298
00:07:36,960 --> 00:07:36,970
throwing away I talked about this
 

299
00:07:36,970 --> 00:07:42,780
throwing away I talked about this
yesterday what's the rationale here yeah

300
00:07:42,780 --> 00:07:42,790
yesterday what's the rationale here yeah
 

301
00:07:42,790 --> 00:07:45,030
yesterday what's the rationale here yeah
so it's not a majority of the servers

302
00:07:45,030 --> 00:07:45,040
so it's not a majority of the servers
 

303
00:07:45,040 --> 00:07:46,710
so it's not a majority of the servers
and therefore whatever previous leader

304
00:07:46,710 --> 00:07:46,720
and therefore whatever previous leader
 

305
00:07:46,720 --> 00:07:49,290
and therefore whatever previous leader
it was who sent this out couldn't have

306
00:07:49,290 --> 00:07:49,300
it was who sent this out couldn't have
 

307
00:07:49,300 --> 00:07:51,300
it was who sent this out couldn't have
gotten acknowledgments from a majority

308
00:07:51,300 --> 00:07:51,310
gotten acknowledgments from a majority
 

309
00:07:51,310 --> 00:07:52,800
gotten acknowledgments from a majority
of servers therefore that previous

310
00:07:52,800 --> 00:07:52,810
of servers therefore that previous
 

311
00:07:52,810 --> 00:07:55,230
of servers therefore that previous
leader couldn't have decided it was

312
00:07:55,230 --> 00:07:55,240
leader couldn't have decided it was
 

313
00:07:55,240 --> 00:07:57,390
leader couldn't have decided it was
committed couldn't have executed it and

314
00:07:57,390 --> 00:07:57,400
committed couldn't have executed it and
 

315
00:07:57,400 --> 00:07:58,920
committed couldn't have executed it and
applied it to the application state

316
00:07:58,920 --> 00:07:58,930
applied it to the application state
 

317
00:07:58,930 --> 00:08:00,960
applied it to the application state
could never have sent a positive reply

318
00:08:00,960 --> 00:08:00,970
could never have sent a positive reply
 

319
00:08:00,970 --> 00:08:03,570
could never have sent a positive reply
back to the client so because this isn't

320
00:08:03,570 --> 00:08:03,580
back to the client so because this isn't
 

321
00:08:03,580 --> 00:08:05,310
back to the client so because this isn't
done a majority of servers we know that

322
00:08:05,310 --> 00:08:05,320
done a majority of servers we know that
 

323
00:08:05,320 --> 00:08:07,050
done a majority of servers we know that
the client who send in and has no reason

324
00:08:07,050 --> 00:08:07,060
the client who send in and has no reason
 

325
00:08:07,060 --> 00:08:08,850
the client who send in and has no reason
to believe it was executed couldn't have

326
00:08:08,850 --> 00:08:08,860
to believe it was executed couldn't have
 

327
00:08:08,860 --> 00:08:10,230
to believe it was executed couldn't have
gotten a reply because one of the rules

328
00:08:10,230 --> 00:08:10,240
gotten a reply because one of the rules
 

329
00:08:10,240 --> 00:08:12,930
gotten a reply because one of the rules
is the server only sends over the leader

330
00:08:12,930 --> 00:08:12,940
is the server only sends over the leader
 

331
00:08:12,940 --> 00:08:15,060
is the server only sends over the leader
only sends a reply to a client after it

332
00:08:15,060 --> 00:08:15,070
only sends a reply to a client after it
 

333
00:08:15,070 --> 00:08:19,080
only sends a reply to a client after it
commits and executes so the client had

334
00:08:19,080 --> 00:08:19,090
commits and executes so the client had
 

335
00:08:19,090 --> 00:08:20,370
commits and executes so the client had
no reason to believe it was even

336
00:08:20,370 --> 00:08:20,380
no reason to believe it was even
 

337
00:08:20,380 --> 00:08:23,370
no reason to believe it was even
received by any server and then and the

338
00:08:23,370 --> 00:08:23,380
received by any server and then and the
 

339
00:08:23,380 --> 00:08:24,720
received by any server and then and the
rules of figure to basically say the

340
00:08:24,720 --> 00:08:24,730
rules of figure to basically say the
 

341
00:08:24,730 --> 00:08:26,580
rules of figure to basically say the
client if he gets no response after a

342
00:08:26,580 --> 00:08:26,590
client if he gets no response after a
 

343
00:08:26,590 --> 00:08:27,870
client if he gets no response after a
while it supposed to resend the request

344
00:08:27,870 --> 00:08:27,880
while it supposed to resend the request
 

345
00:08:27,880 --> 00:08:29,790
while it supposed to resend the request
so we know whatever request this was it

346
00:08:29,790 --> 00:08:29,800
so we know whatever request this was it
 

347
00:08:29,800 --> 00:08:33,690
so we know whatever request this was it
threw away we've never executed never

348
00:08:33,690 --> 00:08:33,700
threw away we've never executed never
 

349
00:08:33,700 --> 00:08:36,030
threw away we've never executed never
included in any state already and the

350
00:08:36,030 --> 00:08:36,040
included in any state already and the
 

351
00:08:36,040 --> 00:08:58,430
included in any state already and the
clients gonna resend it by-and-by yes

352
00:08:58,430 --> 00:08:58,440

 

353
00:08:58,440 --> 00:09:03,450

well it's always deleting suffix of the

354
00:09:03,450 --> 00:09:03,460
well it's always deleting suffix of the
 

355
00:09:03,460 --> 00:09:08,280
well it's always deleting suffix of the
followers log I mean in the end the sort

356
00:09:08,280 --> 00:09:08,290
followers log I mean in the end the sort
 

357
00:09:08,290 --> 00:09:10,740
followers log I mean in the end the sort
of backup answer to this is that the

358
00:09:10,740 --> 00:09:10,750
of backup answer to this is that the
 

359
00:09:10,750 --> 00:09:13,830
of backup answer to this is that the
leader has a complete log so all its

360
00:09:13,830 --> 00:09:13,840
leader has a complete log so all its
 

361
00:09:13,840 --> 00:09:16,500
leader has a complete log so all its
fails it can just send us complete log

362
00:09:16,500 --> 00:09:16,510
fails it can just send us complete log
 

363
00:09:16,510 --> 00:09:19,260
fails it can just send us complete log
to the follower and indeed if you know

364
00:09:19,260 --> 00:09:19,270
to the follower and indeed if you know
 

365
00:09:19,270 --> 00:09:20,580
to the follower and indeed if you know
if you've just started up the system and

366
00:09:20,580 --> 00:09:20,590
if you've just started up the system and
 

367
00:09:20,590 --> 00:09:22,380
if you've just started up the system and
something very strange happened even at

368
00:09:22,380 --> 00:09:22,390
something very strange happened even at
 

369
00:09:22,390 --> 00:09:24,870
something very strange happened even at
the very beginning then you may end up

370
00:09:24,870 --> 00:09:24,880
the very beginning then you may end up
 

371
00:09:24,880 --> 00:09:26,130
the very beginning then you may end up
actually you know maybe in some of the

372
00:09:26,130 --> 00:09:26,140
actually you know maybe in some of the
 

373
00:09:26,140 --> 00:09:28,770
actually you know maybe in some of the
tests for lab two you may end up backing

374
00:09:28,770 --> 00:09:28,780
tests for lab two you may end up backing
 

375
00:09:28,780 --> 00:09:31,320
tests for lab two you may end up backing
up to the very first entry and then

376
00:09:31,320 --> 00:09:31,330
up to the very first entry and then
 

377
00:09:31,330 --> 00:09:32,910
up to the very first entry and then
having the leader essentially send the

378
00:09:32,910 --> 00:09:32,920
having the leader essentially send the
 

379
00:09:32,920 --> 00:09:34,170
having the leader essentially send the
whole log but because the leader has

380
00:09:34,170 --> 00:09:34,180
whole log but because the leader has
 

381
00:09:34,180 --> 00:09:35,610
whole log but because the leader has
this whole law we know it could sort of

382
00:09:35,610 --> 00:09:35,620
this whole law we know it could sort of
 

383
00:09:35,620 --> 00:09:37,320
this whole law we know it could sort of
it's got all the information that's

384
00:09:37,320 --> 00:09:37,330
it's got all the information that's
 

385
00:09:37,330 --> 00:09:40,320
it's got all the information that's
required to feel everybody's logs if it

386
00:09:40,320 --> 00:09:40,330
required to feel everybody's logs if it
 

387
00:09:40,330 --> 00:09:49,250
required to feel everybody's logs if it
needs to

388
00:09:49,250 --> 00:09:49,260

 

389
00:09:49,260 --> 00:09:53,940

okay all right so in this example which

390
00:09:53,940 --> 00:09:53,950
okay all right so in this example which
 

391
00:09:53,950 --> 00:09:57,840
okay all right so in this example which
I guess are now erased we elected s3 as

392
00:09:57,840 --> 00:09:57,850
I guess are now erased we elected s3 as
 

393
00:09:57,850 --> 00:10:02,670
I guess are now erased we elected s3 as
the leader and the question is could we

394
00:10:02,670 --> 00:10:02,680
the leader and the question is could we
 

395
00:10:02,680 --> 00:10:04,860
the leader and the question is could we
you know who can we who are we allowed

396
00:10:04,860 --> 00:10:04,870
you know who can we who are we allowed
 

397
00:10:04,870 --> 00:10:08,820
you know who can we who are we allowed
to elect this leader right cool

398
00:10:08,820 --> 00:10:08,830
to elect this leader right cool
 

399
00:10:08,830 --> 00:10:10,830
to elect this leader right cool
you know that all right if you read the

400
00:10:10,830 --> 00:10:10,840
you know that all right if you read the
 

401
00:10:10,840 --> 00:10:12,720
you know that all right if you read the
paper you know the answer is not just

402
00:10:12,720 --> 00:10:12,730
paper you know the answer is not just
 

403
00:10:12,730 --> 00:10:15,660
paper you know the answer is not just
anyone it turns out it matters a lot for

404
00:10:15,660 --> 00:10:15,670
anyone it turns out it matters a lot for
 

405
00:10:15,670 --> 00:10:17,400
anyone it turns out it matters a lot for
the correctness the correctness of the

406
00:10:17,400 --> 00:10:17,410
the correctness the correctness of the
 

407
00:10:17,410 --> 00:10:19,890
the correctness the correctness of the
system that we don't allow just anyone

408
00:10:19,890 --> 00:10:19,900
system that we don't allow just anyone
 

409
00:10:19,900 --> 00:10:21,660
system that we don't allow just anyone
to be the leader like for example the

410
00:10:21,660 --> 00:10:21,670
to be the leader like for example the
 

411
00:10:21,670 --> 00:10:24,600
to be the leader like for example the
first node whose timer goes off may in

412
00:10:24,600 --> 00:10:24,610
first node whose timer goes off may in
 

413
00:10:24,610 --> 00:10:28,140
first node whose timer goes off may in
fact not be an acceptable leader and so

414
00:10:28,140 --> 00:10:28,150
fact not be an acceptable leader and so
 

415
00:10:28,150 --> 00:10:29,790
fact not be an acceptable leader and so
it turns out raft has some rules that

416
00:10:29,790 --> 00:10:29,800
it turns out raft has some rules that
 

417
00:10:29,800 --> 00:10:32,610
it turns out raft has some rules that
applies about oh yes you can be leader

418
00:10:32,610 --> 00:10:32,620
applies about oh yes you can be leader
 

419
00:10:32,620 --> 00:10:35,430
applies about oh yes you can be leader
or you can't be leader and to see why

420
00:10:35,430 --> 00:10:35,440
or you can't be leader and to see why
 

421
00:10:35,440 --> 00:10:36,990
or you can't be leader and to see why
this is true let's sort of set up a

422
00:10:36,990 --> 00:10:37,000
this is true let's sort of set up a
 

423
00:10:37,000 --> 00:10:43,080
this is true let's sort of set up a
straw man proposal that maybe raft

424
00:10:43,080 --> 00:10:43,090
straw man proposal that maybe raft
 

425
00:10:43,090 --> 00:10:46,110
straw man proposal that maybe raft
should accept should use the server with

426
00:10:46,110 --> 00:10:46,120
should accept should use the server with
 

427
00:10:46,120 --> 00:10:49,200
should accept should use the server with
the longest log as the leader right you

428
00:10:49,200 --> 00:10:49,210
the longest log as the leader right you
 

429
00:10:49,210 --> 00:10:50,820
the longest log as the leader right you
know some alternate universe that could

430
00:10:50,820 --> 00:10:50,830
know some alternate universe that could
 

431
00:10:50,830 --> 00:10:52,410
know some alternate universe that could
be true and it is actually true in

432
00:10:52,410 --> 00:10:52,420
be true and it is actually true in
 

433
00:10:52,420 --> 00:10:54,990
be true and it is actually true in
systems with different designs just not

434
00:10:54,990 --> 00:10:55,000
systems with different designs just not
 

435
00:10:55,000 --> 00:10:57,330
systems with different designs just not
in raft so the question we're

436
00:10:57,330 --> 00:10:57,340
in raft so the question we're
 

437
00:10:57,340 --> 00:11:02,250
in raft so the question we're
investigating is why not use the

438
00:11:02,250 --> 00:11:02,260
investigating is why not use the
 

439
00:11:02,260 --> 00:11:09,900
investigating is why not use the
cervical longest law as leader and this

440
00:11:09,900 --> 00:11:09,910
cervical longest law as leader and this
 

441
00:11:09,910 --> 00:11:11,700
cervical longest law as leader and this
would involve changing the voting rules

442
00:11:11,700 --> 00:11:11,710
would involve changing the voting rules
 

443
00:11:11,710 --> 00:11:16,080
would involve changing the voting rules
in raft have a voters only vote for

444
00:11:16,080 --> 00:11:16,090
in raft have a voters only vote for
 

445
00:11:16,090 --> 00:11:19,590
in raft have a voters only vote for
nodes that have longer logs all right so

446
00:11:19,590 --> 00:11:19,600
nodes that have longer logs all right so
 

447
00:11:19,600 --> 00:11:21,600
nodes that have longer logs all right so
the example that's going to be

448
00:11:21,600 --> 00:11:21,610
the example that's going to be
 

449
00:11:21,610 --> 00:11:23,070
the example that's going to be
convenient for showing why this is a bad

450
00:11:23,070 --> 00:11:23,080
convenient for showing why this is a bad
 

451
00:11:23,080 --> 00:11:25,890
convenient for showing why this is a bad
idea so let's imagine we have three

452
00:11:25,890 --> 00:11:25,900
idea so let's imagine we have three
 

453
00:11:25,900 --> 00:11:29,970
idea so let's imagine we have three
servers again and now the log set setups

454
00:11:29,970 --> 00:11:29,980
servers again and now the log set setups
 

455
00:11:29,980 --> 00:11:34,350
servers again and now the log set setups
are server Wan has entries for terms

456
00:11:34,350 --> 00:11:34,360
are server Wan has entries for terms
 

457
00:11:34,360 --> 00:11:38,520
are server Wan has entries for terms
five six and seven server two four five

458
00:11:38,520 --> 00:11:38,530
five six and seven server two four five
 

459
00:11:38,530 --> 00:11:41,940
five six and seven server two four five
and eight and server three also four

460
00:11:41,940 --> 00:11:41,950
and eight and server three also four
 

461
00:11:41,950 --> 00:11:46,890
and eight and server three also four
five and eight that's the first question

462
00:11:46,890 --> 00:11:46,900
five and eight that's the first question
 

463
00:11:46,900 --> 00:11:50,010
five and eight that's the first question
of course to avoid spending our time

464
00:11:50,010 --> 00:11:50,020
of course to avoid spending our time
 

465
00:11:50,020 --> 00:11:51,600
of course to avoid spending our time
scratching our heads about utter

466
00:11:51,600 --> 00:11:51,610
scratching our heads about utter
 

467
00:11:51,610 --> 00:11:54,510
scratching our heads about utter
nonsense is to make sure that convince

468
00:11:54,510 --> 00:11:54,520
nonsense is to make sure that convince
 

469
00:11:54,520 --> 00:11:56,310
nonsense is to make sure that convince
ourselves that this configuration could

470
00:11:56,310 --> 00:11:56,320
ourselves that this configuration could
 

471
00:11:56,320 --> 00:11:58,050
ourselves that this configuration could
actually arise because if it couldn't

472
00:11:58,050 --> 00:11:58,060
actually arise because if it couldn't
 

473
00:11:58,060 --> 00:11:59,790
actually arise because if it couldn't
possibly arise then

474
00:11:59,790 --> 00:11:59,800
possibly arise then
 

475
00:11:59,800 --> 00:12:01,380
possibly arise then
may be a waste of time to figure out

476
00:12:01,380 --> 00:12:01,390
may be a waste of time to figure out
 

477
00:12:01,390 --> 00:12:03,750
may be a waste of time to figure out
what would happen if it did arise so

478
00:12:03,750 --> 00:12:03,760
what would happen if it did arise so
 

479
00:12:03,760 --> 00:12:07,620
what would happen if it did arise so
anybody wanna propose a sequence of

480
00:12:07,620 --> 00:12:07,630
anybody wanna propose a sequence of
 

481
00:12:07,630 --> 00:12:10,769
anybody wanna propose a sequence of
events whereby this set of logs could

482
00:12:10,769 --> 00:12:10,779
events whereby this set of logs could
 

483
00:12:10,779 --> 00:12:17,130
events whereby this set of logs could
have arisen how about an argument that

484
00:12:17,130 --> 00:12:17,140
have arisen how about an argument that
 

485
00:12:17,140 --> 00:12:27,150
have arisen how about an argument that
it couldn't have arisen oh yeah okay so

486
00:12:27,150 --> 00:12:27,160
it couldn't have arisen oh yeah okay so
 

487
00:12:27,160 --> 00:12:31,790
it couldn't have arisen oh yeah okay so
well maybe we'll back up sometime

488
00:12:31,790 --> 00:12:31,800

 

489
00:12:31,800 --> 00:12:34,440

all right so server one wins is wins the

490
00:12:34,440 --> 00:12:34,450
all right so server one wins is wins the
 

491
00:12:34,450 --> 00:12:37,140
all right so server one wins is wins the
election at this point and it's in term

492
00:12:37,140 --> 00:12:37,150
election at this point and it's in term
 

493
00:12:37,150 --> 00:12:42,510
election at this point and it's in term
six sends out yeah it receives a client

494
00:12:42,510 --> 00:12:42,520
six sends out yeah it receives a client
 

495
00:12:42,520 --> 00:12:44,010
six sends out yeah it receives a client
request sends out the first append

496
00:12:44,010 --> 00:12:44,020
request sends out the first append
 

497
00:12:44,020 --> 00:12:52,890
request sends out the first append
entries and then that's fine actually

498
00:12:52,890 --> 00:12:52,900
entries and then that's fine actually
 

499
00:12:52,900 --> 00:12:56,780
entries and then that's fine actually
everything's fine so far nothing's wrong

500
00:12:56,780 --> 00:12:56,790

 

501
00:12:56,790 --> 00:12:59,760

all right well a good bet for all these

502
00:12:59,760 --> 00:12:59,770
all right well a good bet for all these
 

503
00:12:59,770 --> 00:13:01,950
all right well a good bet for all these
things is then it crashes right or it

504
00:13:01,950 --> 00:13:01,960
things is then it crashes right or it
 

505
00:13:01,960 --> 00:13:04,980
things is then it crashes right or it
receives the client requests in term six

506
00:13:04,980 --> 00:13:04,990
receives the client requests in term six
 

507
00:13:04,990 --> 00:13:06,780
receives the client requests in term six
it appends the client requests to its

508
00:13:06,780 --> 00:13:06,790
it appends the client requests to its
 

509
00:13:06,790 --> 00:13:08,579
it appends the client requests to its
own log which it does first and it's

510
00:13:08,579 --> 00:13:08,589
own log which it does first and it's
 

511
00:13:08,589 --> 00:13:10,260
own log which it does first and it's
about to send out a pen entries but it

512
00:13:10,260 --> 00:13:10,270
about to send out a pen entries but it
 

513
00:13:10,270 --> 00:13:12,750
about to send out a pen entries but it
crashes yes it didn't send out any pen

514
00:13:12,750 --> 00:13:12,760
crashes yes it didn't send out any pen
 

515
00:13:12,760 --> 00:13:14,760
crashes yes it didn't send out any pen
entries and then you know we need then

516
00:13:14,760 --> 00:13:14,770
entries and then you know we need then
 

517
00:13:14,770 --> 00:13:16,500
entries and then you know we need then
it crashes and restarts very quickly

518
00:13:16,500 --> 00:13:16,510
it crashes and restarts very quickly
 

519
00:13:16,510 --> 00:13:19,350
it crashes and restarts very quickly
there's a new election and gosh server

520
00:13:19,350 --> 00:13:19,360
there's a new election and gosh server
 

521
00:13:19,360 --> 00:13:22,079
there's a new election and gosh server
one is elected again as the as the new

522
00:13:22,079 --> 00:13:22,089
one is elected again as the as the new
 

523
00:13:22,089 --> 00:13:24,450
one is elected again as the as the new
leader it receives in term seven and

524
00:13:24,450 --> 00:13:24,460
leader it receives in term seven and
 

525
00:13:24,460 --> 00:13:25,829
leader it receives in term seven and
receives a client request appends it to

526
00:13:25,829 --> 00:13:25,839
receives a client request appends it to
 

527
00:13:25,839 --> 00:13:33,210
receives a client request appends it to
its log and then it crashes right and

528
00:13:33,210 --> 00:13:33,220
its log and then it crashes right and
 

529
00:13:33,220 --> 00:13:35,370
its log and then it crashes right and
then after after a crashes we have a new

530
00:13:35,370 --> 00:13:35,380
then after after a crashes we have a new
 

531
00:13:35,380 --> 00:13:37,350
then after after a crashes we have a new
election maybe server 2 gets elected

532
00:13:37,350 --> 00:13:37,360
election maybe server 2 gets elected
 

533
00:13:37,360 --> 00:13:42,570
election maybe server 2 gets elected
this time maybe server 1 is down now so

534
00:13:42,570 --> 00:13:42,580
this time maybe server 1 is down now so
 

535
00:13:42,580 --> 00:13:45,960
this time maybe server 1 is down now so
off the table if server 2 is elected at

536
00:13:45,960 --> 00:13:45,970
off the table if server 2 is elected at
 

537
00:13:45,970 --> 00:13:48,900
off the table if server 2 is elected at
this point suppose server 1 is still

538
00:13:48,900 --> 00:13:48,910
this point suppose server 1 is still
 

539
00:13:48,910 --> 00:13:51,329
this point suppose server 1 is still
dead what term is server what server two

540
00:13:51,329 --> 00:13:51,339
dead what term is server what server two
 

541
00:13:51,339 --> 00:13:56,410
dead what term is server what server two
venues

542
00:13:56,410 --> 00:13:56,420

 

543
00:13:56,420 --> 00:13:58,300

yeah eights the right answer so why

544
00:13:58,300 --> 00:13:58,310
yeah eights the right answer so why
 

545
00:13:58,310 --> 00:14:00,700
yeah eights the right answer so why
eight and not remember this you know

546
00:14:00,700 --> 00:14:00,710
eight and not remember this you know
 

547
00:14:00,710 --> 00:14:07,230
eight and not remember this you know
this is now gone why eight and not six

548
00:14:07,230 --> 00:14:07,240

 

549
00:14:07,240 --> 00:14:09,610

that's absolutely right so not written

550
00:14:09,610 --> 00:14:09,620
that's absolutely right so not written
 

551
00:14:09,620 --> 00:14:11,260
that's absolutely right so not written
on the board but in order for server one

552
00:14:11,260 --> 00:14:11,270
on the board but in order for server one
 

553
00:14:11,270 --> 00:14:12,730
on the board but in order for server one
to have been elected here it must have

554
00:14:12,730 --> 00:14:12,740
to have been elected here it must have
 

555
00:14:12,740 --> 00:14:14,140
to have been elected here it must have
votes from majority of nodes which

556
00:14:14,140 --> 00:14:14,150
votes from majority of nodes which
 

557
00:14:14,150 --> 00:14:16,680
votes from majority of nodes which
include at least one of server-to-server

558
00:14:16,680 --> 00:14:16,690
include at least one of server-to-server
 

559
00:14:16,690 --> 00:14:21,090
include at least one of server-to-server
three if you look at the vote request

560
00:14:21,090 --> 00:14:21,100
three if you look at the vote request
 

561
00:14:21,100 --> 00:14:24,370
three if you look at the vote request
code and figure two if you vote for

562
00:14:24,370 --> 00:14:24,380
code and figure two if you vote for
 

563
00:14:24,380 --> 00:14:25,630
code and figure two if you vote for
somebody you're you're supposed to

564
00:14:25,630 --> 00:14:25,640
somebody you're you're supposed to
 

565
00:14:25,640 --> 00:14:30,000
somebody you're you're supposed to
record the term in persistent storage

566
00:14:30,000 --> 00:14:30,010
record the term in persistent storage
 

567
00:14:30,010 --> 00:14:32,890
record the term in persistent storage
and that means that either server 2 or

568
00:14:32,890 --> 00:14:32,900
and that means that either server 2 or
 

569
00:14:32,900 --> 00:14:35,140
and that means that either server 2 or
server 3 are both new about term six and

570
00:14:35,140 --> 00:14:35,150
server 3 are both new about term six and
 

571
00:14:35,150 --> 00:14:38,020
server 3 are both new about term six and
in fact term seven and therefore when

572
00:14:38,020 --> 00:14:38,030
in fact term seven and therefore when
 

573
00:14:38,030 --> 00:14:39,700
in fact term seven and therefore when
sever one dies and they cannot elect a

574
00:14:39,700 --> 00:14:39,710
sever one dies and they cannot elect a
 

575
00:14:39,710 --> 00:14:41,740
sever one dies and they cannot elect a
new leader at least one of them knows

576
00:14:41,740 --> 00:14:41,750
new leader at least one of them knows
 

577
00:14:41,750 --> 00:14:44,920
new leader at least one of them knows
that the current term was eight if that

578
00:14:44,920 --> 00:14:44,930
that the current term was eight if that
 

579
00:14:44,930 --> 00:14:48,010
that the current term was eight if that
one and only that one actually if

580
00:14:48,010 --> 00:14:48,020
one and only that one actually if
 

581
00:14:48,020 --> 00:14:49,090
one and only that one actually if
there's only one of them only that one

582
00:14:49,090 --> 00:14:49,100
there's only one of them only that one
 

583
00:14:49,100 --> 00:14:51,220
there's only one of them only that one
could win an election because it has the

584
00:14:51,220 --> 00:14:51,230
could win an election because it has the
 

585
00:14:51,230 --> 00:14:52,390
could win an election because it has the
higher terminal birth they both know

586
00:14:52,390 --> 00:14:52,400
higher terminal birth they both know
 

587
00:14:52,400 --> 00:14:53,830
higher terminal birth they both know
about term eight sorry if they both know

588
00:14:53,830 --> 00:14:53,840
about term eight sorry if they both know
 

589
00:14:53,840 --> 00:14:56,140
about term eight sorry if they both know
about term seven then they'll both and

590
00:14:56,140 --> 00:14:56,150
about term seven then they'll both and
 

591
00:14:56,150 --> 00:14:57,730
about term seven then they'll both and
either one of them will try to be leader

592
00:14:57,730 --> 00:14:57,740
either one of them will try to be leader
 

593
00:14:57,740 --> 00:15:00,520
either one of them will try to be leader
and term eight so that fact of that the

594
00:15:00,520 --> 00:15:00,530
and term eight so that fact of that the
 

595
00:15:00,530 --> 00:15:02,950
and term eight so that fact of that the
next term must be term a dis is insured

596
00:15:02,950 --> 00:15:02,960
next term must be term a dis is insured
 

597
00:15:02,960 --> 00:15:05,080
next term must be term a dis is insured
by the property of the majorities must

598
00:15:05,080 --> 00:15:05,090
by the property of the majorities must
 

599
00:15:05,090 --> 00:15:08,050
by the property of the majorities must
overlap and the fact that current term

600
00:15:08,050 --> 00:15:08,060
overlap and the fact that current term
 

601
00:15:08,060 --> 00:15:10,480
overlap and the fact that current term
is updated by vote request and is

602
00:15:10,480 --> 00:15:10,490
is updated by vote request and is
 

603
00:15:10,490 --> 00:15:12,700
is updated by vote request and is
persistent and guarantee did not be lost

604
00:15:12,700 --> 00:15:12,710
persistent and guarantee did not be lost
 

605
00:15:12,710 --> 00:15:14,800
persistent and guarantee did not be lost
even if there were some crashes here so

606
00:15:14,800 --> 00:15:14,810
even if there were some crashes here so
 

607
00:15:14,810 --> 00:15:15,640
even if there were some crashes here so
the next term is going to be eight

608
00:15:15,640 --> 00:15:15,650
the next term is going to be eight
 

609
00:15:15,650 --> 00:15:17,350
the next term is going to be eight
server two or server three will win the

610
00:15:17,350 --> 00:15:17,360
server two or server three will win the
 

611
00:15:17,360 --> 00:15:19,480
server two or server three will win the
leadership election and let's just

612
00:15:19,480 --> 00:15:19,490
leadership election and let's just
 

613
00:15:19,490 --> 00:15:21,340
leadership election and let's just
imagine that whichever one it is sends

614
00:15:21,340 --> 00:15:21,350
imagine that whichever one it is sends
 

615
00:15:21,350 --> 00:15:25,810
imagine that whichever one it is sends
out append entries for a new client

616
00:15:25,810 --> 00:15:25,820
out append entries for a new client
 

617
00:15:25,820 --> 00:15:27,370
out append entries for a new client
requests the other one gets it and so

618
00:15:27,370 --> 00:15:27,380
requests the other one gets it and so
 

619
00:15:27,380 --> 00:15:30,010
requests the other one gets it and so
now we have this configuration right so

620
00:15:30,010 --> 00:15:30,020
now we have this configuration right so
 

621
00:15:30,020 --> 00:15:32,620
now we have this configuration right so
I was a bit of a detour we're back to

622
00:15:32,620 --> 00:15:32,630
I was a bit of a detour we're back to
 

623
00:15:32,630 --> 00:15:36,070
I was a bit of a detour we're back to
our original question of in this

624
00:15:36,070 --> 00:15:36,080
our original question of in this
 

625
00:15:36,080 --> 00:15:38,140
our original question of in this
configuration suppose server one revives

626
00:15:38,140 --> 00:15:38,150
configuration suppose server one revives
 

627
00:15:38,150 --> 00:15:42,850
configuration suppose server one revives
we have an election would it be okay to

628
00:15:42,850 --> 00:15:42,860
we have an election would it be okay to
 

629
00:15:42,860 --> 00:15:44,710
we have an election would it be okay to
use server one would it be okay to have

630
00:15:44,710 --> 00:15:44,720
use server one would it be okay to have
 

631
00:15:44,720 --> 00:15:48,880
use server one would it be okay to have
the rule be the longest log wins the

632
00:15:48,880 --> 00:15:48,890
the rule be the longest log wins the
 

633
00:15:48,890 --> 00:15:54,280
the rule be the longest log wins the
longest log gets to be the leader yeah

634
00:15:54,280 --> 00:15:54,290
longest log gets to be the leader yeah
 

635
00:15:54,290 --> 00:15:56,680
longest log gets to be the leader yeah
obviously not right because server was a

636
00:15:56,680 --> 00:15:56,690
obviously not right because server was a
 

637
00:15:56,690 --> 00:16:04,450
obviously not right because server was a
leader did it's going to force its log

638
00:16:04,450 --> 00:16:04,460
leader did it's going to force its log
 

639
00:16:04,460 --> 00:16:07,240
leader did it's going to force its log
on to the to followers by the append

640
00:16:07,240 --> 00:16:07,250
on to the to followers by the append
 

641
00:16:07,250 --> 00:16:08,560
on to the to followers by the append
entries machinery that we just talked

642
00:16:08,560 --> 00:16:08,570
entries machinery that we just talked
 

643
00:16:08,570 --> 00:16:09,940
entries machinery that we just talked
about a few minutes ago

644
00:16:09,940 --> 00:16:09,950
about a few minutes ago
 

645
00:16:09,950 --> 00:16:11,380
about a few minutes ago
if we live server one to be the leader

646
00:16:11,380 --> 00:16:11,390
if we live server one to be the leader
 

647
00:16:11,390 --> 00:16:13,840
if we live server one to be the leader
it's gonna you know sent out a pen

648
00:16:13,840 --> 00:16:13,850
it's gonna you know sent out a pen
 

649
00:16:13,850 --> 00:16:15,700
it's gonna you know sent out a pen
entries whatever backup overwrite these

650
00:16:15,700 --> 00:16:15,710
entries whatever backup overwrite these
 

651
00:16:15,710 --> 00:16:19,030
entries whatever backup overwrite these
aids tell the followers to erase their

652
00:16:19,030 --> 00:16:19,040
aids tell the followers to erase their
 

653
00:16:19,040 --> 00:16:21,460
aids tell the followers to erase their
log entries for term a to accept to

654
00:16:21,460 --> 00:16:21,470
log entries for term a to accept to
 

655
00:16:21,470 --> 00:16:23,470
log entries for term a to accept to
overwrite them with this six and seven

656
00:16:23,470 --> 00:16:23,480
overwrite them with this six and seven
 

657
00:16:23,480 --> 00:16:26,070
overwrite them with this six and seven
log entries and then to proceed now with

658
00:16:26,070 --> 00:16:26,080
log entries and then to proceed now with
 

659
00:16:26,080 --> 00:16:30,370
log entries and then to proceed now with
identical to server ones so of course

660
00:16:30,370 --> 00:16:30,380
identical to server ones so of course
 

661
00:16:30,380 --> 00:16:39,850
identical to server ones so of course
why are we upset about this yeah yeah

662
00:16:39,850 --> 00:16:39,860
why are we upset about this yeah yeah
 

663
00:16:39,860 --> 00:16:43,060
why are we upset about this yeah yeah
exactly it was already committed right

664
00:16:43,060 --> 00:16:43,070
exactly it was already committed right
 

665
00:16:43,070 --> 00:16:45,400
exactly it was already committed right
it's not a majority of servers has

666
00:16:45,400 --> 00:16:45,410
it's not a majority of servers has
 

667
00:16:45,410 --> 00:16:50,050
it's not a majority of servers has
already committed probably executed

668
00:16:50,050 --> 00:16:50,060
already committed probably executed
 

669
00:16:50,060 --> 00:16:52,660
already committed probably executed
quite possibly a reply sent to a client

670
00:16:52,660 --> 00:16:52,670
quite possibly a reply sent to a client
 

671
00:16:52,670 --> 00:16:56,500
quite possibly a reply sent to a client
so we're not entitled to delete it and

672
00:16:56,500 --> 00:16:56,510
so we're not entitled to delete it and
 

673
00:16:56,510 --> 00:17:00,100
so we're not entitled to delete it and
therefore server one cannot be allowed

674
00:17:00,100 --> 00:17:00,110
therefore server one cannot be allowed
 

675
00:17:00,110 --> 00:17:02,650
therefore server one cannot be allowed
to become leader and force its log onto

676
00:17:02,650 --> 00:17:02,660
to become leader and force its log onto
 

677
00:17:02,660 --> 00:17:06,160
to become leader and force its log onto
servers two and three everybody see why

678
00:17:06,160 --> 00:17:06,170
servers two and three everybody see why
 

679
00:17:06,170 --> 00:17:12,040
servers two and three everybody see why
that's bad idea for rapid and because of

680
00:17:12,040 --> 00:17:12,050
that's bad idea for rapid and because of
 

681
00:17:12,050 --> 00:17:15,910
that's bad idea for rapid and because of
that this can't possibly have been rule

682
00:17:15,910 --> 00:17:15,920
that this can't possibly have been rule
 

683
00:17:15,920 --> 00:17:19,960
that this can't possibly have been rule
for elections of course shortest log

684
00:17:19,960 --> 00:17:19,970
for elections of course shortest log
 

685
00:17:19,970 --> 00:17:23,770
for elections of course shortest log
didn't work too well either and so in

686
00:17:23,770 --> 00:17:23,780
didn't work too well either and so in
 

687
00:17:23,780 --> 00:17:26,890
didn't work too well either and so in
fact if you read forward to section

688
00:17:26,890 --> 00:17:26,900
fact if you read forward to section
 

689
00:17:26,900 --> 00:17:32,940
fact if you read forward to section
something five point four point one

690
00:17:32,940 --> 00:17:32,950

 

691
00:17:32,950 --> 00:17:34,900

draft actually has a slightly more

692
00:17:34,900 --> 00:17:34,910
draft actually has a slightly more
 

693
00:17:34,910 --> 00:17:43,950
draft actually has a slightly more
sophisticated election restriction that

694
00:17:43,950 --> 00:17:43,960

 

695
00:17:43,960 --> 00:17:47,110

the request vote handling RPC handling

696
00:17:47,110 --> 00:17:47,120
the request vote handling RPC handling
 

697
00:17:47,120 --> 00:17:49,510
the request vote handling RPC handling
code is supposed to check before it says

698
00:17:49,510 --> 00:17:49,520
code is supposed to check before it says
 

699
00:17:49,520 --> 00:17:51,730
code is supposed to check before it says
yes before votes yes for a different

700
00:17:51,730 --> 00:17:51,740
yes before votes yes for a different
 

701
00:17:51,740 --> 00:18:00,040
yes before votes yes for a different
peer and the rule is we only vote you

702
00:18:00,040 --> 00:18:00,050
peer and the rule is we only vote you
 

703
00:18:00,050 --> 00:18:02,620
peer and the rule is we only vote you
vote yes for some candidate who send us

704
00:18:02,620 --> 00:18:02,630
vote yes for some candidate who send us
 

705
00:18:02,630 --> 00:18:10,720
vote yes for some candidate who send us
over request votes only if candidate has

706
00:18:10,720 --> 00:18:10,730
over request votes only if candidate has
 

707
00:18:10,730 --> 00:18:15,040
over request votes only if candidate has
a higher

708
00:18:15,040 --> 00:18:15,050

 

709
00:18:15,050 --> 00:18:26,799

term in the last log entry or same last

710
00:18:26,799 --> 00:18:26,809
term in the last log entry or same last
 

711
00:18:26,809 --> 00:18:31,440
term in the last log entry or same last
term same charming the last log entry

712
00:18:31,440 --> 00:18:31,450
term same charming the last log entry
 

713
00:18:31,450 --> 00:18:38,080
term same charming the last log entry
and a log length that's greater than or

714
00:18:38,080 --> 00:18:38,090
and a log length that's greater than or
 

715
00:18:38,090 --> 00:18:44,710
and a log length that's greater than or
equal to the the server that received

716
00:18:44,710 --> 00:18:44,720
equal to the the server that received
 

717
00:18:44,720 --> 00:18:51,730
equal to the the server that received
that received the boat request and so if

718
00:18:51,730 --> 00:18:51,740
that received the boat request and so if
 

719
00:18:51,740 --> 00:18:53,830
that received the boat request and so if
we apply this here if server two gets a

720
00:18:53,830 --> 00:18:53,840
we apply this here if server two gets a
 

721
00:18:53,840 --> 00:18:58,390
we apply this here if server two gets a
vote request from server one there our

722
00:18:58,390 --> 00:18:58,400
vote request from server one there our
 

723
00:18:58,400 --> 00:19:03,400
vote request from server one there our
last log entry terms or seven the server

724
00:19:03,400 --> 00:19:03,410
last log entry terms or seven the server
 

725
00:19:03,410 --> 00:19:04,660
last log entry terms or seven the server
one's gonna send out a request votes

726
00:19:04,660 --> 00:19:04,670
one's gonna send out a request votes
 

727
00:19:04,670 --> 00:19:08,140
one's gonna send out a request votes
with a last entry term whatever of 7

728
00:19:08,140 --> 00:19:08,150
with a last entry term whatever of 7
 

729
00:19:08,150 --> 00:19:11,910
with a last entry term whatever of 7
server twos is eight so this isn't true

730
00:19:11,910 --> 00:19:11,920
server twos is eight so this isn't true
 

731
00:19:11,920 --> 00:19:14,890
server twos is eight so this isn't true
server service we didn't get a request

732
00:19:14,890 --> 00:19:14,900
server service we didn't get a request
 

733
00:19:14,900 --> 00:19:16,360
server service we didn't get a request
from somebody with a higher term in the

734
00:19:16,360 --> 00:19:16,370
from somebody with a higher term in the
 

735
00:19:16,370 --> 00:19:22,210
from somebody with a higher term in the
last entry and or the last entry terms

736
00:19:22,210 --> 00:19:22,220
last entry and or the last entry terms
 

737
00:19:22,220 --> 00:19:23,470
last entry and or the last entry terms
aren't the same either said the second

738
00:19:23,470 --> 00:19:23,480
aren't the same either said the second
 

739
00:19:23,480 --> 00:19:26,530
aren't the same either said the second
Clause doesn't apply either so neither

740
00:19:26,530 --> 00:19:26,540
Clause doesn't apply either so neither
 

741
00:19:26,540 --> 00:19:28,450
Clause doesn't apply either so neither
server to new serve nor server three is

742
00:19:28,450 --> 00:19:28,460
server to new serve nor server three is
 

743
00:19:28,460 --> 00:19:30,460
server to new serve nor server three is
going to vote for server one and so even

744
00:19:30,460 --> 00:19:30,470
going to vote for server one and so even
 

745
00:19:30,470 --> 00:19:32,230
going to vote for server one and so even
if it sends out this vote requests first

746
00:19:32,230 --> 00:19:32,240
if it sends out this vote requests first
 

747
00:19:32,240 --> 00:19:33,640
if it sends out this vote requests first
because this has a shorter election

748
00:19:33,640 --> 00:19:33,650
because this has a shorter election
 

749
00:19:33,650 --> 00:19:35,500
because this has a shorter election
timeout nobody's going to vote for it

750
00:19:35,500 --> 00:19:35,510
timeout nobody's going to vote for it
 

751
00:19:35,510 --> 00:19:36,820
timeout nobody's going to vote for it
except itself so I don't think it's one

752
00:19:36,820 --> 00:19:36,830
except itself so I don't think it's one
 

753
00:19:36,830 --> 00:19:38,890
except itself so I don't think it's one
vote it's not a majority if either

754
00:19:38,890 --> 00:19:38,900
vote it's not a majority if either
 

755
00:19:38,900 --> 00:19:41,890
vote it's not a majority if either
server two or server three becomes a

756
00:19:41,890 --> 00:19:41,900
server two or server three becomes a
 

757
00:19:41,900 --> 00:19:44,620
server two or server three becomes a
candidate then either of them will

758
00:19:44,620 --> 00:19:44,630
candidate then either of them will
 

759
00:19:44,630 --> 00:19:45,910
candidate then either of them will
accept the other because they have the

760
00:19:45,910 --> 00:19:45,920
accept the other because they have the
 

761
00:19:45,920 --> 00:19:48,250
accept the other because they have the
same last term number and their logs are

762
00:19:48,250 --> 00:19:48,260
same last term number and their logs are
 

763
00:19:48,260 --> 00:19:49,990
same last term number and their logs are
each greater than or equal to in length

764
00:19:49,990 --> 00:19:50,000
each greater than or equal to in length
 

765
00:19:50,000 --> 00:19:52,270
each greater than or equal to in length
and the others so either of them will

766
00:19:52,270 --> 00:19:52,280
and the others so either of them will
 

767
00:19:52,280 --> 00:19:55,030
and the others so either of them will
vote for for the other one will server

768
00:19:55,030 --> 00:19:55,040
vote for for the other one will server
 

769
00:19:55,040 --> 00:19:56,910
vote for for the other one will server
one vote for either of them

770
00:19:56,910 --> 00:19:56,920
one vote for either of them
 

771
00:19:56,920 --> 00:20:00,130
one vote for either of them
yes because either server 2 or server 3

772
00:20:00,130 --> 00:20:00,140
yes because either server 2 or server 3
 

773
00:20:00,140 --> 00:20:01,360
yes because either server 2 or server 3
has a higher term number in the last

774
00:20:01,360 --> 00:20:01,370
has a higher term number in the last
 

775
00:20:01,370 --> 00:20:05,950
has a higher term number in the last
entry so you know what this is doing is

776
00:20:05,950 --> 00:20:05,960
entry so you know what this is doing is
 

777
00:20:05,960 --> 00:20:07,930
entry so you know what this is doing is
making sure that you can only become a

778
00:20:07,930 --> 00:20:07,940
making sure that you can only become a
 

779
00:20:07,940 --> 00:20:11,770
making sure that you can only become a
candidate if or it prefers candidates

780
00:20:11,770 --> 00:20:11,780
candidate if or it prefers candidates
 

781
00:20:11,780 --> 00:20:13,450
candidate if or it prefers candidates
that knew about higher that have log

782
00:20:13,450 --> 00:20:13,460
that knew about higher that have log
 

783
00:20:13,460 --> 00:20:15,700
that knew about higher that have log
entries some higher terms that is it

784
00:20:15,700 --> 00:20:15,710
entries some higher terms that is it
 

785
00:20:15,710 --> 00:20:17,080
entries some higher terms that is it
prefers candidates that are more likely

786
00:20:17,080 --> 00:20:17,090
prefers candidates that are more likely
 

787
00:20:17,090 --> 00:20:18,669
prefers candidates that are more likely
to have been receiving log entries from

788
00:20:18,669 --> 00:20:18,679
to have been receiving log entries from
 

789
00:20:18,679 --> 00:20:23,740
to have been receiving log entries from
the previous leader and you know this

790
00:20:23,740 --> 00:20:23,750
the previous leader and you know this
 

791
00:20:23,750 --> 00:20:25,390
the previous leader and you know this
second part says well we were all

792
00:20:25,390 --> 00:20:25,400
second part says well we were all
 

793
00:20:25,400 --> 00:20:26,799
second part says well we were all
listening to the previous leader then

794
00:20:26,799 --> 00:20:26,809
listening to the previous leader then
 

795
00:20:26,809 --> 00:20:27,370
listening to the previous leader then
we're going to

796
00:20:27,370 --> 00:20:27,380
we're going to
 

797
00:20:27,380 --> 00:20:30,490
we're going to
for the server that has saw more

798
00:20:30,490 --> 00:20:30,500
for the server that has saw more
 

799
00:20:30,500 --> 00:20:35,530
for the server that has saw more
requests from the very last leader any

800
00:20:35,530 --> 00:20:35,540
requests from the very last leader any
 

801
00:20:35,540 --> 00:20:45,510
requests from the very last leader any
questions about the election restriction

802
00:20:45,510 --> 00:20:45,520

 

803
00:20:45,520 --> 00:20:55,060

okay final thing about sending out log

804
00:20:55,060 --> 00:20:55,070
okay final thing about sending out log
 

805
00:20:55,070 --> 00:20:59,500
okay final thing about sending out log
entries is that this rollback scheme at

806
00:20:59,500 --> 00:20:59,510
entries is that this rollback scheme at
 

807
00:20:59,510 --> 00:21:01,450
entries is that this rollback scheme at
least as I described it and it's as its

808
00:21:01,450 --> 00:21:01,460
least as I described it and it's as its
 

809
00:21:01,460 --> 00:21:03,669
least as I described it and it's as its
described in Figure two rolls back one

810
00:21:03,669 --> 00:21:03,679
described in Figure two rolls back one
 

811
00:21:03,679 --> 00:21:08,020
described in Figure two rolls back one
log entry at a time and you know

812
00:21:08,020 --> 00:21:08,030
log entry at a time and you know
 

813
00:21:08,030 --> 00:21:09,549
log entry at a time and you know
probably a lot of fun that's okay

814
00:21:09,549 --> 00:21:09,559
probably a lot of fun that's okay
 

815
00:21:09,559 --> 00:21:13,090
probably a lot of fun that's okay
but there are situations maybe in the

816
00:21:13,090 --> 00:21:13,100
but there are situations maybe in the
 

817
00:21:13,100 --> 00:21:15,280
but there are situations maybe in the
real world and definitely in the lab

818
00:21:15,280 --> 00:21:15,290
real world and definitely in the lab
 

819
00:21:15,290 --> 00:21:18,520
real world and definitely in the lab
tests where backing up one entry at a

820
00:21:18,520 --> 00:21:18,530
tests where backing up one entry at a
 

821
00:21:18,530 --> 00:21:20,110
tests where backing up one entry at a
time is going to take a long long time

822
00:21:20,110 --> 00:21:20,120
time is going to take a long long time
 

823
00:21:20,120 --> 00:21:22,390
time is going to take a long long time
and so the real-world situation where

824
00:21:22,390 --> 00:21:22,400
and so the real-world situation where
 

825
00:21:22,400 --> 00:21:25,810
and so the real-world situation where
that might be true is if they if a

826
00:21:25,810 --> 00:21:25,820
that might be true is if they if a
 

827
00:21:25,820 --> 00:21:27,940
that might be true is if they if a
follower has been down for a long time

828
00:21:27,940 --> 00:21:27,950
follower has been down for a long time
 

829
00:21:27,950 --> 00:21:30,160
follower has been down for a long time
and missed a lot of upend entries and

830
00:21:30,160 --> 00:21:30,170
and missed a lot of upend entries and
 

831
00:21:30,170 --> 00:21:33,100
and missed a lot of upend entries and
the leader restarts and if you follow

832
00:21:33,100 --> 00:21:33,110
the leader restarts and if you follow
 

833
00:21:33,110 --> 00:21:34,660
the leader restarts and if you follow
the pseudocode in Figure two if a leader

834
00:21:34,660 --> 00:21:34,670
the pseudocode in Figure two if a leader
 

835
00:21:34,670 --> 00:21:36,220
the pseudocode in Figure two if a leader
restarts is supposed to set its next

836
00:21:36,220 --> 00:21:36,230
restarts is supposed to set its next
 

837
00:21:36,230 --> 00:21:38,560
restarts is supposed to set its next
index to the end of the leaders log so

838
00:21:38,560 --> 00:21:38,570
index to the end of the leaders log so
 

839
00:21:38,570 --> 00:21:40,180
index to the end of the leaders log so
if the follower has been down and you

840
00:21:40,180 --> 00:21:40,190
if the follower has been down and you
 

841
00:21:40,190 --> 00:21:42,549
if the follower has been down and you
know miss the last thousand log entries

842
00:21:42,549 --> 00:21:42,559
know miss the last thousand log entries
 

843
00:21:42,559 --> 00:21:45,610
know miss the last thousand log entries
and leader reboots the leader is gonna

844
00:21:45,610 --> 00:21:45,620
and leader reboots the leader is gonna
 

845
00:21:45,620 --> 00:21:48,340
and leader reboots the leader is gonna
have to walk back off one at a time one

846
00:21:48,340 --> 00:21:48,350
have to walk back off one at a time one
 

847
00:21:48,350 --> 00:21:50,950
have to walk back off one at a time one
RPC at a time all thousand of those log

848
00:21:50,950 --> 00:21:50,960
RPC at a time all thousand of those log
 

849
00:21:50,960 --> 00:21:53,830
RPC at a time all thousand of those log
entries that the follower missed and

850
00:21:53,830 --> 00:21:53,840
entries that the follower missed and
 

851
00:21:53,840 --> 00:21:55,180
entries that the follower missed and
there's no you know particular reason

852
00:21:55,180 --> 00:21:55,190
there's no you know particular reason
 

853
00:21:55,190 --> 00:21:57,580
there's no you know particular reason
why this would never happen in real life

854
00:21:57,580 --> 00:21:57,590
why this would never happen in real life
 

855
00:21:57,590 --> 00:22:01,150
why this would never happen in real life
it could easily happen at somewhat more

856
00:22:01,150 --> 00:22:01,160
it could easily happen at somewhat more
 

857
00:22:01,160 --> 00:22:03,940
it could easily happen at somewhat more
contrived situation that the tests are

858
00:22:03,940 --> 00:22:03,950
contrived situation that the tests are
 

859
00:22:03,950 --> 00:22:07,180
contrived situation that the tests are
definitely explorers is if a follower is

860
00:22:07,180 --> 00:22:07,190
definitely explorers is if a follower is
 

861
00:22:07,190 --> 00:22:09,880
definitely explorers is if a follower is
if we say we have five servers and

862
00:22:09,880 --> 00:22:09,890
if we say we have five servers and
 

863
00:22:09,890 --> 00:22:13,900
if we say we have five servers and
there's there's a leader but the leaders

864
00:22:13,900 --> 00:22:13,910
there's there's a leader but the leaders
 

865
00:22:13,910 --> 00:22:16,990
there's there's a leader but the leaders
got trapped with one follower in a

866
00:22:16,990 --> 00:22:17,000
got trapped with one follower in a
 

867
00:22:17,000 --> 00:22:18,430
got trapped with one follower in a
network partition but the leader doesn't

868
00:22:18,430 --> 00:22:18,440
network partition but the leader doesn't
 

869
00:22:18,440 --> 00:22:19,780
network partition but the leader doesn't
know it's not leader anymore and it's

870
00:22:19,780 --> 00:22:19,790
know it's not leader anymore and it's
 

871
00:22:19,790 --> 00:22:21,910
know it's not leader anymore and it's
still sending out append entries to its

872
00:22:21,910 --> 00:22:21,920
still sending out append entries to its
 

873
00:22:21,920 --> 00:22:23,140
still sending out append entries to its
one follower and none of which are

874
00:22:23,140 --> 00:22:23,150
one follower and none of which are
 

875
00:22:23,150 --> 00:22:25,930
one follower and none of which are
committed while in the other majority

876
00:22:25,930 --> 00:22:25,940
committed while in the other majority
 

877
00:22:25,940 --> 00:22:28,720
committed while in the other majority
partition the system is continuing as

878
00:22:28,720 --> 00:22:28,730
partition the system is continuing as
 

879
00:22:28,730 --> 00:22:32,490
partition the system is continuing as
usual the ex leader and follower in that

880
00:22:32,490 --> 00:22:32,500
usual the ex leader and follower in that
 

881
00:22:32,500 --> 00:22:35,680
usual the ex leader and follower in that
Minority partition could end up putting

882
00:22:35,680 --> 00:22:35,690
Minority partition could end up putting
 

883
00:22:35,690 --> 00:22:37,480
Minority partition could end up putting
in their logs you know sort of unlimited

884
00:22:37,480 --> 00:22:37,490
in their logs you know sort of unlimited
 

885
00:22:37,490 --> 00:22:40,780
in their logs you know sort of unlimited
numbers of log entries for a stale term

886
00:22:40,780 --> 00:22:40,790
numbers of log entries for a stale term
 

887
00:22:40,790 --> 00:22:42,250
numbers of log entries for a stale term
that will never be committed and need to

888
00:22:42,250 --> 00:22:42,260
that will never be committed and need to
 

889
00:22:42,260 --> 00:22:44,230
that will never be committed and need to
be deleted and overwritten eventually

890
00:22:44,230 --> 00:22:44,240
be deleted and overwritten eventually
 

891
00:22:44,240 --> 00:22:47,590
be deleted and overwritten eventually
when they rejoin the main group that's

892
00:22:47,590 --> 00:22:47,600
when they rejoin the main group that's
 

893
00:22:47,600 --> 00:22:48,730
when they rejoin the main group that's
maybe a little less likely in the real

894
00:22:48,730 --> 00:22:48,740
maybe a little less likely in the real
 

895
00:22:48,740 --> 00:22:52,510
maybe a little less likely in the real
world but you'll see it happen and the

896
00:22:52,510 --> 00:22:52,520
world but you'll see it happen and the
 

897
00:22:52,520 --> 00:22:55,270
world but you'll see it happen and the
test set up so in order to be able to

898
00:22:55,270 --> 00:22:55,280
test set up so in order to be able to
 

899
00:22:55,280 --> 00:22:57,600
test set up so in order to be able to
back up faster that paper has

900
00:22:57,600 --> 00:22:57,610
back up faster that paper has
 

901
00:22:57,610 --> 00:22:59,940
back up faster that paper has
somewhat a vague description of a faster

902
00:22:59,940 --> 00:22:59,950
somewhat a vague description of a faster
 

903
00:22:59,950 --> 00:23:05,000
somewhat a vague description of a faster
scheme towards the end of section 5.3

904
00:23:05,000 --> 00:23:05,010
scheme towards the end of section 5.3
 

905
00:23:05,010 --> 00:23:07,290
scheme towards the end of section 5.3
it's a little bit hard to interpret so

906
00:23:07,290 --> 00:23:07,300
it's a little bit hard to interpret so
 

907
00:23:07,300 --> 00:23:10,140
it's a little bit hard to interpret so
I'm gonna try to explain what their

908
00:23:10,140 --> 00:23:10,150
I'm gonna try to explain what their
 

909
00:23:10,150 --> 00:23:11,640
I'm gonna try to explain what their
ideas about how to back up faster a

910
00:23:11,640 --> 00:23:11,650
ideas about how to back up faster a
 

911
00:23:11,650 --> 00:23:13,260
ideas about how to back up faster a
little bit better and the general idea

912
00:23:13,260 --> 00:23:13,270
little bit better and the general idea
 

913
00:23:13,270 --> 00:23:15,510
little bit better and the general idea
is to be able to to have the follower

914
00:23:15,510 --> 00:23:15,520
is to be able to to have the follower
 

915
00:23:15,520 --> 00:23:17,370
is to be able to to have the follower
send enough information to the leader

916
00:23:17,370 --> 00:23:17,380
send enough information to the leader
 

917
00:23:17,380 --> 00:23:19,620
send enough information to the leader
that the leader can jump back an entire

918
00:23:19,620 --> 00:23:19,630
that the leader can jump back an entire
 

919
00:23:19,630 --> 00:23:22,950
that the leader can jump back an entire
terms worth of entries that have to be

920
00:23:22,950 --> 00:23:22,960
terms worth of entries that have to be
 

921
00:23:22,960 --> 00:23:26,130
terms worth of entries that have to be
deleted per append entries so it leader

922
00:23:26,130 --> 00:23:26,140
deleted per append entries so it leader
 

923
00:23:26,140 --> 00:23:27,570
deleted per append entries so it leader
may only have to send one in a pennant

924
00:23:27,570 --> 00:23:27,580
may only have to send one in a pennant
 

925
00:23:27,580 --> 00:23:30,870
may only have to send one in a pennant
and append entries per term in which the

926
00:23:30,870 --> 00:23:30,880
and append entries per term in which the
 

927
00:23:30,880 --> 00:23:33,840
and append entries per term in which the
leader and follower disagree instead of

928
00:23:33,840 --> 00:23:33,850
leader and follower disagree instead of
 

929
00:23:33,850 --> 00:23:38,070
leader and follower disagree instead of
one per entry so there's three cases I

930
00:23:38,070 --> 00:23:38,080
one per entry so there's three cases I
 

931
00:23:38,080 --> 00:23:39,900
one per entry so there's three cases I
think are important and the fact is that

932
00:23:39,900 --> 00:23:39,910
think are important and the fact is that
 

933
00:23:39,910 --> 00:23:42,950
think are important and the fact is that
you can probably think of many different

934
00:23:42,950 --> 00:23:42,960
you can probably think of many different
 

935
00:23:42,960 --> 00:23:46,610
you can probably think of many different
log backup acceleration strategies and

936
00:23:46,610 --> 00:23:46,620
log backup acceleration strategies and
 

937
00:23:46,620 --> 00:23:50,160
log backup acceleration strategies and
here's one so I'm going to divide the

938
00:23:50,160 --> 00:23:50,170
here's one so I'm going to divide the
 

939
00:23:50,170 --> 00:23:51,870
here's one so I'm going to divide the
kinds of situations you might see into

940
00:23:51,870 --> 00:23:51,880
kinds of situations you might see into
 

941
00:23:51,880 --> 00:24:01,470
kinds of situations you might see into
three cases so this is fast backup case

942
00:24:01,470 --> 00:24:01,480
three cases so this is fast backup case
 

943
00:24:01,480 --> 00:24:06,930
three cases so this is fast backup case
one I'm just going to talk about one

944
00:24:06,930 --> 00:24:06,940
one I'm just going to talk about one
 

945
00:24:06,940 --> 00:24:09,270
one I'm just going to talk about one
follower and the leader and not worry

946
00:24:09,270 --> 00:24:09,280
follower and the leader and not worry
 

947
00:24:09,280 --> 00:24:12,090
follower and the leader and not worry
about the other nodes the same we have

948
00:24:12,090 --> 00:24:12,100
about the other nodes the same we have
 

949
00:24:12,100 --> 00:24:18,030
about the other nodes the same we have
two server one which is the follower and

950
00:24:18,030 --> 00:24:18,040
two server one which is the follower and
 

951
00:24:18,040 --> 00:24:25,560
two server one which is the follower and
server 2 which is the leader so this is

952
00:24:25,560 --> 00:24:25,570
server 2 which is the leader so this is
 

953
00:24:25,570 --> 00:24:29,070
server 2 which is the leader so this is
one case and here we need to backup over

954
00:24:29,070 --> 00:24:29,080
one case and here we need to backup over
 

955
00:24:29,080 --> 00:24:31,020
one case and here we need to backup over
a term where that term is entirely

956
00:24:31,020 --> 00:24:31,030
a term where that term is entirely
 

957
00:24:31,030 --> 00:24:44,630
a term where that term is entirely
missing from the leader another case

958
00:24:44,630 --> 00:24:44,640

 

959
00:24:44,640 --> 00:24:47,670

so in this case we need to back up over

960
00:24:47,670 --> 00:24:47,680
so in this case we need to back up over
 

961
00:24:47,680 --> 00:24:49,170
so in this case we need to back up over
some entries but their entries for a

962
00:24:49,170 --> 00:24:49,180
some entries but their entries for a
 

963
00:24:49,180 --> 00:24:50,400
some entries but their entries for a
term that the leader actually knows

964
00:24:50,400 --> 00:24:50,410
term that the leader actually knows
 

965
00:24:50,410 --> 00:24:53,970
term that the leader actually knows
about so apparently the this followers

966
00:24:53,970 --> 00:24:53,980
about so apparently the this followers
 

967
00:24:53,980 --> 00:24:56,790
about so apparently the this followers
saw a couple of entry a couple of the

968
00:24:56,790 --> 00:24:56,800
saw a couple of entry a couple of the
 

969
00:24:56,800 --> 00:24:58,950
saw a couple of entry a couple of the
very Flass few append entries sent out

970
00:24:58,950 --> 00:24:58,960
very Flass few append entries sent out
 

971
00:24:58,960 --> 00:25:01,890
very Flass few append entries sent out
by a leader that was about to crash but

972
00:25:01,890 --> 00:25:01,900
by a leader that was about to crash but
 

973
00:25:01,900 --> 00:25:03,630
by a leader that was about to crash but
the new leader didn't see them we still

974
00:25:03,630 --> 00:25:03,640
the new leader didn't see them we still
 

975
00:25:03,640 --> 00:25:05,850
the new leader didn't see them we still
need to back up over them and a third

976
00:25:05,850 --> 00:25:05,860
need to back up over them and a third
 

977
00:25:05,860 --> 00:25:11,670
need to back up over them and a third
case is where the followers entirely

978
00:25:11,670 --> 00:25:11,680
case is where the followers entirely
 

979
00:25:11,680 --> 00:25:15,200
case is where the followers entirely
missing the following the leader agree

980
00:25:15,200 --> 00:25:15,210
missing the following the leader agree
 

981
00:25:15,210 --> 00:25:19,890
missing the following the leader agree
but the followers is missing the end of

982
00:25:19,890 --> 00:25:19,900
but the followers is missing the end of
 

983
00:25:19,900 --> 00:25:24,780
but the followers is missing the end of
the leaders log and I believe you can

984
00:25:24,780 --> 00:25:24,790
the leaders log and I believe you can
 

985
00:25:24,790 --> 00:25:27,200
the leaders log and I believe you can
take care of all three of these with

986
00:25:27,200 --> 00:25:27,210
take care of all three of these with
 

987
00:25:27,210 --> 00:25:29,910
take care of all three of these with
three pieces of extra information in the

988
00:25:29,910 --> 00:25:29,920
three pieces of extra information in the
 

989
00:25:29,920 --> 00:25:32,130
three pieces of extra information in the
reply that a follower sends back to the

990
00:25:32,130 --> 00:25:32,140
reply that a follower sends back to the
 

991
00:25:32,140 --> 00:25:35,580
reply that a follower sends back to the
leader in the case in the append entries

992
00:25:35,580 --> 00:25:35,590
leader in the case in the append entries
 

993
00:25:35,590 --> 00:25:37,290
leader in the case in the append entries
so we're talking about the append

994
00:25:37,290 --> 00:25:37,300
so we're talking about the append
 

995
00:25:37,300 --> 00:25:42,210
so we're talking about the append
entries reply if the follower rejects

996
00:25:42,210 --> 00:25:42,220
entries reply if the follower rejects
 

997
00:25:42,220 --> 00:25:43,920
entries reply if the follower rejects
the append entries because the logs

998
00:25:43,920 --> 00:25:43,930
the append entries because the logs
 

999
00:25:43,930 --> 00:25:46,200
the append entries because the logs
don't agree there's three pieces of

1000
00:25:46,200 --> 00:25:46,210
don't agree there's three pieces of
 

1001
00:25:46,210 --> 00:25:47,490
don't agree there's three pieces of
information that will be useful and

1002
00:25:47,490 --> 00:25:47,500
information that will be useful and
 

1003
00:25:47,500 --> 00:25:49,980
information that will be useful and
taking care of three street cases I'll

1004
00:25:49,980 --> 00:25:49,990
taking care of three street cases I'll
 

1005
00:25:49,990 --> 00:25:55,440
taking care of three street cases I'll
call them X term which is the term of

1006
00:25:55,440 --> 00:25:55,450
call them X term which is the term of
 

1007
00:25:55,450 --> 00:25:58,290
call them X term which is the term of
the conflicting entry I remember the

1008
00:25:58,290 --> 00:25:58,300
the conflicting entry I remember the
 

1009
00:25:58,300 --> 00:26:05,450
the conflicting entry I remember the
leader sent this previous log term and

1010
00:26:05,450 --> 00:26:05,460
leader sent this previous log term and
 

1011
00:26:05,460 --> 00:26:07,800
leader sent this previous log term and
if the follower rejects it because it

1012
00:26:07,800 --> 00:26:07,810
if the follower rejects it because it
 

1013
00:26:07,810 --> 00:26:09,030
if the follower rejects it because it
has something here but the terms wrong

1014
00:26:09,030 --> 00:26:09,040
has something here but the terms wrong
 

1015
00:26:09,040 --> 00:26:12,870
has something here but the terms wrong
so it'll put the followers term for the

1016
00:26:12,870 --> 00:26:12,880
so it'll put the followers term for the
 

1017
00:26:12,880 --> 00:26:19,320
so it'll put the followers term for the
conflicting entry here or you know I'm

1018
00:26:19,320 --> 00:26:19,330
conflicting entry here or you know I'm
 

1019
00:26:19,330 --> 00:26:21,030
conflicting entry here or you know I'm
negative one or something it doesn't

1020
00:26:21,030 --> 00:26:21,040
negative one or something it doesn't
 

1021
00:26:21,040 --> 00:26:25,020
negative one or something it doesn't
have anything in the log there it'll

1022
00:26:25,020 --> 00:26:25,030
have anything in the log there it'll
 

1023
00:26:25,030 --> 00:26:30,210
have anything in the log there it'll
also send back the index of the

1024
00:26:30,210 --> 00:26:30,220
also send back the index of the
 

1025
00:26:30,220 --> 00:26:33,300
also send back the index of the
conflicting but the index are the first

1026
00:26:33,300 --> 00:26:33,310
conflicting but the index are the first
 

1027
00:26:33,310 --> 00:26:46,740
conflicting but the index are the first
entry with that term

1028
00:26:46,740 --> 00:26:46,750

 

1029
00:26:46,750 --> 00:26:49,830

and finally if there wasn't any log

1030
00:26:49,830 --> 00:26:49,840
and finally if there wasn't any log
 

1031
00:26:49,840 --> 00:26:52,740
and finally if there wasn't any log
entry there at all the follower will

1032
00:26:52,740 --> 00:26:52,750
entry there at all the follower will
 

1033
00:26:52,750 --> 00:26:56,850
entry there at all the follower will
send back on the length of its law like

1034
00:26:56,850 --> 00:26:56,860
send back on the length of its law like
 

1035
00:26:56,860 --> 00:27:02,460
send back on the length of its law like
the followers log so for case one the

1036
00:27:02,460 --> 00:27:02,470
the followers log so for case one the
 

1037
00:27:02,470 --> 00:27:12,780
the followers log so for case one the
way this helps if the it's a leader sees

1038
00:27:12,780 --> 00:27:12,790
way this helps if the it's a leader sees
 

1039
00:27:12,790 --> 00:27:16,140
way this helps if the it's a leader sees
that the leader doesn't even have an

1040
00:27:16,140 --> 00:27:16,150
that the leader doesn't even have an
 

1041
00:27:16,150 --> 00:27:19,020
that the leader doesn't even have an
entry with X term of term X term at all

1042
00:27:19,020 --> 00:27:19,030
entry with X term of term X term at all
 

1043
00:27:19,030 --> 00:27:22,860
entry with X term of term X term at all
in its log so that's this case where the

1044
00:27:22,860 --> 00:27:22,870
in its log so that's this case where the
 

1045
00:27:22,870 --> 00:27:24,390
in its log so that's this case where the
leader didn't have turn five and if the

1046
00:27:24,390 --> 00:27:24,400
leader didn't have turn five and if the
 

1047
00:27:24,400 --> 00:27:26,250
leader didn't have turn five and if the
leader can simply back up to the

1048
00:27:26,250 --> 00:27:26,260
leader can simply back up to the
 

1049
00:27:26,260 --> 00:27:30,560
leader can simply back up to the
beginning of the followers run of

1050
00:27:30,560 --> 00:27:30,570
beginning of the followers run of
 

1051
00:27:30,570 --> 00:27:34,010
beginning of the followers run of
entries with X term that is the the

1052
00:27:34,010 --> 00:27:34,020
entries with X term that is the the
 

1053
00:27:34,020 --> 00:27:36,990
entries with X term that is the the
leader can set its next index to this X

1054
00:27:36,990 --> 00:27:37,000
leader can set its next index to this X
 

1055
00:27:37,000 --> 00:27:41,640
leader can set its next index to this X
index thing which is the first entry the

1056
00:27:41,640 --> 00:27:41,650
index thing which is the first entry the
 

1057
00:27:41,650 --> 00:27:45,169
index thing which is the first entry the
followers run of items from term five

1058
00:27:45,169 --> 00:27:45,179
followers run of items from term five
 

1059
00:27:45,179 --> 00:27:48,450
followers run of items from term five
alright so if the leader doesn't have X

1060
00:27:48,450 --> 00:27:48,460
alright so if the leader doesn't have X
 

1061
00:27:48,460 --> 00:27:51,060
alright so if the leader doesn't have X
term at all it should back up to X back

1062
00:27:51,060 --> 00:27:51,070
term at all it should back up to X back
 

1063
00:27:51,070 --> 00:27:53,700
term at all it should back up to X back
the follower up to X index the second

1064
00:27:53,700 --> 00:27:53,710
the follower up to X index the second
 

1065
00:27:53,710 --> 00:27:55,560
the follower up to X index the second
case you can detect the fault the leader

1066
00:27:55,560 --> 00:27:55,570
case you can detect the fault the leader
 

1067
00:27:55,570 --> 00:27:59,760
case you can detect the fault the leader
can detect if X term is valid and the

1068
00:27:59,760 --> 00:27:59,770
can detect if X term is valid and the
 

1069
00:27:59,770 --> 00:28:04,890
can detect if X term is valid and the
leader actually has log entries of term

1070
00:28:04,890 --> 00:28:04,900
leader actually has log entries of term
 

1071
00:28:04,900 --> 00:28:08,270
leader actually has log entries of term
X term that's the case here where the

1072
00:28:08,270 --> 00:28:08,280
X term that's the case here where the
 

1073
00:28:08,280 --> 00:28:10,500
X term that's the case here where the
you know the disagreement is here but

1074
00:28:10,500 --> 00:28:10,510
you know the disagreement is here but
 

1075
00:28:10,510 --> 00:28:12,810
you know the disagreement is here but
the leader actually has some entries

1076
00:28:12,810 --> 00:28:12,820
the leader actually has some entries
 

1077
00:28:12,820 --> 00:28:14,880
the leader actually has some entries
that term in that case the leader should

1078
00:28:14,880 --> 00:28:14,890
that term in that case the leader should
 

1079
00:28:14,890 --> 00:28:18,500
that term in that case the leader should
back up to the last entry it has that

1080
00:28:18,500 --> 00:28:18,510
back up to the last entry it has that
 

1081
00:28:18,510 --> 00:28:22,919
back up to the last entry it has that
has the contesta followers term for the

1082
00:28:22,919 --> 00:28:22,929
has the contesta followers term for the
 

1083
00:28:22,929 --> 00:28:24,780
has the contesta followers term for the
conflicting term in it that is the last

1084
00:28:24,780 --> 00:28:24,790
conflicting term in it that is the last
 

1085
00:28:24,790 --> 00:28:26,909
conflicting term in it that is the last
entry that a leader has for term for in

1086
00:28:26,909 --> 00:28:26,919
entry that a leader has for term for in
 

1087
00:28:26,919 --> 00:28:29,700
entry that a leader has for term for in
this case and if neither of these two

1088
00:28:29,700 --> 00:28:29,710
this case and if neither of these two
 

1089
00:28:29,710 --> 00:28:33,120
this case and if neither of these two
cases hold that is the well actually if

1090
00:28:33,120 --> 00:28:33,130
cases hold that is the well actually if
 

1091
00:28:33,130 --> 00:28:36,000
cases hold that is the well actually if
the follower indicates by maybe setting

1092
00:28:36,000 --> 00:28:36,010
the follower indicates by maybe setting
 

1093
00:28:36,010 --> 00:28:37,650
the follower indicates by maybe setting
X term to minus one it actually didn't

1094
00:28:37,650 --> 00:28:37,660
X term to minus one it actually didn't
 

1095
00:28:37,660 --> 00:28:39,510
X term to minus one it actually didn't
have anything whatsoever at the

1096
00:28:39,510 --> 00:28:39,520
have anything whatsoever at the
 

1097
00:28:39,520 --> 00:28:41,909
have anything whatsoever at the
conflicting log and index because it's

1098
00:28:41,909 --> 00:28:41,919
conflicting log and index because it's
 

1099
00:28:41,919 --> 00:28:46,950
conflicting log and index because it's
log is too short then the leader should

1100
00:28:46,950 --> 00:28:46,960
log is too short then the leader should
 

1101
00:28:46,960 --> 00:28:49,770
log is too short then the leader should
back up its next index to the last entry

1102
00:28:49,770 --> 00:28:49,780
back up its next index to the last entry
 

1103
00:28:49,780 --> 00:28:51,390
back up its next index to the last entry
that the follower had at all and start

1104
00:28:51,390 --> 00:28:51,400
that the follower had at all and start
 

1105
00:28:51,400 --> 00:28:53,830
that the follower had at all and start
sending from there

1106
00:28:53,830 --> 00:28:53,840
sending from there
 

1107
00:28:53,840 --> 00:28:55,820
sending from there
and I'm telling you this because it'll

1108
00:28:55,820 --> 00:28:55,830
and I'm telling you this because it'll
 

1109
00:28:55,830 --> 00:29:00,640
and I'm telling you this because it'll
be useful for doing a lab and if you

1110
00:29:00,640 --> 00:29:00,650
be useful for doing a lab and if you
 

1111
00:29:00,650 --> 00:29:03,080
be useful for doing a lab and if you
miss some of my description it's it's in

1112
00:29:03,080 --> 00:29:03,090
miss some of my description it's it's in
 

1113
00:29:03,090 --> 00:29:05,120
miss some of my description it's it's in
electronics then any questions about

1114
00:29:05,120 --> 00:29:05,130
electronics then any questions about
 

1115
00:29:05,130 --> 00:29:20,960
electronics then any questions about
this backing up business Jack I think

1116
00:29:20,960 --> 00:29:20,970
this backing up business Jack I think
 

1117
00:29:20,970 --> 00:29:25,070
this backing up business Jack I think
that's true yeah yeah yeah maybe binary

1118
00:29:25,070 --> 00:29:25,080
that's true yeah yeah yeah maybe binary
 

1119
00:29:25,080 --> 00:29:26,870
that's true yeah yeah yeah maybe binary
search I'm not ruling out other

1120
00:29:26,870 --> 00:29:26,880
search I'm not ruling out other
 

1121
00:29:26,880 --> 00:29:29,600
search I'm not ruling out other
solutions I mean that you know after

1122
00:29:29,600 --> 00:29:29,610
solutions I mean that you know after
 

1123
00:29:29,610 --> 00:29:32,120
solutions I mean that you know after
reading the papers non description of

1124
00:29:32,120 --> 00:29:32,130
reading the papers non description of
 

1125
00:29:32,130 --> 00:29:34,460
reading the papers non description of
how to do it I like cook this up and

1126
00:29:34,460 --> 00:29:34,470
how to do it I like cook this up and
 

1127
00:29:34,470 --> 00:29:37,520
how to do it I like cook this up and
there's probably other ways to do this

1128
00:29:37,520 --> 00:29:37,530
there's probably other ways to do this
 

1129
00:29:37,530 --> 00:29:39,050
there's probably other ways to do this
probably better ways and faster ways of

1130
00:29:39,050 --> 00:29:39,060
probably better ways and faster ways of
 

1131
00:29:39,060 --> 00:29:40,580
probably better ways and faster ways of
doing it like I'm I'm sure that if

1132
00:29:40,580 --> 00:29:40,590
doing it like I'm I'm sure that if
 

1133
00:29:40,590 --> 00:29:41,870
doing it like I'm I'm sure that if
you're willing to send back more

1134
00:29:41,870 --> 00:29:41,880
you're willing to send back more
 

1135
00:29:41,880 --> 00:29:43,880
you're willing to send back more
information or have a more sophisticated

1136
00:29:43,880 --> 00:29:43,890
information or have a more sophisticated
 

1137
00:29:43,890 --> 00:29:46,010
information or have a more sophisticated
strategy like binary search you can do a

1138
00:29:46,010 --> 00:29:46,020
strategy like binary search you can do a
 

1139
00:29:46,020 --> 00:29:50,540
strategy like binary search you can do a
better job yeah well you you almost

1140
00:29:50,540 --> 00:29:50,550
better job yeah well you you almost
 

1141
00:29:50,550 --> 00:29:53,140
better job yeah well you you almost
certainly need to do something

1142
00:29:53,140 --> 00:29:53,150
certainly need to do something
 

1143
00:29:53,150 --> 00:29:55,130
certainly need to do something
experience suggests that in order to

1144
00:29:55,130 --> 00:29:55,140
experience suggests that in order to
 

1145
00:29:55,140 --> 00:29:57,590
experience suggests that in order to
pass the tests you'll need to do

1146
00:29:57,590 --> 00:29:57,600
pass the tests you'll need to do
 

1147
00:29:57,600 --> 00:30:02,030
pass the tests you'll need to do
something to as well probably not me

1148
00:30:02,030 --> 00:30:02,040
something to as well probably not me
 

1149
00:30:02,040 --> 00:30:04,940
something to as well probably not me
although I that's not quite true like

1150
00:30:04,940 --> 00:30:04,950
although I that's not quite true like
 

1151
00:30:04,950 --> 00:30:06,410
although I that's not quite true like
one of the solutions I've written over

1152
00:30:06,410 --> 00:30:06,420
one of the solutions I've written over
 

1153
00:30:06,420 --> 00:30:08,540
one of the solutions I've written over
the years actually does the stupid thing

1154
00:30:08,540 --> 00:30:08,550
the years actually does the stupid thing
 

1155
00:30:08,550 --> 00:30:11,480
the years actually does the stupid thing
and still passes the tests but because

1156
00:30:11,480 --> 00:30:11,490
and still passes the tests but because
 

1157
00:30:11,490 --> 00:30:15,980
and still passes the tests but because
the tests you know the one of the sort

1158
00:30:15,980 --> 00:30:15,990
the tests you know the one of the sort
 

1159
00:30:15,990 --> 00:30:17,420
the tests you know the one of the sort
of unfortunate but inevitable things

1160
00:30:17,420 --> 00:30:17,430
of unfortunate but inevitable things
 

1161
00:30:17,430 --> 00:30:19,400
of unfortunate but inevitable things
about the tests we give you is that they

1162
00:30:19,400 --> 00:30:19,410
about the tests we give you is that they
 

1163
00:30:19,410 --> 00:30:21,650
about the tests we give you is that they
have a bit of a real time requirement

1164
00:30:21,650 --> 00:30:21,660
have a bit of a real time requirement
 

1165
00:30:21,660 --> 00:30:23,240
have a bit of a real time requirement
that is the tests are not willing to

1166
00:30:23,240 --> 00:30:23,250
that is the tests are not willing to
 

1167
00:30:23,250 --> 00:30:25,580
that is the tests are not willing to
wait forever for your solution to

1168
00:30:25,580 --> 00:30:25,590
wait forever for your solution to
 

1169
00:30:25,590 --> 00:30:29,360
wait forever for your solution to
produce an answer so it is possible to

1170
00:30:29,360 --> 00:30:29,370
produce an answer so it is possible to
 

1171
00:30:29,370 --> 00:30:30,710
produce an answer so it is possible to
have a solution that's you know

1172
00:30:30,710 --> 00:30:30,720
have a solution that's you know
 

1173
00:30:30,720 --> 00:30:33,920
have a solution that's you know
technically correct but takes so long

1174
00:30:33,920 --> 00:30:33,930
technically correct but takes so long
 

1175
00:30:33,930 --> 00:30:36,700
technically correct but takes so long
that the tester gives up and

1176
00:30:36,700 --> 00:30:36,710
that the tester gives up and
 

1177
00:30:36,710 --> 00:30:39,050
that the tester gives up and
unfortunately you know we will the

1178
00:30:39,050 --> 00:30:39,060
unfortunately you know we will the
 

1179
00:30:39,060 --> 00:30:40,820
unfortunately you know we will the
tester will fail you if your solution

1180
00:30:40,820 --> 00:30:40,830
tester will fail you if your solution
 

1181
00:30:40,830 --> 00:30:42,800
tester will fail you if your solution
doesn't finish the test and whatever the

1182
00:30:42,800 --> 00:30:42,810
doesn't finish the test and whatever the
 

1183
00:30:42,810 --> 00:30:44,780
doesn't finish the test and whatever the
time limit is and therefore you do

1184
00:30:44,780 --> 00:30:44,790
time limit is and therefore you do
 

1185
00:30:44,790 --> 00:30:46,930
time limit is and therefore you do
actually have to pay some attention to

1186
00:30:46,930 --> 00:30:46,940
actually have to pay some attention to
 

1187
00:30:46,940 --> 00:30:50,450
actually have to pay some attention to
performance in order you know your

1188
00:30:50,450 --> 00:30:50,460
performance in order you know your
 

1189
00:30:50,460 --> 00:30:52,460
performance in order you know your
solution has to be both correct and have

1190
00:30:52,460 --> 00:30:52,470
solution has to be both correct and have
 

1191
00:30:52,470 --> 00:30:54,080
solution has to be both correct and have
enough performance to finish before the

1192
00:30:54,080 --> 00:30:54,090
enough performance to finish before the
 

1193
00:30:54,090 --> 00:30:56,480
enough performance to finish before the
tester gets bored and sometimes out on

1194
00:30:56,480 --> 00:30:56,490
tester gets bored and sometimes out on
 

1195
00:30:56,490 --> 00:30:58,250
tester gets bored and sometimes out on
you which is like 10 minutes or I don't

1196
00:30:58,250 --> 00:30:58,260
you which is like 10 minutes or I don't
 

1197
00:30:58,260 --> 00:31:00,380
you which is like 10 minutes or I don't
know what it is and unfortunately it's

1198
00:31:00,380 --> 00:31:00,390
know what it is and unfortunately it's
 

1199
00:31:00,390 --> 00:31:02,270
know what it is and unfortunately it's
relatively this stuff's complex enough

1200
00:31:02,270 --> 00:31:02,280
relatively this stuff's complex enough
 

1201
00:31:02,280 --> 00:31:04,640
relatively this stuff's complex enough
that it's not that hard to write a color

1202
00:31:04,640 --> 00:31:04,650
that it's not that hard to write a color
 

1203
00:31:04,650 --> 00:31:05,200
that it's not that hard to write a color
correction

1204
00:31:05,200 --> 00:31:05,210
correction
 

1205
00:31:05,210 --> 00:31:15,340
correction
that's not fast enough yes so the way

1206
00:31:15,340 --> 00:31:15,350
that's not fast enough yes so the way
 

1207
00:31:15,350 --> 00:31:16,840
that's not fast enough yes so the way
you can tap the leader can tell the

1208
00:31:16,840 --> 00:31:16,850
you can tap the leader can tell the
 

1209
00:31:16,850 --> 00:31:20,710
you can tap the leader can tell the
difference is that the follower we're

1210
00:31:20,710 --> 00:31:20,720
difference is that the follower we're
 

1211
00:31:20,720 --> 00:31:23,110
difference is that the follower we're
supposed to send back the term number it

1212
00:31:23,110 --> 00:31:23,120
supposed to send back the term number it
 

1213
00:31:23,120 --> 00:31:25,720
supposed to send back the term number it
sees in the conflicting entry you we

1214
00:31:25,720 --> 00:31:25,730
sees in the conflicting entry you we
 

1215
00:31:25,730 --> 00:31:29,110
sees in the conflicting entry you we
have case one if the leader does not

1216
00:31:29,110 --> 00:31:29,120
have case one if the leader does not
 

1217
00:31:29,120 --> 00:31:31,350
have case one if the leader does not
have that term in its log

1218
00:31:31,350 --> 00:31:31,360
have that term in its log
 

1219
00:31:31,360 --> 00:31:34,870
have that term in its log
so here the follower will set X term to

1220
00:31:34,870 --> 00:31:34,880
so here the follower will set X term to
 

1221
00:31:34,880 --> 00:31:37,570
so here the follower will set X term to
five to five because this is this is

1222
00:31:37,570 --> 00:31:37,580
five to five because this is this is
 

1223
00:31:37,580 --> 00:31:39,909
five to five because this is this is
going to be the this is gonna be the

1224
00:31:39,909 --> 00:31:39,919
going to be the this is gonna be the
 

1225
00:31:39,919 --> 00:31:44,200
going to be the this is gonna be the
conflicting entry the follower says this

1226
00:31:44,200 --> 00:31:44,210
conflicting entry the follower says this
 

1227
00:31:44,210 --> 00:31:46,360
conflicting entry the follower says this
X term to five the leader observes oh I

1228
00:31:46,360 --> 00:31:46,370
X term to five the leader observes oh I
 

1229
00:31:46,370 --> 00:31:48,730
X term to five the leader observes oh I
do not have term five in my log and

1230
00:31:48,730 --> 00:31:48,740
do not have term five in my log and
 

1231
00:31:48,740 --> 00:31:57,190
do not have term five in my log and
therefore this case one and you know it

1232
00:31:57,190 --> 00:31:57,200
therefore this case one and you know it
 

1233
00:31:57,200 --> 00:31:58,090
therefore this case one and you know it
should back up to the beginning

1234
00:31:58,090 --> 00:31:58,100
should back up to the beginning
 

1235
00:31:58,100 --> 00:32:00,159
should back up to the beginning
like it doesn't follower hasn't leader

1236
00:32:00,159 --> 00:32:00,169
like it doesn't follower hasn't leader
 

1237
00:32:00,169 --> 00:32:02,529
like it doesn't follower hasn't leader
has none of those and term five entry so

1238
00:32:02,529 --> 00:32:02,539
has none of those and term five entry so
 

1239
00:32:02,539 --> 00:32:04,120
has none of those and term five entry so
it should just get rid of all of them in

1240
00:32:04,120 --> 00:32:04,130
it should just get rid of all of them in
 

1241
00:32:04,130 --> 00:32:05,769
it should just get rid of all of them in
the follower by backing up to the

1242
00:32:05,769 --> 00:32:05,779
the follower by backing up to the
 

1243
00:32:05,779 --> 00:32:20,110
the follower by backing up to the
beginning which is X index yeah yeah

1244
00:32:20,110 --> 00:32:20,120
beginning which is X index yeah yeah
 

1245
00:32:20,120 --> 00:32:22,480
beginning which is X index yeah yeah
because the leaders gonna back up its

1246
00:32:22,480 --> 00:32:22,490
because the leaders gonna back up its
 

1247
00:32:22,490 --> 00:32:25,899
because the leaders gonna back up its
next index to here and then send an

1248
00:32:25,899 --> 00:32:25,909
next index to here and then send an
 

1249
00:32:25,909 --> 00:32:28,029
next index to here and then send an
append entries that starts here and the

1250
00:32:28,029 --> 00:32:28,039
append entries that starts here and the
 

1251
00:32:28,039 --> 00:32:29,889
append entries that starts here and the
rules a figure to say ah the follower

1252
00:32:29,889 --> 00:32:29,899
rules a figure to say ah the follower
 

1253
00:32:29,899 --> 00:32:31,930
rules a figure to say ah the follower
just has to replace its log so it is

1254
00:32:31,930 --> 00:32:31,940
just has to replace its log so it is
 

1255
00:32:31,940 --> 00:32:37,810
just has to replace its log so it is
gonna get rid of the fives okay alright

1256
00:32:37,810 --> 00:32:37,820
gonna get rid of the fives okay alright
 

1257
00:32:37,820 --> 00:32:38,919
gonna get rid of the fives okay alright
the next thing I want to talk about is

1258
00:32:38,919 --> 00:32:38,929
the next thing I want to talk about is
 

1259
00:32:38,929 --> 00:32:42,130
the next thing I want to talk about is
persistence you'll notice in Figure two

1260
00:32:42,130 --> 00:32:42,140
persistence you'll notice in Figure two
 

1261
00:32:42,140 --> 00:32:44,500
persistence you'll notice in Figure two
that the state in the upper left-hand

1262
00:32:44,500 --> 00:32:44,510
that the state in the upper left-hand
 

1263
00:32:44,510 --> 00:32:47,740
that the state in the upper left-hand
corners sort of divided and summer

1264
00:32:47,740 --> 00:32:47,750
corners sort of divided and summer
 

1265
00:32:47,750 --> 00:32:50,820
corners sort of divided and summer
marked persistent and some are marked

1266
00:32:50,820 --> 00:32:50,830
marked persistent and some are marked
 

1267
00:32:50,830 --> 00:32:54,639
marked persistent and some are marked
volatile and what's going on here is

1268
00:32:54,639 --> 00:32:54,649
volatile and what's going on here is
 

1269
00:32:54,649 --> 00:32:57,639
volatile and what's going on here is
that the the distinction between

1270
00:32:57,639 --> 00:32:57,649
that the the distinction between
 

1271
00:32:57,649 --> 00:32:59,889
that the the distinction between
persistence and volatile you know only

1272
00:32:59,889 --> 00:32:59,899
persistence and volatile you know only
 

1273
00:32:59,899 --> 00:33:03,549
persistence and volatile you know only
matters if a server reboots crashes and

1274
00:33:03,549 --> 00:33:03,559
matters if a server reboots crashes and
 

1275
00:33:03,559 --> 00:33:06,250
matters if a server reboots crashes and
restarts because the persistent what the

1276
00:33:06,250 --> 00:33:06,260
restarts because the persistent what the
 

1277
00:33:06,260 --> 00:33:08,200
restarts because the persistent what the
persistent means is that if you change

1278
00:33:08,200 --> 00:33:08,210
persistent means is that if you change
 

1279
00:33:08,210 --> 00:33:09,730
persistent means is that if you change
one of those items it's marked

1280
00:33:09,730 --> 00:33:09,740
one of those items it's marked
 

1281
00:33:09,740 --> 00:33:14,110
one of those items it's marked
persistent you're supposed to the server

1282
00:33:14,110 --> 00:33:14,120
persistent you're supposed to the server
 

1283
00:33:14,120 --> 00:33:15,700
persistent you're supposed to the server
supposed to write it to disk or to some

1284
00:33:15,700 --> 00:33:15,710
supposed to write it to disk or to some
 

1285
00:33:15,710 --> 00:33:17,919
supposed to write it to disk or to some
other non-volatile storage like as

1286
00:33:17,919 --> 00:33:17,929
other non-volatile storage like as
 

1287
00:33:17,929 --> 00:33:20,789
other non-volatile storage like as
or battery-backed something or whatever

1288
00:33:20,789 --> 00:33:20,799
or battery-backed something or whatever
 

1289
00:33:20,799 --> 00:33:23,440
or battery-backed something or whatever
that will ensure that if the server

1290
00:33:23,440 --> 00:33:23,450
that will ensure that if the server
 

1291
00:33:23,450 --> 00:33:26,320
that will ensure that if the server
restarts that it will be able to find

1292
00:33:26,320 --> 00:33:26,330
restarts that it will be able to find
 

1293
00:33:26,330 --> 00:33:28,480
restarts that it will be able to find
that information and sort of reload it

1294
00:33:28,480 --> 00:33:28,490
that information and sort of reload it
 

1295
00:33:28,490 --> 00:33:34,149
that information and sort of reload it
into memory and that's to allow us to

1296
00:33:34,149 --> 00:33:34,159
into memory and that's to allow us to
 

1297
00:33:34,159 --> 00:33:35,980
into memory and that's to allow us to
allow servers to be able to pick up

1298
00:33:35,980 --> 00:33:35,990
allow servers to be able to pick up
 

1299
00:33:35,990 --> 00:33:37,930
allow servers to be able to pick up
where they left off if they crash and

1300
00:33:37,930 --> 00:33:37,940
where they left off if they crash and
 

1301
00:33:37,940 --> 00:33:46,389
where they left off if they crash and
restart now you might think that it

1302
00:33:46,389 --> 00:33:46,399
restart now you might think that it
 

1303
00:33:46,399 --> 00:33:48,159
restart now you might think that it
would it would be sufficient and simpler

1304
00:33:48,159 --> 00:33:48,169
would it would be sufficient and simpler
 

1305
00:33:48,169 --> 00:33:51,700
would it would be sufficient and simpler
to say well if a server crashes then we

1306
00:33:51,700 --> 00:33:51,710
to say well if a server crashes then we
 

1307
00:33:51,710 --> 00:33:55,869
to say well if a server crashes then we
just throw it away and or we need to be

1308
00:33:55,869 --> 00:33:55,879
just throw it away and or we need to be
 

1309
00:33:55,879 --> 00:33:57,549
just throw it away and or we need to be
able to throw it away and replace it

1310
00:33:57,549 --> 00:33:57,559
able to throw it away and replace it
 

1311
00:33:57,559 --> 00:33:59,080
able to throw it away and replace it
with a brand-new empty server and bring

1312
00:33:59,080 --> 00:33:59,090
with a brand-new empty server and bring
 

1313
00:33:59,090 --> 00:34:01,960
with a brand-new empty server and bring
it up to speed right and of course you

1314
00:34:01,960 --> 00:34:01,970
it up to speed right and of course you
 

1315
00:34:01,970 --> 00:34:04,600
it up to speed right and of course you
do actually it is vital to be able to do

1316
00:34:04,600 --> 00:34:04,610
do actually it is vital to be able to do
 

1317
00:34:04,610 --> 00:34:06,580
do actually it is vital to be able to do
that right because if some server

1318
00:34:06,580 --> 00:34:06,590
that right because if some server
 

1319
00:34:06,590 --> 00:34:08,169
that right because if some server
suffers a failure of some catastrophic

1320
00:34:08,169 --> 00:34:08,179
suffers a failure of some catastrophic
 

1321
00:34:08,179 --> 00:34:10,780
suffers a failure of some catastrophic
failure like it's you know disk melts or

1322
00:34:10,780 --> 00:34:10,790
failure like it's you know disk melts or
 

1323
00:34:10,790 --> 00:34:14,470
failure like it's you know disk melts or
something you absolutely need to be able

1324
00:34:14,470 --> 00:34:14,480
something you absolutely need to be able
 

1325
00:34:14,480 --> 00:34:17,109
something you absolutely need to be able
to replace it and you cannot count on

1326
00:34:17,109 --> 00:34:17,119
to replace it and you cannot count on
 

1327
00:34:17,119 --> 00:34:18,879
to replace it and you cannot count on
getting anything useful off its disk if

1328
00:34:18,879 --> 00:34:18,889
getting anything useful off its disk if
 

1329
00:34:18,889 --> 00:34:20,710
getting anything useful off its disk if
something bad happened to its disk so we

1330
00:34:20,710 --> 00:34:20,720
something bad happened to its disk so we
 

1331
00:34:20,720 --> 00:34:22,030
something bad happened to its disk so we
absolutely need to be able to replace

1332
00:34:22,030 --> 00:34:22,040
absolutely need to be able to replace
 

1333
00:34:22,040 --> 00:34:24,849
absolutely need to be able to replace
completely replace servers that have no

1334
00:34:24,849 --> 00:34:24,859
completely replace servers that have no
 

1335
00:34:24,859 --> 00:34:28,359
completely replace servers that have no
state whatsoever you might think that's

1336
00:34:28,359 --> 00:34:28,369
state whatsoever you might think that's
 

1337
00:34:28,369 --> 00:34:30,369
state whatsoever you might think that's
sufficient to handle any difficulties

1338
00:34:30,369 --> 00:34:30,379
sufficient to handle any difficulties
 

1339
00:34:30,379 --> 00:34:32,589
sufficient to handle any difficulties
but it's actually not it turns out that

1340
00:34:32,589 --> 00:34:32,599
but it's actually not it turns out that
 

1341
00:34:32,599 --> 00:34:34,750
but it's actually not it turns out that
another common failure mode is power

1342
00:34:34,750 --> 00:34:34,760
another common failure mode is power
 

1343
00:34:34,760 --> 00:34:38,530
another common failure mode is power
failure of you know the entire cluster

1344
00:34:38,530 --> 00:34:38,540
failure of you know the entire cluster
 

1345
00:34:38,540 --> 00:34:40,690
failure of you know the entire cluster
where they all stop executing at the

1346
00:34:40,690 --> 00:34:40,700
where they all stop executing at the
 

1347
00:34:40,700 --> 00:34:43,119
where they all stop executing at the
same time right and in that case we

1348
00:34:43,119 --> 00:34:43,129
same time right and in that case we
 

1349
00:34:43,129 --> 00:34:46,780
same time right and in that case we
can't handle or we can't handle that

1350
00:34:46,780 --> 00:34:46,790
can't handle or we can't handle that
 

1351
00:34:46,790 --> 00:34:48,669
can't handle or we can't handle that
failure by simply throwing away the

1352
00:34:48,669 --> 00:34:48,679
failure by simply throwing away the
 

1353
00:34:48,679 --> 00:34:50,710
failure by simply throwing away the
servers and replacing them with new

1354
00:34:50,710 --> 00:34:50,720
servers and replacing them with new
 

1355
00:34:50,720 --> 00:34:53,740
servers and replacing them with new
hardware that we buy from Dell we

1356
00:34:53,740 --> 00:34:53,750
hardware that we buy from Dell we
 

1357
00:34:53,750 --> 00:34:56,470
hardware that we buy from Dell we
actually have to be able to get off the

1358
00:34:56,470 --> 00:34:56,480
actually have to be able to get off the
 

1359
00:34:56,480 --> 00:34:58,960
actually have to be able to get off the
ground we need to be able to get a copy

1360
00:34:58,960 --> 00:34:58,970
ground we need to be able to get a copy
 

1361
00:34:58,970 --> 00:35:01,630
ground we need to be able to get a copy
of the state back in order to keep

1362
00:35:01,630 --> 00:35:01,640
of the state back in order to keep
 

1363
00:35:01,640 --> 00:35:04,120
of the state back in order to keep
executing if we want our service to be

1364
00:35:04,120 --> 00:35:04,130
executing if we want our service to be
 

1365
00:35:04,130 --> 00:35:07,000
executing if we want our service to be
fault tolerant and therefore in order at

1366
00:35:07,000 --> 00:35:07,010
fault tolerant and therefore in order at
 

1367
00:35:07,010 --> 00:35:09,280
fault tolerant and therefore in order at
least in order to handle the situation

1368
00:35:09,280 --> 00:35:09,290
least in order to handle the situation
 

1369
00:35:09,290 --> 00:35:11,680
least in order to handle the situation
of simultaneous power failure we have to

1370
00:35:11,680 --> 00:35:11,690
of simultaneous power failure we have to
 

1371
00:35:11,690 --> 00:35:13,390
of simultaneous power failure we have to
have a way for the server's to sort of

1372
00:35:13,390 --> 00:35:13,400
have a way for the server's to sort of
 

1373
00:35:13,400 --> 00:35:15,309
have a way for the server's to sort of
save their state somewhere where it will

1374
00:35:15,309 --> 00:35:15,319
save their state somewhere where it will
 

1375
00:35:15,319 --> 00:35:19,030
save their state somewhere where it will
be available when the power returns and

1376
00:35:19,030 --> 00:35:19,040
be available when the power returns and
 

1377
00:35:19,040 --> 00:35:20,559
be available when the power returns and
that's one way of viewing what's going

1378
00:35:20,559 --> 00:35:20,569
that's one way of viewing what's going
 

1379
00:35:20,569 --> 00:35:23,950
that's one way of viewing what's going
on with persistence it said that's the

1380
00:35:23,950 --> 00:35:23,960
on with persistence it said that's the
 

1381
00:35:23,960 --> 00:35:26,480
on with persistence it said that's the
state that's required

1382
00:35:26,480 --> 00:35:26,490
state that's required
 

1383
00:35:26,490 --> 00:35:28,849
state that's required
to get a server going again I'm after

1384
00:35:28,849 --> 00:35:28,859
to get a server going again I'm after
 

1385
00:35:28,859 --> 00:35:31,190
to get a server going again I'm after
either a single power failure or power

1386
00:35:31,190 --> 00:35:31,200
either a single power failure or power
 

1387
00:35:31,200 --> 00:35:33,579
either a single power failure or power
failure of the entire cluster

1388
00:35:33,579 --> 00:35:33,589
failure of the entire cluster
 

1389
00:35:33,589 --> 00:35:38,599
failure of the entire cluster
alright so figure two this three items

1390
00:35:38,599 --> 00:35:38,609
alright so figure two this three items
 

1391
00:35:38,609 --> 00:35:44,890
alright so figure two this three items
only three items are persistent so

1392
00:35:44,890 --> 00:35:44,900

 

1393
00:35:44,900 --> 00:35:49,190

there's a log that's like all the log

1394
00:35:49,190 --> 00:35:49,200
there's a log that's like all the log
 

1395
00:35:49,200 --> 00:36:03,769
there's a log that's like all the log
entries current term and voted for and

1396
00:36:03,769 --> 00:36:03,779
entries current term and voted for and
 

1397
00:36:03,779 --> 00:36:06,079
entries current term and voted for and
by the way you know one of us server

1398
00:36:06,079 --> 00:36:06,089
by the way you know one of us server
 

1399
00:36:06,089 --> 00:36:07,549
by the way you know one of us server
reboots it actually has to make an

1400
00:36:07,549 --> 00:36:07,559
reboots it actually has to make an
 

1401
00:36:07,559 --> 00:36:09,829
reboots it actually has to make an
explicit check to make sure that these

1402
00:36:09,829 --> 00:36:09,839
explicit check to make sure that these
 

1403
00:36:09,839 --> 00:36:14,839
explicit check to make sure that these
data are valid on its disk before it

1404
00:36:14,839 --> 00:36:14,849
data are valid on its disk before it
 

1405
00:36:14,849 --> 00:36:17,210
data are valid on its disk before it
rejoins the raft cluster I have to have

1406
00:36:17,210 --> 00:36:17,220
rejoins the raft cluster I have to have
 

1407
00:36:17,220 --> 00:36:18,859
rejoins the raft cluster I have to have
some way of saying oh yeah I actually do

1408
00:36:18,859 --> 00:36:18,869
some way of saying oh yeah I actually do
 

1409
00:36:18,869 --> 00:36:20,390
some way of saying oh yeah I actually do
have some save persistent state as

1410
00:36:20,390 --> 00:36:20,400
have some save persistent state as
 

1411
00:36:20,400 --> 00:36:24,170
have some save persistent state as
opposed to a bunch of zeros that that

1412
00:36:24,170 --> 00:36:24,180
opposed to a bunch of zeros that that
 

1413
00:36:24,180 --> 00:36:28,370
opposed to a bunch of zeros that that
are not valid all right so the reason

1414
00:36:28,370 --> 00:36:28,380
are not valid all right so the reason
 

1415
00:36:28,380 --> 00:36:34,160
are not valid all right so the reason
why log has to be persisted is that at

1416
00:36:34,160 --> 00:36:34,170
why log has to be persisted is that at
 

1417
00:36:34,170 --> 00:36:36,019
why log has to be persisted is that at
least according to figure two this is

1418
00:36:36,019 --> 00:36:36,029
least according to figure two this is
 

1419
00:36:36,029 --> 00:36:40,150
least according to figure two this is
the only record of the application state

1420
00:36:40,150 --> 00:36:40,160
the only record of the application state
 

1421
00:36:40,160 --> 00:36:42,109
the only record of the application state
that is figure two doesn't really have a

1422
00:36:42,109 --> 00:36:42,119
that is figure two doesn't really have a
 

1423
00:36:42,119 --> 00:36:44,150
that is figure two doesn't really have a
notion fears two does not say that we

1424
00:36:44,150 --> 00:36:44,160
notion fears two does not say that we
 

1425
00:36:44,160 --> 00:36:46,250
notion fears two does not say that we
have to persist the application state so

1426
00:36:46,250 --> 00:36:46,260
have to persist the application state so
 

1427
00:36:46,260 --> 00:36:48,319
have to persist the application state so
if we're running a database or you know

1428
00:36:48,319 --> 00:36:48,329
if we're running a database or you know
 

1429
00:36:48,329 --> 00:36:50,539
if we're running a database or you know
a test and set service like for vmware

1430
00:36:50,539 --> 00:36:50,549
a test and set service like for vmware
 

1431
00:36:50,549 --> 00:36:53,299
a test and set service like for vmware
ft the actual database or the actual

1432
00:36:53,299 --> 00:36:53,309
ft the actual database or the actual
 

1433
00:36:53,309 --> 00:36:55,039
ft the actual database or the actual
value of the test and set flag isn't

1434
00:36:55,039 --> 00:36:55,049
value of the test and set flag isn't
 

1435
00:36:55,049 --> 00:36:57,200
value of the test and set flag isn't
persistent according to figure two only

1436
00:36:57,200 --> 00:36:57,210
persistent according to figure two only
 

1437
00:36:57,210 --> 00:36:59,240
persistent according to figure two only
the logins and so when the server

1438
00:36:59,240 --> 00:36:59,250
the logins and so when the server
 

1439
00:36:59,250 --> 00:37:02,150
the logins and so when the server
restarts the only information available

1440
00:37:02,150 --> 00:37:02,160
restarts the only information available
 

1441
00:37:02,160 --> 00:37:05,210
restarts the only information available
to reconstruct the application state is

1442
00:37:05,210 --> 00:37:05,220
to reconstruct the application state is
 

1443
00:37:05,220 --> 00:37:08,450
to reconstruct the application state is
the sequence of commands in the log and

1444
00:37:08,450 --> 00:37:08,460
the sequence of commands in the log and
 

1445
00:37:08,460 --> 00:37:13,430
the sequence of commands in the log and
so that has to be persisted that's what

1446
00:37:13,430 --> 00:37:13,440
so that has to be persisted that's what
 

1447
00:37:13,440 --> 00:37:17,359
so that has to be persisted that's what
about current term why does current term

1448
00:37:17,359 --> 00:37:17,369
about current term why does current term
 

1449
00:37:17,369 --> 00:37:34,579
about current term why does current term
have to be persistent

1450
00:37:34,579 --> 00:37:34,589

 

1451
00:37:34,589 --> 00:37:37,020

yeah so they're both about ensuring that

1452
00:37:37,020 --> 00:37:37,030
yeah so they're both about ensuring that
 

1453
00:37:37,030 --> 00:37:39,750
yeah so they're both about ensuring that
there's only one that each term has at

1454
00:37:39,750 --> 00:37:39,760
there's only one that each term has at
 

1455
00:37:39,760 --> 00:37:43,140
there's only one that each term has at
most one leader so yeah so voted for the

1456
00:37:43,140 --> 00:37:43,150
most one leader so yeah so voted for the
 

1457
00:37:43,150 --> 00:37:45,900
most one leader so yeah so voted for the
specific you know potential damaging

1458
00:37:45,900 --> 00:37:45,910
specific you know potential damaging
 

1459
00:37:45,910 --> 00:37:48,329
specific you know potential damaging
case is that if a server receives a boat

1460
00:37:48,329 --> 00:37:48,339
case is that if a server receives a boat
 

1461
00:37:48,339 --> 00:37:50,790
case is that if a server receives a boat
request and votes for server one and

1462
00:37:50,790 --> 00:37:50,800
request and votes for server one and
 

1463
00:37:50,800 --> 00:37:53,250
request and votes for server one and
then it crashes and if it didn't persist

1464
00:37:53,250 --> 00:37:53,260
then it crashes and if it didn't persist
 

1465
00:37:53,260 --> 00:37:55,710
then it crashes and if it didn't persist
this the identity of who had voted for

1466
00:37:55,710 --> 00:37:55,720
this the identity of who had voted for
 

1467
00:37:55,720 --> 00:37:57,990
this the identity of who had voted for
and in my crash we start get another

1468
00:37:57,990 --> 00:37:58,000
and in my crash we start get another
 

1469
00:37:58,000 --> 00:37:59,910
and in my crash we start get another
boat request for the same term from

1470
00:37:59,910 --> 00:37:59,920
boat request for the same term from
 

1471
00:37:59,920 --> 00:38:01,829
boat request for the same term from
server two and say gosh I haven't voted

1472
00:38:01,829 --> 00:38:01,839
server two and say gosh I haven't voted
 

1473
00:38:01,839 --> 00:38:03,540
server two and say gosh I haven't voted
for anybody because my voted for is

1474
00:38:03,540 --> 00:38:03,550
for anybody because my voted for is
 

1475
00:38:03,550 --> 00:38:03,930
for anybody because my voted for is
blank

1476
00:38:03,930 --> 00:38:03,940
blank
 

1477
00:38:03,940 --> 00:38:05,849
blank
now I'm gonna vote for server 2 and now

1478
00:38:05,849 --> 00:38:05,859
now I'm gonna vote for server 2 and now
 

1479
00:38:05,859 --> 00:38:08,339
now I'm gonna vote for server 2 and now
our servers voted for server 1 and for

1480
00:38:08,339 --> 00:38:08,349
our servers voted for server 1 and for
 

1481
00:38:08,349 --> 00:38:12,150
our servers voted for server 1 and for
server 2 in the same term and that might

1482
00:38:12,150 --> 00:38:12,160
server 2 in the same term and that might
 

1483
00:38:12,160 --> 00:38:14,280
server 2 in the same term and that might
allow two servers

1484
00:38:14,280 --> 00:38:14,290
allow two servers
 

1485
00:38:14,290 --> 00:38:15,990
allow two servers
since both server and server to voted

1486
00:38:15,990 --> 00:38:16,000
since both server and server to voted
 

1487
00:38:16,000 --> 00:38:17,970
since both server and server to voted
for themselves they both may think they

1488
00:38:17,970 --> 00:38:17,980
for themselves they both may think they
 

1489
00:38:17,980 --> 00:38:19,200
for themselves they both may think they
have a majority out of three and they're

1490
00:38:19,200 --> 00:38:19,210
have a majority out of three and they're
 

1491
00:38:19,210 --> 00:38:20,430
have a majority out of three and they're
both going to become leader now we have

1492
00:38:20,430 --> 00:38:20,440
both going to become leader now we have
 

1493
00:38:20,440 --> 00:38:23,339
both going to become leader now we have
two simultaneous servers for the same

1494
00:38:23,339 --> 00:38:23,349
two simultaneous servers for the same
 

1495
00:38:23,349 --> 00:38:24,900
two simultaneous servers for the same
term so this that's why I voted for it

1496
00:38:24,900 --> 00:38:24,910
term so this that's why I voted for it
 

1497
00:38:24,910 --> 00:38:28,559
term so this that's why I voted for it
has to be persistent current term is

1498
00:38:28,559 --> 00:38:28,569
has to be persistent current term is
 

1499
00:38:28,569 --> 00:38:30,690
has to be persistent current term is
gonna be a little more subtle but we

1500
00:38:30,690 --> 00:38:30,700
gonna be a little more subtle but we
 

1501
00:38:30,700 --> 00:38:34,500
gonna be a little more subtle but we
actually talked before about how you

1502
00:38:34,500 --> 00:38:34,510
actually talked before about how you
 

1503
00:38:34,510 --> 00:38:36,390
actually talked before about how you
know again we don't want to have more

1504
00:38:36,390 --> 00:38:36,400
know again we don't want to have more
 

1505
00:38:36,400 --> 00:38:38,460
know again we don't want to have more
than one server for a term and if we

1506
00:38:38,460 --> 00:38:38,470
than one server for a term and if we
 

1507
00:38:38,470 --> 00:38:41,210
than one server for a term and if we
don't know what term number it is then

1508
00:38:41,210 --> 00:38:41,220
don't know what term number it is then
 

1509
00:38:41,220 --> 00:38:44,490
don't know what term number it is then
we can't necessarily then it may be hard

1510
00:38:44,490 --> 00:38:44,500
we can't necessarily then it may be hard
 

1511
00:38:44,500 --> 00:38:46,770
we can't necessarily then it may be hard
to ensure that there's only one server

1512
00:38:46,770 --> 00:38:46,780
to ensure that there's only one server
 

1513
00:38:46,780 --> 00:38:49,770
to ensure that there's only one server
for a term and I think maybe in this

1514
00:38:49,770 --> 00:38:49,780
for a term and I think maybe in this
 

1515
00:38:49,780 --> 00:38:54,089
for a term and I think maybe in this
example ya if s if server 1 was down and

1516
00:38:54,089 --> 00:38:54,099
example ya if s if server 1 was down and
 

1517
00:38:54,099 --> 00:38:57,180
example ya if s if server 1 was down and
server 2 and server 3 we're gonna try to

1518
00:38:57,180 --> 00:38:57,190
server 2 and server 3 we're gonna try to
 

1519
00:38:57,190 --> 00:38:59,670
server 2 and server 3 we're gonna try to
elect a new server they need evidence

1520
00:38:59,670 --> 00:38:59,680
elect a new server they need evidence
 

1521
00:38:59,680 --> 00:39:02,130
elect a new server they need evidence
that the correct turn numbers 8 and not

1522
00:39:02,130 --> 00:39:02,140
that the correct turn numbers 8 and not
 

1523
00:39:02,140 --> 00:39:04,980
that the correct turn numbers 8 and not
6 right because if they if they forgot

1524
00:39:04,980 --> 00:39:04,990
6 right because if they if they forgot
 

1525
00:39:04,990 --> 00:39:06,660
6 right because if they if they forgot
about current term and it was just

1526
00:39:06,660 --> 00:39:06,670
about current term and it was just
 

1527
00:39:06,670 --> 00:39:08,309
about current term and it was just
server 2 and server 3 voting for each

1528
00:39:08,309 --> 00:39:08,319
server 2 and server 3 voting for each
 

1529
00:39:08,319 --> 00:39:09,540
server 2 and server 3 voting for each
other and they only had their log to

1530
00:39:09,540 --> 00:39:09,550
other and they only had their log to
 

1531
00:39:09,550 --> 00:39:10,980
other and they only had their log to
look at they might think the next term

1532
00:39:10,980 --> 00:39:10,990
look at they might think the next term
 

1533
00:39:10,990 --> 00:39:12,839
look at they might think the next term
should be term 6 they did that they

1534
00:39:12,839 --> 00:39:12,849
should be term 6 they did that they
 

1535
00:39:12,849 --> 00:39:14,670
should be term 6 they did that they
start producing stuff for term 6 but now

1536
00:39:14,670 --> 00:39:14,680
start producing stuff for term 6 but now
 

1537
00:39:14,680 --> 00:39:16,109
start producing stuff for term 6 but now
there's gonna be a lot of confusion

1538
00:39:16,109 --> 00:39:16,119
there's gonna be a lot of confusion
 

1539
00:39:16,119 --> 00:39:18,710
there's gonna be a lot of confusion
because we have two different term sixes

1540
00:39:18,710 --> 00:39:18,720
because we have two different term sixes
 

1541
00:39:18,720 --> 00:39:21,710
because we have two different term sixes
and so that's the reason my current term

1542
00:39:21,710 --> 00:39:21,720
and so that's the reason my current term
 

1543
00:39:21,720 --> 00:39:24,809
and so that's the reason my current term
has to be persistent to preserve

1544
00:39:24,809 --> 00:39:24,819
has to be persistent to preserve
 

1545
00:39:24,819 --> 00:39:27,569
has to be persistent to preserve
evidence about term numbers that have

1546
00:39:27,569 --> 00:39:27,579
evidence about term numbers that have
 

1547
00:39:27,579 --> 00:39:34,400
evidence about term numbers that have
already been used these have to be

1548
00:39:34,400 --> 00:39:34,410
already been used these have to be
 

1549
00:39:34,410 --> 00:39:38,430
already been used these have to be
persisted pretty much every time you

1550
00:39:38,430 --> 00:39:38,440
persisted pretty much every time you
 

1551
00:39:38,440 --> 00:39:42,630
persisted pretty much every time you
change them right so certainly the safe

1552
00:39:42,630 --> 00:39:42,640
change them right so certainly the safe
 

1553
00:39:42,640 --> 00:39:44,160
change them right so certainly the safe
thing to do is every time you add an

1554
00:39:44,160 --> 00:39:44,170
thing to do is every time you add an
 

1555
00:39:44,170 --> 00:39:46,890
thing to do is every time you add an
entry of log or change current term

1556
00:39:46,890 --> 00:39:46,900
entry of log or change current term
 

1557
00:39:46,900 --> 00:39:51,180
entry of log or change current term
are said voted for you need you probably

1558
00:39:51,180 --> 00:39:51,190
are said voted for you need you probably
 

1559
00:39:51,190 --> 00:39:53,310
are said voted for you need you probably
need to persist that and in a real raft

1560
00:39:53,310 --> 00:39:53,320
need to persist that and in a real raft
 

1561
00:39:53,320 --> 00:39:54,510
need to persist that and in a real raft
server that would mean writing it to the

1562
00:39:54,510 --> 00:39:54,520
server that would mean writing it to the
 

1563
00:39:54,520 --> 00:39:56,310
server that would mean writing it to the
disk so you'd have some set of files

1564
00:39:56,310 --> 00:39:56,320
disk so you'd have some set of files
 

1565
00:39:56,320 --> 00:39:59,220
disk so you'd have some set of files
that recorded this stuff you can

1566
00:39:59,220 --> 00:39:59,230
that recorded this stuff you can
 

1567
00:39:59,230 --> 00:40:01,980
that recorded this stuff you can
probably be a little bit you may be can

1568
00:40:01,980 --> 00:40:01,990
probably be a little bit you may be can
 

1569
00:40:01,990 --> 00:40:04,609
probably be a little bit you may be can
cut some corners if you observed that

1570
00:40:04,609 --> 00:40:04,619
cut some corners if you observed that
 

1571
00:40:04,619 --> 00:40:08,130
cut some corners if you observed that
you don't need to persist these things

1572
00:40:08,130 --> 00:40:08,140
you don't need to persist these things
 

1573
00:40:08,140 --> 00:40:09,720
you don't need to persist these things
until you communicate with the outside

1574
00:40:09,720 --> 00:40:09,730
until you communicate with the outside
 

1575
00:40:09,730 --> 00:40:11,880
until you communicate with the outside
world so there may be some opportunity

1576
00:40:11,880 --> 00:40:11,890
world so there may be some opportunity
 

1577
00:40:11,890 --> 00:40:13,200
world so there may be some opportunity
for a little bit of batching by saying

1578
00:40:13,200 --> 00:40:13,210
for a little bit of batching by saying
 

1579
00:40:13,210 --> 00:40:14,490
for a little bit of batching by saying
well we don't have to persist anything

1580
00:40:14,490 --> 00:40:14,500
well we don't have to persist anything
 

1581
00:40:14,500 --> 00:40:17,220
well we don't have to persist anything
until we're about to reply to an RPC or

1582
00:40:17,220 --> 00:40:17,230
until we're about to reply to an RPC or
 

1583
00:40:17,230 --> 00:40:20,730
until we're about to reply to an RPC or
about to send out an RPC I mean that may

1584
00:40:20,730 --> 00:40:20,740
about to send out an RPC I mean that may
 

1585
00:40:20,740 --> 00:40:23,210
about to send out an RPC I mean that may
allow you to avoid a few persisting x'

1586
00:40:23,210 --> 00:40:23,220
allow you to avoid a few persisting x'
 

1587
00:40:23,220 --> 00:40:27,050
allow you to avoid a few persisting x'
the reason that's important is that

1588
00:40:27,050 --> 00:40:27,060
the reason that's important is that
 

1589
00:40:27,060 --> 00:40:31,170
the reason that's important is that
writing stuff to disk is can be very

1590
00:40:31,170 --> 00:40:31,180
writing stuff to disk is can be very
 

1591
00:40:31,180 --> 00:40:32,609
writing stuff to disk is can be very
expensive it's a if it's a mechanical

1592
00:40:32,609 --> 00:40:32,619
expensive it's a if it's a mechanical
 

1593
00:40:32,619 --> 00:40:34,320
expensive it's a if it's a mechanical
hard drive that we're talking about then

1594
00:40:34,320 --> 00:40:34,330
hard drive that we're talking about then
 

1595
00:40:34,330 --> 00:40:37,020
hard drive that we're talking about then
writing anything you know if the way

1596
00:40:37,020 --> 00:40:37,030
writing anything you know if the way
 

1597
00:40:37,030 --> 00:40:38,640
writing anything you know if the way
we're persisting is writing files on the

1598
00:40:38,640 --> 00:40:38,650
we're persisting is writing files on the
 

1599
00:40:38,650 --> 00:40:41,370
we're persisting is writing files on the
disk writing anything on the disk cost

1600
00:40:41,370 --> 00:40:41,380
disk writing anything on the disk cost
 

1601
00:40:41,380 --> 00:40:43,020
disk writing anything on the disk cost
you about 10 milliseconds because you

1602
00:40:43,020 --> 00:40:43,030
you about 10 milliseconds because you
 

1603
00:40:43,030 --> 00:40:45,260
you about 10 milliseconds because you
either have to wait for the disk to spin

1604
00:40:45,260 --> 00:40:45,270
either have to wait for the disk to spin
 

1605
00:40:45,270 --> 00:40:47,550
either have to wait for the disk to spin
for the point you want to write to spin

1606
00:40:47,550 --> 00:40:47,560
for the point you want to write to spin
 

1607
00:40:47,560 --> 00:40:49,890
for the point you want to write to spin
under the head which disk only rotates

1608
00:40:49,890 --> 00:40:49,900
under the head which disk only rotates
 

1609
00:40:49,900 --> 00:40:51,839
under the head which disk only rotates
about once every 10 milliseconds or

1610
00:40:51,839 --> 00:40:51,849
about once every 10 milliseconds or
 

1611
00:40:51,849 --> 00:40:53,130
about once every 10 milliseconds or
worse that you may actually have to seek

1612
00:40:53,130 --> 00:40:53,140
worse that you may actually have to seek
 

1613
00:40:53,140 --> 00:40:55,680
worse that you may actually have to seek
to move the arm the right track right so

1614
00:40:55,680 --> 00:40:55,690
to move the arm the right track right so
 

1615
00:40:55,690 --> 00:40:58,560
to move the arm the right track right so
these per systems can be terribly

1616
00:40:58,560 --> 00:40:58,570
these per systems can be terribly
 

1617
00:40:58,570 --> 00:41:01,500
these per systems can be terribly
terribly expensive and if for sort of

1618
00:41:01,500 --> 00:41:01,510
terribly expensive and if for sort of
 

1619
00:41:01,510 --> 00:41:03,510
terribly expensive and if for sort of
any kind of straightforward design

1620
00:41:03,510 --> 00:41:03,520
any kind of straightforward design
 

1621
00:41:03,520 --> 00:41:06,210
any kind of straightforward design
they're likely to be the limiting factor

1622
00:41:06,210 --> 00:41:06,220
they're likely to be the limiting factor
 

1623
00:41:06,220 --> 00:41:09,079
they're likely to be the limiting factor
in performance because they mean that

1624
00:41:09,079 --> 00:41:09,089
in performance because they mean that
 

1625
00:41:09,089 --> 00:41:13,680
in performance because they mean that
doing anything anything whatsoever on

1626
00:41:13,680 --> 00:41:13,690
doing anything anything whatsoever on
 

1627
00:41:13,690 --> 00:41:15,329
doing anything anything whatsoever on
these graph servers takes ten

1628
00:41:15,329 --> 00:41:15,339
these graph servers takes ten
 

1629
00:41:15,339 --> 00:41:18,570
these graph servers takes ten
milliseconds a pop and 10 milliseconds

1630
00:41:18,570 --> 00:41:18,580
milliseconds a pop and 10 milliseconds
 

1631
00:41:18,580 --> 00:41:20,400
milliseconds a pop and 10 milliseconds
as far longer than it takes to say send

1632
00:41:20,400 --> 00:41:20,410
as far longer than it takes to say send
 

1633
00:41:20,410 --> 00:41:23,310
as far longer than it takes to say send
an RPC or almost anything else you might

1634
00:41:23,310 --> 00:41:23,320
an RPC or almost anything else you might
 

1635
00:41:23,320 --> 00:41:26,160
an RPC or almost anything else you might
do 10 milliseconds each means you can

1636
00:41:26,160 --> 00:41:26,170
do 10 milliseconds each means you can
 

1637
00:41:26,170 --> 00:41:29,599
do 10 milliseconds each means you can
just never if you persist data to a

1638
00:41:29,599 --> 00:41:29,609
just never if you persist data to a
 

1639
00:41:29,609 --> 00:41:31,859
just never if you persist data to a
mechanical drive you just can never

1640
00:41:31,859 --> 00:41:31,869
mechanical drive you just can never
 

1641
00:41:31,869 --> 00:41:33,390
mechanical drive you just can never
build a raft service it can serve more

1642
00:41:33,390 --> 00:41:33,400
build a raft service it can serve more
 

1643
00:41:33,400 --> 00:41:37,320
build a raft service it can serve more
than 100 requests per second because

1644
00:41:37,320 --> 00:41:37,330
than 100 requests per second because
 

1645
00:41:37,330 --> 00:41:38,520
than 100 requests per second because
that's what you get it at 10

1646
00:41:38,520 --> 00:41:38,530
that's what you get it at 10
 

1647
00:41:38,530 --> 00:41:41,609
that's what you get it at 10
milliseconds per operation and you know

1648
00:41:41,609 --> 00:41:41,619
milliseconds per operation and you know
 

1649
00:41:41,619 --> 00:41:44,760
milliseconds per operation and you know
this is this cost so this is really all

1650
00:41:44,760 --> 00:41:44,770
this is this cost so this is really all
 

1651
00:41:44,770 --> 00:41:49,910
this is this cost so this is really all
about cost of synchronous

1652
00:41:49,910 --> 00:41:49,920

 

1653
00:41:49,920 --> 00:41:58,080

just updates and it comes up in many

1654
00:41:58,080 --> 00:41:58,090
just updates and it comes up in many
 

1655
00:41:58,090 --> 00:41:59,520
just updates and it comes up in many
systems like file systems the file

1656
00:41:59,520 --> 00:41:59,530
systems like file systems the file
 

1657
00:41:59,530 --> 00:42:00,960
systems like file systems the file
systems that are running in your laptops

1658
00:42:00,960 --> 00:42:00,970
systems that are running in your laptops
 

1659
00:42:00,970 --> 00:42:03,270
systems that are running in your laptops
are that the designers spend a huge

1660
00:42:03,270 --> 00:42:03,280
are that the designers spend a huge
 

1661
00:42:03,280 --> 00:42:05,160
are that the designers spend a huge
amount of time sort of trying to

1662
00:42:05,160 --> 00:42:05,170
amount of time sort of trying to
 

1663
00:42:05,170 --> 00:42:07,110
amount of time sort of trying to
navigate around the performance problems

1664
00:42:07,110 --> 00:42:07,120
navigate around the performance problems
 

1665
00:42:07,120 --> 00:42:09,030
navigate around the performance problems
of synchronous disk up they think of as

1666
00:42:09,030 --> 00:42:09,040
of synchronous disk up they think of as
 

1667
00:42:09,040 --> 00:42:10,950
of synchronous disk up they think of as
disk writes because in order for stuff

1668
00:42:10,950 --> 00:42:10,960
disk writes because in order for stuff
 

1669
00:42:10,960 --> 00:42:12,360
disk writes because in order for stuff
to get safe on your disk in order to

1670
00:42:12,360 --> 00:42:12,370
to get safe on your disk in order to
 

1671
00:42:12,370 --> 00:42:14,190
to get safe on your disk in order to
update the file system on your laptop's

1672
00:42:14,190 --> 00:42:14,200
update the file system on your laptop's
 

1673
00:42:14,200 --> 00:42:18,420
update the file system on your laptop's
disk safely there turns out the file

1674
00:42:18,420 --> 00:42:18,430
disk safely there turns out the file
 

1675
00:42:18,430 --> 00:42:20,610
disk safely there turns out the file
system has to like be careful about how

1676
00:42:20,610 --> 00:42:20,620
system has to like be careful about how
 

1677
00:42:20,620 --> 00:42:22,830
system has to like be careful about how
it writes and needs to sometimes wait

1678
00:42:22,830 --> 00:42:22,840
it writes and needs to sometimes wait
 

1679
00:42:22,840 --> 00:42:25,410
it writes and needs to sometimes wait
for the disk to finish writing so this

1680
00:42:25,410 --> 00:42:25,420
for the disk to finish writing so this
 

1681
00:42:25,420 --> 00:42:27,870
for the disk to finish writing so this
is a like a cross-cutting issue in all

1682
00:42:27,870 --> 00:42:27,880
is a like a cross-cutting issue in all
 

1683
00:42:27,880 --> 00:42:29,730
is a like a cross-cutting issue in all
kinds of systems certainly comes up in

1684
00:42:29,730 --> 00:42:29,740
kinds of systems certainly comes up in
 

1685
00:42:29,740 --> 00:42:33,690
kinds of systems certainly comes up in
draft if you want it to build a system

1686
00:42:33,690 --> 00:42:33,700
draft if you want it to build a system
 

1687
00:42:33,700 --> 00:42:34,890
draft if you want it to build a system
they could serve more than a hundred

1688
00:42:34,890 --> 00:42:34,900
they could serve more than a hundred
 

1689
00:42:34,900 --> 00:42:38,820
they could serve more than a hundred
quests per second then there's a bunch

1690
00:42:38,820 --> 00:42:38,830
quests per second then there's a bunch
 

1691
00:42:38,830 --> 00:42:39,930
quests per second then there's a bunch
of options one is you can use a

1692
00:42:39,930 --> 00:42:39,940
of options one is you can use a
 

1693
00:42:39,940 --> 00:42:41,760
of options one is you can use a
solid-state drive or some kind of flash

1694
00:42:41,760 --> 00:42:41,770
solid-state drive or some kind of flash
 

1695
00:42:41,770 --> 00:42:44,310
solid-state drive or some kind of flash
or something solid eight drives can do a

1696
00:42:44,310 --> 00:42:44,320
or something solid eight drives can do a
 

1697
00:42:44,320 --> 00:42:50,520
or something solid eight drives can do a
write to the flash memory in maybe a

1698
00:42:50,520 --> 00:42:50,530
write to the flash memory in maybe a
 

1699
00:42:50,530 --> 00:42:52,590
write to the flash memory in maybe a
tenth of a millisecond so that's a

1700
00:42:52,590 --> 00:42:52,600
tenth of a millisecond so that's a
 

1701
00:42:52,600 --> 00:42:55,470
tenth of a millisecond so that's a
factor of a hundred for you or if you're

1702
00:42:55,470 --> 00:42:55,480
factor of a hundred for you or if you're
 

1703
00:42:55,480 --> 00:42:57,720
factor of a hundred for you or if you're
even more sophisticated maybe you can

1704
00:42:57,720 --> 00:42:57,730
even more sophisticated maybe you can
 

1705
00:42:57,730 --> 00:43:02,190
even more sophisticated maybe you can
build yourself battery backed DRAM and

1706
00:43:02,190 --> 00:43:02,200
build yourself battery backed DRAM and
 

1707
00:43:02,200 --> 00:43:03,810
build yourself battery backed DRAM and
do the persistence into battery back

1708
00:43:03,810 --> 00:43:03,820
do the persistence into battery back
 

1709
00:43:03,820 --> 00:43:07,260
do the persistence into battery back
DRAM and then if the server reboots hope

1710
00:43:07,260 --> 00:43:07,270
DRAM and then if the server reboots hope
 

1711
00:43:07,270 --> 00:43:11,010
DRAM and then if the server reboots hope
that reboot was took shorter than the

1712
00:43:11,010 --> 00:43:11,020
that reboot was took shorter than the
 

1713
00:43:11,020 --> 00:43:12,420
that reboot was took shorter than the
amount of time the battery lasts and

1714
00:43:12,420 --> 00:43:12,430
amount of time the battery lasts and
 

1715
00:43:12,430 --> 00:43:14,550
amount of time the battery lasts and
that this stuff you persisted is still

1716
00:43:14,550 --> 00:43:14,560
that this stuff you persisted is still
 

1717
00:43:14,560 --> 00:43:17,760
that this stuff you persisted is still
in the RAM and the reason I mean if you

1718
00:43:17,760 --> 00:43:17,770
in the RAM and the reason I mean if you
 

1719
00:43:17,770 --> 00:43:19,410
in the RAM and the reason I mean if you
have money and sophistication the reason

1720
00:43:19,410 --> 00:43:19,420
have money and sophistication the reason
 

1721
00:43:19,420 --> 00:43:21,390
have money and sophistication the reason
to favor that is you can write DRAM you

1722
00:43:21,390 --> 00:43:21,400
to favor that is you can write DRAM you
 

1723
00:43:21,400 --> 00:43:23,220
to favor that is you can write DRAM you
know millions of times per second and so

1724
00:43:23,220 --> 00:43:23,230
know millions of times per second and so
 

1725
00:43:23,230 --> 00:43:24,590
know millions of times per second and so
it's probably not going to be a

1726
00:43:24,590 --> 00:43:24,600
it's probably not going to be a
 

1727
00:43:24,600 --> 00:43:28,590
it's probably not going to be a
performance bottleneck anyway so that

1728
00:43:28,590 --> 00:43:28,600
performance bottleneck anyway so that
 

1729
00:43:28,600 --> 00:43:33,360
performance bottleneck anyway so that
this problem is why and it's sort of

1730
00:43:33,360 --> 00:43:33,370
this problem is why and it's sort of
 

1731
00:43:33,370 --> 00:43:35,220
this problem is why and it's sort of
marking a persistent versus volatile and

1732
00:43:35,220 --> 00:43:35,230
marking a persistent versus volatile and
 

1733
00:43:35,230 --> 00:43:36,870
marking a persistent versus volatile and
figure 2 is like has a lot of

1734
00:43:36,870 --> 00:43:36,880
figure 2 is like has a lot of
 

1735
00:43:36,880 --> 00:43:38,900
figure 2 is like has a lot of
significance for performance as well as

1736
00:43:38,900 --> 00:43:38,910
significance for performance as well as
 

1737
00:43:38,910 --> 00:43:43,680
significance for performance as well as
crash recovery and correctness any

1738
00:43:43,680 --> 00:43:43,690
crash recovery and correctness any
 

1739
00:43:43,690 --> 00:43:55,560
crash recovery and correctness any
questions about persisting yeah

1740
00:43:55,560 --> 00:43:55,570

 

1741
00:43:55,570 --> 00:44:08,230

yes alright so your question is

1742
00:44:08,230 --> 00:44:08,240
yes alright so your question is
 

1743
00:44:08,240 --> 00:44:10,330
yes alright so your question is
basically you're writing code say go

1744
00:44:10,330 --> 00:44:10,340
basically you're writing code say go
 

1745
00:44:10,340 --> 00:44:12,400
basically you're writing code say go
code for your raft implementation or

1746
00:44:12,400 --> 00:44:12,410
code for your raft implementation or
 

1747
00:44:12,410 --> 00:44:13,510
code for your raft implementation or
you're trying to write a real rafterman

1748
00:44:13,510 --> 00:44:13,520
you're trying to write a real rafterman
 

1749
00:44:13,520 --> 00:44:15,190
you're trying to write a real rafterman
implementation and you actually want to

1750
00:44:15,190 --> 00:44:15,200
implementation and you actually want to
 

1751
00:44:15,200 --> 00:44:18,490
implementation and you actually want to
make sure that when you persist your an

1752
00:44:18,490 --> 00:44:18,500
make sure that when you persist your an
 

1753
00:44:18,500 --> 00:44:20,170
make sure that when you persist your an
update to the law or the current term or

1754
00:44:20,170 --> 00:44:20,180
update to the law or the current term or
 

1755
00:44:20,180 --> 00:44:21,790
update to the law or the current term or
whatever that it in fact will be there

1756
00:44:21,790 --> 00:44:21,800
whatever that it in fact will be there
 

1757
00:44:21,800 --> 00:44:23,860
whatever that it in fact will be there
after a crash and reboot like what's the

1758
00:44:23,860 --> 00:44:23,870
after a crash and reboot like what's the
 

1759
00:44:23,870 --> 00:44:26,290
after a crash and reboot like what's the
recipe for what you have to do to make

1760
00:44:26,290 --> 00:44:26,300
recipe for what you have to do to make
 

1761
00:44:26,300 --> 00:44:28,000
recipe for what you have to do to make
sure it's there and your observation

1762
00:44:28,000 --> 00:44:28,010
sure it's there and your observation
 

1763
00:44:28,010 --> 00:44:31,030
sure it's there and your observation
that if you call you know on a UNIX or

1764
00:44:31,030 --> 00:44:31,040
that if you call you know on a UNIX or
 

1765
00:44:31,040 --> 00:44:34,440
that if you call you know on a UNIX or
Linux or whatever Mac if you call right

1766
00:44:34,440 --> 00:44:34,450
Linux or whatever Mac if you call right
 

1767
00:44:34,450 --> 00:44:36,970
Linux or whatever Mac if you call right
you know the right system call is how

1768
00:44:36,970 --> 00:44:36,980
you know the right system call is how
 

1769
00:44:36,980 --> 00:44:38,500
you know the right system call is how
you write to a disk file you simply call

1770
00:44:38,500 --> 00:44:38,510
you write to a disk file you simply call
 

1771
00:44:38,510 --> 00:44:41,320
you write to a disk file you simply call
right as you pointed out it is not the

1772
00:44:41,320 --> 00:44:41,330
right as you pointed out it is not the
 

1773
00:44:41,330 --> 00:44:43,660
right as you pointed out it is not the
case that after the write returns the

1774
00:44:43,660 --> 00:44:43,670
case that after the write returns the
 

1775
00:44:43,670 --> 00:44:45,790
case that after the write returns the
data is safe on disk and will survive a

1776
00:44:45,790 --> 00:44:45,800
data is safe on disk and will survive a
 

1777
00:44:45,800 --> 00:44:48,640
data is safe on disk and will survive a
reboot it almost certainly isn't almost

1778
00:44:48,640 --> 00:44:48,650
reboot it almost certainly isn't almost
 

1779
00:44:48,650 --> 00:44:51,190
reboot it almost certainly isn't almost
certainly not on disk so the you know

1780
00:44:51,190 --> 00:44:51,200
certainly not on disk so the you know
 

1781
00:44:51,200 --> 00:44:53,470
certainly not on disk so the you know
the particular piece of magic you need

1782
00:44:53,470 --> 00:44:53,480
the particular piece of magic you need
 

1783
00:44:53,480 --> 00:44:56,200
the particular piece of magic you need
to do is on unix at any rate you need

1784
00:44:56,200 --> 00:44:56,210
to do is on unix at any rate you need
 

1785
00:44:56,210 --> 00:44:58,500
to do is on unix at any rate you need
you need to call right so you cannot

1786
00:44:58,500 --> 00:44:58,510
you need to call right so you cannot
 

1787
00:44:58,510 --> 00:45:01,330
you need to call right so you cannot
write some file you've opened that's

1788
00:45:01,330 --> 00:45:01,340
write some file you've opened that's
 

1789
00:45:01,340 --> 00:45:02,710
write some file you've opened that's
going to contain the stuff that you want

1790
00:45:02,710 --> 00:45:02,720
going to contain the stuff that you want
 

1791
00:45:02,720 --> 00:45:06,280
going to contain the stuff that you want
to write and then you got a call this F

1792
00:45:06,280 --> 00:45:06,290
to write and then you got a call this F
 

1793
00:45:06,290 --> 00:45:09,700
to write and then you got a call this F
st. call which on most systems the

1794
00:45:09,700 --> 00:45:09,710
st. call which on most systems the
 

1795
00:45:09,710 --> 00:45:12,000
st. call which on most systems the
guarantee is that F sync doesn't return

1796
00:45:12,000 --> 00:45:12,010
guarantee is that F sync doesn't return
 

1797
00:45:12,010 --> 00:45:15,340
guarantee is that F sync doesn't return
until all the data you've previously

1798
00:45:15,340 --> 00:45:15,350
until all the data you've previously
 

1799
00:45:15,350 --> 00:45:18,130
until all the data you've previously
written into this file is safely on the

1800
00:45:18,130 --> 00:45:18,140
written into this file is safely on the
 

1801
00:45:18,140 --> 00:45:22,120
written into this file is safely on the
surface on the media in a place on a

1802
00:45:22,120 --> 00:45:22,130
surface on the media in a place on a
 

1803
00:45:22,130 --> 00:45:23,770
surface on the media in a place on a
place where it will still be there if

1804
00:45:23,770 --> 00:45:23,780
place where it will still be there if
 

1805
00:45:23,780 --> 00:45:26,920
place where it will still be there if
there's a crash so so this thing is some

1806
00:45:26,920 --> 00:45:26,930
there's a crash so so this thing is some
 

1807
00:45:26,930 --> 00:45:29,020
there's a crash so so this thing is some
then this call is an expensive call and

1808
00:45:29,020 --> 00:45:29,030
then this call is an expensive call and
 

1809
00:45:29,030 --> 00:45:30,610
then this call is an expensive call and
that's why it's a separate that's why

1810
00:45:30,610 --> 00:45:30,620
that's why it's a separate that's why
 

1811
00:45:30,620 --> 00:45:33,490
that's why it's a separate that's why
Wright doesn't write the disk only F

1812
00:45:33,490 --> 00:45:33,500
Wright doesn't write the disk only F
 

1813
00:45:33,500 --> 00:45:35,410
Wright doesn't write the disk only F
sync does is because it's so expensive

1814
00:45:35,410 --> 00:45:35,420
sync does is because it's so expensive
 

1815
00:45:35,420 --> 00:45:37,000
sync does is because it's so expensive
you would never want to do it unless you

1816
00:45:37,000 --> 00:45:37,010
you would never want to do it unless you
 

1817
00:45:37,010 --> 00:45:40,450
you would never want to do it unless you
really wanted to persist some stuff some

1818
00:45:40,450 --> 00:45:40,460
really wanted to persist some stuff some
 

1819
00:45:40,460 --> 00:45:46,270
really wanted to persist some stuff some
data okay so you can use more expensive

1820
00:45:46,270 --> 00:45:46,280
data okay so you can use more expensive
 

1821
00:45:46,280 --> 00:45:47,920
data okay so you can use more expensive
disk hardware the other trick people

1822
00:45:47,920 --> 00:45:47,930
disk hardware the other trick people
 

1823
00:45:47,930 --> 00:45:51,400
disk hardware the other trick people
play a lot is to try to batch that is if

1824
00:45:51,400 --> 00:45:51,410
play a lot is to try to batch that is if
 

1825
00:45:51,410 --> 00:45:53,800
play a lot is to try to batch that is if
you can if client requests are if you

1826
00:45:53,800 --> 00:45:53,810
you can if client requests are if you
 

1827
00:45:53,810 --> 00:45:55,360
you can if client requests are if you
have a lot of client requests coming in

1828
00:45:55,360 --> 00:45:55,370
have a lot of client requests coming in
 

1829
00:45:55,370 --> 00:45:57,400
have a lot of client requests coming in
maybe you should accept a lot of them

1830
00:45:57,400 --> 00:45:57,410
maybe you should accept a lot of them
 

1831
00:45:57,410 --> 00:45:59,200
maybe you should accept a lot of them
and not reply to any of them for a

1832
00:45:59,200 --> 00:45:59,210
and not reply to any of them for a
 

1833
00:45:59,210 --> 00:46:00,850
and not reply to any of them for a
little bit we call a lot of them

1834
00:46:00,850 --> 00:46:00,860
little bit we call a lot of them
 

1835
00:46:00,860 --> 00:46:01,630
little bit we call a lot of them
accumulate

1836
00:46:01,630 --> 00:46:01,640
accumulate
 

1837
00:46:01,640 --> 00:46:04,990
accumulate
and then persist you know a hundred log

1838
00:46:04,990 --> 00:46:05,000
and then persist you know a hundred log
 

1839
00:46:05,000 --> 00:46:07,600
and then persist you know a hundred log
entries at a time from your hundred

1840
00:46:07,600 --> 00:46:07,610
entries at a time from your hundred
 

1841
00:46:07,610 --> 00:46:09,790
entries at a time from your hundred
clients and you know only then send out

1842
00:46:09,790 --> 00:46:09,800
clients and you know only then send out
 

1843
00:46:09,800 --> 00:46:12,310
clients and you know only then send out
the append entries good because you do

1844
00:46:12,310 --> 00:46:12,320
the append entries good because you do
 

1845
00:46:12,320 --> 00:46:13,540
the append entries good because you do
actually have to persist this stuff to

1846
00:46:13,540 --> 00:46:13,550
actually have to persist this stuff to
 

1847
00:46:13,550 --> 00:46:16,120
actually have to persist this stuff to
disk if you receive a client request you

1848
00:46:16,120 --> 00:46:16,130
disk if you receive a client request you
 

1849
00:46:16,130 --> 00:46:17,590
disk if you receive a client request you
have to persist the new entry to disk

1850
00:46:17,590 --> 00:46:17,600
have to persist the new entry to disk
 

1851
00:46:17,600 --> 00:46:20,320
have to persist the new entry to disk
before you send the append entries our

1852
00:46:20,320 --> 00:46:20,330
before you send the append entries our
 

1853
00:46:20,330 --> 00:46:24,910
before you send the append entries our
PCs the followers because you're not

1854
00:46:24,910 --> 00:46:24,920
PCs the followers because you're not
 

1855
00:46:24,920 --> 00:46:26,680
PCs the followers because you're not
allowed if the leader you know the

1856
00:46:26,680 --> 00:46:26,690
allowed if the leader you know the
 

1857
00:46:26,690 --> 00:46:29,410
allowed if the leader you know the
leader it's essentially promising to

1858
00:46:29,410 --> 00:46:29,420
leader it's essentially promising to
 

1859
00:46:29,420 --> 00:46:34,390
leader it's essentially promising to
commit that that request and can't

1860
00:46:34,390 --> 00:46:34,400
commit that that request and can't
 

1861
00:46:34,400 --> 00:46:35,140
commit that that request and can't
forget about it

1862
00:46:35,140 --> 00:46:35,150
forget about it
 

1863
00:46:35,150 --> 00:46:37,480
forget about it
and indeed the followers have to persist

1864
00:46:37,480 --> 00:46:37,490
and indeed the followers have to persist
 

1865
00:46:37,490 --> 00:46:39,250
and indeed the followers have to persist
the new log entry to their disk before

1866
00:46:39,250 --> 00:46:39,260
the new log entry to their disk before
 

1867
00:46:39,260 --> 00:46:40,870
the new log entry to their disk before
they reply to the append entries because

1868
00:46:40,870 --> 00:46:40,880
they reply to the append entries because
 

1869
00:46:40,880 --> 00:46:42,160
they reply to the append entries because
they were apply to the append entries

1870
00:46:42,160 --> 00:46:42,170
they were apply to the append entries
 

1871
00:46:42,170 --> 00:46:45,100
they were apply to the append entries
it's also a promise to preserve and

1872
00:46:45,100 --> 00:46:45,110
it's also a promise to preserve and
 

1873
00:46:45,110 --> 00:46:46,960
it's also a promise to preserve and
eventually commit that log entry so they

1874
00:46:46,960 --> 00:46:46,970
eventually commit that log entry so they
 

1875
00:46:46,970 --> 00:46:48,610
eventually commit that log entry so they
can't be allowed to forget about it if

1876
00:46:48,610 --> 00:46:48,620
can't be allowed to forget about it if
 

1877
00:46:48,620 --> 00:46:51,940
can't be allowed to forget about it if
they crash other questions about

1878
00:46:51,940 --> 00:46:51,950
they crash other questions about
 

1879
00:46:51,950 --> 00:47:01,420
they crash other questions about
persistence all right well final you

1880
00:47:01,420 --> 00:47:01,430
persistence all right well final you
 

1881
00:47:01,430 --> 00:47:02,770
persistence all right well final you
know a little detail about persistence

1882
00:47:02,770 --> 00:47:02,780
know a little detail about persistence
 

1883
00:47:02,780 --> 00:47:09,610
know a little detail about persistence
is that some of the stuff in figure two

1884
00:47:09,610 --> 00:47:09,620
is that some of the stuff in figure two
 

1885
00:47:09,620 --> 00:47:11,290
is that some of the stuff in figure two
is not persistent and so it's worth

1886
00:47:11,290 --> 00:47:11,300
is not persistent and so it's worth
 

1887
00:47:11,300 --> 00:47:12,760
is not persistent and so it's worth
scratching your head a little bit about

1888
00:47:12,760 --> 00:47:12,770
scratching your head a little bit about
 

1889
00:47:12,770 --> 00:47:15,280
scratching your head a little bit about
why commit index lasts apply next index

1890
00:47:15,280 --> 00:47:15,290
why commit index lasts apply next index
 

1891
00:47:15,290 --> 00:47:17,230
why commit index lasts apply next index
and match index why it's fair game for

1892
00:47:17,230 --> 00:47:17,240
and match index why it's fair game for
 

1893
00:47:17,240 --> 00:47:19,630
and match index why it's fair game for
them to be simply thrown away if the

1894
00:47:19,630 --> 00:47:19,640
them to be simply thrown away if the
 

1895
00:47:19,640 --> 00:47:22,000
them to be simply thrown away if the
server crashes and restarts like why

1896
00:47:22,000 --> 00:47:22,010
server crashes and restarts like why
 

1897
00:47:22,010 --> 00:47:24,850
server crashes and restarts like why
wasn't you know commit index or last

1898
00:47:24,850 --> 00:47:24,860
wasn't you know commit index or last
 

1899
00:47:24,860 --> 00:47:26,500
wasn't you know commit index or last
apply it like geez last applied is the

1900
00:47:26,500 --> 00:47:26,510
apply it like geez last applied is the
 

1901
00:47:26,510 --> 00:47:29,350
apply it like geez last applied is the
record of how much we've executed right

1902
00:47:29,350 --> 00:47:29,360
record of how much we've executed right
 

1903
00:47:29,360 --> 00:47:30,430
record of how much we've executed right
if we throw that away aren't we gonna

1904
00:47:30,430 --> 00:47:30,440
if we throw that away aren't we gonna
 

1905
00:47:30,440 --> 00:47:32,170
if we throw that away aren't we gonna
execute log entries twice and is that

1906
00:47:32,170 --> 00:47:32,180
execute log entries twice and is that
 

1907
00:47:32,180 --> 00:47:35,680
execute log entries twice and is that
correct how about that why is why is it

1908
00:47:35,680 --> 00:47:35,690
correct how about that why is why is it
 

1909
00:47:35,690 --> 00:47:46,670
correct how about that why is why is it
safe to throw away last applied

1910
00:47:46,670 --> 00:47:46,680

 

1911
00:47:46,680 --> 00:47:55,620

yes I am we're all about simplicity and

1912
00:47:55,620 --> 00:47:55,630
yes I am we're all about simplicity and
 

1913
00:47:55,630 --> 00:47:58,140
yes I am we're all about simplicity and
safety here with raft so that's exactly

1914
00:47:58,140 --> 00:47:58,150
safety here with raft so that's exactly
 

1915
00:47:58,150 --> 00:48:02,310
safety here with raft so that's exactly
correct the the reason why all that

1916
00:48:02,310 --> 00:48:02,320
correct the the reason why all that
 

1917
00:48:02,320 --> 00:48:04,230
correct the the reason why all that
other stuff can be non-volatile as you

1918
00:48:04,230 --> 00:48:04,240
other stuff can be non-volatile as you
 

1919
00:48:04,240 --> 00:48:06,870
other stuff can be non-volatile as you
mentioned I mean sorry volatile the

1920
00:48:06,870 --> 00:48:06,880
mentioned I mean sorry volatile the
 

1921
00:48:06,880 --> 00:48:07,920
mentioned I mean sorry volatile the
reason why those other fields can be

1922
00:48:07,920 --> 00:48:07,930
reason why those other fields can be
 

1923
00:48:07,930 --> 00:48:10,350
reason why those other fields can be
volatile and thrown away is that we can

1924
00:48:10,350 --> 00:48:10,360
volatile and thrown away is that we can
 

1925
00:48:10,360 --> 00:48:12,570
volatile and thrown away is that we can
the leader can reconstruct sort of

1926
00:48:12,570 --> 00:48:12,580
the leader can reconstruct sort of
 

1927
00:48:12,580 --> 00:48:15,330
the leader can reconstruct sort of
what's been committed by inspecting its

1928
00:48:15,330 --> 00:48:15,340
what's been committed by inspecting its
 

1929
00:48:15,340 --> 00:48:17,640
what's been committed by inspecting its
own log and by the results of append

1930
00:48:17,640 --> 00:48:17,650
own log and by the results of append
 

1931
00:48:17,650 --> 00:48:19,080
own log and by the results of append
entries that it sends out to the

1932
00:48:19,080 --> 00:48:19,090
entries that it sends out to the
 

1933
00:48:19,090 --> 00:48:20,670
entries that it sends out to the
followers I mean initially the leader if

1934
00:48:20,670 --> 00:48:20,680
followers I mean initially the leader if
 

1935
00:48:20,680 --> 00:48:22,290
followers I mean initially the leader if
it if everybody restarts because they

1936
00:48:22,290 --> 00:48:22,300
it if everybody restarts because they
 

1937
00:48:22,300 --> 00:48:23,310
it if everybody restarts because they
experienced a power failure

1938
00:48:23,310 --> 00:48:23,320
experienced a power failure
 

1939
00:48:23,320 --> 00:48:24,930
experienced a power failure
initially the leader does not know

1940
00:48:24,930 --> 00:48:24,940
initially the leader does not know
 

1941
00:48:24,940 --> 00:48:27,870
initially the leader does not know
what's committed what's executed but

1942
00:48:27,870 --> 00:48:27,880
what's committed what's executed but
 

1943
00:48:27,880 --> 00:48:29,670
what's committed what's executed but
when it sends out log and append entries

1944
00:48:29,670 --> 00:48:29,680
when it sends out log and append entries
 

1945
00:48:29,680 --> 00:48:31,200
when it sends out log and append entries
it'll sort of gather back information

1946
00:48:31,200 --> 00:48:31,210
it'll sort of gather back information
 

1947
00:48:31,210 --> 00:48:32,760
it'll sort of gather back information
and essentially from the followers about

1948
00:48:32,760 --> 00:48:32,770
and essentially from the followers about
 

1949
00:48:32,770 --> 00:48:34,770
and essentially from the followers about
What's in how much of their logs match

1950
00:48:34,770 --> 00:48:34,780
What's in how much of their logs match
 

1951
00:48:34,780 --> 00:48:36,360
What's in how much of their logs match
the leaders and therefore how much must

1952
00:48:36,360 --> 00:48:36,370
the leaders and therefore how much must
 

1953
00:48:36,370 --> 00:48:38,060
the leaders and therefore how much must
have been committed before the crash

1954
00:48:38,060 --> 00:48:38,070
have been committed before the crash
 

1955
00:48:38,070 --> 00:48:41,940
have been committed before the crash
another thing in the 4-2 world which is

1956
00:48:41,940 --> 00:48:41,950
another thing in the 4-2 world which is
 

1957
00:48:41,950 --> 00:48:43,140
another thing in the 4-2 world which is
not the real world

1958
00:48:43,140 --> 00:48:43,150
not the real world
 

1959
00:48:43,150 --> 00:48:45,120
not the real world
another thing about figure two is that

1960
00:48:45,120 --> 00:48:45,130
another thing about figure two is that
 

1961
00:48:45,130 --> 00:48:47,760
another thing about figure two is that
figure two assumes that the application

1962
00:48:47,760 --> 00:48:47,770
figure two assumes that the application
 

1963
00:48:47,770 --> 00:48:51,570
figure two assumes that the application
state is destroyed and thrown away if

1964
00:48:51,570 --> 00:48:51,580
state is destroyed and thrown away if
 

1965
00:48:51,580 --> 00:48:54,300
state is destroyed and thrown away if
there's a crash in a restart so the

1966
00:48:54,300 --> 00:48:54,310
there's a crash in a restart so the
 

1967
00:48:54,310 --> 00:48:55,890
there's a crash in a restart so the
figure two world assumes that while log

1968
00:48:55,890 --> 00:48:55,900
figure two world assumes that while log
 

1969
00:48:55,900 --> 00:48:57,540
figure two world assumes that while log
is persistent that the application state

1970
00:48:57,540 --> 00:48:57,550
is persistent that the application state
 

1971
00:48:57,550 --> 00:49:00,090
is persistent that the application state
is absolutely not persistent required

1972
00:49:00,090 --> 00:49:00,100
is absolutely not persistent required
 

1973
00:49:00,100 --> 00:49:04,190
is absolutely not persistent required
not to be consistent in figure 2 because

1974
00:49:04,190 --> 00:49:04,200
not to be consistent in figure 2 because
 

1975
00:49:04,200 --> 00:49:07,380
not to be consistent in figure 2 because
the in figure 2 the log is preserved

1976
00:49:07,380 --> 00:49:07,390
the in figure 2 the log is preserved
 

1977
00:49:07,390 --> 00:49:10,020
the in figure 2 the log is preserved
persisted from the very beginning of the

1978
00:49:10,020 --> 00:49:10,030
persisted from the very beginning of the
 

1979
00:49:10,030 --> 00:49:12,990
persisted from the very beginning of the
system and so what's going to happen if

1980
00:49:12,990 --> 00:49:13,000
system and so what's going to happen if
 

1981
00:49:13,000 --> 00:49:15,630
system and so what's going to happen if
you sort of play out what the various

1982
00:49:15,630 --> 00:49:15,640
you sort of play out what the various
 

1983
00:49:15,640 --> 00:49:18,450
you sort of play out what the various
rules in figure 2 after a leader restart

1984
00:49:18,450 --> 00:49:18,460
rules in figure 2 after a leader restart
 

1985
00:49:18,460 --> 00:49:21,120
rules in figure 2 after a leader restart
is that the leader will eventually re

1986
00:49:21,120 --> 00:49:21,130
is that the leader will eventually re
 

1987
00:49:21,130 --> 00:49:24,000
is that the leader will eventually re
execute every single log entry that is

1988
00:49:24,000 --> 00:49:24,010
execute every single log entry that is
 

1989
00:49:24,010 --> 00:49:26,490
execute every single log entry that is
handed to the application you know

1990
00:49:26,490 --> 00:49:26,500
handed to the application you know
 

1991
00:49:26,500 --> 00:49:28,590
handed to the application you know
starting with log entry one after a

1992
00:49:28,590 --> 00:49:28,600
starting with log entry one after a
 

1993
00:49:28,600 --> 00:49:31,410
starting with log entry one after a
reboot it's the raft is gonna hand the

1994
00:49:31,410 --> 00:49:31,420
reboot it's the raft is gonna hand the
 

1995
00:49:31,420 --> 00:49:33,330
reboot it's the raft is gonna hand the
application every log entry starting

1996
00:49:33,330 --> 00:49:33,340
application every log entry starting
 

1997
00:49:33,340 --> 00:49:34,830
application every log entry starting
from one and so that will after a

1998
00:49:34,830 --> 00:49:34,840
from one and so that will after a
 

1999
00:49:34,840 --> 00:49:36,780
from one and so that will after a
restart the application will completely

2000
00:49:36,780 --> 00:49:36,790
restart the application will completely
 

2001
00:49:36,790 --> 00:49:39,630
restart the application will completely
reconstruct its state from scratch by a

2002
00:49:39,630 --> 00:49:39,640
reconstruct its state from scratch by a
 

2003
00:49:39,640 --> 00:49:41,880
reconstruct its state from scratch by a
replay from the beginning of the time of

2004
00:49:41,880 --> 00:49:41,890
replay from the beginning of the time of
 

2005
00:49:41,890 --> 00:49:45,420
replay from the beginning of the time of
the entire log after each restart and

2006
00:49:45,420 --> 00:49:45,430
the entire log after each restart and
 

2007
00:49:45,430 --> 00:49:46,350
the entire log after each restart and
again that's like a sort of

2008
00:49:46,350 --> 00:49:46,360
again that's like a sort of
 

2009
00:49:46,360 --> 00:49:49,380
again that's like a sort of
straightforward elegant plan but

2010
00:49:49,380 --> 00:49:49,390
straightforward elegant plan but
 

2011
00:49:49,390 --> 00:49:56,109
straightforward elegant plan but
obviously potentially very slow

2012
00:49:56,109 --> 00:49:56,119

 

2013
00:49:56,119 --> 00:49:58,030

which brings us to the next topic which

2014
00:49:58,030 --> 00:49:58,040
which brings us to the next topic which
 

2015
00:49:58,040 --> 00:50:04,660
which brings us to the next topic which
is log compaction and and snapshots and

2016
00:50:04,660 --> 00:50:04,670
is log compaction and and snapshots and
 

2017
00:50:04,670 --> 00:50:07,960
is log compaction and and snapshots and
this has a lot to do with lab 3b

2018
00:50:07,960 --> 00:50:07,970
this has a lot to do with lab 3b
 

2019
00:50:07,970 --> 00:50:09,609
this has a lot to do with lab 3b
actually you'll see log compaction and

2020
00:50:09,609 --> 00:50:09,619
actually you'll see log compaction and
 

2021
00:50:09,619 --> 00:50:13,960
actually you'll see log compaction and
snapshots in vlog 3b in lab 3b and so

2022
00:50:13,960 --> 00:50:13,970
snapshots in vlog 3b in lab 3b and so
 

2023
00:50:13,970 --> 00:50:15,430
snapshots in vlog 3b in lab 3b and so
the problem that log compaction and

2024
00:50:15,430 --> 00:50:15,440
the problem that log compaction and
 

2025
00:50:15,440 --> 00:50:18,790
the problem that log compaction and
snapshotting is solving a raft is that

2026
00:50:18,790 --> 00:50:18,800
snapshotting is solving a raft is that
 

2027
00:50:18,800 --> 00:50:20,680
snapshotting is solving a raft is that
indeed for a long-running system that's

2028
00:50:20,680 --> 00:50:20,690
indeed for a long-running system that's
 

2029
00:50:20,690 --> 00:50:22,349
indeed for a long-running system that's
been going for weeks or months or years

2030
00:50:22,349 --> 00:50:22,359
been going for weeks or months or years
 

2031
00:50:22,359 --> 00:50:25,300
been going for weeks or months or years
if we just follow the figure 2 rules the

2032
00:50:25,300 --> 00:50:25,310
if we just follow the figure 2 rules the
 

2033
00:50:25,310 --> 00:50:27,400
if we just follow the figure 2 rules the
log just keeps on growing may end up you

2034
00:50:27,400 --> 00:50:27,410
log just keeps on growing may end up you
 

2035
00:50:27,410 --> 00:50:28,480
log just keeps on growing may end up you
know millions and millions of entries

2036
00:50:28,480 --> 00:50:28,490
know millions and millions of entries
 

2037
00:50:28,490 --> 00:50:30,760
know millions and millions of entries
long and so requires a lot of memory to

2038
00:50:30,760 --> 00:50:30,770
long and so requires a lot of memory to
 

2039
00:50:30,770 --> 00:50:34,120
long and so requires a lot of memory to
store if you store it on disk like if

2040
00:50:34,120 --> 00:50:34,130
store if you store it on disk like if
 

2041
00:50:34,130 --> 00:50:35,349
store if you store it on disk like if
you have to persist it every time you

2042
00:50:35,349 --> 00:50:35,359
you have to persist it every time you
 

2043
00:50:35,359 --> 00:50:37,120
you have to persist it every time you
persist the log it's using up a huge I

2044
00:50:37,120 --> 00:50:37,130
persist the log it's using up a huge I
 

2045
00:50:37,130 --> 00:50:39,190
persist the log it's using up a huge I
may not space on disk and if a server

2046
00:50:39,190 --> 00:50:39,200
may not space on disk and if a server
 

2047
00:50:39,200 --> 00:50:41,980
may not space on disk and if a server
ever be starts it has to reconstruct its

2048
00:50:41,980 --> 00:50:41,990
ever be starts it has to reconstruct its
 

2049
00:50:41,990 --> 00:50:44,650
ever be starts it has to reconstruct its
state by replaying these millions and

2050
00:50:44,650 --> 00:50:44,660
state by replaying these millions and
 

2051
00:50:44,660 --> 00:50:46,030
state by replaying these millions and
millions of log entries from the very

2052
00:50:46,030 --> 00:50:46,040
millions of log entries from the very
 

2053
00:50:46,040 --> 00:50:47,650
millions of log entries from the very
beginning which could take like hours

2054
00:50:47,650 --> 00:50:47,660
beginning which could take like hours
 

2055
00:50:47,660 --> 00:50:50,020
beginning which could take like hours
for a server to run through its entire

2056
00:50:50,020 --> 00:50:50,030
for a server to run through its entire
 

2057
00:50:50,030 --> 00:50:52,780
for a server to run through its entire
log and we execute it if it crashes and

2058
00:50:52,780 --> 00:50:52,790
log and we execute it if it crashes and
 

2059
00:50:52,790 --> 00:50:54,670
log and we execute it if it crashes and
restarts all of which is like similar

2060
00:50:54,670 --> 00:50:54,680
restarts all of which is like similar
 

2061
00:50:54,680 --> 00:50:56,470
restarts all of which is like similar
what kind of wasted because before it

2062
00:50:56,470 --> 00:50:56,480
what kind of wasted because before it
 

2063
00:50:56,480 --> 00:50:58,660
what kind of wasted because before it
crashed it had already had applications

2064
00:50:58,660 --> 00:50:58,670
crashed it had already had applications
 

2065
00:50:58,670 --> 00:51:08,220
crashed it had already had applications
state and so in order to cope with this

2066
00:51:08,220 --> 00:51:08,230
state and so in order to cope with this
 

2067
00:51:08,230 --> 00:51:11,740
state and so in order to cope with this
wrath has this idea of snapshots and the

2068
00:51:11,740 --> 00:51:11,750
wrath has this idea of snapshots and the
 

2069
00:51:11,750 --> 00:51:15,220
wrath has this idea of snapshots and the
sort of idea behind snapshots is to be

2070
00:51:15,220 --> 00:51:15,230
sort of idea behind snapshots is to be
 

2071
00:51:15,230 --> 00:51:18,400
sort of idea behind snapshots is to be
able to save or ask the application to

2072
00:51:18,400 --> 00:51:18,410
able to save or ask the application to
 

2073
00:51:18,410 --> 00:51:20,829
able to save or ask the application to
save a copy of its state as of a

2074
00:51:20,829 --> 00:51:20,839
save a copy of its state as of a
 

2075
00:51:20,839 --> 00:51:23,260
save a copy of its state as of a
particular log entry so we've been

2076
00:51:23,260 --> 00:51:23,270
particular log entry so we've been
 

2077
00:51:23,270 --> 00:51:24,910
particular log entry so we've been
mostly kind of ignoring the application

2078
00:51:24,910 --> 00:51:24,920
mostly kind of ignoring the application
 

2079
00:51:24,920 --> 00:51:28,150
mostly kind of ignoring the application
but the fact is that you know if we have

2080
00:51:28,150 --> 00:51:28,160
but the fact is that you know if we have
 

2081
00:51:28,160 --> 00:51:30,130
but the fact is that you know if we have
a suppose we're building a key value

2082
00:51:30,130 --> 00:51:30,140
a suppose we're building a key value
 

2083
00:51:30,140 --> 00:51:33,339
a suppose we're building a key value
store under BRAF you know the log is

2084
00:51:33,339 --> 00:51:33,349
store under BRAF you know the log is
 

2085
00:51:33,349 --> 00:51:34,930
store under BRAF you know the log is
gonna contain a bunch of you know

2086
00:51:34,930 --> 00:51:34,940
gonna contain a bunch of you know
 

2087
00:51:34,940 --> 00:51:37,089
gonna contain a bunch of you know
putting gets or read and write request

2088
00:51:37,089 --> 00:51:37,099
putting gets or read and write request
 

2089
00:51:37,099 --> 00:51:39,670
putting gets or read and write request
so maybe a law contains you know a put

2090
00:51:39,670 --> 00:51:39,680
so maybe a law contains you know a put
 

2091
00:51:39,680 --> 00:51:42,400
so maybe a law contains you know a put
that some client wants to set X to one

2092
00:51:42,400 --> 00:51:42,410
that some client wants to set X to one
 

2093
00:51:42,410 --> 00:51:44,349
that some client wants to set X to one
and then another one where it says X to

2094
00:51:44,349 --> 00:51:44,359
and then another one where it says X to
 

2095
00:51:44,359 --> 00:51:47,680
and then another one where it says X to
2 and then you know y equals 7 or

2096
00:51:47,680 --> 00:51:47,690
2 and then you know y equals 7 or
 

2097
00:51:47,690 --> 00:51:51,040
2 and then you know y equals 7 or
whatever and if there's no crashes as

2098
00:51:51,040 --> 00:51:51,050
whatever and if there's no crashes as
 

2099
00:51:51,050 --> 00:51:53,559
whatever and if there's no crashes as
the raft is executing along there's

2100
00:51:53,559 --> 00:51:53,569
the raft is executing along there's
 

2101
00:51:53,569 --> 00:51:55,720
the raft is executing along there's
going to be this if the layer above Rath

2102
00:51:55,720 --> 00:51:55,730
going to be this if the layer above Rath
 

2103
00:51:55,730 --> 00:51:57,250
going to be this if the layer above Rath
there's going to be this application and

2104
00:51:57,250 --> 00:51:57,260
there's going to be this application and
 

2105
00:51:57,260 --> 00:51:59,380
there's going to be this application and
the application if it's a key value

2106
00:51:59,380 --> 00:51:59,390
the application if it's a key value
 

2107
00:51:59,390 --> 00:52:01,510
the application if it's a key value
store databases it's going to be meeting

2108
00:52:01,510 --> 00:52:01,520
store databases it's going to be meeting
 

2109
00:52:01,520 --> 00:52:05,410
store databases it's going to be meeting
this table and as raft hands it one

2110
00:52:05,410 --> 00:52:05,420
this table and as raft hands it one
 

2111
00:52:05,420 --> 00:52:07,210
this table and as raft hands it one
command after our next

2112
00:52:07,210 --> 00:52:07,220
command after our next
 

2113
00:52:07,220 --> 00:52:09,130
command after our next
the applications going to update its

2114
00:52:09,130 --> 00:52:09,140
the applications going to update its
 

2115
00:52:09,140 --> 00:52:10,870
the applications going to update its
table so you know after the first

2116
00:52:10,870 --> 00:52:10,880
table so you know after the first
 

2117
00:52:10,880 --> 00:52:12,880
table so you know after the first
command it's going to set X to one and

2118
00:52:12,880 --> 00:52:12,890
command it's going to set X to one and
 

2119
00:52:12,890 --> 00:52:14,290
command it's going to set X to one and
it's stable after the second command

2120
00:52:14,290 --> 00:52:14,300
it's stable after the second command
 

2121
00:52:14,300 --> 00:52:19,620
it's stable after the second command
it's going to update its table you know

2122
00:52:19,620 --> 00:52:19,630

 

2123
00:52:19,630 --> 00:52:22,030

one interesting fact is that for most

2124
00:52:22,030 --> 00:52:22,040
one interesting fact is that for most
 

2125
00:52:22,040 --> 00:52:24,310
one interesting fact is that for most
applications the application state is

2126
00:52:24,310 --> 00:52:24,320
applications the application state is
 

2127
00:52:24,320 --> 00:52:26,980
applications the application state is
likely to be much smaller than the

2128
00:52:26,980 --> 00:52:26,990
likely to be much smaller than the
 

2129
00:52:26,990 --> 00:52:29,830
likely to be much smaller than the
corresponding log right at some level we

2130
00:52:29,830 --> 00:52:29,840
corresponding log right at some level we
 

2131
00:52:29,840 --> 00:52:31,540
corresponding log right at some level we
know that the the you know the log and

2132
00:52:31,540 --> 00:52:31,550
know that the the you know the log and
 

2133
00:52:31,550 --> 00:52:33,700
know that the the you know the log and
the state are the log in that and the

2134
00:52:33,700 --> 00:52:33,710
the state are the log in that and the
 

2135
00:52:33,710 --> 00:52:35,140
the state are the log in that and the
state as of some point in the log are

2136
00:52:35,140 --> 00:52:35,150
state as of some point in the log are
 

2137
00:52:35,150 --> 00:52:38,310
state as of some point in the log are
kind of interchangeable right they both

2138
00:52:38,310 --> 00:52:38,320
kind of interchangeable right they both
 

2139
00:52:38,320 --> 00:52:40,810
kind of interchangeable right they both
sort of implied the same thing about the

2140
00:52:40,810 --> 00:52:40,820
sort of implied the same thing about the
 

2141
00:52:40,820 --> 00:52:44,560
sort of implied the same thing about the
state of the application but the log may

2142
00:52:44,560 --> 00:52:44,570
state of the application but the log may
 

2143
00:52:44,570 --> 00:52:46,090
state of the application but the log may
contain a lot of you know a lot of

2144
00:52:46,090 --> 00:52:46,100
contain a lot of you know a lot of
 

2145
00:52:46,100 --> 00:52:48,160
contain a lot of you know a lot of
multiple assignments 2x they use up a

2146
00:52:48,160 --> 00:52:48,170
multiple assignments 2x they use up a
 

2147
00:52:48,170 --> 00:52:49,840
multiple assignments 2x they use up a
lot of space in the log but are also to

2148
00:52:49,840 --> 00:52:49,850
lot of space in the log but are also to
 

2149
00:52:49,850 --> 00:52:51,850
lot of space in the log but are also to
effectively compact it down to a single

2150
00:52:51,850 --> 00:52:51,860
effectively compact it down to a single
 

2151
00:52:51,860 --> 00:52:53,500
effectively compact it down to a single
entry in the table and that's pretty

2152
00:52:53,500 --> 00:52:53,510
entry in the table and that's pretty
 

2153
00:52:53,510 --> 00:52:56,290
entry in the table and that's pretty
typical of these replicated applications

2154
00:52:56,290 --> 00:52:56,300
typical of these replicated applications
 

2155
00:52:56,300 --> 00:53:00,100
typical of these replicated applications
but the point is that instead of storing

2156
00:53:00,100 --> 00:53:00,110
but the point is that instead of storing
 

2157
00:53:00,110 --> 00:53:02,680
but the point is that instead of storing
the log which may go to be huge we have

2158
00:53:02,680 --> 00:53:02,690
the log which may go to be huge we have
 

2159
00:53:02,690 --> 00:53:05,320
the log which may go to be huge we have
the option of storing instead the table

2160
00:53:05,320 --> 00:53:05,330
the option of storing instead the table
 

2161
00:53:05,330 --> 00:53:08,050
the option of storing instead the table
which might be a lot smaller and that's

2162
00:53:08,050 --> 00:53:08,060
which might be a lot smaller and that's
 

2163
00:53:08,060 --> 00:53:11,620
which might be a lot smaller and that's
what the snapshots are doing so when

2164
00:53:11,620 --> 00:53:11,630
what the snapshots are doing so when
 

2165
00:53:11,630 --> 00:53:14,410
what the snapshots are doing so when
raft feels that it's log has gotten to

2166
00:53:14,410 --> 00:53:14,420
raft feels that it's log has gotten to
 

2167
00:53:14,420 --> 00:53:17,680
raft feels that it's log has gotten to
be too large you know more than a

2168
00:53:17,680 --> 00:53:17,690
be too large you know more than a
 

2169
00:53:17,690 --> 00:53:19,180
be too large you know more than a
megabyte or ten megabytes or whatever

2170
00:53:19,180 --> 00:53:19,190
megabyte or ten megabytes or whatever
 

2171
00:53:19,190 --> 00:53:21,610
megabyte or ten megabytes or whatever
some arbitrary limit raft will ask the

2172
00:53:21,610 --> 00:53:21,620
some arbitrary limit raft will ask the
 

2173
00:53:21,620 --> 00:53:24,250
some arbitrary limit raft will ask the
application to take make a snapshot of

2174
00:53:24,250 --> 00:53:24,260
application to take make a snapshot of
 

2175
00:53:24,260 --> 00:53:26,980
application to take make a snapshot of
it the application state as of a certain

2176
00:53:26,980 --> 00:53:26,990
it the application state as of a certain
 

2177
00:53:26,990 --> 00:53:28,360
it the application state as of a certain
point in the log

2178
00:53:28,360 --> 00:53:28,370
point in the log
 

2179
00:53:28,370 --> 00:53:30,750
point in the log
so if we add if raft asked the

2180
00:53:30,750 --> 00:53:30,760
so if we add if raft asked the
 

2181
00:53:30,760 --> 00:53:33,100
so if we add if raft asked the
application for a snapshot reference it

2182
00:53:33,100 --> 00:53:33,110
application for a snapshot reference it
 

2183
00:53:33,110 --> 00:53:35,290
application for a snapshot reference it
would pick a point in the log that the

2184
00:53:35,290 --> 00:53:35,300
would pick a point in the log that the
 

2185
00:53:35,300 --> 00:53:37,360
would pick a point in the log that the
snapshot referred to and require the

2186
00:53:37,360 --> 00:53:37,370
snapshot referred to and require the
 

2187
00:53:37,370 --> 00:53:39,760
snapshot referred to and require the
application to produce a snapshot as at

2188
00:53:39,760 --> 00:53:39,770
application to produce a snapshot as at
 

2189
00:53:39,770 --> 00:53:41,560
application to produce a snapshot as at
that point this is extremely critical

2190
00:53:41,560 --> 00:53:41,570
that point this is extremely critical
 

2191
00:53:41,570 --> 00:53:44,470
that point this is extremely critical
because the because what we're about to

2192
00:53:44,470 --> 00:53:44,480
because the because what we're about to
 

2193
00:53:44,480 --> 00:53:45,970
because the because what we're about to
do is throw away everything before that

2194
00:53:45,970 --> 00:53:45,980
do is throw away everything before that
 

2195
00:53:45,980 --> 00:53:47,350
do is throw away everything before that
point so if there's not a will to find

2196
00:53:47,350 --> 00:53:47,360
point so if there's not a will to find
 

2197
00:53:47,360 --> 00:53:48,850
point so if there's not a will to find
point that corresponds to a snapshot

2198
00:53:48,850 --> 00:53:48,860
point that corresponds to a snapshot
 

2199
00:53:48,860 --> 00:53:51,280
point that corresponds to a snapshot
then we can't safely throw away the log

2200
00:53:51,280 --> 00:53:51,290
then we can't safely throw away the log
 

2201
00:53:51,290 --> 00:53:54,900
then we can't safely throw away the log
before that point so that means that

2202
00:53:54,900 --> 00:53:54,910
before that point so that means that
 

2203
00:53:54,910 --> 00:53:57,010
before that point so that means that
Rath is gonna have you know ask for

2204
00:53:57,010 --> 00:53:57,020
Rath is gonna have you know ask for
 

2205
00:53:57,020 --> 00:53:58,330
Rath is gonna have you know ask for
snaps on the snap so it's basically just

2206
00:53:58,330 --> 00:53:58,340
snaps on the snap so it's basically just
 

2207
00:53:58,340 --> 00:54:00,640
snaps on the snap so it's basically just
the table it's just about a database

2208
00:54:00,640 --> 00:54:00,650
the table it's just about a database
 

2209
00:54:00,650 --> 00:54:04,510
the table it's just about a database
server and we also need to annotate the

2210
00:54:04,510 --> 00:54:04,520
server and we also need to annotate the
 

2211
00:54:04,520 --> 00:54:07,390
server and we also need to annotate the
snapshot with the entry number that are

2212
00:54:07,390 --> 00:54:07,400
snapshot with the entry number that are
 

2213
00:54:07,400 --> 00:54:09,880
snapshot with the entry number that are
corresponds to you so it's basically you

2214
00:54:09,880 --> 00:54:09,890
corresponds to you so it's basically you
 

2215
00:54:09,890 --> 00:54:12,370
corresponds to you so it's basically you
know if the entries are 1 2 3 this

2216
00:54:12,370 --> 00:54:12,380
know if the entries are 1 2 3 this
 

2217
00:54:12,380 --> 00:54:16,390
know if the entries are 1 2 3 this
snapshot corresponds to just after log

2218
00:54:16,390 --> 00:54:16,400
snapshot corresponds to just after log
 

2219
00:54:16,400 --> 00:54:19,799
snapshot corresponds to just after log
index 3 with the snapshot in hand

2220
00:54:19,799 --> 00:54:19,809
index 3 with the snapshot in hand
 

2221
00:54:19,809 --> 00:54:23,319
index 3 with the snapshot in hand
if we persist it to disk rats persistent

2222
00:54:23,319 --> 00:54:23,329
if we persist it to disk rats persistent
 

2223
00:54:23,329 --> 00:54:26,859
if we persist it to disk rats persistent
to disk raft never again will need this

2224
00:54:26,859 --> 00:54:26,869
to disk raft never again will need this
 

2225
00:54:26,869 --> 00:54:33,880
to disk raft never again will need this
part of the logs and it can simply throw

2226
00:54:33,880 --> 00:54:33,890
part of the logs and it can simply throw
 

2227
00:54:33,890 --> 00:54:36,640
part of the logs and it can simply throw
it away as long as it persists a

2228
00:54:36,640 --> 00:54:36,650
it away as long as it persists a
 

2229
00:54:36,650 --> 00:54:39,579
it away as long as it persists a
snapshot as of a certain in debt log

2230
00:54:39,579 --> 00:54:39,589
snapshot as of a certain in debt log
 

2231
00:54:39,589 --> 00:54:42,700
snapshot as of a certain in debt log
index plus the log after that index as

2232
00:54:42,700 --> 00:54:42,710
index plus the log after that index as
 

2233
00:54:42,710 --> 00:54:44,440
index plus the log after that index as
long as that's persisted to disk we

2234
00:54:44,440 --> 00:54:44,450
long as that's persisted to disk we
 

2235
00:54:44,450 --> 00:54:46,470
long as that's persisted to disk we
never going to need to log before that

2236
00:54:46,470 --> 00:54:46,480
never going to need to log before that
 

2237
00:54:46,480 --> 00:54:49,779
never going to need to log before that
and so this is what RAF does the rocks

2238
00:54:49,779 --> 00:54:49,789
and so this is what RAF does the rocks
 

2239
00:54:49,789 --> 00:54:51,519
and so this is what RAF does the rocks
ask the application for snapshot gets

2240
00:54:51,519 --> 00:54:51,529
ask the application for snapshot gets
 

2241
00:54:51,529 --> 00:54:52,960
ask the application for snapshot gets
the snapshot saves it to disk with the

2242
00:54:52,960 --> 00:54:52,970
the snapshot saves it to disk with the
 

2243
00:54:52,970 --> 00:54:54,460
the snapshot saves it to disk with the
log after that it just throws away this

2244
00:54:54,460 --> 00:54:54,470
log after that it just throws away this
 

2245
00:54:54,470 --> 00:54:58,359
log after that it just throws away this
log here right and so it really operates

2246
00:54:58,359 --> 00:54:58,369
log here right and so it really operates
 

2247
00:54:58,369 --> 00:55:00,940
log here right and so it really operates
or the sort of persistence story is all

2248
00:55:00,940 --> 00:55:00,950
or the sort of persistence story is all
 

2249
00:55:00,950 --> 00:55:03,519
or the sort of persistence story is all
about pairs of a snapshot in the log

2250
00:55:03,519 --> 00:55:03,529
about pairs of a snapshot in the log
 

2251
00:55:03,529 --> 00:55:06,220
about pairs of a snapshot in the log
after that after the point in the log

2252
00:55:06,220 --> 00:55:06,230
after that after the point in the log
 

2253
00:55:06,230 --> 00:55:09,880
after that after the point in the log
associated with snapshot I don't see

2254
00:55:09,880 --> 00:55:09,890
associated with snapshot I don't see
 

2255
00:55:09,890 --> 00:55:24,299
associated with snapshot I don't see
this yes

2256
00:55:24,299 --> 00:55:24,309

 

2257
00:55:24,309 --> 00:55:27,670

no it's still it's it's you know there's

2258
00:55:27,670 --> 00:55:27,680
no it's still it's it's you know there's
 

2259
00:55:27,680 --> 00:55:29,260
no it's still it's it's you know there's
these sort of phantom entries one two

2260
00:55:29,260 --> 00:55:29,270
these sort of phantom entries one two
 

2261
00:55:29,270 --> 00:55:31,420
these sort of phantom entries one two
three and this you know suffix of the

2262
00:55:31,420 --> 00:55:31,430
three and this you know suffix of the
 

2263
00:55:31,430 --> 00:55:37,380
three and this you know suffix of the
log is indeed viewed as still the it's

2264
00:55:37,380 --> 00:55:37,390
log is indeed viewed as still the it's
 

2265
00:55:37,390 --> 00:55:39,220
log is indeed viewed as still the it's
maybe the right way to think of it is

2266
00:55:39,220 --> 00:55:39,230
maybe the right way to think of it is
 

2267
00:55:39,230 --> 00:55:41,230
maybe the right way to think of it is
still there's just one log except these

2268
00:55:41,230 --> 00:55:41,240
still there's just one log except these
 

2269
00:55:41,240 --> 00:55:43,500
still there's just one log except these
entries are sort of phantom entries that

2270
00:55:43,500 --> 00:55:43,510
entries are sort of phantom entries that
 

2271
00:55:43,510 --> 00:55:46,569
entries are sort of phantom entries that
we that we can view as being kind of

2272
00:55:46,569 --> 00:55:46,579
we that we can view as being kind of
 

2273
00:55:46,579 --> 00:55:48,760
we that we can view as being kind of
there in principle but since we're we

2274
00:55:48,760 --> 00:55:48,770
there in principle but since we're we
 

2275
00:55:48,770 --> 00:55:51,010
there in principle but since we're we
never need to look at them because we

2276
00:55:51,010 --> 00:55:51,020
never need to look at them because we
 

2277
00:55:51,020 --> 00:55:52,539
never need to look at them because we
have the snapshot the fact that they

2278
00:55:52,539 --> 00:55:52,549
have the snapshot the fact that they
 

2279
00:55:52,549 --> 00:55:53,859
have the snapshot the fact that they
just happened not to be stored anywhere

2280
00:55:53,859 --> 00:55:53,869
just happened not to be stored anywhere
 

2281
00:55:53,869 --> 00:55:57,819
just happened not to be stored anywhere
is neither here nor there but it's but

2282
00:55:57,819 --> 00:55:57,829
is neither here nor there but it's but
 

2283
00:55:57,829 --> 00:55:58,690
is neither here nor there but it's but
yeah you should think of it as being

2284
00:55:58,690 --> 00:55:58,700
yeah you should think of it as being
 

2285
00:55:58,700 --> 00:56:01,630
yeah you should think of it as being
stole the same log it's just not just

2286
00:56:01,630 --> 00:56:01,640
stole the same log it's just not just
 

2287
00:56:01,640 --> 00:56:04,809
stole the same log it's just not just
threw away their early entries did this

2288
00:56:04,809 --> 00:56:04,819
threw away their early entries did this
 

2289
00:56:04,819 --> 00:56:06,430
threw away their early entries did this
that's a maybe a little bit too glib of

2290
00:56:06,430 --> 00:56:06,440
that's a maybe a little bit too glib of
 

2291
00:56:06,440 --> 00:56:07,569
that's a maybe a little bit too glib of
an answer because the fact is that

2292
00:56:07,569 --> 00:56:07,579
an answer because the fact is that
 

2293
00:56:07,579 --> 00:56:10,120
an answer because the fact is that
figure two talks about the log in ways

2294
00:56:10,120 --> 00:56:10,130
figure two talks about the log in ways
 

2295
00:56:10,130 --> 00:56:12,549
figure two talks about the log in ways
that makes it that if you just follow

2296
00:56:12,549 --> 00:56:12,559
that makes it that if you just follow
 

2297
00:56:12,559 --> 00:56:14,230
that makes it that if you just follow
figure to you sometimes still need these

2298
00:56:14,230 --> 00:56:14,240
figure to you sometimes still need these
 

2299
00:56:14,240 --> 00:56:15,789
figure to you sometimes still need these
earlier entries and so you'll have to

2300
00:56:15,789 --> 00:56:15,799
earlier entries and so you'll have to
 

2301
00:56:15,799 --> 00:56:17,410
earlier entries and so you'll have to
reinterpret figure two a little bit in

2302
00:56:17,410 --> 00:56:17,420
reinterpret figure two a little bit in
 

2303
00:56:17,420 --> 00:56:19,660
reinterpret figure two a little bit in
light of the fact that sometimes it says

2304
00:56:19,660 --> 00:56:19,670
light of the fact that sometimes it says
 

2305
00:56:19,670 --> 00:56:22,299
light of the fact that sometimes it says
blah blah blah a log entry where the log

2306
00:56:22,299 --> 00:56:22,309
blah blah blah a log entry where the log
 

2307
00:56:22,309 --> 00:56:39,380
blah blah blah a log entry where the log
entry doesn't exist okay

2308
00:56:39,380 --> 00:56:39,390

 

2309
00:56:39,390 --> 00:56:43,109

okay and so what happens on a restart

2310
00:56:43,109 --> 00:56:43,119
okay and so what happens on a restart
 

2311
00:56:43,119 --> 00:56:44,880
okay and so what happens on a restart
so the restart story is a little more

2312
00:56:44,880 --> 00:56:44,890
so the restart story is a little more
 

2313
00:56:44,890 --> 00:56:46,319
so the restart story is a little more
complicated in it than it used to be

2314
00:56:46,319 --> 00:56:46,329
complicated in it than it used to be
 

2315
00:56:46,329 --> 00:56:48,690
complicated in it than it used to be
with just a log what happens on a

2316
00:56:48,690 --> 00:56:48,700
with just a log what happens on a
 

2317
00:56:48,700 --> 00:56:50,279
with just a log what happens on a
restart is that there needs to be away

2318
00:56:50,279 --> 00:56:50,289
restart is that there needs to be away
 

2319
00:56:50,289 --> 00:56:54,539
restart is that there needs to be away
for raft to give the latest for graph to

2320
00:56:54,539 --> 00:56:54,549
for raft to give the latest for graph to
 

2321
00:56:54,549 --> 00:56:56,970
for raft to give the latest for graph to
find the latest snapshot log pair on its

2322
00:56:56,970 --> 00:56:56,980
find the latest snapshot log pair on its
 

2323
00:56:56,980 --> 00:57:01,049
find the latest snapshot log pair on its
disk and hand the snapshot to the

2324
00:57:01,049 --> 00:57:01,059
disk and hand the snapshot to the
 

2325
00:57:01,059 --> 00:57:03,120
disk and hand the snapshot to the
application because we no longer are

2326
00:57:03,120 --> 00:57:03,130
application because we no longer are
 

2327
00:57:03,130 --> 00:57:04,980
application because we no longer are
able to replay you know all the log

2328
00:57:04,980 --> 00:57:04,990
able to replay you know all the log
 

2329
00:57:04,990 --> 00:57:06,450
able to replay you know all the log
entries so there must be some other way

2330
00:57:06,450 --> 00:57:06,460
entries so there must be some other way
 

2331
00:57:06,460 --> 00:57:08,730
entries so there must be some other way
to initialize the application basically

2332
00:57:08,730 --> 00:57:08,740
to initialize the application basically
 

2333
00:57:08,740 --> 00:57:10,230
to initialize the application basically
not only is the application have to be

2334
00:57:10,230 --> 00:57:10,240
not only is the application have to be
 

2335
00:57:10,240 --> 00:57:11,430
not only is the application have to be
able to produce a snapshot of

2336
00:57:11,430 --> 00:57:11,440
able to produce a snapshot of
 

2337
00:57:11,440 --> 00:57:13,920
able to produce a snapshot of
application state but but it has to be

2338
00:57:13,920 --> 00:57:13,930
application state but but it has to be
 

2339
00:57:13,930 --> 00:57:15,829
application state but but it has to be
able to absorb a previously made

2340
00:57:15,829 --> 00:57:15,839
able to absorb a previously made
 

2341
00:57:15,839 --> 00:57:17,970
able to absorb a previously made
snapshot and sort of reconstruct it

2342
00:57:17,970 --> 00:57:17,980
snapshot and sort of reconstruct it
 

2343
00:57:17,980 --> 00:57:20,730
snapshot and sort of reconstruct it
stable in memory from a snapshot and so

2344
00:57:20,730 --> 00:57:20,740
stable in memory from a snapshot and so
 

2345
00:57:20,740 --> 00:57:22,230
stable in memory from a snapshot and so
this now even though raft is kind of

2346
00:57:22,230 --> 00:57:22,240
this now even though raft is kind of
 

2347
00:57:22,240 --> 00:57:23,700
this now even though raft is kind of
managing this whole snapshotting stuff

2348
00:57:23,700 --> 00:57:23,710
managing this whole snapshotting stuff
 

2349
00:57:23,710 --> 00:57:26,190
managing this whole snapshotting stuff
the snapshot contents are really the

2350
00:57:26,190 --> 00:57:26,200
the snapshot contents are really the
 

2351
00:57:26,200 --> 00:57:28,289
the snapshot contents are really the
property to the application and RAF

2352
00:57:28,289 --> 00:57:28,299
property to the application and RAF
 

2353
00:57:28,299 --> 00:57:29,940
property to the application and RAF
doesn't even understand what's in here

2354
00:57:29,940 --> 00:57:29,950
doesn't even understand what's in here
 

2355
00:57:29,950 --> 00:57:31,410
doesn't even understand what's in here
only the application does because it's

2356
00:57:31,410 --> 00:57:31,420
only the application does because it's
 

2357
00:57:31,420 --> 00:57:33,000
only the application does because it's
all full of application specific

2358
00:57:33,000 --> 00:57:33,010
all full of application specific
 

2359
00:57:33,010 --> 00:57:36,269
all full of application specific
information so after a restart the

2360
00:57:36,269 --> 00:57:36,279
information so after a restart the
 

2361
00:57:36,279 --> 00:57:39,779
information so after a restart the
application has to be able to absorb the

2362
00:57:39,779 --> 00:57:39,789
application has to be able to absorb the
 

2363
00:57:39,789 --> 00:57:45,779
application has to be able to absorb the
latest snapshot that raft found so for

2364
00:57:45,779 --> 00:57:45,789
latest snapshot that raft found so for
 

2365
00:57:45,789 --> 00:57:48,740
latest snapshot that raft found so for
just this simple it would be simple

2366
00:57:48,740 --> 00:57:48,750
just this simple it would be simple
 

2367
00:57:48,750 --> 00:57:52,079
just this simple it would be simple
unfortunately this snapshotting and in

2368
00:57:52,079 --> 00:57:52,089
unfortunately this snapshotting and in
 

2369
00:57:52,089 --> 00:57:54,569
unfortunately this snapshotting and in
particular the idea that the leader

2370
00:57:54,569 --> 00:57:54,579
particular the idea that the leader
 

2371
00:57:54,579 --> 00:57:56,910
particular the idea that the leader
might throw away part of its log

2372
00:57:56,910 --> 00:57:56,920
might throw away part of its log
 

2373
00:57:56,920 --> 00:57:59,670
might throw away part of its log
introduces a major piece of complexity

2374
00:57:59,670 --> 00:57:59,680
introduces a major piece of complexity
 

2375
00:57:59,680 --> 00:58:01,799
introduces a major piece of complexity
and that is that if there's some

2376
00:58:01,799 --> 00:58:01,809
and that is that if there's some
 

2377
00:58:01,809 --> 00:58:05,930
and that is that if there's some
follower out there whose log ends before

2378
00:58:05,930 --> 00:58:05,940
follower out there whose log ends before
 

2379
00:58:05,940 --> 00:58:10,799
follower out there whose log ends before
the point at which the leaders log

2380
00:58:10,799 --> 00:58:10,809
the point at which the leaders log
 

2381
00:58:10,809 --> 00:58:14,130
the point at which the leaders log
starts then unless we invent something

2382
00:58:14,130 --> 00:58:14,140
starts then unless we invent something
 

2383
00:58:14,140 --> 00:58:15,809
starts then unless we invent something
new we need monney install snapshot

2384
00:58:15,809 --> 00:58:15,819
new we need monney install snapshot
 

2385
00:58:15,819 --> 00:58:17,910
new we need monney install snapshot
unless we invent something new that

2386
00:58:17,910 --> 00:58:17,920
unless we invent something new that
 

2387
00:58:17,920 --> 00:58:20,849
unless we invent something new that
follower can never get up-to-date right

2388
00:58:20,849 --> 00:58:20,859
follower can never get up-to-date right
 

2389
00:58:20,859 --> 00:58:23,010
follower can never get up-to-date right
because if the followers you know if

2390
00:58:23,010 --> 00:58:23,020
because if the followers you know if
 

2391
00:58:23,020 --> 00:58:25,200
because if the followers you know if
there's some follower whose log only is

2392
00:58:25,200 --> 00:58:25,210
there's some follower whose log only is
 

2393
00:58:25,210 --> 00:58:27,390
there's some follower whose log only is
the first two log entries we no longer

2394
00:58:27,390 --> 00:58:27,400
the first two log entries we no longer
 

2395
00:58:27,400 --> 00:58:29,880
the first two log entries we no longer
have the log entry three that's required

2396
00:58:29,880 --> 00:58:29,890
have the log entry three that's required
 

2397
00:58:29,890 --> 00:58:32,700
have the log entry three that's required
to send it to that follower in an append

2398
00:58:32,700 --> 00:58:32,710
to send it to that follower in an append
 

2399
00:58:32,710 --> 00:58:35,400
to send it to that follower in an append
entries RPC to allow its log to catch up

2400
00:58:35,400 --> 00:58:35,410
entries RPC to allow its log to catch up
 

2401
00:58:35,410 --> 00:58:41,140
entries RPC to allow its log to catch up
to the leaders now

2402
00:58:41,140 --> 00:58:41,150
to the leaders now
 

2403
00:58:41,150 --> 00:58:44,809
to the leaders now
we could avoid this problem by having

2404
00:58:44,809 --> 00:58:44,819
we could avoid this problem by having
 

2405
00:58:44,819 --> 00:58:47,870
we could avoid this problem by having
the leader never drop part of its log if

2406
00:58:47,870 --> 00:58:47,880
the leader never drop part of its log if
 

2407
00:58:47,880 --> 00:58:50,420
the leader never drop part of its log if
there's any follower out there that

2408
00:58:50,420 --> 00:58:50,430
there's any follower out there that
 

2409
00:58:50,430 --> 00:58:53,359
there's any follower out there that
hasn't caught up to the point at which

2410
00:58:53,359 --> 00:58:53,369
hasn't caught up to the point at which
 

2411
00:58:53,369 --> 00:58:54,950
hasn't caught up to the point at which
the leader is thinking about doing a

2412
00:58:54,950 --> 00:58:54,960
the leader is thinking about doing a
 

2413
00:58:54,960 --> 00:58:56,480
the leader is thinking about doing a
snapshot because the leader knows

2414
00:58:56,480 --> 00:58:56,490
snapshot because the leader knows
 

2415
00:58:56,490 --> 00:58:58,910
snapshot because the leader knows
through next index

2416
00:58:58,910 --> 00:58:58,920
through next index
 

2417
00:58:58,920 --> 00:59:00,950
through next index
well actually leader doesn't really know

2418
00:59:00,950 --> 00:59:00,960
well actually leader doesn't really know
 

2419
00:59:00,960 --> 00:59:02,559
well actually leader doesn't really know
but the leader could know in principle

2420
00:59:02,559 --> 00:59:02,569
but the leader could know in principle
 

2421
00:59:02,569 --> 00:59:05,539
but the leader could know in principle
how far each follower had gotten and the

2422
00:59:05,539 --> 00:59:05,549
how far each follower had gotten and the
 

2423
00:59:05,549 --> 00:59:06,650
how far each follower had gotten and the
leader could say well I'm just never

2424
00:59:06,650 --> 00:59:06,660
leader could say well I'm just never
 

2425
00:59:06,660 --> 00:59:09,289
leader could say well I'm just never
gonna drop the part of my log before the

2426
00:59:09,289 --> 00:59:09,299
gonna drop the part of my log before the
 

2427
00:59:09,299 --> 00:59:12,049
gonna drop the part of my log before the
end of the follower with the shortest

2428
00:59:12,049 --> 00:59:12,059
end of the follower with the shortest
 

2429
00:59:12,059 --> 00:59:16,880
end of the follower with the shortest
log and that would be okay they might

2430
00:59:16,880 --> 00:59:16,890
log and that would be okay they might
 

2431
00:59:16,890 --> 00:59:20,029
log and that would be okay they might
actually just be a good idea period the

2432
00:59:20,029 --> 00:59:20,039
actually just be a good idea period the
 

2433
00:59:20,039 --> 00:59:21,289
actually just be a good idea period the
reason why that's maybe not such a great

2434
00:59:21,289 --> 00:59:21,299
reason why that's maybe not such a great
 

2435
00:59:21,299 --> 00:59:23,029
reason why that's maybe not such a great
idea is that of course if a follower

2436
00:59:23,029 --> 00:59:23,039
idea is that of course if a follower
 

2437
00:59:23,039 --> 00:59:26,720
idea is that of course if a follower
shut down for a week you know it's not

2438
00:59:26,720 --> 00:59:26,730
shut down for a week you know it's not
 

2439
00:59:26,730 --> 00:59:28,760
shut down for a week you know it's not
gonna be acknowledging log entries and

2440
00:59:28,760 --> 00:59:28,770
gonna be acknowledging log entries and
 

2441
00:59:28,770 --> 00:59:31,250
gonna be acknowledging log entries and
that means that the leader can't reduce

2442
00:59:31,250 --> 00:59:31,260
that means that the leader can't reduce
 

2443
00:59:31,260 --> 00:59:34,339
that means that the leader can't reduce
its memory use by snapshotting so the

2444
00:59:34,339 --> 00:59:34,349
its memory use by snapshotting so the
 

2445
00:59:34,349 --> 00:59:35,990
its memory use by snapshotting so the
way the raft designs chosen to go is

2446
00:59:35,990 --> 00:59:36,000
way the raft designs chosen to go is
 

2447
00:59:36,000 --> 00:59:40,279
way the raft designs chosen to go is
that the leader is allowed to throw away

2448
00:59:40,279 --> 00:59:40,289
that the leader is allowed to throw away
 

2449
00:59:40,289 --> 00:59:42,049
that the leader is allowed to throw away
parts of its logs that would be needed

2450
00:59:42,049 --> 00:59:42,059
parts of its logs that would be needed
 

2451
00:59:42,059 --> 00:59:43,609
parts of its logs that would be needed
by some follower and so we need some

2452
00:59:43,609 --> 00:59:43,619
by some follower and so we need some
 

2453
00:59:43,619 --> 00:59:45,760
by some follower and so we need some
other scheme that append entries to deal

2454
00:59:45,760 --> 00:59:45,770
other scheme that append entries to deal
 

2455
00:59:45,770 --> 00:59:48,019
other scheme that append entries to deal
with the gap between the end of some

2456
00:59:48,019 --> 00:59:48,029
with the gap between the end of some
 

2457
00:59:48,029 --> 00:59:49,339
with the gap between the end of some
followers log in the beginning of the

2458
00:59:49,339 --> 00:59:49,349
followers log in the beginning of the
 

2459
00:59:49,349 --> 00:59:51,829
followers log in the beginning of the
leaders log and so that solution is the

2460
00:59:51,829 --> 00:59:51,839
leaders log and so that solution is the
 

2461
00:59:51,839 --> 01:00:02,870
leaders log and so that solution is the
install snapshot RPC and the deal is

2462
01:00:02,870 --> 01:00:02,880
install snapshot RPC and the deal is
 

2463
01:00:02,880 --> 01:00:06,920
install snapshot RPC and the deal is
that when a leader we have some follower

2464
01:00:06,920 --> 01:00:06,930
that when a leader we have some follower
 

2465
01:00:06,930 --> 01:00:09,470
that when a leader we have some follower
whose log is that you know just powered

2466
01:00:09,470 --> 01:00:09,480
whose log is that you know just powered
 

2467
01:00:09,480 --> 01:00:12,230
whose log is that you know just powered
on its log as short the leaders gonna

2468
01:00:12,230 --> 01:00:12,240
on its log as short the leaders gonna
 

2469
01:00:12,240 --> 01:00:14,539
on its log as short the leaders gonna
send it and append entries and you know

2470
01:00:14,539 --> 01:00:14,549
send it and append entries and you know
 

2471
01:00:14,549 --> 01:00:15,859
send it and append entries and you know
it's gonna be forced the leaders gonna

2472
01:00:15,859 --> 01:00:15,869
it's gonna be forced the leaders gonna
 

2473
01:00:15,869 --> 01:00:17,240
it's gonna be forced the leaders gonna
be forced to backup and at some point

2474
01:00:17,240 --> 01:00:17,250
be forced to backup and at some point
 

2475
01:00:17,250 --> 01:00:19,069
be forced to backup and at some point
the leader you know failure or fail

2476
01:00:19,069 --> 01:00:19,079
the leader you know failure or fail
 

2477
01:00:19,079 --> 01:00:20,809
the leader you know failure or fail
dependent recalls will cause the leader

2478
01:00:20,809 --> 01:00:20,819
dependent recalls will cause the leader
 

2479
01:00:20,819 --> 01:00:23,329
dependent recalls will cause the leader
to realize it it's reached the beginning

2480
01:00:23,329 --> 01:00:23,339
to realize it it's reached the beginning
 

2481
01:00:23,339 --> 01:00:25,130
to realize it it's reached the beginning
of the actual log its doors and at that

2482
01:00:25,130 --> 01:00:25,140
of the actual log its doors and at that
 

2483
01:00:25,140 --> 01:00:27,140
of the actual log its doors and at that
point instead of sending in append

2484
01:00:27,140 --> 01:00:27,150
point instead of sending in append
 

2485
01:00:27,150 --> 01:00:30,319
point instead of sending in append
entries the leader will send its current

2486
01:00:30,319 --> 01:00:30,329
entries the leader will send its current
 

2487
01:00:30,329 --> 01:00:33,559
entries the leader will send its current
snapshot plus current law well send its

2488
01:00:33,559 --> 01:00:33,569
snapshot plus current law well send its
 

2489
01:00:33,569 --> 01:00:35,660
snapshot plus current law well send its
current snapshot to the follower and

2490
01:00:35,660 --> 01:00:35,670
current snapshot to the follower and
 

2491
01:00:35,670 --> 01:00:37,880
current snapshot to the follower and
then presumably immediately follow it

2492
01:00:37,880 --> 01:00:37,890
then presumably immediately follow it
 

2493
01:00:37,890 --> 01:00:40,069
then presumably immediately follow it
with an append entries that has the

2494
01:00:40,069 --> 01:00:40,079
with an append entries that has the
 

2495
01:00:40,079 --> 01:00:46,760
with an append entries that has the
leaders current law

2496
01:00:46,760 --> 01:00:46,770

 

2497
01:00:46,770 --> 01:00:52,359

questions

2498
01:00:52,359 --> 01:00:52,369

 

2499
01:00:52,369 --> 01:00:55,239

yeah I'm the sad truth this is like this

2500
01:00:55,239 --> 01:00:55,249
yeah I'm the sad truth this is like this
 

2501
01:00:55,249 --> 01:00:59,130
yeah I'm the sad truth this is like this
is adds significant complexity here

2502
01:00:59,130 --> 01:00:59,140
is adds significant complexity here
 

2503
01:00:59,140 --> 01:01:02,529
is adds significant complexity here
Jarrell I'm three partially because of

2504
01:01:02,529 --> 01:01:02,539
Jarrell I'm three partially because of
 

2505
01:01:02,539 --> 01:01:05,019
Jarrell I'm three partially because of
the kind of cooperation that's required

2506
01:01:05,019 --> 01:01:05,029
the kind of cooperation that's required
 

2507
01:01:05,029 --> 01:01:07,209
the kind of cooperation that's required
between raff this is sort of a little

2508
01:01:07,209 --> 01:01:07,219
between raff this is sort of a little
 

2509
01:01:07,219 --> 01:01:08,769
between raff this is sort of a little
bit of a violation of modularity it

2510
01:01:08,769 --> 01:01:08,779
bit of a violation of modularity it
 

2511
01:01:08,779 --> 01:01:12,039
bit of a violation of modularity it
requires a good deal cooperation like

2512
01:01:12,039 --> 01:01:12,049
requires a good deal cooperation like
 

2513
01:01:12,049 --> 01:01:13,569
requires a good deal cooperation like
for example when an install snapshot

2514
01:01:13,569 --> 01:01:13,579
for example when an install snapshot
 

2515
01:01:13,579 --> 01:01:15,969
for example when an install snapshot
comes in it's delivered to raft but raft

2516
01:01:15,969 --> 01:01:15,979
comes in it's delivered to raft but raft
 

2517
01:01:15,979 --> 01:01:17,769
comes in it's delivered to raft but raft
really requires the application to

2518
01:01:17,769 --> 01:01:17,779
really requires the application to
 

2519
01:01:17,779 --> 01:01:23,229
really requires the application to
absorb the snapshot so they have to talk

2520
01:01:23,229 --> 01:01:23,239
absorb the snapshot so they have to talk
 

2521
01:01:23,239 --> 01:01:24,099
absorb the snapshot so they have to talk
to each other more than they otherwise

2522
01:01:24,099 --> 01:01:24,109
to each other more than they otherwise
 

2523
01:01:24,109 --> 01:01:33,609
to each other more than they otherwise
might yes the question is that this is

2524
01:01:33,609 --> 01:01:33,619
might yes the question is that this is
 

2525
01:01:33,619 --> 01:01:35,200
might yes the question is that this is
the way the snapshot is created

2526
01:01:35,200 --> 01:01:35,210
the way the snapshot is created
 

2527
01:01:35,210 --> 01:01:36,880
the way the snapshot is created
dependent on the application

2528
01:01:36,880 --> 01:01:36,890
dependent on the application
 

2529
01:01:36,890 --> 01:01:38,709
dependent on the application
it's absolutely it so the snapshot

2530
01:01:38,709 --> 01:01:38,719
it's absolutely it so the snapshot
 

2531
01:01:38,719 --> 01:01:40,959
it's absolutely it so the snapshot
creation function is part of the

2532
01:01:40,959 --> 01:01:40,969
creation function is part of the
 

2533
01:01:40,969 --> 01:01:42,670
creation function is part of the
application as part of like the key

2534
01:01:42,670 --> 01:01:42,680
application as part of like the key
 

2535
01:01:42,680 --> 01:01:45,249
application as part of like the key
value server so raffle you know somehow

2536
01:01:45,249 --> 01:01:45,259
value server so raffle you know somehow
 

2537
01:01:45,259 --> 01:01:46,779
value server so raffle you know somehow
call up to the application and say geez

2538
01:01:46,779 --> 01:01:46,789
call up to the application and say geez
 

2539
01:01:46,789 --> 01:01:48,130
call up to the application and say geez
you know I really like a snapshot right

2540
01:01:48,130 --> 01:01:48,140
you know I really like a snapshot right
 

2541
01:01:48,140 --> 01:01:50,319
you know I really like a snapshot right
now in the application because only the

2542
01:01:50,319 --> 01:01:50,329
now in the application because only the
 

2543
01:01:50,329 --> 01:01:53,880
now in the application because only the
application understands what it's status

2544
01:01:53,880 --> 01:01:53,890
application understands what it's status
 

2545
01:01:53,890 --> 01:01:57,640
application understands what it's status
and you know the inverse function by

2546
01:01:57,640 --> 01:01:57,650
and you know the inverse function by
 

2547
01:01:57,650 --> 01:01:59,440
and you know the inverse function by
which an application reconstructs a

2548
01:01:59,440 --> 01:01:59,450
which an application reconstructs a
 

2549
01:01:59,450 --> 01:02:01,719
which an application reconstructs a
state from a snapshot files also totally

2550
01:02:01,719 --> 01:02:01,729
state from a snapshot files also totally
 

2551
01:02:01,729 --> 01:02:05,049
state from a snapshot files also totally
application dependent where there's

2552
01:02:05,049 --> 01:02:05,059
application dependent where there's
 

2553
01:02:05,059 --> 01:02:06,849
application dependent where there's
intertwining because of course every

2554
01:02:06,849 --> 01:02:06,859
intertwining because of course every
 

2555
01:02:06,859 --> 01:02:09,489
intertwining because of course every
snapshot has to be labeled with a point

2556
01:02:09,489 --> 01:02:09,499
snapshot has to be labeled with a point
 

2557
01:02:09,499 --> 01:02:25,260
snapshot has to be labeled with a point
in a log that it corresponds to

2558
01:02:25,260 --> 01:02:25,270

 

2559
01:02:25,270 --> 01:02:27,220

talking about rule six and figure

2560
01:02:27,220 --> 01:02:27,230
talking about rule six and figure
 

2561
01:02:27,230 --> 01:02:39,670
talking about rule six and figure
thirteen okay so yeah the question here

2562
01:02:39,670 --> 01:02:39,680
thirteen okay so yeah the question here
 

2563
01:02:39,680 --> 01:02:42,550
thirteen okay so yeah the question here
is that and you will be faced with this

2564
01:02:42,550 --> 01:02:42,560
is that and you will be faced with this
 

2565
01:02:42,560 --> 01:02:46,240
is that and you will be faced with this
in lab three that because the RPC system

2566
01:02:46,240 --> 01:02:46,250
in lab three that because the RPC system
 

2567
01:02:46,250 --> 01:02:48,640
in lab three that because the RPC system
isn't perfectly reliable and perfectly

2568
01:02:48,640 --> 01:02:48,650
isn't perfectly reliable and perfectly
 

2569
01:02:48,650 --> 01:02:50,890
isn't perfectly reliable and perfectly
sequenced and RBC's can arrive out of

2570
01:02:50,890 --> 01:02:50,900
sequenced and RBC's can arrive out of
 

2571
01:02:50,900 --> 01:02:52,630
sequenced and RBC's can arrive out of
order or not at all or you may send an

2572
01:02:52,630 --> 01:02:52,640
order or not at all or you may send an
 

2573
01:02:52,640 --> 01:02:54,640
order or not at all or you may send an
RPC and get no response and think it was

2574
01:02:54,640 --> 01:02:54,650
RPC and get no response and think it was
 

2575
01:02:54,650 --> 01:02:56,440
RPC and get no response and think it was
lost but actually was delivered and was

2576
01:02:56,440 --> 01:02:56,450
lost but actually was delivered and was
 

2577
01:02:56,450 --> 01:02:58,300
lost but actually was delivered and was
the reply that was lost all these things

2578
01:02:58,300 --> 01:02:58,310
the reply that was lost all these things
 

2579
01:02:58,310 --> 01:03:02,530
the reply that was lost all these things
happen including to send to whatever

2580
01:03:02,530 --> 01:03:02,540
happen including to send to whatever
 

2581
01:03:02,540 --> 01:03:04,600
happen including to send to whatever
install snapshot our pcs and the leaders

2582
01:03:04,600 --> 01:03:04,610
install snapshot our pcs and the leaders
 

2583
01:03:04,610 --> 01:03:06,850
install snapshot our pcs and the leaders
almost certainly sending out many our

2584
01:03:06,850 --> 01:03:06,860
almost certainly sending out many our
 

2585
01:03:06,860 --> 01:03:08,740
almost certainly sending out many our
pcs concurrently you know both append

2586
01:03:08,740 --> 01:03:08,750
pcs concurrently you know both append
 

2587
01:03:08,750 --> 01:03:12,190
pcs concurrently you know both append
entries and install snapshots that means

2588
01:03:12,190 --> 01:03:12,200
entries and install snapshots that means
 

2589
01:03:12,200 --> 01:03:15,010
entries and install snapshots that means
that you can get things like install

2590
01:03:15,010 --> 01:03:15,020
that you can get things like install
 

2591
01:03:15,020 --> 01:03:20,550
that you can get things like install
snapshot our pcs from deep in the past

2592
01:03:20,550 --> 01:03:20,560

 

2593
01:03:20,560 --> 01:03:25,030

almost anything else right and therefore

2594
01:03:25,030 --> 01:03:25,040
almost anything else right and therefore
 

2595
01:03:25,040 --> 01:03:29,980
almost anything else right and therefore
the the follower has to be careful you

2596
01:03:29,980 --> 01:03:29,990
the the follower has to be careful you
 

2597
01:03:29,990 --> 01:03:31,210
the the follower has to be careful you
know has to think carefully about an

2598
01:03:31,210 --> 01:03:31,220
know has to think carefully about an
 

2599
01:03:31,220 --> 01:03:37,260
know has to think carefully about an
install snapshot that arrives and the

2600
01:03:37,260 --> 01:03:37,270

 

2601
01:03:37,270 --> 01:03:39,430

yeah I think the specific thing you're

2602
01:03:39,430 --> 01:03:39,440
yeah I think the specific thing you're
 

2603
01:03:39,440 --> 01:03:41,980
yeah I think the specific thing you're
asking is that if follower receives that

2604
01:03:41,980 --> 01:03:41,990
asking is that if follower receives that
 

2605
01:03:41,990 --> 01:03:43,780
asking is that if follower receives that
an install snapshot that appears to be

2606
01:03:43,780 --> 01:03:43,790
an install snapshot that appears to be
 

2607
01:03:43,790 --> 01:03:46,300
an install snapshot that appears to be
completely redundant that is the install

2608
01:03:46,300 --> 01:03:46,310
completely redundant that is the install
 

2609
01:03:46,310 --> 01:03:47,770
completely redundant that is the install
snapshot contains information that's

2610
01:03:47,770 --> 01:03:47,780
snapshot contains information that's
 

2611
01:03:47,780 --> 01:03:50,380
snapshot contains information that's
older than the information the follower

2612
01:03:50,380 --> 01:03:50,390
older than the information the follower
 

2613
01:03:50,390 --> 01:03:51,430
older than the information the follower
already has

2614
01:03:51,430 --> 01:03:51,440
already has
 

2615
01:03:51,440 --> 01:03:55,240
already has
what should the follower do and rule six

2616
01:03:55,240 --> 01:03:55,250
what should the follower do and rule six
 

2617
01:03:55,250 --> 01:03:57,340
what should the follower do and rule six
and figure thirteen says something but I

2618
01:03:57,340 --> 01:03:57,350
and figure thirteen says something but I
 

2619
01:03:57,350 --> 01:03:59,470
and figure thirteen says something but I
think equally valid response to that is

2620
01:03:59,470 --> 01:03:59,480
think equally valid response to that is
 

2621
01:03:59,480 --> 01:04:01,330
think equally valid response to that is
that the follower can ignore a snapshot

2622
01:04:01,330 --> 01:04:01,340
that the follower can ignore a snapshot
 

2623
01:04:01,340 --> 01:04:07,450
that the follower can ignore a snapshot
that clearly is from the past I don't

2624
01:04:07,450 --> 01:04:07,460
that clearly is from the past I don't
 

2625
01:04:07,460 --> 01:04:12,060
that clearly is from the past I don't
really understand that rule six okay I

2626
01:04:12,060 --> 01:04:12,070
really understand that rule six okay I
 

2627
01:04:12,070 --> 01:04:17,980
really understand that rule six okay I
want to move on to sort of somewhat more

2628
01:04:17,980 --> 01:04:17,990
want to move on to sort of somewhat more
 

2629
01:04:17,990 --> 01:04:21,700
want to move on to sort of somewhat more
conceptual topic for a bit so far we

2630
01:04:21,700 --> 01:04:21,710
conceptual topic for a bit so far we
 

2631
01:04:21,710 --> 01:04:24,720
conceptual topic for a bit so far we
haven't really tried to nail down

2632
01:04:24,720 --> 01:04:24,730
haven't really tried to nail down
 

2633
01:04:24,730 --> 01:04:27,010
haven't really tried to nail down
anything about what it meant to be

2634
01:04:27,010 --> 01:04:27,020
anything about what it meant to be
 

2635
01:04:27,020 --> 01:04:28,600
anything about what it meant to be
correct

2636
01:04:28,600 --> 01:04:28,610
correct
 

2637
01:04:28,610 --> 01:04:33,850
correct
what I meant for a replicated service

2638
01:04:33,850 --> 01:04:33,860
what I meant for a replicated service
 

2639
01:04:33,860 --> 01:04:36,280
what I meant for a replicated service
already any other kind of service to be

2640
01:04:36,280 --> 01:04:36,290
already any other kind of service to be
 

2641
01:04:36,290 --> 01:04:39,040
already any other kind of service to be
behaving correctly and the reason why

2642
01:04:39,040 --> 01:04:39,050
behaving correctly and the reason why
 

2643
01:04:39,050 --> 01:04:42,310
behaving correctly and the reason why
and you know whatever for most of my

2644
01:04:42,310 --> 01:04:42,320
and you know whatever for most of my
 

2645
01:04:42,320 --> 01:04:44,230
and you know whatever for most of my
life I managed to get by without

2646
01:04:44,230 --> 01:04:44,240
life I managed to get by without
 

2647
01:04:44,240 --> 01:04:46,060
life I managed to get by without
worrying too much about precise

2648
01:04:46,060 --> 01:04:46,070
worrying too much about precise
 

2649
01:04:46,070 --> 01:04:47,950
worrying too much about precise
definitions of correctness but the fact

2650
01:04:47,950 --> 01:04:47,960
definitions of correctness but the fact
 

2651
01:04:47,960 --> 01:04:49,720
definitions of correctness but the fact
is that you know if you're trying to

2652
01:04:49,720 --> 01:04:49,730
is that you know if you're trying to
 

2653
01:04:49,730 --> 01:04:51,370
is that you know if you're trying to
optimize something or you're trying to

2654
01:04:51,370 --> 01:04:51,380
optimize something or you're trying to
 

2655
01:04:51,380 --> 01:04:53,020
optimize something or you're trying to
think through some weird corner case

2656
01:04:53,020 --> 01:04:53,030
think through some weird corner case
 

2657
01:04:53,030 --> 01:04:55,810
think through some weird corner case
it's often handy to actually have a more

2658
01:04:55,810 --> 01:04:55,820
it's often handy to actually have a more
 

2659
01:04:55,820 --> 01:04:58,090
it's often handy to actually have a more
or less formal way of deciding is that

2660
01:04:58,090 --> 01:04:58,100
or less formal way of deciding is that
 

2661
01:04:58,100 --> 01:05:00,460
or less formal way of deciding is that
behavior correct or not correct and so

2662
01:05:00,460 --> 01:05:00,470
behavior correct or not correct and so
 

2663
01:05:00,470 --> 01:05:01,900
behavior correct or not correct and so
you know for here what we're talking

2664
01:05:01,900 --> 01:05:01,910
you know for here what we're talking
 

2665
01:05:01,910 --> 01:05:03,670
you know for here what we're talking
about is you know clients are sending in

2666
01:05:03,670 --> 01:05:03,680
about is you know clients are sending in
 

2667
01:05:03,680 --> 01:05:05,530
about is you know clients are sending in
requests to the to our replicated

2668
01:05:05,530 --> 01:05:05,540
requests to the to our replicated
 

2669
01:05:05,540 --> 01:05:07,690
requests to the to our replicated
service with our PC maybe they'll be

2670
01:05:07,690 --> 01:05:07,700
service with our PC maybe they'll be
 

2671
01:05:07,700 --> 01:05:09,700
service with our PC maybe they'll be
sending who knows well maybe the service

2672
01:05:09,700 --> 01:05:09,710
sending who knows well maybe the service
 

2673
01:05:09,710 --> 01:05:11,830
sending who knows well maybe the service
is crash it can be starting and you know

2674
01:05:11,830 --> 01:05:11,840
is crash it can be starting and you know
 

2675
01:05:11,840 --> 01:05:14,200
is crash it can be starting and you know
loading snapshots or whatever the client

2676
01:05:14,200 --> 01:05:14,210
loading snapshots or whatever the client
 

2677
01:05:14,210 --> 01:05:15,940
loading snapshots or whatever the client
sends in a request and gets a response

2678
01:05:15,940 --> 01:05:15,950
sends in a request and gets a response
 

2679
01:05:15,950 --> 01:05:18,310
sends in a request and gets a response
like is that response correct how are we

2680
01:05:18,310 --> 01:05:18,320
like is that response correct how are we
 

2681
01:05:18,320 --> 01:05:20,080
like is that response correct how are we
supposed to how are we supposed to tell

2682
01:05:20,080 --> 01:05:20,090
supposed to how are we supposed to tell
 

2683
01:05:20,090 --> 01:05:22,420
supposed to how are we supposed to tell
whether response a would be correct or

2684
01:05:22,420 --> 01:05:22,430
whether response a would be correct or
 

2685
01:05:22,430 --> 01:05:26,200
whether response a would be correct or
response B so we need a notion we need a

2686
01:05:26,200 --> 01:05:26,210
response B so we need a notion we need a
 

2687
01:05:26,210 --> 01:05:27,730
response B so we need a notion we need a
pretty formal notion of distinguishing

2688
01:05:27,730 --> 01:05:27,740
pretty formal notion of distinguishing
 

2689
01:05:27,740 --> 01:05:30,040
pretty formal notion of distinguishing
oh that's okay from now that would be a

2690
01:05:30,040 --> 01:05:30,050
oh that's okay from now that would be a
 

2691
01:05:30,050 --> 01:05:33,760
oh that's okay from now that would be a
wrong answer and for this lab the our

2692
01:05:33,760 --> 01:05:33,770
wrong answer and for this lab the our
 

2693
01:05:33,770 --> 01:05:36,220
wrong answer and for this lab the our
notion of correctness is linearize

2694
01:05:36,220 --> 01:05:36,230
notion of correctness is linearize
 

2695
01:05:36,230 --> 01:05:42,400
notion of correctness is linearize
ability and I mentioned strong

2696
01:05:42,400 --> 01:05:42,410
ability and I mentioned strong
 

2697
01:05:42,410 --> 01:05:43,900
ability and I mentioned strong
consistency and some of the papers I

2698
01:05:43,900 --> 01:05:43,910
consistency and some of the papers I
 

2699
01:05:43,910 --> 01:05:45,480
consistency and some of the papers I
mentioned strong consistency and

2700
01:05:45,480 --> 01:05:45,490
mentioned strong consistency and
 

2701
01:05:45,490 --> 01:05:47,260
mentioned strong consistency and
basically equivalent to linearize

2702
01:05:47,260 --> 01:05:47,270
basically equivalent to linearize
 

2703
01:05:47,270 --> 01:05:50,530
basically equivalent to linearize
ability linearize ability is a sort of a

2704
01:05:50,530 --> 01:05:50,540
ability linearize ability is a sort of a
 

2705
01:05:50,540 --> 01:05:54,570
ability linearize ability is a sort of a
formalization of more or less of the

2706
01:05:54,570 --> 01:05:54,580
formalization of more or less of the
 

2707
01:05:54,580 --> 01:05:57,400
formalization of more or less of the
behavior you would expect if there was

2708
01:05:57,400 --> 01:05:57,410
behavior you would expect if there was
 

2709
01:05:57,410 --> 01:05:59,710
behavior you would expect if there was
just one server and it didn't crash and

2710
01:05:59,710 --> 01:05:59,720
just one server and it didn't crash and
 

2711
01:05:59,720 --> 01:06:02,200
just one server and it didn't crash and
it executed the command client requests

2712
01:06:02,200 --> 01:06:02,210
it executed the command client requests
 

2713
01:06:02,210 --> 01:06:04,900
it executed the command client requests
one at a time and you know nothing funny

2714
01:06:04,900 --> 01:06:04,910
one at a time and you know nothing funny
 

2715
01:06:04,910 --> 01:06:09,160
one at a time and you know nothing funny
ever happened so it has it has a

2716
01:06:09,160 --> 01:06:09,170
ever happened so it has it has a
 

2717
01:06:09,170 --> 01:06:12,340
ever happened so it has it has a
definition and the definition I'll write

2718
01:06:12,340 --> 01:06:12,350
definition and the definition I'll write
 

2719
01:06:12,350 --> 01:06:14,100
definition and the definition I'll write
out the definition then talk about it so

2720
01:06:14,100 --> 01:06:14,110
out the definition then talk about it so
 

2721
01:06:14,110 --> 01:06:24,600
out the definition then talk about it so
so an execution history is linearizable

2722
01:06:24,600 --> 01:06:24,610
so an execution history is linearizable
 

2723
01:06:24,610 --> 01:06:30,820
so an execution history is linearizable
linearizable and this is in the notes if

2724
01:06:30,820 --> 01:06:30,830
linearizable and this is in the notes if
 

2725
01:06:30,830 --> 01:06:33,130
linearizable and this is in the notes if
there exists a total order so an

2726
01:06:33,130 --> 01:06:33,140
there exists a total order so an
 

2727
01:06:33,140 --> 01:06:34,900
there exists a total order so an
execution history is a sequence of

2728
01:06:34,900 --> 01:06:34,910
execution history is a sequence of
 

2729
01:06:34,910 --> 01:06:37,210
execution history is a sequence of
client requests maybe many requests from

2730
01:06:37,210 --> 01:06:37,220
client requests maybe many requests from
 

2731
01:06:37,220 --> 01:06:39,500
client requests maybe many requests from
many clients

2732
01:06:39,500 --> 01:06:39,510
many clients
 

2733
01:06:39,510 --> 01:06:46,880
many clients
if there's some total order of the

2734
01:06:46,880 --> 01:06:46,890
if there's some total order of the
 

2735
01:06:46,890 --> 01:06:53,630
if there's some total order of the
operations in the history it matches the

2736
01:06:53,630 --> 01:06:53,640
operations in the history it matches the
 

2737
01:06:53,640 --> 01:06:55,550
operations in the history it matches the
real-time order of requests so if one

2738
01:06:55,550 --> 01:06:55,560
real-time order of requests so if one
 

2739
01:06:55,560 --> 01:06:56,240
real-time order of requests so if one
request

2740
01:06:56,240 --> 01:06:56,250
request
 

2741
01:06:56,250 --> 01:06:57,980
request
if client sends out a request and gets a

2742
01:06:57,980 --> 01:06:57,990
if client sends out a request and gets a
 

2743
01:06:57,990 --> 01:07:01,190
if client sends out a request and gets a
response and then later in time another

2744
01:07:01,190 --> 01:07:01,200
response and then later in time another
 

2745
01:07:01,200 --> 01:07:02,720
response and then later in time another
client sends out a request and I get a

2746
01:07:02,720 --> 01:07:02,730
client sends out a request and I get a
 

2747
01:07:02,730 --> 01:07:04,880
client sends out a request and I get a
response those two requests are ordered

2748
01:07:04,880 --> 01:07:04,890
response those two requests are ordered
 

2749
01:07:04,890 --> 01:07:07,760
response those two requests are ordered
because one of them's started after the

2750
01:07:07,760 --> 01:07:07,770
because one of them's started after the
 

2751
01:07:07,770 --> 01:07:08,930
because one of them's started after the
other one finished

2752
01:07:08,930 --> 01:07:08,940
other one finished
 

2753
01:07:08,940 --> 01:07:12,290
other one finished
so it's linearizable history is

2754
01:07:12,290 --> 01:07:12,300
so it's linearizable history is
 

2755
01:07:12,300 --> 01:07:13,850
so it's linearizable history is
linearizable if there exists an order of

2756
01:07:13,850 --> 01:07:13,860
linearizable if there exists an order of
 

2757
01:07:13,860 --> 01:07:15,890
linearizable if there exists an order of
the operations in the history that

2758
01:07:15,890 --> 01:07:15,900
the operations in the history that
 

2759
01:07:15,900 --> 01:07:23,240
the operations in the history that
matches real-time for non concurrent

2760
01:07:23,240 --> 01:07:23,250
matches real-time for non concurrent
 

2761
01:07:23,250 --> 01:07:25,850
matches real-time for non concurrent
requests that is for a request to didn't

2762
01:07:25,850 --> 01:07:25,860
requests that is for a request to didn't
 

2763
01:07:25,860 --> 01:07:42,260
requests that is for a request to didn't
overlap in time and each read you can

2764
01:07:42,260 --> 01:07:42,270
overlap in time and each read you can
 

2765
01:07:42,270 --> 01:07:44,480
overlap in time and each read you can
think of it as each read sees the value

2766
01:07:44,480 --> 01:07:44,490
think of it as each read sees the value
 

2767
01:07:44,490 --> 01:07:46,730
think of it as each read sees the value
from the most immediately preceding

2768
01:07:46,730 --> 01:07:46,740
from the most immediately preceding
 

2769
01:07:46,740 --> 01:07:56,750
from the most immediately preceding
right to the the same piece of data most

2770
01:07:56,750 --> 01:07:56,760
right to the the same piece of data most
 

2771
01:07:56,760 --> 01:08:08,390
right to the the same piece of data most
recent right in the order all right this

2772
01:08:08,390 --> 01:08:08,400
recent right in the order all right this
 

2773
01:08:08,400 --> 01:08:10,820
recent right in the order all right this
is the definition let me illustrate what

2774
01:08:10,820 --> 01:08:10,830
is the definition let me illustrate what
 

2775
01:08:10,830 --> 01:08:12,610
is the definition let me illustrate what
it means by running through an example

2776
01:08:12,610 --> 01:08:12,620
it means by running through an example
 

2777
01:08:12,620 --> 01:08:15,200
it means by running through an example
so first of all the history is a record

2778
01:08:15,200 --> 01:08:15,210
so first of all the history is a record
 

2779
01:08:15,210 --> 01:08:16,610
so first of all the history is a record
of client operations so this is a

2780
01:08:16,610 --> 01:08:16,620
of client operations so this is a
 

2781
01:08:16,620 --> 01:08:18,500
of client operations so this is a
definition that you can apply from

2782
01:08:18,500 --> 01:08:18,510
definition that you can apply from
 

2783
01:08:18,510 --> 01:08:20,570
definition that you can apply from
outside this definition doesn't appeal

2784
01:08:20,570 --> 01:08:20,580
outside this definition doesn't appeal
 

2785
01:08:20,580 --> 01:08:23,420
outside this definition doesn't appeal
in any way to what happens inside the

2786
01:08:23,420 --> 01:08:23,430
in any way to what happens inside the
 

2787
01:08:23,430 --> 01:08:24,530
in any way to what happens inside the
implementation or how the implementation

2788
01:08:24,530 --> 01:08:24,540
implementation or how the implementation
 

2789
01:08:24,540 --> 01:08:27,170
implementation or how the implementation
works it's something that we can if we

2790
01:08:27,170 --> 01:08:27,180
works it's something that we can if we
 

2791
01:08:27,180 --> 01:08:29,990
works it's something that we can if we
see a system operating and we can watch

2792
01:08:29,990 --> 01:08:30,000
see a system operating and we can watch
 

2793
01:08:30,000 --> 01:08:32,450
see a system operating and we can watch
the messages that come in and out we can

2794
01:08:32,450 --> 01:08:32,460
the messages that come in and out we can
 

2795
01:08:32,460 --> 01:08:34,280
the messages that come in and out we can
answer the question was that execution

2796
01:08:34,280 --> 01:08:34,290
answer the question was that execution
 

2797
01:08:34,290 --> 01:08:44,820
answer the question was that execution
that we observe linearizable so let me

2798
01:08:44,820 --> 01:08:44,830

 

2799
01:08:44,830 --> 01:08:47,590

let me write out of history and talk

2800
01:08:47,590 --> 01:08:47,600
let me write out of history and talk
 

2801
01:08:47,600 --> 01:08:53,520
let me write out of history and talk
about why it is or isn't linearizable

2802
01:08:53,520 --> 01:08:53,530

 

2803
01:08:53,530 --> 01:09:01,690

all right so here's an example the new

2804
01:09:01,690 --> 01:09:01,700
all right so here's an example the new
 

2805
01:09:01,700 --> 01:09:03,370
all right so here's an example the new
eyes ability talks about operations that

2806
01:09:03,370 --> 01:09:03,380
eyes ability talks about operations that
 

2807
01:09:03,380 --> 01:09:05,530
eyes ability talks about operations that
start at one point and end at another

2808
01:09:05,530 --> 01:09:05,540
start at one point and end at another
 

2809
01:09:05,540 --> 01:09:07,240
start at one point and end at another
and so this corresponds to the time at

2810
01:09:07,240 --> 01:09:07,250
and so this corresponds to the time at
 

2811
01:09:07,250 --> 01:09:10,270
and so this corresponds to the time at
which a client sends a request and then

2812
01:09:10,270 --> 01:09:10,280
which a client sends a request and then
 

2813
01:09:10,280 --> 01:09:13,960
which a client sends a request and then
later receives a reply so let us suppose

2814
01:09:13,960 --> 01:09:13,970
later receives a reply so let us suppose
 

2815
01:09:13,970 --> 01:09:16,090
later receives a reply so let us suppose
that our history says that at at some

2816
01:09:16,090 --> 01:09:16,100
that our history says that at at some
 

2817
01:09:16,100 --> 01:09:19,180
that our history says that at at some
particular time this time some client

2818
01:09:19,180 --> 01:09:19,190
particular time this time some client
 

2819
01:09:19,190 --> 01:09:22,150
particular time this time some client
sent a write request for the data item

2820
01:09:22,150 --> 01:09:22,160
sent a write request for the data item
 

2821
01:09:22,160 --> 01:09:24,570
sent a write request for the data item
named X and asked for it to be set to 1

2822
01:09:24,570 --> 01:09:24,580
named X and asked for it to be set to 1
 

2823
01:09:24,580 --> 01:09:28,660
named X and asked for it to be set to 1
and then time passed and at the second

2824
01:09:28,660 --> 01:09:28,670
and then time passed and at the second
 

2825
01:09:28,670 --> 01:09:30,160
and then time passed and at the second
vertical bar is when that client got a

2826
01:09:30,160 --> 01:09:30,170
vertical bar is when that client got a
 

2827
01:09:30,170 --> 01:09:31,900
vertical bar is when that client got a
reply through send a request at this

2828
01:09:31,900 --> 01:09:31,910
reply through send a request at this
 

2829
01:09:31,910 --> 01:09:33,280
reply through send a request at this
point you know time pass who knows

2830
01:09:33,280 --> 01:09:33,290
point you know time pass who knows
 

2831
01:09:33,290 --> 01:09:34,690
point you know time pass who knows
what's happening when the client got a

2832
01:09:34,690 --> 01:09:34,700
what's happening when the client got a
 

2833
01:09:34,700 --> 01:09:37,720
what's happening when the client got a
reply there and then later in time that

2834
01:09:37,720 --> 01:09:37,730
reply there and then later in time that
 

2835
01:09:37,730 --> 01:09:39,010
reply there and then later in time that
client or some other client doesn't

2836
01:09:39,010 --> 01:09:39,020
client or some other client doesn't
 

2837
01:09:39,020 --> 01:09:40,270
client or some other client doesn't
really matter

2838
01:09:40,270 --> 01:09:40,280
really matter
 

2839
01:09:40,280 --> 01:09:43,090
really matter
sends a write request again for item X

2840
01:09:43,090 --> 01:09:43,100
sends a write request again for item X
 

2841
01:09:43,100 --> 01:09:45,460
sends a write request again for item X
and value 2 and gets a response to that

2842
01:09:45,460 --> 01:09:45,470
and value 2 and gets a response to that
 

2843
01:09:45,470 --> 01:09:52,360
and value 2 and gets a response to that
right meanwhile some client sends a read

2844
01:09:52,360 --> 01:09:52,370
right meanwhile some client sends a read
 

2845
01:09:52,370 --> 01:09:56,980
right meanwhile some client sends a read
for X and gets value 2 and sent the

2846
01:09:56,980 --> 01:09:56,990
for X and gets value 2 and sent the
 

2847
01:09:56,990 --> 01:09:58,810
for X and gets value 2 and sent the
request there and got the response with

2848
01:09:58,810 --> 01:09:58,820
request there and got the response with
 

2849
01:09:58,820 --> 01:10:00,880
request there and got the response with
value 2 there and there's another

2850
01:10:00,880 --> 01:10:00,890
value 2 there and there's another
 

2851
01:10:00,890 --> 01:10:03,310
value 2 there and there's another
request that we observed it's a part of

2852
01:10:03,310 --> 01:10:03,320
request that we observed it's a part of
 

2853
01:10:03,320 --> 01:10:07,270
request that we observed it's a part of
the history request was sent to read

2854
01:10:07,270 --> 01:10:07,280
the history request was sent to read
 

2855
01:10:07,280 --> 01:10:12,820
the history request was sent to read
value X and it got value 1 back and so

2856
01:10:12,820 --> 01:10:12,830
value X and it got value 1 back and so
 

2857
01:10:12,830 --> 01:10:14,740
value X and it got value 1 back and so
when we have a history like this you

2858
01:10:14,740 --> 01:10:14,750
when we have a history like this you
 

2859
01:10:14,750 --> 01:10:16,150
when we have a history like this you
know the question were that you asked

2860
01:10:16,150 --> 01:10:16,160
know the question were that you asked
 

2861
01:10:16,160 --> 01:10:17,680
know the question were that you asked
about this history is is this a

2862
01:10:17,680 --> 01:10:17,690
about this history is is this a
 

2863
01:10:17,690 --> 01:10:20,170
about this history is is this a
linearizable history that is did the

2864
01:10:20,170 --> 01:10:20,180
linearizable history that is did the
 

2865
01:10:20,180 --> 01:10:22,300
linearizable history that is did the
machinery did the service did the system

2866
01:10:22,300 --> 01:10:22,310
machinery did the service did the system
 

2867
01:10:22,310 --> 01:10:23,920
machinery did the service did the system
that produced this history and was that

2868
01:10:23,920 --> 01:10:23,930
that produced this history and was that
 

2869
01:10:23,930 --> 01:10:28,420
that produced this history and was that
a linearizable system or did it produce

2870
01:10:28,420 --> 01:10:28,430
a linearizable system or did it produce
 

2871
01:10:28,430 --> 01:10:30,370
a linearizable system or did it produce
a linearizable history in this case if

2872
01:10:30,370 --> 01:10:30,380
a linearizable history in this case if
 

2873
01:10:30,380 --> 01:10:31,780
a linearizable history in this case if
this history is not linear inaudible

2874
01:10:31,780 --> 01:10:31,790
this history is not linear inaudible
 

2875
01:10:31,790 --> 01:10:36,550
this history is not linear inaudible
then then Lisa we're talking about I

2876
01:10:36,550 --> 01:10:36,560
then then Lisa we're talking about I
 

2877
01:10:36,560 --> 01:10:38,740
then then Lisa we're talking about I
have 3 we know we have a problem there

2878
01:10:38,740 --> 01:10:38,750
have 3 we know we have a problem there
 

2879
01:10:38,750 --> 01:10:42,250
have 3 we know we have a problem there
must be some some bug ok so we need to

2880
01:10:42,250 --> 01:10:42,260
must be some some bug ok so we need to
 

2881
01:10:42,260 --> 01:10:43,450
must be some some bug ok so we need to
analyze this to figure out if it's

2882
01:10:43,450 --> 01:10:43,460
analyze this to figure out if it's
 

2883
01:10:43,460 --> 01:10:45,970
analyze this to figure out if it's
linearizable there's linear linearize

2884
01:10:45,970 --> 01:10:45,980
linearizable there's linear linearize
 

2885
01:10:45,980 --> 01:10:48,820
linearizable there's linear linearize
ability requires us to produce an order

2886
01:10:48,820 --> 01:10:48,830
ability requires us to produce an order
 

2887
01:10:48,830 --> 01:10:52,390
ability requires us to produce an order
you know one by one order of the four

2888
01:10:52,390 --> 01:10:52,400
you know one by one order of the four
 

2889
01:10:52,400 --> 01:10:54,790
you know one by one order of the four
operations in that history so we know

2890
01:10:54,790 --> 01:10:54,800
operations in that history so we know
 

2891
01:10:54,800 --> 01:10:55,840
operations in that history so we know
we're looking for an order and there's

2892
01:10:55,840 --> 01:10:55,850
we're looking for an order and there's
 

2893
01:10:55,850 --> 01:10:57,040
we're looking for an order and there's
two constraints on the

2894
01:10:57,040 --> 01:10:57,050
two constraints on the
 

2895
01:10:57,050 --> 01:11:03,880
two constraints on the
order one is if one operation finished

2896
01:11:03,880 --> 01:11:03,890
order one is if one operation finished
 

2897
01:11:03,890 --> 01:11:07,630
order one is if one operation finished
before another started then the one that

2898
01:11:07,630 --> 01:11:07,640
before another started then the one that
 

2899
01:11:07,640 --> 01:11:08,890
before another started then the one that
finished first has to come first in the

2900
01:11:08,890 --> 01:11:08,900
finished first has to come first in the
 

2901
01:11:08,900 --> 01:11:13,780
finished first has to come first in the
history the other is if some read sees a

2902
01:11:13,780 --> 01:11:13,790
history the other is if some read sees a
 

2903
01:11:13,790 --> 01:11:17,920
history the other is if some read sees a
particular written value then the read

2904
01:11:17,920 --> 01:11:17,930
particular written value then the read
 

2905
01:11:17,930 --> 01:11:20,910
particular written value then the read
must come after the write in the order

2906
01:11:20,910 --> 01:11:20,920
must come after the write in the order
 

2907
01:11:20,920 --> 01:11:23,080
must come after the write in the order
all right so we want to order so we're

2908
01:11:23,080 --> 01:11:23,090
all right so we want to order so we're
 

2909
01:11:23,090 --> 01:11:24,370
all right so we want to order so we're
gonna produce an order that has four

2910
01:11:24,370 --> 01:11:24,380
gonna produce an order that has four
 

2911
01:11:24,380 --> 01:11:26,640
gonna produce an order that has four
entries the two rights and the two leads

2912
01:11:26,640 --> 01:11:26,650
entries the two rights and the two leads
 

2913
01:11:26,650 --> 01:11:29,020
entries the two rights and the two leads
I'm gonna draw with arrows that

2914
01:11:29,020 --> 01:11:29,030
I'm gonna draw with arrows that
 

2915
01:11:29,030 --> 01:11:31,330
I'm gonna draw with arrows that
constraints implied by those two rules

2916
01:11:31,330 --> 01:11:31,340
constraints implied by those two rules
 

2917
01:11:31,340 --> 01:11:33,790
constraints implied by those two rules
and then our order is gonna have to obey

2918
01:11:33,790 --> 01:11:33,800
and then our order is gonna have to obey
 

2919
01:11:33,800 --> 01:11:36,430
and then our order is gonna have to obey
these constraints so one constraint is

2920
01:11:36,430 --> 01:11:36,440
these constraints so one constraint is
 

2921
01:11:36,440 --> 01:11:39,190
these constraints so one constraint is
that this write finished before this

2922
01:11:39,190 --> 01:11:39,200
that this write finished before this
 

2923
01:11:39,200 --> 01:11:41,260
that this write finished before this
write started and therefore one of the

2924
01:11:41,260 --> 01:11:41,270
write started and therefore one of the
 

2925
01:11:41,270 --> 01:11:44,410
write started and therefore one of the
ordering constraints is that this write

2926
01:11:44,410 --> 01:11:44,420
ordering constraints is that this write
 

2927
01:11:44,420 --> 01:11:47,470
ordering constraints is that this write
must appear in the total order before

2928
01:11:47,470 --> 01:11:47,480
must appear in the total order before
 

2929
01:11:47,480 --> 01:11:51,280
must appear in the total order before
this write this read saw the value of

2930
01:11:51,280 --> 01:11:51,290
this write this read saw the value of
 

2931
01:11:51,290 --> 01:11:56,860
this write this read saw the value of
two so in the total order the most

2932
01:11:56,860 --> 01:11:56,870
two so in the total order the most
 

2933
01:11:56,870 --> 01:11:59,080
two so in the total order the most
recent right that this read must come

2934
01:11:59,080 --> 01:11:59,090
recent right that this read must come
 

2935
01:11:59,090 --> 01:12:00,730
recent right that this read must come
after this right and this write must be

2936
01:12:00,730 --> 01:12:00,740
after this right and this write must be
 

2937
01:12:00,740 --> 01:12:03,600
after this right and this write must be
the most recent right so that means that

2938
01:12:03,600 --> 01:12:03,610
the most recent right so that means that
 

2939
01:12:03,610 --> 01:12:06,310
the most recent right so that means that
in the total order we must see the right

2940
01:12:06,310 --> 01:12:06,320
in the total order we must see the right
 

2941
01:12:06,320 --> 01:12:08,920
in the total order we must see the right
of X - 2 and then after it the read of X

2942
01:12:08,920 --> 01:12:08,930
of X - 2 and then after it the read of X
 

2943
01:12:08,930 --> 01:12:19,660
of X - 2 and then after it the read of X
it yields - and this this read of X of 1

2944
01:12:19,660 --> 01:12:19,670
it yields - and this this read of X of 1
 

2945
01:12:19,670 --> 01:12:21,040
it yields - and this this read of X of 1
if we assume that the X didn't already

2946
01:12:21,040 --> 01:12:21,050
if we assume that the X didn't already
 

2947
01:12:21,050 --> 01:12:23,200
if we assume that the X didn't already
have the value 1 there there must be in

2948
01:12:23,200 --> 01:12:23,210
have the value 1 there there must be in
 

2949
01:12:23,210 --> 01:12:27,010
have the value 1 there there must be in
this relationship and that is the read

2950
01:12:27,010 --> 01:12:27,020
this relationship and that is the read
 

2951
01:12:27,020 --> 01:12:29,230
this relationship and that is the read
must come after the right and this read

2952
01:12:29,230 --> 01:12:29,240
must come after the right and this read
 

2953
01:12:29,240 --> 01:12:32,740
must come after the right and this read
also must become for this right and

2954
01:12:32,740 --> 01:12:32,750
also must become for this right and
 

2955
01:12:32,750 --> 01:12:35,470
also must become for this right and
maybe there's some other restrictions -

2956
01:12:35,470 --> 01:12:35,480
maybe there's some other restrictions -
 

2957
01:12:35,480 --> 01:12:37,900
maybe there's some other restrictions -
anyway we can take these we can take

2958
01:12:37,900 --> 01:12:37,910
anyway we can take these we can take
 

2959
01:12:37,910 --> 01:12:39,250
anyway we can take these we can take
this set of arrows and flatten it out

2960
01:12:39,250 --> 01:12:39,260
this set of arrows and flatten it out
 

2961
01:12:39,260 --> 01:12:41,080
this set of arrows and flatten it out
into an order and that actually works so

2962
01:12:41,080 --> 01:12:41,090
into an order and that actually works so
 

2963
01:12:41,090 --> 01:12:44,020
into an order and that actually works so
the order that's the total order that

2964
01:12:44,020 --> 01:12:44,030
the order that's the total order that
 

2965
01:12:44,030 --> 01:12:45,580
the order that's the total order that
demonstrates that this history is

2966
01:12:45,580 --> 01:12:45,590
demonstrates that this history is
 

2967
01:12:45,590 --> 01:12:50,010
demonstrates that this history is
linearizable is first the right of x - 1

2968
01:12:50,010 --> 01:12:50,020
linearizable is first the right of x - 1
 

2969
01:12:50,020 --> 01:12:56,500
linearizable is first the right of x - 1
then the read of x yielding 1 then the

2970
01:12:56,500 --> 01:12:56,510
then the read of x yielding 1 then the
 

2971
01:12:56,510 --> 01:13:00,640
then the read of x yielding 1 then the
right of x - 2 and the read of x that

2972
01:13:00,640 --> 01:13:00,650
right of x - 2 and the read of x that
 

2973
01:13:00,650 --> 01:13:03,910
right of x - 2 and the read of x that
yields 2

2974
01:13:03,910 --> 01:13:03,920

 

2975
01:13:03,920 --> 01:13:06,380

alright so the fact that there is this

2976
01:13:06,380 --> 01:13:06,390
alright so the fact that there is this
 

2977
01:13:06,390 --> 01:13:07,910
alright so the fact that there is this
order that does obey the ordering

2978
01:13:07,910 --> 01:13:07,920
order that does obey the ordering
 

2979
01:13:07,920 --> 01:13:09,439
order that does obey the ordering
constraints shows that this history is

2980
01:13:09,439 --> 01:13:09,449
constraints shows that this history is
 

2981
01:13:09,449 --> 01:13:13,970
constraints shows that this history is
linearize ability and doesn't you know

2982
01:13:13,970 --> 01:13:13,980
linearize ability and doesn't you know
 

2983
01:13:13,980 --> 01:13:15,290
linearize ability and doesn't you know
if we're worried about the system that

2984
01:13:15,290 --> 01:13:15,300
if we're worried about the system that
 

2985
01:13:15,300 --> 01:13:17,930
if we're worried about the system that
produced this history whether it's a but

2986
01:13:17,930 --> 01:13:17,940
produced this history whether it's a but
 

2987
01:13:17,940 --> 01:13:20,600
produced this history whether it's a but
that system is linearizable then this

2988
01:13:20,600 --> 01:13:20,610
that system is linearizable then this
 

2989
01:13:20,610 --> 01:13:22,100
that system is linearizable then this
particular example we saw it doesn't

2990
01:13:22,100 --> 01:13:22,110
particular example we saw it doesn't
 

2991
01:13:22,110 --> 01:13:24,650
particular example we saw it doesn't
contradict the presumption that the

2992
01:13:24,650 --> 01:13:24,660
contradict the presumption that the
 

2993
01:13:24,660 --> 01:13:29,030
contradict the presumption that the
system is linearizable any questions

2994
01:13:29,030 --> 01:13:29,040
system is linearizable any questions
 

2995
01:13:29,040 --> 01:13:45,350
system is linearizable any questions
about what I just did each read sees you

2996
01:13:45,350 --> 01:13:45,360
about what I just did each read sees you
 

2997
01:13:45,360 --> 01:13:48,140
about what I just did each read sees you
know read of X the value it sees must be

2998
01:13:48,140 --> 01:13:48,150
know read of X the value it sees must be
 

2999
01:13:48,150 --> 01:13:51,590
know read of X the value it sees must be
them value written by the most the most

3000
01:13:51,590 --> 01:13:51,600
them value written by the most the most
 

3001
01:13:51,600 --> 01:13:56,320
them value written by the most the most
recent proceeding right in the order so

3002
01:13:56,320 --> 01:13:56,330
recent proceeding right in the order so
 

3003
01:13:56,330 --> 01:13:58,910
recent proceeding right in the order so
you know in this case in this case we're

3004
01:13:58,910 --> 01:13:58,920
you know in this case in this case we're
 

3005
01:13:58,920 --> 01:14:00,229
you know in this case in this case we're
totally ok with this order because this

3006
01:14:00,229 --> 01:14:00,239
totally ok with this order because this
 

3007
01:14:00,239 --> 01:14:03,439
totally ok with this order because this
read the value it saw is indeed the

3008
01:14:03,439 --> 01:14:03,449
read the value it saw is indeed the
 

3009
01:14:03,449 --> 01:14:04,760
read the value it saw is indeed the
value written by the most recent write

3010
01:14:04,760 --> 01:14:04,770
value written by the most recent write
 

3011
01:14:04,770 --> 01:14:08,240
value written by the most recent write
in this order and this read the value it

3012
01:14:08,240 --> 01:14:08,250
in this order and this read the value it
 

3013
01:14:08,250 --> 01:14:12,620
in this order and this read the value it
sighs I mean in informally it's that

3014
01:14:12,620 --> 01:14:12,630
sighs I mean in informally it's that
 

3015
01:14:12,630 --> 01:14:15,410
sighs I mean in informally it's that
reads can't real should not be yielding

3016
01:14:15,410 --> 01:14:15,420
reads can't real should not be yielding
 

3017
01:14:15,420 --> 01:14:17,930
reads can't real should not be yielding
stale data if I write something in Rita

3018
01:14:17,930 --> 01:14:17,940
stale data if I write something in Rita
 

3019
01:14:17,940 --> 01:14:20,030
stale data if I write something in Rita
back gosh I should see the value I wrote

3020
01:14:20,030 --> 01:14:20,040
back gosh I should see the value I wrote
 

3021
01:14:20,040 --> 01:14:21,860
back gosh I should see the value I wrote
and that's like a formalization of the

3022
01:14:21,860 --> 01:14:21,870
and that's like a formalization of the
 

3023
01:14:21,870 --> 01:14:27,520
and that's like a formalization of the
notion that

3024
01:14:27,520 --> 01:14:27,530

 

3025
01:14:27,530 --> 01:14:34,120

oh yes oh yeah yeah all right let me let

3026
01:14:34,120 --> 01:14:34,130
oh yes oh yeah yeah all right let me let
 

3027
01:14:34,130 --> 01:14:40,420
oh yes oh yeah yeah all right let me let
me he's right up example that's not

3028
01:14:40,420 --> 01:14:40,430
me he's right up example that's not
 

3029
01:14:40,430 --> 01:14:44,800
me he's right up example that's not
indeed linearizable so example two let's

3030
01:14:44,800 --> 01:14:44,810
indeed linearizable so example two let's
 

3031
01:14:44,810 --> 01:14:48,100
indeed linearizable so example two let's
suppose our history is we had a right of

3032
01:14:48,100 --> 01:14:48,110
suppose our history is we had a right of
 

3033
01:14:48,110 --> 01:15:14,080
suppose our history is we had a right of
X value one right back with value two

3034
01:15:14,080 --> 01:15:14,090

 

3035
01:15:14,090 --> 01:15:16,630

and so this one we also want to write

3036
01:15:16,630 --> 01:15:16,640
and so this one we also want to write
 

3037
01:15:16,640 --> 01:15:20,110
and so this one we also want to write
out the arrows and so we know what the

3038
01:15:20,110 --> 01:15:20,120
out the arrows and so we know what the
 

3039
01:15:20,120 --> 01:15:21,910
out the arrows and so we know what the
constraints are on any total order we

3040
01:15:21,910 --> 01:15:21,920
constraints are on any total order we
 

3041
01:15:21,920 --> 01:15:26,110
constraints are on any total order we
might find the right of X to one because

3042
01:15:26,110 --> 01:15:26,120
might find the right of X to one because
 

3043
01:15:26,120 --> 01:15:28,570
might find the right of X to one because
of time because it finished in real time

3044
01:15:28,570 --> 01:15:28,580
of time because it finished in real time
 

3045
01:15:28,580 --> 01:15:31,120
of time because it finished in real time
before the right x to started and must

3046
01:15:31,120 --> 01:15:31,130
before the right x to started and must
 

3047
01:15:31,130 --> 01:15:36,190
before the right x to started and must
come before in any satisfying order we

3048
01:15:36,190 --> 01:15:36,200
come before in any satisfying order we
 

3049
01:15:36,200 --> 01:15:38,500
come before in any satisfying order we
produce the right of Ecsta two has to

3050
01:15:38,500 --> 01:15:38,510
produce the right of Ecsta two has to
 

3051
01:15:38,510 --> 01:15:41,050
produce the right of Ecsta two has to
come before the right before the read of

3052
01:15:41,050 --> 01:15:41,060
come before the right before the read of
 

3053
01:15:41,060 --> 01:15:46,830
come before the right before the read of
X that yields two so we have this arrow

3054
01:15:46,830 --> 01:15:46,840

 

3055
01:15:46,840 --> 01:15:49,390

the read of X had to finished before the

3056
01:15:49,390 --> 01:15:49,400
the read of X had to finished before the
 

3057
01:15:49,400 --> 01:15:51,400
the read of X had to finished before the
read of X to one started so we have this

3058
01:15:51,400 --> 01:15:51,410
read of X to one started so we have this
 

3059
01:15:51,410 --> 01:16:00,250
read of X to one started so we have this
arrow and the read of X to one because

3060
01:16:00,250 --> 01:16:00,260
arrow and the read of X to one because
 

3061
01:16:00,260 --> 01:16:03,820
arrow and the read of X to one because
it saw value one has to come after the

3062
01:16:03,820 --> 01:16:03,830
it saw value one has to come after the
 

3063
01:16:03,830 --> 01:16:06,130
it saw value one has to come after the
right of X - 1 and more crucially before

3064
01:16:06,130 --> 01:16:06,140
right of X - 1 and more crucially before
 

3065
01:16:06,140 --> 01:16:09,760
right of X - 1 and more crucially before
the right of X 2 - right so we can't

3066
01:16:09,760 --> 01:16:09,770
the right of X 2 - right so we can't
 

3067
01:16:09,770 --> 01:16:12,220
the right of X 2 - right so we can't
have this read of X yielding one if it's

3068
01:16:12,220 --> 01:16:12,230
have this read of X yielding one if it's
 

3069
01:16:12,230 --> 01:16:14,230
have this read of X yielding one if it's
immediately preceded by I'll write out X

3070
01:16:14,230 --> 01:16:14,240
immediately preceded by I'll write out X
 

3071
01:16:14,240 --> 01:16:18,240
immediately preceded by I'll write out X
- 2 so we also have this arrow like this

3072
01:16:18,240 --> 01:16:18,250
- 2 so we also have this arrow like this
 

3073
01:16:18,250 --> 01:16:23,050
- 2 so we also have this arrow like this
and because there's a cycle in these

3074
01:16:23,050 --> 01:16:23,060
and because there's a cycle in these
 

3075
01:16:23,060 --> 01:16:27,100
and because there's a cycle in these
constraints there's no order that can

3076
01:16:27,100 --> 01:16:27,110
constraints there's no order that can
 

3077
01:16:27,110 --> 01:16:29,140
constraints there's no order that can
obey all these constraints and therefore

3078
01:16:29,140 --> 01:16:29,150
obey all these constraints and therefore
 

3079
01:16:29,150 --> 01:16:35,170
obey all these constraints and therefore
this history is not linearizable and so

3080
01:16:35,170 --> 01:16:35,180
this history is not linearizable and so
 

3081
01:16:35,180 --> 01:16:37,650
this history is not linearizable and so
the system that produced it is

3082
01:16:37,650 --> 01:16:37,660
the system that produced it is
 

3083
01:16:37,660 --> 01:16:42,870
the system that produced it is
is not a linearizable system you know

3084
01:16:42,870 --> 01:16:42,880
is not a linearizable system you know
 

3085
01:16:42,880 --> 01:16:44,310
is not a linearizable system you know
would be linearizable the history was

3086
01:16:44,310 --> 01:16:44,320
would be linearizable the history was
 

3087
01:16:44,320 --> 01:16:47,730
would be linearizable the history was
missing any one of these three and I

3088
01:16:47,730 --> 01:16:47,740
missing any one of these three and I
 

3089
01:16:47,740 --> 01:17:05,760
missing any one of these three and I
would break the cycle yes maybe I'm not

3090
01:17:05,760 --> 01:17:05,770
would break the cycle yes maybe I'm not
 

3091
01:17:05,770 --> 01:17:08,610
would break the cycle yes maybe I'm not
sure because suppose or I don't know how

3092
01:17:08,610 --> 01:17:08,620
sure because suppose or I don't know how
 

3093
01:17:08,620 --> 01:17:11,220
sure because suppose or I don't know how
to incorporate very strange things like

3094
01:17:11,220 --> 01:17:11,230
to incorporate very strange things like
 

3095
01:17:11,230 --> 01:17:16,860
to incorporate very strange things like
supposing somebody red 27 you know it

3096
01:17:16,860 --> 01:17:16,870
supposing somebody red 27 you know it
 

3097
01:17:16,870 --> 01:17:18,900
supposing somebody red 27 you know it
doesn't really if there's no right of 27

3098
01:17:18,900 --> 01:17:18,910
doesn't really if there's no right of 27
 

3099
01:17:18,910 --> 01:17:22,350
doesn't really if there's no right of 27
a read of 27 doesn't at least the way

3100
01:17:22,350 --> 01:17:22,360
a read of 27 doesn't at least the way
 

3101
01:17:22,360 --> 01:17:23,700
a read of 27 doesn't at least the way
I've written out the rules doesn't sort

3102
01:17:23,700 --> 01:17:23,710
I've written out the rules doesn't sort
 

3103
01:17:23,710 --> 01:17:26,610
I've written out the rules doesn't sort
of well there may be some sort of anti

3104
01:17:26,610 --> 01:17:26,620
of well there may be some sort of anti
 

3105
01:17:26,620 --> 01:17:29,190
of well there may be some sort of anti
dependency that you would construct okay

3106
01:17:29,190 --> 01:17:29,200
dependency that you would construct okay
 

3107
01:17:29,200 --> 01:17:33,120
dependency that you would construct okay
um I will continue this discussion next

3108
01:17:33,120 --> 01:17:33,130
um I will continue this discussion next
 

3109
01:17:33,130 --> 01:17:35,340
um I will continue this discussion next
week

