1
00:00:00,540 --> 00:00:03,500

all right today's topic is distributed

2
00:00:03,500 --> 00:00:03,510
all right today's topic is distributed
 

3
00:00:03,510 --> 00:00:15,499
all right today's topic is distributed
transactions and these come in really to

4
00:00:15,499 --> 00:00:15,509
transactions and these come in really to
 

5
00:00:15,509 --> 00:00:17,660
transactions and these come in really to
implementation pieces and that's how

6
00:00:17,660 --> 00:00:17,670
implementation pieces and that's how
 

7
00:00:17,670 --> 00:00:20,000
implementation pieces and that's how
I'll cover them the first big piece of

8
00:00:20,000 --> 00:00:20,010
I'll cover them the first big piece of
 

9
00:00:20,010 --> 00:00:28,640
I'll cover them the first big piece of
concurrency control the second is atomic

10
00:00:28,640 --> 00:00:28,650
concurrency control the second is atomic
 

11
00:00:28,650 --> 00:00:35,090
concurrency control the second is atomic
commit and the reason why distributive

12
00:00:35,090 --> 00:00:35,100
commit and the reason why distributive
 

13
00:00:35,100 --> 00:00:36,590
commit and the reason why distributive
transactions come up is that it's very

14
00:00:36,590 --> 00:00:36,600
transactions come up is that it's very
 

15
00:00:36,600 --> 00:00:38,630
transactions come up is that it's very
frequent for people with large amounts

16
00:00:38,630 --> 00:00:38,640
frequent for people with large amounts
 

17
00:00:38,640 --> 00:00:41,090
frequent for people with large amounts
of data to end up splitting or sharding

18
00:00:41,090 --> 00:00:41,100
of data to end up splitting or sharding
 

19
00:00:41,100 --> 00:00:43,970
of data to end up splitting or sharding
the data over many different servers so

20
00:00:43,970 --> 00:00:43,980
the data over many different servers so
 

21
00:00:43,980 --> 00:00:45,560
the data over many different servers so
maybe if you're running a bank for

22
00:00:45,560 --> 00:00:45,570
maybe if you're running a bank for
 

23
00:00:45,570 --> 00:00:49,310
maybe if you're running a bank for
example the bank balances for half your

24
00:00:49,310 --> 00:00:49,320
example the bank balances for half your
 

25
00:00:49,320 --> 00:00:51,410
example the bank balances for half your
customers are one server and the bank

26
00:00:51,410 --> 00:00:51,420
customers are one server and the bank
 

27
00:00:51,420 --> 00:00:53,030
customers are one server and the bank
balances for the other half are on a

28
00:00:53,030 --> 00:00:53,040
balances for the other half are on a
 

29
00:00:53,040 --> 00:00:54,770
balances for the other half are on a
different server let's do it like split

30
00:00:54,770 --> 00:00:54,780
different server let's do it like split
 

31
00:00:54,780 --> 00:00:56,600
different server let's do it like split
the load both the processing load and

32
00:00:56,600 --> 00:00:56,610
the load both the processing load and
 

33
00:00:56,610 --> 00:01:00,800
the load both the processing load and
the space requirements this comes up for

34
00:01:00,800 --> 00:01:00,810
the space requirements this comes up for
 

35
00:01:00,810 --> 00:01:02,180
the space requirements this comes up for
other things too maybe you're recording

36
00:01:02,180 --> 00:01:02,190
other things too maybe you're recording
 

37
00:01:02,190 --> 00:01:05,420
other things too maybe you're recording
vote counts on articles at a website you

38
00:01:05,420 --> 00:01:05,430
vote counts on articles at a website you
 

39
00:01:05,430 --> 00:01:07,370
vote counts on articles at a website you
know the maybe there's so many millions

40
00:01:07,370 --> 00:01:07,380
know the maybe there's so many millions
 

41
00:01:07,380 --> 00:01:08,870
know the maybe there's so many millions
millions of articles half the vote

42
00:01:08,870 --> 00:01:08,880
millions of articles half the vote
 

43
00:01:08,880 --> 00:01:11,570
millions of articles half the vote
counts are and are on one server and

44
00:01:11,570 --> 00:01:11,580
counts are and are on one server and
 

45
00:01:11,580 --> 00:01:15,500
counts are and are on one server and
half the vote cancer or another but some

46
00:01:15,500 --> 00:01:15,510
half the vote cancer or another but some
 

47
00:01:15,510 --> 00:01:18,500
half the vote cancer or another but some
operations require touching modifying or

48
00:01:18,500 --> 00:01:18,510
operations require touching modifying or
 

49
00:01:18,510 --> 00:01:20,270
operations require touching modifying or
reading data on multiple different

50
00:01:20,270 --> 00:01:20,280
reading data on multiple different
 

51
00:01:20,280 --> 00:01:21,649
reading data on multiple different
servers so if we're doing a bank

52
00:01:21,649 --> 00:01:21,659
servers so if we're doing a bank
 

53
00:01:21,659 --> 00:01:23,690
servers so if we're doing a bank
transfer from one customer into another

54
00:01:23,690 --> 00:01:23,700
transfer from one customer into another
 

55
00:01:23,700 --> 00:01:25,430
transfer from one customer into another
well their balances may be on different

56
00:01:25,430 --> 00:01:25,440
well their balances may be on different
 

57
00:01:25,440 --> 00:01:27,469
well their balances may be on different
servers and therefore in order to do the

58
00:01:27,469 --> 00:01:27,479
servers and therefore in order to do the
 

59
00:01:27,479 --> 00:01:29,480
servers and therefore in order to do the
balance we have to modify data read and

60
00:01:29,480 --> 00:01:29,490
balance we have to modify data read and
 

61
00:01:29,490 --> 00:01:33,080
balance we have to modify data read and
write data on two different servers and

62
00:01:33,080 --> 00:01:33,090
write data on two different servers and
 

63
00:01:33,090 --> 00:01:37,280
write data on two different servers and
we'd really like to or one way building

64
00:01:37,280 --> 00:01:37,290
we'd really like to or one way building
 

65
00:01:37,290 --> 00:01:39,289
we'd really like to or one way building
these systems and we'll see others later

66
00:01:39,289 --> 00:01:39,299
these systems and we'll see others later
 

67
00:01:39,299 --> 00:01:40,609
these systems and we'll see others later
on in the course one way to build the

68
00:01:40,609 --> 00:01:40,619
on in the course one way to build the
 

69
00:01:40,619 --> 00:01:43,670
on in the course one way to build the
system just try to hide the complexity

70
00:01:43,670 --> 00:01:43,680
system just try to hide the complexity
 

71
00:01:43,680 --> 00:01:46,010
system just try to hide the complexity
of splitting this data across multiple

72
00:01:46,010 --> 00:01:46,020
of splitting this data across multiple
 

73
00:01:46,020 --> 00:01:47,660
of splitting this data across multiple
servers try to hide it from the

74
00:01:47,660 --> 00:01:47,670
servers try to hide it from the
 

75
00:01:47,670 --> 00:01:51,800
servers try to hide it from the
application programmer and this is like

76
00:01:51,800 --> 00:01:51,810
application programmer and this is like
 

77
00:01:51,810 --> 00:01:53,899
application programmer and this is like
traditionally has been a database

78
00:01:53,899 --> 00:01:53,909
traditionally has been a database
 

79
00:01:53,909 --> 00:01:56,929
traditionally has been a database
concern for for many decades and so a

80
00:01:56,929 --> 00:01:56,939
concern for for many decades and so a
 

81
00:01:56,939 --> 00:01:58,490
concern for for many decades and so a
lot of today's material originated with

82
00:01:58,490 --> 00:01:58,500
lot of today's material originated with
 

83
00:01:58,500 --> 00:02:00,830
lot of today's material originated with
databases but the ideas have been used

84
00:02:00,830 --> 00:02:00,840
databases but the ideas have been used
 

85
00:02:00,840 --> 00:02:03,380
databases but the ideas have been used
much more widely in distributed systems

86
00:02:03,380 --> 00:02:03,390
much more widely in distributed systems
 

87
00:02:03,390 --> 00:02:04,640
much more widely in distributed systems
which you wouldn't necessarily call a

88
00:02:04,640 --> 00:02:04,650
which you wouldn't necessarily call a
 

89
00:02:04,650 --> 00:02:09,499
which you wouldn't necessarily call a
traditional database the way people sort

90
00:02:09,499 --> 00:02:09,509
traditional database the way people sort
 

91
00:02:09,509 --> 00:02:13,009
traditional database the way people sort
of usually package up concurrency

92
00:02:13,009 --> 00:02:13,019
of usually package up concurrency
 

93
00:02:13,019 --> 00:02:16,610
of usually package up concurrency
control plus

94
00:02:16,610 --> 00:02:16,620

 

95
00:02:16,620 --> 00:02:23,250

atomic commit is in abstraction called a

96
00:02:23,250 --> 00:02:23,260
atomic commit is in abstraction called a
 

97
00:02:23,260 --> 00:02:30,949
atomic commit is in abstraction called a
transaction which we've seen before and

98
00:02:30,949 --> 00:02:30,959
transaction which we've seen before and
 

99
00:02:30,959 --> 00:02:33,930
transaction which we've seen before and
the idea is that the programmer you know

100
00:02:33,930 --> 00:02:33,940
the idea is that the programmer you know
 

101
00:02:33,940 --> 00:02:36,509
the idea is that the programmer you know
has a bunch of different operations may

102
00:02:36,509 --> 00:02:36,519
has a bunch of different operations may
 

103
00:02:36,519 --> 00:02:37,880
has a bunch of different operations may
be on different records in the database

104
00:02:37,880 --> 00:02:37,890
be on different records in the database
 

105
00:02:37,890 --> 00:02:40,680
be on different records in the database
they'd like all those operations to be

106
00:02:40,680 --> 00:02:40,690
they'd like all those operations to be
 

107
00:02:40,690 --> 00:02:43,589
they'd like all those operations to be
sort of a single unit and not split by

108
00:02:43,589 --> 00:02:43,599
sort of a single unit and not split by
 

109
00:02:43,599 --> 00:02:45,720
sort of a single unit and not split by
failures or by observation from other

110
00:02:45,720 --> 00:02:45,730
failures or by observation from other
 

111
00:02:45,730 --> 00:02:50,190
failures or by observation from other
activities and the transaction

112
00:02:50,190 --> 00:02:50,200
activities and the transaction
 

113
00:02:50,200 --> 00:02:52,110
activities and the transaction
processing system will require the

114
00:02:52,110 --> 00:02:52,120
processing system will require the
 

115
00:02:52,120 --> 00:02:53,850
processing system will require the
programmer to mark the beginning and the

116
00:02:53,850 --> 00:02:53,860
programmer to mark the beginning and the
 

117
00:02:53,860 --> 00:02:56,250
programmer to mark the beginning and the
end of that sequence of reading and

118
00:02:56,250 --> 00:02:56,260
end of that sequence of reading and
 

119
00:02:56,260 --> 00:02:58,559
end of that sequence of reading and
writing and updating operations in order

120
00:02:58,559 --> 00:02:58,569
writing and updating operations in order
 

121
00:02:58,569 --> 00:02:59,729
writing and updating operations in order
to mark the beginning and of the

122
00:02:59,729 --> 00:02:59,739
to mark the beginning and of the
 

123
00:02:59,739 --> 00:03:00,900
to mark the beginning and of the
transaction and the transaction

124
00:03:00,900 --> 00:03:00,910
transaction and the transaction
 

125
00:03:00,910 --> 00:03:03,089
transaction and the transaction
processing system has certainly will

126
00:03:03,089 --> 00:03:03,099
processing system has certainly will
 

127
00:03:03,099 --> 00:03:05,610
processing system has certainly will
provide certain guarantees about what

128
00:03:05,610 --> 00:03:05,620
provide certain guarantees about what
 

129
00:03:05,620 --> 00:03:07,080
provide certain guarantees about what
happens between the beginning and the

130
00:03:07,080 --> 00:03:07,090
happens between the beginning and the
 

131
00:03:07,090 --> 00:03:07,650
happens between the beginning and the
end

132
00:03:07,650 --> 00:03:07,660
end
 

133
00:03:07,660 --> 00:03:11,190
end
so for example supposing we're running

134
00:03:11,190 --> 00:03:11,200
so for example supposing we're running
 

135
00:03:11,200 --> 00:03:15,120
so for example supposing we're running
our bank and we want to do a transfer

136
00:03:15,120 --> 00:03:15,130
our bank and we want to do a transfer
 

137
00:03:15,130 --> 00:03:19,289
our bank and we want to do a transfer
from account of user X to the account of

138
00:03:19,289 --> 00:03:19,299
from account of user X to the account of
 

139
00:03:19,299 --> 00:03:21,660
from account of user X to the account of
user wide now these balances from both

140
00:03:21,660 --> 00:03:21,670
user wide now these balances from both
 

141
00:03:21,670 --> 00:03:23,900
user wide now these balances from both
of them start out as 10 so initially

142
00:03:23,900 --> 00:03:23,910
of them start out as 10 so initially
 

143
00:03:23,910 --> 00:03:29,990
of them start out as 10 so initially
expose 10 y equals 10 and x and y I'm

144
00:03:29,990 --> 00:03:30,000
expose 10 y equals 10 and x and y I'm
 

145
00:03:30,000 --> 00:03:35,550
expose 10 y equals 10 and x and y I'm
mean to be records in a database and we

146
00:03:35,550 --> 00:03:35,560
mean to be records in a database and we
 

147
00:03:35,560 --> 00:03:38,039
mean to be records in a database and we
want to transfer we will actually

148
00:03:38,039 --> 00:03:38,049
want to transfer we will actually
 

149
00:03:38,049 --> 00:03:40,229
want to transfer we will actually
imagine that there's two transactions

150
00:03:40,229 --> 00:03:40,239
imagine that there's two transactions
 

151
00:03:40,239 --> 00:03:41,729
imagine that there's two transactions
that might be running at the same time

152
00:03:41,729 --> 00:03:41,739
that might be running at the same time
 

153
00:03:41,739 --> 00:03:44,819
that might be running at the same time
one to transfer a dollar from account X

154
00:03:44,819 --> 00:03:44,829
one to transfer a dollar from account X
 

155
00:03:44,829 --> 00:03:47,009
one to transfer a dollar from account X
to account Y and the other transaction

156
00:03:47,009 --> 00:03:47,019
to account Y and the other transaction
 

157
00:03:47,019 --> 00:03:49,979
to account Y and the other transaction
to do an audit of of all the accounts at

158
00:03:49,979 --> 00:03:49,989
to do an audit of of all the accounts at
 

159
00:03:49,989 --> 00:03:51,690
to do an audit of of all the accounts at
the bank to make sure that the total

160
00:03:51,690 --> 00:03:51,700
the bank to make sure that the total
 

161
00:03:51,700 --> 00:03:53,400
the bank to make sure that the total
amount of money in the bank never

162
00:03:53,400 --> 00:03:53,410
amount of money in the bank never
 

163
00:03:53,410 --> 00:03:54,809
amount of money in the bank never
changes because after all if you do

164
00:03:54,809 --> 00:03:54,819
changes because after all if you do
 

165
00:03:54,819 --> 00:03:56,759
changes because after all if you do
transfers you know the total shouldn't

166
00:03:56,759 --> 00:03:56,769
transfers you know the total shouldn't
 

167
00:03:56,769 --> 00:03:58,020
transfers you know the total shouldn't
change even if you move money between

168
00:03:58,020 --> 00:03:58,030
change even if you move money between
 

169
00:03:58,030 --> 00:04:01,170
change even if you move money between
accounts in order to express this with

170
00:04:01,170 --> 00:04:01,180
accounts in order to express this with
 

171
00:04:01,180 --> 00:04:04,710
accounts in order to express this with
transactions we might have two

172
00:04:04,710 --> 00:04:04,720
transactions we might have two
 

173
00:04:04,720 --> 00:04:07,080
transactions we might have two
transactions the first transaction call

174
00:04:07,080 --> 00:04:07,090
transactions the first transaction call
 

175
00:04:07,090 --> 00:04:10,949
transactions the first transaction call
it t1 is the transfer well mark the

176
00:04:10,949 --> 00:04:10,959
it t1 is the transfer well mark the
 

177
00:04:10,959 --> 00:04:12,840
it t1 is the transfer well mark the
programmer is expected to mark the

178
00:04:12,840 --> 00:04:12,850
programmer is expected to mark the
 

179
00:04:12,850 --> 00:04:13,949
programmer is expected to mark the
beginning of it with the begin

180
00:04:13,949 --> 00:04:13,959
beginning of it with the begin
 

181
00:04:13,959 --> 00:04:17,969
beginning of it with the begin
transaction which all right at the

182
00:04:17,969 --> 00:04:17,979
transaction which all right at the
 

183
00:04:17,979 --> 00:04:21,210
transaction which all right at the
beginning and then the operations on the

184
00:04:21,210 --> 00:04:21,220
beginning and then the operations on the
 

185
00:04:21,220 --> 00:04:23,909
beginning and then the operations on the
two balances on the two records in the

186
00:04:23,909 --> 00:04:23,919
two balances on the two records in the
 

187
00:04:23,919 --> 00:04:25,540
two balances on the two records in the
database so we might add

188
00:04:25,540 --> 00:04:25,550
database so we might add
 

189
00:04:25,550 --> 00:04:27,120
database so we might add
[Music]

190
00:04:27,120 --> 00:04:27,130
[Music]
 

191
00:04:27,130 --> 00:04:34,090
[Music]
one might add one the balance X and add

192
00:04:34,090 --> 00:04:34,100
one might add one the balance X and add
 

193
00:04:34,100 --> 00:04:42,659
one might add one the balance X and add
-1 to Y and then we need to mark the end

194
00:04:42,659 --> 00:04:42,669
-1 to Y and then we need to mark the end
 

195
00:04:42,669 --> 00:04:46,390
-1 to Y and then we need to mark the end
by the transaction currently we might

196
00:04:46,390 --> 00:04:46,400
by the transaction currently we might
 

197
00:04:46,400 --> 00:04:49,210
by the transaction currently we might
have a transaction that's going to check

198
00:04:49,210 --> 00:04:49,220
have a transaction that's going to check
 

199
00:04:49,220 --> 00:04:50,680
have a transaction that's going to check
all the balance do an audit of all the

200
00:04:50,680 --> 00:04:50,690
all the balance do an audit of all the
 

201
00:04:50,690 --> 00:04:52,810
all the balance do an audit of all the
balances find the sum or look at all the

202
00:04:52,810 --> 00:04:52,820
balances find the sum or look at all the
 

203
00:04:52,820 --> 00:04:54,370
balances find the sum or look at all the
balances make sure they add up to the

204
00:04:54,370 --> 00:04:54,380
balances make sure they add up to the
 

205
00:04:54,380 --> 00:04:56,590
balances make sure they add up to the
number that doesn't change despite

206
00:04:56,590 --> 00:04:56,600
number that doesn't change despite
 

207
00:04:56,600 --> 00:04:59,860
number that doesn't change despite
transfers so the second transaction I'm

208
00:04:59,860 --> 00:04:59,870
transfers so the second transaction I'm
 

209
00:04:59,870 --> 00:05:05,580
transfers so the second transaction I'm
thinking about the audit transaction

210
00:05:05,580 --> 00:05:05,590

 

211
00:05:05,590 --> 00:05:07,930

also we need to mark the beginning and

212
00:05:07,930 --> 00:05:07,940
also we need to mark the beginning and
 

213
00:05:07,940 --> 00:05:13,420
also we need to mark the beginning and
end this time we're just reading there's

214
00:05:13,420 --> 00:05:13,430
end this time we're just reading there's
 

215
00:05:13,430 --> 00:05:16,390
end this time we're just reading there's
a read-only transaction we need to get

216
00:05:16,390 --> 00:05:16,400
a read-only transaction we need to get
 

217
00:05:16,400 --> 00:05:19,540
a read-only transaction we need to get
the current balances of all the accounts

218
00:05:19,540 --> 00:05:19,550
the current balances of all the accounts
 

219
00:05:19,550 --> 00:05:21,310
the current balances of all the accounts
lists they were just these two accounts

220
00:05:21,310 --> 00:05:21,320
lists they were just these two accounts
 

221
00:05:21,320 --> 00:05:24,250
lists they were just these two accounts
for now so we have two temporary

222
00:05:24,250 --> 00:05:24,260
for now so we have two temporary
 

223
00:05:24,260 --> 00:05:27,900
for now so we have two temporary
variables we're gonna read the first one

224
00:05:27,900 --> 00:05:27,910
variables we're gonna read the first one
 

225
00:05:27,910 --> 00:05:32,650
variables we're gonna read the first one
it's going to be the value of balance X

226
00:05:32,650 --> 00:05:32,660
it's going to be the value of balance X
 

227
00:05:32,660 --> 00:05:34,960
it's going to be the value of balance X
just right get to mean we're reading

228
00:05:34,960 --> 00:05:34,970
just right get to mean we're reading
 

229
00:05:34,970 --> 00:05:40,719
just right get to mean we're reading
that record we also read Y and we print

230
00:05:40,719 --> 00:05:40,729
that record we also read Y and we print
 

231
00:05:40,729 --> 00:05:48,610
that record we also read Y and we print
them both and that's the end of the

232
00:05:48,610 --> 00:05:48,620
them both and that's the end of the
 

233
00:05:48,620 --> 00:05:55,690
them both and that's the end of the
transaction the question is what are

234
00:05:55,690 --> 00:05:55,700
transaction the question is what are
 

235
00:05:55,700 --> 00:05:57,190
transaction the question is what are
legal results from these two

236
00:05:57,190 --> 00:05:57,200
legal results from these two
 

237
00:05:57,200 --> 00:05:59,650
legal results from these two
transactions that's the first thing we

238
00:05:59,650 --> 00:05:59,660
transactions that's the first thing we
 

239
00:05:59,660 --> 00:06:01,390
transactions that's the first thing we
want to establish is what are you know

240
00:06:01,390 --> 00:06:01,400
want to establish is what are you know
 

241
00:06:01,400 --> 00:06:03,610
want to establish is what are you know
given the starting state namely the two

242
00:06:03,610 --> 00:06:03,620
given the starting state namely the two
 

243
00:06:03,620 --> 00:06:06,010
given the starting state namely the two
balances for ten dollars and what could

244
00:06:06,010 --> 00:06:06,020
balances for ten dollars and what could
 

245
00:06:06,020 --> 00:06:07,659
balances for ten dollars and what could
be the final results after you've run

246
00:06:07,659 --> 00:06:07,669
be the final results after you've run
 

247
00:06:07,669 --> 00:06:09,159
be the final results after you've run
both these transactions maybe at the

248
00:06:09,159 --> 00:06:09,169
both these transactions maybe at the
 

249
00:06:09,169 --> 00:06:12,040
both these transactions maybe at the
same time so we need a notion of what

250
00:06:12,040 --> 00:06:12,050
same time so we need a notion of what
 

251
00:06:12,050 --> 00:06:14,650
same time so we need a notion of what
would be correct and once we know that

252
00:06:14,650 --> 00:06:14,660
would be correct and once we know that
 

253
00:06:14,660 --> 00:06:17,320
would be correct and once we know that
we need to be able to build machinery

254
00:06:17,320 --> 00:06:17,330
we need to be able to build machinery
 

255
00:06:17,330 --> 00:06:18,670
we need to be able to build machinery
that will actually be able to execute

256
00:06:18,670 --> 00:06:18,680
that will actually be able to execute
 

257
00:06:18,680 --> 00:06:23,050
that will actually be able to execute
these transactions and get only those

258
00:06:23,050 --> 00:06:23,060
these transactions and get only those
 

259
00:06:23,060 --> 00:06:25,380
these transactions and get only those
correct answers despite concurrency and

260
00:06:25,380 --> 00:06:25,390
correct answers despite concurrency and
 

261
00:06:25,390 --> 00:06:28,180
correct answers despite concurrency and
failures so first what's correctness

262
00:06:28,180 --> 00:06:28,190
failures so first what's correctness
 

263
00:06:28,190 --> 00:06:33,340
failures so first what's correctness
well databases usually have a notion of

264
00:06:33,340 --> 00:06:33,350
well databases usually have a notion of
 

265
00:06:33,350 --> 00:06:38,100
well databases usually have a notion of
correctness called acid

266
00:06:38,100 --> 00:06:38,110

 

267
00:06:38,110 --> 00:06:44,909

or bb-8 is acid and it stands for atomic

268
00:06:44,909 --> 00:06:44,919
or bb-8 is acid and it stands for atomic
 

269
00:06:44,919 --> 00:06:48,760
or bb-8 is acid and it stands for atomic
and this means that a transaction that

270
00:06:48,760 --> 00:06:48,770
and this means that a transaction that
 

271
00:06:48,770 --> 00:06:49,810
and this means that a transaction that
has multiple steps

272
00:06:49,810 --> 00:06:49,820
has multiple steps
 

273
00:06:49,820 --> 00:06:50,950
has multiple steps
you know maybe writes multiple different

274
00:06:50,950 --> 00:06:50,960
you know maybe writes multiple different
 

275
00:06:50,960 --> 00:06:53,080
you know maybe writes multiple different
records if there's a failure despite

276
00:06:53,080 --> 00:06:53,090
records if there's a failure despite
 

277
00:06:53,090 --> 00:06:55,930
records if there's a failure despite
failures either all of the right should

278
00:06:55,930 --> 00:06:55,940
failures either all of the right should
 

279
00:06:55,940 --> 00:06:58,360
failures either all of the right should
be done or none of them it shouldn't be

280
00:06:58,360 --> 00:06:58,370
be done or none of them it shouldn't be
 

281
00:06:58,370 --> 00:07:00,070
be done or none of them it shouldn't be
the case that a failure at an awkward

282
00:07:00,070 --> 00:07:00,080
the case that a failure at an awkward
 

283
00:07:00,080 --> 00:07:01,390
the case that a failure at an awkward
time in the middle of a transaction

284
00:07:01,390 --> 00:07:01,400
time in the middle of a transaction
 

285
00:07:01,400 --> 00:07:04,330
time in the middle of a transaction
should leave half the updates completed

286
00:07:04,330 --> 00:07:04,340
should leave half the updates completed
 

287
00:07:04,340 --> 00:07:06,520
should leave half the updates completed
invisible and half the updates never

288
00:07:06,520 --> 00:07:06,530
invisible and half the updates never
 

289
00:07:06,530 --> 00:07:16,150
invisible and half the updates never
done it's all or nothing so this is or

290
00:07:16,150 --> 00:07:16,160
done it's all or nothing so this is or
 

291
00:07:16,160 --> 00:07:25,390
done it's all or nothing so this is or
not despite failures the C stands for

292
00:07:25,390 --> 00:07:25,400
not despite failures the C stands for
 

293
00:07:25,400 --> 00:07:31,990
not despite failures the C stands for
consistent it's actually we're not going

294
00:07:31,990 --> 00:07:32,000
consistent it's actually we're not going
 

295
00:07:32,000 --> 00:07:35,830
consistent it's actually we're not going
to worry about that that's usually meant

296
00:07:35,830 --> 00:07:35,840
to worry about that that's usually meant
 

297
00:07:35,840 --> 00:07:38,020
to worry about that that's usually meant
to refer to the fact that database will

298
00:07:38,020 --> 00:07:38,030
to refer to the fact that database will
 

299
00:07:38,030 --> 00:07:40,450
to refer to the fact that database will
enforce certain invariants declared by

300
00:07:40,450 --> 00:07:40,460
enforce certain invariants declared by
 

301
00:07:40,460 --> 00:07:43,600
enforce certain invariants declared by
the application it's not really our

302
00:07:43,600 --> 00:07:43,610
the application it's not really our
 

303
00:07:43,610 --> 00:07:45,370
the application it's not really our
concern today the I though it's quite

304
00:07:45,370 --> 00:07:45,380
concern today the I though it's quite
 

305
00:07:45,380 --> 00:07:49,379
concern today the I though it's quite
important it usually stands for isolated

306
00:07:49,379 --> 00:07:49,389
important it usually stands for isolated
 

307
00:07:49,389 --> 00:07:52,330
important it usually stands for isolated
and this is a really a property of

308
00:07:52,330 --> 00:07:52,340
and this is a really a property of
 

309
00:07:52,340 --> 00:07:54,820
and this is a really a property of
whether or not two transactions that run

310
00:07:54,820 --> 00:07:54,830
whether or not two transactions that run
 

311
00:07:54,830 --> 00:07:56,350
whether or not two transactions that run
at the same time can see each other's

312
00:07:56,350 --> 00:07:56,360
at the same time can see each other's
 

313
00:07:56,360 --> 00:07:58,600
at the same time can see each other's
changes before the transactions have

314
00:07:58,600 --> 00:07:58,610
changes before the transactions have
 

315
00:07:58,610 --> 00:08:00,430
changes before the transactions have
finished whether or not they can see

316
00:08:00,430 --> 00:08:00,440
finished whether or not they can see
 

317
00:08:00,440 --> 00:08:02,620
finished whether or not they can see
sort of intermediate updates and from

318
00:08:02,620 --> 00:08:02,630
sort of intermediate updates and from
 

319
00:08:02,630 --> 00:08:06,219
sort of intermediate updates and from
the middle of another transaction and

320
00:08:06,219 --> 00:08:06,229
the middle of another transaction and
 

321
00:08:06,229 --> 00:08:11,350
the middle of another transaction and
your goal is no and the sort of

322
00:08:11,350 --> 00:08:11,360
your goal is no and the sort of
 

323
00:08:11,360 --> 00:08:14,020
your goal is no and the sort of
technical specific thing that most

324
00:08:14,020 --> 00:08:14,030
technical specific thing that most
 

325
00:08:14,030 --> 00:08:17,529
technical specific thing that most
people generally mean by isolation is

326
00:08:17,529 --> 00:08:17,539
people generally mean by isolation is
 

327
00:08:17,539 --> 00:08:19,270
people generally mean by isolation is
that the transaction execution is

328
00:08:19,270 --> 00:08:19,280
that the transaction execution is
 

329
00:08:19,280 --> 00:08:21,129
that the transaction execution is
serializable and I'll explain what that

330
00:08:21,129 --> 00:08:21,139
serializable and I'll explain what that
 

331
00:08:21,139 --> 00:08:27,659
serializable and I'll explain what that
means in a bit but it boils down to

332
00:08:27,659 --> 00:08:27,669
means in a bit but it boils down to
 

333
00:08:27,669 --> 00:08:29,620
means in a bit but it boils down to
transactions can't see each other's

334
00:08:29,620 --> 00:08:29,630
transactions can't see each other's
 

335
00:08:29,630 --> 00:08:32,079
transactions can't see each other's
changes can't see intermediate states

336
00:08:32,079 --> 00:08:32,089
changes can't see intermediate states
 

337
00:08:32,089 --> 00:08:34,899
changes can't see intermediate states
but only complete transaction results

338
00:08:34,899 --> 00:08:34,909
but only complete transaction results
 

339
00:08:34,909 --> 00:08:39,959
but only complete transaction results
and the final D stands for durable

340
00:08:39,959 --> 00:08:39,969

 

341
00:08:39,969 --> 00:08:42,600

and this means that after a transaction

342
00:08:42,600 --> 00:08:42,610
and this means that after a transaction
 

343
00:08:42,610 --> 00:08:44,790
and this means that after a transaction
commits after the client or whatever

344
00:08:44,790 --> 00:08:44,800
commits after the client or whatever
 

345
00:08:44,800 --> 00:08:46,350
commits after the client or whatever
program that submitted the transaction

346
00:08:46,350 --> 00:08:46,360
program that submitted the transaction
 

347
00:08:46,360 --> 00:08:48,990
program that submitted the transaction
gets a reply back from the database

348
00:08:48,990 --> 00:08:49,000
gets a reply back from the database
 

349
00:08:49,000 --> 00:08:49,829
gets a reply back from the database
saying yes

350
00:08:49,829 --> 00:08:49,839
saying yes
 

351
00:08:49,839 --> 00:08:52,759
saying yes
you know we've executed your transaction

352
00:08:52,759 --> 00:08:52,769
you know we've executed your transaction
 

353
00:08:52,769 --> 00:08:56,550
you know we've executed your transaction
the D in acid means that the

354
00:08:56,550 --> 00:08:56,560
the D in acid means that the
 

355
00:08:56,560 --> 00:08:58,679
the D in acid means that the
transactions modifications the database

356
00:08:58,679 --> 00:08:58,689
transactions modifications the database
 

357
00:08:58,689 --> 00:08:59,939
transactions modifications the database
will be durable that they'll still be

358
00:08:59,939 --> 00:08:59,949
will be durable that they'll still be
 

359
00:08:59,949 --> 00:09:02,610
will be durable that they'll still be
there they won't be erased by a some

360
00:09:02,610 --> 00:09:02,620
there they won't be erased by a some
 

361
00:09:02,620 --> 00:09:06,179
there they won't be erased by a some
sort of failure and in practice that

362
00:09:06,179 --> 00:09:06,189
sort of failure and in practice that
 

363
00:09:06,189 --> 00:09:08,189
sort of failure and in practice that
means that stuff has to be written into

364
00:09:08,189 --> 00:09:08,199
means that stuff has to be written into
 

365
00:09:08,199 --> 00:09:10,230
means that stuff has to be written into
some non-volatile storage persistent

366
00:09:10,230 --> 00:09:10,240
some non-volatile storage persistent
 

367
00:09:10,240 --> 00:09:13,530
some non-volatile storage persistent
storage like a disk and so today you are

368
00:09:13,530 --> 00:09:13,540
storage like a disk and so today you are
 

369
00:09:13,540 --> 00:09:16,019
storage like a disk and so today you are
in fact for this whole course really our

370
00:09:16,019 --> 00:09:16,029
in fact for this whole course really our
 

371
00:09:16,029 --> 00:09:18,650
in fact for this whole course really our
concerns are going to revolve around

372
00:09:18,650 --> 00:09:18,660
concerns are going to revolve around
 

373
00:09:18,660 --> 00:09:21,210
concerns are going to revolve around
good behavior with respect to failure

374
00:09:21,210 --> 00:09:21,220
good behavior with respect to failure
 

375
00:09:21,220 --> 00:09:25,499
good behavior with respect to failure
good respect good behavior with respect

376
00:09:25,499 --> 00:09:25,509
good respect good behavior with respect
 

377
00:09:25,509 --> 00:09:28,710
good respect good behavior with respect
to other from multiple parallel

378
00:09:28,710 --> 00:09:28,720
to other from multiple parallel
 

379
00:09:28,720 --> 00:09:31,110
to other from multiple parallel
activities and making sure that the data

380
00:09:31,110 --> 00:09:31,120
activities and making sure that the data
 

381
00:09:31,120 --> 00:09:35,129
activities and making sure that the data
is there still they are after even if

382
00:09:35,129 --> 00:09:35,139
is there still they are after even if
 

383
00:09:35,139 --> 00:09:40,650
is there still they are after even if
something crashes so the most

384
00:09:40,650 --> 00:09:40,660
something crashes so the most
 

385
00:09:40,660 --> 00:09:42,420
something crashes so the most
interesting part of this for us is the

386
00:09:42,420 --> 00:09:42,430
interesting part of this for us is the
 

387
00:09:42,430 --> 00:09:44,939
interesting part of this for us is the
specific definition of ice of isolated

388
00:09:44,939 --> 00:09:44,949
specific definition of ice of isolated
 

389
00:09:44,949 --> 00:09:48,869
specific definition of ice of isolated
or serializable so I'm going to lay that

390
00:09:48,869 --> 00:09:48,879
or serializable so I'm going to lay that
 

391
00:09:48,879 --> 00:09:51,449
or serializable so I'm going to lay that
out before before talking about how it

392
00:09:51,449 --> 00:09:51,459
out before before talking about how it
 

393
00:09:51,459 --> 00:09:52,920
out before before talking about how it
actually applies to these transactions

394
00:09:52,920 --> 00:09:52,930
actually applies to these transactions
 

395
00:09:52,930 --> 00:10:03,629
actually applies to these transactions
so the ioan isolated is usually and the

396
00:10:03,629 --> 00:10:03,639
so the ioan isolated is usually and the
 

397
00:10:03,639 --> 00:10:06,900
so the ioan isolated is usually and the
definition for this if a set of

398
00:10:06,900 --> 00:10:06,910
definition for this if a set of
 

399
00:10:06,910 --> 00:10:10,319
definition for this if a set of
transactions executes you know

400
00:10:10,319 --> 00:10:10,329
transactions executes you know
 

401
00:10:10,329 --> 00:10:12,179
transactions executes you know
concurrently more or less at the same

402
00:10:12,179 --> 00:10:12,189
concurrently more or less at the same
 

403
00:10:12,189 --> 00:10:16,710
concurrently more or less at the same
time they you are the set of results and

404
00:10:16,710 --> 00:10:16,720
time they you are the set of results and
 

405
00:10:16,720 --> 00:10:19,170
time they you are the set of results and
here the results refer to both the new

406
00:10:19,170 --> 00:10:19,180
here the results refer to both the new
 

407
00:10:19,180 --> 00:10:21,869
here the results refer to both the new
database records created by any

408
00:10:21,869 --> 00:10:21,879
database records created by any
 

409
00:10:21,879 --> 00:10:23,699
database records created by any
modifications the transactions might do

410
00:10:23,699 --> 00:10:23,709
modifications the transactions might do
 

411
00:10:23,709 --> 00:10:26,819
modifications the transactions might do
and in addition any output that the

412
00:10:26,819 --> 00:10:26,829
and in addition any output that the
 

413
00:10:26,829 --> 00:10:28,920
and in addition any output that the
transaction is produced so broader

414
00:10:28,920 --> 00:10:28,930
transaction is produced so broader
 

415
00:10:28,930 --> 00:10:30,960
transaction is produced so broader
transactions these two adds since they

416
00:10:30,960 --> 00:10:30,970
transactions these two adds since they
 

417
00:10:30,970 --> 00:10:32,400
transactions these two adds since they
change records their needs change

418
00:10:32,400 --> 00:10:32,410
change records their needs change
 

419
00:10:32,410 --> 00:10:34,470
change records their needs change
records are part of the results and the

420
00:10:34,470 --> 00:10:34,480
records are part of the results and the
 

421
00:10:34,480 --> 00:10:35,759
records are part of the results and the
output of this print statement is part

422
00:10:35,759 --> 00:10:35,769
output of this print statement is part
 

423
00:10:35,769 --> 00:10:38,309
output of this print statement is part
of the results so the definition of

424
00:10:38,309 --> 00:10:38,319
of the results so the definition of
 

425
00:10:38,319 --> 00:10:42,420
of the results so the definition of
serializable says the results are

426
00:10:42,420 --> 00:10:42,430
serializable says the results are
 

427
00:10:42,430 --> 00:10:47,240
serializable says the results are
serializable

428
00:10:47,240 --> 00:10:47,250

 

429
00:10:47,250 --> 00:10:55,699

if there exists some order of execution

430
00:10:55,699 --> 00:10:55,709
if there exists some order of execution
 

431
00:10:55,709 --> 00:11:20,600
if there exists some order of execution
of the transactions so we're gonna say a

432
00:11:20,600 --> 00:11:20,610
of the transactions so we're gonna say a
 

433
00:11:20,610 --> 00:11:23,210
of the transactions so we're gonna say a
specific execution parallel concurrent

434
00:11:23,210 --> 00:11:23,220
specific execution parallel concurrent
 

435
00:11:23,220 --> 00:11:24,920
specific execution parallel concurrent
execution of transactions is

436
00:11:24,920 --> 00:11:24,930
execution of transactions is
 

437
00:11:24,930 --> 00:11:28,129
execution of transactions is
serializable if there exists some serial

438
00:11:28,129 --> 00:11:28,139
serializable if there exists some serial
 

439
00:11:28,139 --> 00:11:31,420
serializable if there exists some serial
order really emphasizing serial here a

440
00:11:31,420 --> 00:11:31,430
order really emphasizing serial here a
 

441
00:11:31,430 --> 00:11:34,069
order really emphasizing serial here a
serial order of execution of those same

442
00:11:34,069 --> 00:11:34,079
serial order of execution of those same
 

443
00:11:34,079 --> 00:11:37,100
serial order of execution of those same
transactions that yields the same result

444
00:11:37,100 --> 00:11:37,110
transactions that yields the same result
 

445
00:11:37,110 --> 00:11:38,990
transactions that yields the same result
as the actual execution and the

446
00:11:38,990 --> 00:11:39,000
as the actual execution and the
 

447
00:11:39,000 --> 00:11:40,129
as the actual execution and the
difference of here is the actual

448
00:11:40,129 --> 00:11:40,139
difference of here is the actual
 

449
00:11:40,139 --> 00:11:41,179
difference of here is the actual
execution may have had a lot of

450
00:11:41,179 --> 00:11:41,189
execution may have had a lot of
 

451
00:11:41,189 --> 00:11:46,460
execution may have had a lot of
parallelism in it but it's required to

452
00:11:46,460 --> 00:11:46,470
parallelism in it but it's required to
 

453
00:11:46,470 --> 00:11:48,829
parallelism in it but it's required to
produce the same result as some one at a

454
00:11:48,829 --> 00:11:48,839
produce the same result as some one at a
 

455
00:11:48,839 --> 00:11:49,460
produce the same result as some one at a
time

456
00:11:49,460 --> 00:11:49,470
time
 

457
00:11:49,470 --> 00:11:52,549
time
execution of the same transactions and

458
00:11:52,549 --> 00:11:52,559
execution of the same transactions and
 

459
00:11:52,559 --> 00:11:54,619
execution of the same transactions and
so the way you check whether an

460
00:11:54,619 --> 00:11:54,629
so the way you check whether an
 

461
00:11:54,629 --> 00:11:56,439
so the way you check whether an
execution is serializable whether some

462
00:11:56,439 --> 00:11:56,449
execution is serializable whether some
 

463
00:11:56,449 --> 00:11:59,030
execution is serializable whether some
concurrent execution is serializable is

464
00:11:59,030 --> 00:11:59,040
concurrent execution is serializable is
 

465
00:11:59,040 --> 00:12:01,129
concurrent execution is serializable is
you look at the results and see if you

466
00:12:01,129 --> 00:12:01,139
you look at the results and see if you
 

467
00:12:01,139 --> 00:12:03,710
you look at the results and see if you
can find actually some one at a time

468
00:12:03,710 --> 00:12:03,720
can find actually some one at a time
 

469
00:12:03,720 --> 00:12:06,019
can find actually some one at a time
execution of the same transactions that

470
00:12:06,019 --> 00:12:06,029
execution of the same transactions that
 

471
00:12:06,029 --> 00:12:09,170
execution of the same transactions that
does produce the same results so for our

472
00:12:09,170 --> 00:12:09,180
does produce the same results so for our
 

473
00:12:09,180 --> 00:12:14,030
does produce the same results so for our
transaction up here there's only two

474
00:12:14,030 --> 00:12:14,040
transaction up here there's only two
 

475
00:12:14,040 --> 00:12:16,129
transaction up here there's only two
orders there's only two one at a time

476
00:12:16,129 --> 00:12:16,139
orders there's only two one at a time
 

477
00:12:16,139 --> 00:12:19,100
orders there's only two one at a time
serial orders available transaction 1

478
00:12:19,100 --> 00:12:19,110
serial orders available transaction 1
 

479
00:12:19,110 --> 00:12:22,160
serial orders available transaction 1
then transaction 2 or transaction 2 then

480
00:12:22,160 --> 00:12:22,170
then transaction 2 or transaction 2 then
 

481
00:12:22,170 --> 00:12:25,879
then transaction 2 or transaction 2 then
transaction 1 and so we can just look at

482
00:12:25,879 --> 00:12:25,889
transaction 1 and so we can just look at
 

483
00:12:25,889 --> 00:12:27,499
transaction 1 and so we can just look at
the results that they would produce if

484
00:12:27,499 --> 00:12:27,509
the results that they would produce if
 

485
00:12:27,509 --> 00:12:29,480
the results that they would produce if
executed one at a time in each of these

486
00:12:29,480 --> 00:12:29,490
executed one at a time in each of these
 

487
00:12:29,490 --> 00:12:34,900
executed one at a time in each of these
orders so if we execute t1 and then t2

488
00:12:34,900 --> 00:12:34,910
orders so if we execute t1 and then t2
 

489
00:12:34,910 --> 00:12:42,230
orders so if we execute t1 and then t2
then we get x equals 11

490
00:12:42,230 --> 00:12:42,240

 

491
00:12:42,240 --> 00:12:46,590

why equals 9 and this print statement

492
00:12:46,590 --> 00:12:46,600
why equals 9 and this print statement
 

493
00:12:46,600 --> 00:12:49,740
why equals 9 and this print statement
since t1 executed first this print

494
00:12:49,740 --> 00:12:49,750
since t1 executed first this print
 

495
00:12:49,750 --> 00:12:51,960
since t1 executed first this print
statement sees these two updated values

496
00:12:51,960 --> 00:12:51,970
statement sees these two updated values
 

497
00:12:51,970 --> 00:12:58,680
statement sees these two updated values
and so it will print the string 11 9 the

498
00:12:58,680 --> 00:12:58,690
and so it will print the string 11 9 the
 

499
00:12:58,690 --> 00:13:01,890
and so it will print the string 11 9 the
other possible order is that perhaps t2

500
00:13:01,890 --> 00:13:01,900
other possible order is that perhaps t2
 

501
00:13:01,900 --> 00:13:06,269
other possible order is that perhaps t2
ran first and then t1 and in that case

502
00:13:06,269 --> 00:13:06,279
ran first and then t1 and in that case
 

503
00:13:06,279 --> 00:13:09,060
ran first and then t1 and in that case
t2 will see that 2 records before they

504
00:13:09,060 --> 00:13:09,070
t2 will see that 2 records before they
 

505
00:13:09,070 --> 00:13:11,970
t2 will see that 2 records before they
were modified but the modifications will

506
00:13:11,970 --> 00:13:11,980
were modified but the modifications will
 

507
00:13:11,980 --> 00:13:14,820
were modified but the modifications will
still take place since t1 runs later so

508
00:13:14,820 --> 00:13:14,830
still take place since t1 runs later so
 

509
00:13:14,830 --> 00:13:16,740
still take place since t1 runs later so
the final results will again be x equals

510
00:13:16,740 --> 00:13:16,750
the final results will again be x equals
 

511
00:13:16,750 --> 00:13:22,440
the final results will again be x equals
11 y equal 9 but this time t2 sodded

512
00:13:22,440 --> 00:13:22,450
11 y equal 9 but this time t2 sodded
 

513
00:13:22,450 --> 00:13:27,590
11 y equal 9 but this time t2 sodded
before our values so these are the two

514
00:13:27,590 --> 00:13:27,600
before our values so these are the two
 

515
00:13:27,600 --> 00:13:33,090
before our values so these are the two
legal results for serializability and if

516
00:13:33,090 --> 00:13:33,100
legal results for serializability and if
 

517
00:13:33,100 --> 00:13:34,470
legal results for serializability and if
we ever see anything else from running

518
00:13:34,470 --> 00:13:34,480
we ever see anything else from running
 

519
00:13:34,480 --> 00:13:36,120
we ever see anything else from running
these two transactions at the same time

520
00:13:36,120 --> 00:13:36,130
these two transactions at the same time
 

521
00:13:36,130 --> 00:13:38,100
these two transactions at the same time
we'll know that the database were

522
00:13:38,100 --> 00:13:38,110
we'll know that the database were
 

523
00:13:38,110 --> 00:13:39,860
we'll know that the database were
running against does not provide

524
00:13:39,860 --> 00:13:39,870
running against does not provide
 

525
00:13:39,870 --> 00:13:42,120
running against does not provide
serializable execution it's doing

526
00:13:42,120 --> 00:13:42,130
serializable execution it's doing
 

527
00:13:42,130 --> 00:13:45,810
serializable execution it's doing
something else and so while we're

528
00:13:45,810 --> 00:13:45,820
something else and so while we're
 

529
00:13:45,820 --> 00:13:48,810
something else and so while we're
thinking through what would happen if or

530
00:13:48,810 --> 00:13:48,820
thinking through what would happen if or
 

531
00:13:48,820 --> 00:13:50,550
thinking through what would happen if or
what would happen if will always be

532
00:13:50,550 --> 00:13:50,560
what would happen if will always be
 

533
00:13:50,560 --> 00:13:52,890
what would happen if will always be
against these AHA these are the only two

534
00:13:52,890 --> 00:13:52,900
against these AHA these are the only two
 

535
00:13:52,900 --> 00:13:55,170
against these AHA these are the only two
legal results we better be doing

536
00:13:55,170 --> 00:13:55,180
legal results we better be doing
 

537
00:13:55,180 --> 00:13:56,900
legal results we better be doing
something that produces one or the other

538
00:13:56,900 --> 00:13:56,910
something that produces one or the other
 

539
00:13:56,910 --> 00:13:59,880
something that produces one or the other
it's interesting to note that there's

540
00:13:59,880 --> 00:13:59,890
it's interesting to note that there's
 

541
00:13:59,890 --> 00:14:02,940
it's interesting to note that there's
more than one possible result depending

542
00:14:02,940 --> 00:14:02,950
more than one possible result depending
 

543
00:14:02,950 --> 00:14:04,890
more than one possible result depending
on the actual order you if you you

544
00:14:04,890 --> 00:14:04,900
on the actual order you if you you
 

545
00:14:04,900 --> 00:14:06,420
on the actual order you if you you
submit these two transactions at the

546
00:14:06,420 --> 00:14:06,430
submit these two transactions at the
 

547
00:14:06,430 --> 00:14:08,010
submit these two transactions at the
same time you don't know whether it's

548
00:14:08,010 --> 00:14:08,020
same time you don't know whether it's
 

549
00:14:08,020 --> 00:14:11,970
same time you don't know whether it's
gonna be t1 t2 or t2 t1 so you have to

550
00:14:11,970 --> 00:14:11,980
gonna be t1 t2 or t2 t1 so you have to
 

551
00:14:11,980 --> 00:14:13,769
gonna be t1 t2 or t2 t1 so you have to
be willing to expect more than one

552
00:14:13,769 --> 00:14:13,779
be willing to expect more than one
 

553
00:14:13,779 --> 00:14:15,300
be willing to expect more than one
possible legal result and as you have

554
00:14:15,300 --> 00:14:15,310
possible legal result and as you have
 

555
00:14:15,310 --> 00:14:16,620
possible legal result and as you have
more or transactions running

556
00:14:16,620 --> 00:14:16,630
more or transactions running
 

557
00:14:16,630 --> 00:14:18,449
more or transactions running
concurrently a more complicated there

558
00:14:18,449 --> 00:14:18,459
concurrently a more complicated there
 

559
00:14:18,459 --> 00:14:20,699
concurrently a more complicated there
may be many many possible different

560
00:14:20,699 --> 00:14:20,709
may be many many possible different
 

561
00:14:20,709 --> 00:14:22,800
may be many many possible different
correct results that are all

562
00:14:22,800 --> 00:14:22,810
correct results that are all
 

563
00:14:22,810 --> 00:14:25,920
correct results that are all
serializable because of many many orders

564
00:14:25,920 --> 00:14:25,930
serializable because of many many orders
 

565
00:14:25,930 --> 00:14:28,590
serializable because of many many orders
here that could be used to fulfill this

566
00:14:28,590 --> 00:14:28,600
here that could be used to fulfill this
 

567
00:14:28,600 --> 00:14:34,019
here that could be used to fulfill this
requirement okay so now that we have a

568
00:14:34,019 --> 00:14:34,029
requirement okay so now that we have a
 

569
00:14:34,029 --> 00:14:35,550
requirement okay so now that we have a
definition of correctness and we even

570
00:14:35,550 --> 00:14:35,560
definition of correctness and we even
 

571
00:14:35,560 --> 00:14:37,650
definition of correctness and we even
know what all the possible results are

572
00:14:37,650 --> 00:14:37,660
know what all the possible results are
 

573
00:14:37,660 --> 00:14:42,390
know what all the possible results are
we can ask a few questions so few

574
00:14:42,390 --> 00:14:42,400
we can ask a few questions so few
 

575
00:14:42,400 --> 00:14:44,550
we can ask a few questions so few
what-if questions about how these could

576
00:14:44,550 --> 00:14:44,560
what-if questions about how these could
 

577
00:14:44,560 --> 00:14:48,600
what-if questions about how these could
execute so for example suppose that the

578
00:14:48,600 --> 00:14:48,610
execute so for example suppose that the
 

579
00:14:48,610 --> 00:14:50,970
execute so for example suppose that the
way the system actually executed this

580
00:14:50,970 --> 00:14:50,980
way the system actually executed this
 

581
00:14:50,980 --> 00:14:53,250
way the system actually executed this
was that it started transaction 2 and

582
00:14:53,250 --> 00:14:53,260
was that it started transaction 2 and
 

583
00:14:53,260 --> 00:14:55,059
was that it started transaction 2 and
got as far as

584
00:14:55,059 --> 00:14:55,069
got as far as
 

585
00:14:55,069 --> 00:14:58,170
got as far as
just after reading X and then

586
00:14:58,170 --> 00:14:58,180
just after reading X and then
 

587
00:14:58,180 --> 00:15:03,549
just after reading X and then
transaction one ran at this point and

588
00:15:03,549 --> 00:15:03,559
transaction one ran at this point and
 

589
00:15:03,559 --> 00:15:05,340
transaction one ran at this point and
then after transaction one finished

590
00:15:05,340 --> 00:15:05,350
then after transaction one finished
 

591
00:15:05,350 --> 00:15:11,559
then after transaction one finished
transaction to continue executing now it

592
00:15:11,559 --> 00:15:11,569
transaction to continue executing now it
 

593
00:15:11,569 --> 00:15:13,809
transaction to continue executing now it
turns out in with different other

594
00:15:13,809 --> 00:15:13,819
turns out in with different other
 

595
00:15:13,819 --> 00:15:15,429
turns out in with different other
transactions than this that might

596
00:15:15,429 --> 00:15:15,439
transactions than this that might
 

597
00:15:15,439 --> 00:15:18,249
transactions than this that might
actually be legal but here we want to

598
00:15:18,249 --> 00:15:18,259
actually be legal but here we want to
 

599
00:15:18,259 --> 00:15:20,499
actually be legal but here we want to
know if it's legal so we're wondering

600
00:15:20,499 --> 00:15:20,509
know if it's legal so we're wondering
 

601
00:15:20,509 --> 00:15:22,269
know if it's legal so we're wondering
gosh if we actually executed that way

602
00:15:22,269 --> 00:15:22,279
gosh if we actually executed that way
 

603
00:15:22,279 --> 00:15:23,739
gosh if we actually executed that way
what results will we get and are they

604
00:15:23,739 --> 00:15:23,749
what results will we get and are they
 

605
00:15:23,749 --> 00:15:27,340
what results will we get and are they
the same as either of these two well if

606
00:15:27,340 --> 00:15:27,350
the same as either of these two well if
 

607
00:15:27,350 --> 00:15:29,619
the same as either of these two well if
we execute transaction one here then t1

608
00:15:29,619 --> 00:15:29,629
we execute transaction one here then t1
 

609
00:15:29,629 --> 00:15:32,499
we execute transaction one here then t1
is gonna see value 10 t2 is gonna see

610
00:15:32,499 --> 00:15:32,509
is gonna see value 10 t2 is gonna see
 

611
00:15:32,509 --> 00:15:35,980
is gonna see value 10 t2 is gonna see
the value after decrementing Y so t1

612
00:15:35,980 --> 00:15:35,990
the value after decrementing Y so t1
 

613
00:15:35,990 --> 00:15:38,739
the value after decrementing Y so t1
will be 10 t2 will be 9 and what this

614
00:15:38,739 --> 00:15:38,749
will be 10 t2 will be 9 and what this
 

615
00:15:38,749 --> 00:15:42,280
will be 10 t2 will be 9 and what this
print will be 10 9 and that's neither of

616
00:15:42,280 --> 00:15:42,290
print will be 10 9 and that's neither of
 

617
00:15:42,290 --> 00:15:45,429
print will be 10 9 and that's neither of
these two outputs here so that means

618
00:15:45,429 --> 00:15:45,439
these two outputs here so that means
 

619
00:15:45,439 --> 00:15:47,169
these two outputs here so that means
executing in this way that I just drew

620
00:15:47,169 --> 00:15:47,179
executing in this way that I just drew
 

621
00:15:47,179 --> 00:15:49,359
executing in this way that I just drew
is not serializable it would not be

622
00:15:49,359 --> 00:15:49,369
is not serializable it would not be
 

623
00:15:49,369 --> 00:15:55,049
is not serializable it would not be
legal another interesting question is

624
00:15:55,049 --> 00:15:55,059
legal another interesting question is
 

625
00:15:55,059 --> 00:15:57,850
legal another interesting question is
what if we started executing transaction

626
00:15:57,850 --> 00:15:57,860
what if we started executing transaction
 

627
00:15:57,860 --> 00:15:59,619
what if we started executing transaction
1 and we got as far as just after the

628
00:15:59,619 --> 00:15:59,629
1 and we got as far as just after the
 

629
00:15:59,629 --> 00:16:02,410
1 and we got as far as just after the
first ad and then at that point all the

630
00:16:02,410 --> 00:16:02,420
first ad and then at that point all the
 

631
00:16:02,420 --> 00:16:08,710
first ad and then at that point all the
transaction 2 executed right here so

632
00:16:08,710 --> 00:16:08,720
transaction 2 executed right here so
 

633
00:16:08,720 --> 00:16:10,929
transaction 2 executed right here so
that would mean at this point X is value

634
00:16:10,929 --> 00:16:10,939
that would mean at this point X is value
 

635
00:16:10,939 --> 00:16:17,860
that would mean at this point X is value
11 the transaction 2 would read 1110 now

636
00:16:17,860 --> 00:16:17,870
11 the transaction 2 would read 1110 now
 

637
00:16:17,870 --> 00:16:20,169
11 the transaction 2 would read 1110 now
print 1110 and 1110 is not one of these

638
00:16:20,169 --> 00:16:20,179
print 1110 and 1110 is not one of these
 

639
00:16:20,179 --> 00:16:22,179
print 1110 and 1110 is not one of these
two legal values so this execution is

640
00:16:22,179 --> 00:16:22,189
two legal values so this execution is
 

641
00:16:22,189 --> 00:16:23,739
two legal values so this execution is
also not legal for these two

642
00:16:23,739 --> 00:16:23,749
also not legal for these two
 

643
00:16:23,749 --> 00:16:35,500
also not legal for these two
transactions

644
00:16:35,500 --> 00:16:35,510

 

645
00:16:35,510 --> 00:16:39,340

so the reason why serializable

646
00:16:39,340 --> 00:16:39,350
so the reason why serializable
 

647
00:16:39,350 --> 00:16:43,100
so the reason why serializable
serializability is a popular and useful

648
00:16:43,100 --> 00:16:43,110
serializability is a popular and useful
 

649
00:16:43,110 --> 00:16:44,830
serializability is a popular and useful
definition of what it means for

650
00:16:44,830 --> 00:16:44,840
definition of what it means for
 

651
00:16:44,840 --> 00:16:47,270
definition of what it means for
transactions to be correct for execution

652
00:16:47,270 --> 00:16:47,280
transactions to be correct for execution
 

653
00:16:47,280 --> 00:16:48,920
transactions to be correct for execution
of transactions to be correct is that

654
00:16:48,920 --> 00:16:48,930
of transactions to be correct is that
 

655
00:16:48,930 --> 00:16:51,020
of transactions to be correct is that
it's a very easy model for programmers

656
00:16:51,020 --> 00:16:51,030
it's a very easy model for programmers
 

657
00:16:51,030 --> 00:16:53,210
it's a very easy model for programmers
you can write complicated transactions

658
00:16:53,210 --> 00:16:53,220
you can write complicated transactions
 

659
00:16:53,220 --> 00:16:56,180
you can write complicated transactions
without having to worry about what else

660
00:16:56,180 --> 00:16:56,190
without having to worry about what else
 

661
00:16:56,190 --> 00:16:57,980
without having to worry about what else
may be running in the system there may

662
00:16:57,980 --> 00:16:57,990
may be running in the system there may
 

663
00:16:57,990 --> 00:16:59,360
may be running in the system there may
be lots of other transactions may be

664
00:16:59,360 --> 00:16:59,370
be lots of other transactions may be
 

665
00:16:59,370 --> 00:17:00,860
be lots of other transactions may be
using the same date as you may be

666
00:17:00,860 --> 00:17:00,870
using the same date as you may be
 

667
00:17:00,870 --> 00:17:02,600
using the same date as you may be
reading trying to read and write it at

668
00:17:02,600 --> 00:17:02,610
reading trying to read and write it at
 

669
00:17:02,610 --> 00:17:04,790
reading trying to read and write it at
the same time there might be failures

670
00:17:04,790 --> 00:17:04,800
the same time there might be failures
 

671
00:17:04,800 --> 00:17:10,309
the same time there might be failures
who knows but the guarantee here is that

672
00:17:10,309 --> 00:17:10,319
who knows but the guarantee here is that
 

673
00:17:10,319 --> 00:17:12,860
who knows but the guarantee here is that
it's safe to write your transactions as

674
00:17:12,860 --> 00:17:12,870
it's safe to write your transactions as
 

675
00:17:12,870 --> 00:17:15,679
it's safe to write your transactions as
if nothing else was happening because

676
00:17:15,679 --> 00:17:15,689
if nothing else was happening because
 

677
00:17:15,689 --> 00:17:19,550
if nothing else was happening because
the final results have to be as if your

678
00:17:19,550 --> 00:17:19,560
the final results have to be as if your
 

679
00:17:19,560 --> 00:17:22,309
the final results have to be as if your
transaction was executed by itself in

680
00:17:22,309 --> 00:17:22,319
transaction was executed by itself in
 

681
00:17:22,319 --> 00:17:24,530
transaction was executed by itself in
this one-at-a-time order which is a very

682
00:17:24,530 --> 00:17:24,540
this one-at-a-time order which is a very
 

683
00:17:24,540 --> 00:17:28,010
this one-at-a-time order which is a very
simple very nice programming model it's

684
00:17:28,010 --> 00:17:28,020
simple very nice programming model it's
 

685
00:17:28,020 --> 00:17:31,580
simple very nice programming model it's
also nice that this definition allows

686
00:17:31,580 --> 00:17:31,590
also nice that this definition allows
 

687
00:17:31,590 --> 00:17:34,400
also nice that this definition allows
truly parallel execution of transactions

688
00:17:34,400 --> 00:17:34,410
truly parallel execution of transactions
 

689
00:17:34,410 --> 00:17:36,410
truly parallel execution of transactions
as long as they don't use the same data

690
00:17:36,410 --> 00:17:36,420
as long as they don't use the same data
 

691
00:17:36,420 --> 00:17:38,000
as long as they don't use the same data
so we run into trouble here because

692
00:17:38,000 --> 00:17:38,010
so we run into trouble here because
 

693
00:17:38,010 --> 00:17:39,710
so we run into trouble here because
these two transactions are both reading

694
00:17:39,710 --> 00:17:39,720
these two transactions are both reading
 

695
00:17:39,720 --> 00:17:41,360
these two transactions are both reading
x and y but if they were using

696
00:17:41,360 --> 00:17:41,370
x and y but if they were using
 

697
00:17:41,370 --> 00:17:44,060
x and y but if they were using
completely disjoint database records

698
00:17:44,060 --> 00:17:44,070
completely disjoint database records
 

699
00:17:44,070 --> 00:17:46,160
completely disjoint database records
they could it turns out this definition

700
00:17:46,160 --> 00:17:46,170
they could it turns out this definition
 

701
00:17:46,170 --> 00:17:48,830
they could it turns out this definition
allows you to build a database system

702
00:17:48,830 --> 00:17:48,840
allows you to build a database system
 

703
00:17:48,840 --> 00:17:51,830
allows you to build a database system
that would execute transactions to use

704
00:17:51,830 --> 00:17:51,840
that would execute transactions to use
 

705
00:17:51,840 --> 00:17:54,500
that would execute transactions to use
disjoint data completely in parallel and

706
00:17:54,500 --> 00:17:54,510
disjoint data completely in parallel and
 

707
00:17:54,510 --> 00:17:56,210
disjoint data completely in parallel and
if you are a sharded system which is

708
00:17:56,210 --> 00:17:56,220
if you are a sharded system which is
 

709
00:17:56,220 --> 00:17:57,740
if you are a sharded system which is
what we're sort of working up to today

710
00:17:57,740 --> 00:17:57,750
what we're sort of working up to today
 

711
00:17:57,750 --> 00:17:59,480
what we're sort of working up to today
with the data different data is on

712
00:17:59,480 --> 00:17:59,490
with the data different data is on
 

713
00:17:59,490 --> 00:18:01,190
with the data different data is on
different machines you can get true

714
00:18:01,190 --> 00:18:01,200
different machines you can get true
 

715
00:18:01,200 --> 00:18:02,780
different machines you can get true
parallel speed-up because maybe one

716
00:18:02,780 --> 00:18:02,790
parallel speed-up because maybe one
 

717
00:18:02,790 --> 00:18:04,790
parallel speed-up because maybe one
transaction executes Spira in the first

718
00:18:04,790 --> 00:18:04,800
transaction executes Spira in the first
 

719
00:18:04,800 --> 00:18:06,500
transaction executes Spira in the first
shard on the first machine and the other

720
00:18:06,500 --> 00:18:06,510
shard on the first machine and the other
 

721
00:18:06,510 --> 00:18:09,380
shard on the first machine and the other
in parallel on the second machine so

722
00:18:09,380 --> 00:18:09,390
in parallel on the second machine so
 

723
00:18:09,390 --> 00:18:12,950
in parallel on the second machine so
there are opportunities here for for

724
00:18:12,950 --> 00:18:12,960
there are opportunities here for for
 

725
00:18:12,960 --> 00:18:17,480
there are opportunities here for for
good performance before I dig into how

726
00:18:17,480 --> 00:18:17,490
good performance before I dig into how
 

727
00:18:17,490 --> 00:18:21,580
good performance before I dig into how
to implement serializable transactions

728
00:18:21,580 --> 00:18:21,590
to implement serializable transactions
 

729
00:18:21,590 --> 00:18:24,470
to implement serializable transactions
there's one more small point I want to

730
00:18:24,470 --> 00:18:24,480
there's one more small point I want to
 

731
00:18:24,480 --> 00:18:29,300
there's one more small point I want to
bring up it turns out that one of the

732
00:18:29,300 --> 00:18:29,310
bring up it turns out that one of the
 

733
00:18:29,310 --> 00:18:30,530
bring up it turns out that one of the
things we need to be able to cope with

734
00:18:30,530 --> 00:18:30,540
things we need to be able to cope with
 

735
00:18:30,540 --> 00:18:33,140
things we need to be able to cope with
is that transactions may for one reason

736
00:18:33,140 --> 00:18:33,150
is that transactions may for one reason
 

737
00:18:33,150 --> 00:18:34,360
is that transactions may for one reason
or another

738
00:18:34,360 --> 00:18:34,370
or another
 

739
00:18:34,370 --> 00:18:39,410
or another
basically fail or decide to fail in the

740
00:18:39,410 --> 00:18:39,420
basically fail or decide to fail in the
 

741
00:18:39,420 --> 00:18:41,660
basically fail or decide to fail in the
middle of the transaction and this is

742
00:18:41,660 --> 00:18:41,670
middle of the transaction and this is
 

743
00:18:41,670 --> 00:18:47,150
middle of the transaction and this is
usually called an abort and you know for

744
00:18:47,150 --> 00:18:47,160
usually called an abort and you know for
 

745
00:18:47,160 --> 00:18:48,830
usually called an abort and you know for
many transaction systems we need to be

746
00:18:48,830 --> 00:18:48,840
many transaction systems we need to be
 

747
00:18:48,840 --> 00:18:50,870
many transaction systems we need to be
prepared to handle Oh what should happen

748
00:18:50,870 --> 00:18:50,880
prepared to handle Oh what should happen
 

749
00:18:50,880 --> 00:18:53,480
prepared to handle Oh what should happen
if a transaction tries to access a

750
00:18:53,480 --> 00:18:53,490
if a transaction tries to access a
 

751
00:18:53,490 --> 00:18:56,060
if a transaction tries to access a
record that doesn't exist or divides by

752
00:18:56,060 --> 00:18:56,070
record that doesn't exist or divides by
 

753
00:18:56,070 --> 00:18:59,450
record that doesn't exist or divides by
zero or maybe you know since some

754
00:18:59,450 --> 00:18:59,460
zero or maybe you know since some
 

755
00:18:59,460 --> 00:19:01,130
zero or maybe you know since some
transaction implementation schemes use

756
00:19:01,130 --> 00:19:01,140
transaction implementation schemes use
 

757
00:19:01,140 --> 00:19:03,710
transaction implementation schemes use
locking maybe a transaction causes a

758
00:19:03,710 --> 00:19:03,720
locking maybe a transaction causes a
 

759
00:19:03,720 --> 00:19:05,450
locking maybe a transaction causes a
locking deadlock and the only way to

760
00:19:05,450 --> 00:19:05,460
locking deadlock and the only way to
 

761
00:19:05,460 --> 00:19:08,000
locking deadlock and the only way to
break the deadlock is to kill one of one

762
00:19:08,000 --> 00:19:08,010
break the deadlock is to kill one of one
 

763
00:19:08,010 --> 00:19:09,440
break the deadlock is to kill one of one
or more of the transactions this

764
00:19:09,440 --> 00:19:09,450
or more of the transactions this
 

765
00:19:09,450 --> 00:19:13,160
or more of the transactions this
participating in the deadlock so one of

766
00:19:13,160 --> 00:19:13,170
participating in the deadlock so one of
 

767
00:19:13,170 --> 00:19:14,900
participating in the deadlock so one of
the things that's going to be kind of

768
00:19:14,900 --> 00:19:14,910
the things that's going to be kind of
 

769
00:19:14,910 --> 00:19:16,160
the things that's going to be kind of
hanging in the background and will come

770
00:19:16,160 --> 00:19:16,170
hanging in the background and will come
 

771
00:19:16,170 --> 00:19:18,710
hanging in the background and will come
up is the necessity of coping with

772
00:19:18,710 --> 00:19:18,720
up is the necessity of coping with
 

773
00:19:18,720 --> 00:19:20,810
up is the necessity of coping with
transactions that all of a sudden in the

774
00:19:20,810 --> 00:19:20,820
transactions that all of a sudden in the
 

775
00:19:20,820 --> 00:19:22,960
transactions that all of a sudden in the
middle decide they just cannot proceed

776
00:19:22,960 --> 00:19:22,970
middle decide they just cannot proceed
 

777
00:19:22,970 --> 00:19:26,570
middle decide they just cannot proceed
and you know maybe really in the middle

778
00:19:26,570 --> 00:19:26,580
and you know maybe really in the middle
 

779
00:19:26,580 --> 00:19:28,520
and you know maybe really in the middle
after they've done some work and started

780
00:19:28,520 --> 00:19:28,530
after they've done some work and started
 

781
00:19:28,530 --> 00:19:30,230
after they've done some work and started
modifying things we need to be able to

782
00:19:30,230 --> 00:19:30,240
modifying things we need to be able to
 

783
00:19:30,240 --> 00:19:33,140
modifying things we need to be able to
kind of back out of these transactions

784
00:19:33,140 --> 00:19:33,150
kind of back out of these transactions
 

785
00:19:33,150 --> 00:19:35,680
kind of back out of these transactions
and undo any modifications they've made

786
00:19:35,680 --> 00:19:35,690
and undo any modifications they've made
 

787
00:19:35,690 --> 00:19:38,180
and undo any modifications they've made
all right

788
00:19:38,180 --> 00:19:38,190
all right
 

789
00:19:38,190 --> 00:19:40,820
all right
the implementation strategy for

790
00:19:40,820 --> 00:19:40,830
the implementation strategy for
 

791
00:19:40,830 --> 00:19:42,380
the implementation strategy for
transactions for these asset

792
00:19:42,380 --> 00:19:42,390
transactions for these asset
 

793
00:19:42,390 --> 00:19:46,130
transactions for these asset
transactions I'm gonna split into two

794
00:19:46,130 --> 00:19:46,140
transactions I'm gonna split into two
 

795
00:19:46,140 --> 00:19:48,500
transactions I'm gonna split into two
big pieces but and talk about both of

796
00:19:48,500 --> 00:19:48,510
big pieces but and talk about both of
 

797
00:19:48,510 --> 00:19:52,550
big pieces but and talk about both of
them the main topics in the lecture the

798
00:19:52,550 --> 00:19:52,560
them the main topics in the lecture the
 

799
00:19:52,560 --> 00:19:54,350
them the main topics in the lecture the
first big implementation topic is

800
00:19:54,350 --> 00:19:54,360
first big implementation topic is
 

801
00:19:54,360 --> 00:20:05,420
first big implementation topic is
concurrency control this is the main

802
00:20:05,420 --> 00:20:05,430
concurrency control this is the main
 

803
00:20:05,430 --> 00:20:07,370
concurrency control this is the main
tool we use to provide serializability

804
00:20:07,370 --> 00:20:07,380
tool we use to provide serializability
 

805
00:20:07,380 --> 00:20:10,070
tool we use to provide serializability
the current or isolation so concurrency

806
00:20:10,070 --> 00:20:10,080
the current or isolation so concurrency
 

807
00:20:10,080 --> 00:20:16,499
the current or isolation so concurrency
control bias

808
00:20:16,499 --> 00:20:16,509

 

809
00:20:16,509 --> 00:20:19,869

by its isolation from other concurrent

810
00:20:19,869 --> 00:20:19,879
by its isolation from other concurrent
 

811
00:20:19,879 --> 00:20:21,310
by its isolation from other concurrent
transactions that might be trying to use

812
00:20:21,310 --> 00:20:21,320
transactions that might be trying to use
 

813
00:20:21,320 --> 00:20:24,039
transactions that might be trying to use
the same data and the other big pieces I

814
00:20:24,039 --> 00:20:24,049
the same data and the other big pieces I
 

815
00:20:24,049 --> 00:20:28,799
the same data and the other big pieces I
mentioned is atomic commit and this is

816
00:20:28,799 --> 00:20:28,809

 

817
00:20:28,809 --> 00:20:31,359

what's going to help us deal with the

818
00:20:31,359 --> 00:20:31,369
what's going to help us deal with the
 

819
00:20:31,369 --> 00:20:34,060
what's going to help us deal with the
possibility that oh yeah this

820
00:20:34,060 --> 00:20:34,070
possibility that oh yeah this
 

821
00:20:34,070 --> 00:20:35,950
possibility that oh yeah this
transactions executing a long and it's

822
00:20:35,950 --> 00:20:35,960
transactions executing a long and it's
 

823
00:20:35,960 --> 00:20:38,320
transactions executing a long and it's
may be modified X and then all of a

824
00:20:38,320 --> 00:20:38,330
may be modified X and then all of a
 

825
00:20:38,330 --> 00:20:41,889
may be modified X and then all of a
sudden there's a failure and one of the

826
00:20:41,889 --> 00:20:41,899
sudden there's a failure and one of the
 

827
00:20:41,899 --> 00:20:44,470
sudden there's a failure and one of the
server's involved but other servers that

828
00:20:44,470 --> 00:20:44,480
server's involved but other servers that
 

829
00:20:44,480 --> 00:20:45,909
server's involved but other servers that
were maybe actually in other parts of

830
00:20:45,909 --> 00:20:45,919
were maybe actually in other parts of
 

831
00:20:45,919 --> 00:20:48,129
were maybe actually in other parts of
the transaction that is if x and y are

832
00:20:48,129 --> 00:20:48,139
the transaction that is if x and y are
 

833
00:20:48,139 --> 00:20:50,769
the transaction that is if x and y are
in different machines we need to be able

834
00:20:50,769 --> 00:20:50,779
in different machines we need to be able
 

835
00:20:50,779 --> 00:20:52,720
in different machines we need to be able
to recover even if there's a partial

836
00:20:52,720 --> 00:20:52,730
to recover even if there's a partial
 

837
00:20:52,730 --> 00:20:55,330
to recover even if there's a partial
failure of only some of the machines the

838
00:20:55,330 --> 00:20:55,340
failure of only some of the machines the
 

839
00:20:55,340 --> 00:20:58,450
failure of only some of the machines the
transactions running off and the big

840
00:20:58,450 --> 00:20:58,460
transactions running off and the big
 

841
00:20:58,460 --> 00:21:00,159
transactions running off and the big
tool people use for that is this atomic

842
00:21:00,159 --> 00:21:00,169
tool people use for that is this atomic
 

843
00:21:00,169 --> 00:21:03,879
tool people use for that is this atomic
commit you'll talk about all right so

844
00:21:03,879 --> 00:21:03,889
commit you'll talk about all right so
 

845
00:21:03,889 --> 00:21:08,950
commit you'll talk about all right so
first concurrency control there's really

846
00:21:08,950 --> 00:21:08,960
first concurrency control there's really
 

847
00:21:08,960 --> 00:21:11,470
first concurrency control there's really
two classes two major approaches to

848
00:21:11,470 --> 00:21:11,480
two classes two major approaches to
 

849
00:21:11,480 --> 00:21:13,980
two classes two major approaches to
concurrency control I'll talk about both

850
00:21:13,980 --> 00:21:13,990
concurrency control I'll talk about both
 

851
00:21:13,990 --> 00:21:20,440
concurrency control I'll talk about both
during the course if they're just mean

852
00:21:20,440 --> 00:21:20,450
during the course if they're just mean
 

853
00:21:20,450 --> 00:21:22,950
during the course if they're just mean
strategies the first strategy is a

854
00:21:22,950 --> 00:21:22,960
strategies the first strategy is a
 

855
00:21:22,960 --> 00:21:29,470
strategies the first strategy is a
pessimistic usually called pessimist

856
00:21:29,470 --> 00:21:29,480
pessimistic usually called pessimist
 

857
00:21:29,480 --> 00:21:32,350
pessimistic usually called pessimist
pessimistic concurrency control and this

858
00:21:32,350 --> 00:21:32,360
pessimistic concurrency control and this
 

859
00:21:32,360 --> 00:21:34,509
pessimistic concurrency control and this
is usually locking we've all done

860
00:21:34,509 --> 00:21:34,519
is usually locking we've all done
 

861
00:21:34,519 --> 00:21:36,430
is usually locking we've all done
locking in the labs in the context of go

862
00:21:36,430 --> 00:21:36,440
locking in the labs in the context of go
 

863
00:21:36,440 --> 00:21:38,499
locking in the labs in the context of go
program so it turns out databases

864
00:21:38,499 --> 00:21:38,509
program so it turns out databases
 

865
00:21:38,509 --> 00:21:40,869
program so it turns out databases
transaction processing systems also used

866
00:21:40,869 --> 00:21:40,879
transaction processing systems also used
 

867
00:21:40,879 --> 00:21:45,399
transaction processing systems also used
locking and the idea here is U is the

868
00:21:45,399 --> 00:21:45,409
locking and the idea here is U is the
 

869
00:21:45,409 --> 00:21:46,899
locking and the idea here is U is the
same as well you're quite familiar with

870
00:21:46,899 --> 00:21:46,909
same as well you're quite familiar with
 

871
00:21:46,909 --> 00:21:48,850
same as well you're quite familiar with
this that before transaction uses any

872
00:21:48,850 --> 00:21:48,860
this that before transaction uses any
 

873
00:21:48,860 --> 00:21:50,950
this that before transaction uses any
data it needs to acquire a lock on that

874
00:21:50,950 --> 00:21:50,960
data it needs to acquire a lock on that
 

875
00:21:50,960 --> 00:21:52,840
data it needs to acquire a lock on that
data and if some other transactions

876
00:21:52,840 --> 00:21:52,850
data and if some other transactions
 

877
00:21:52,850 --> 00:21:54,609
data and if some other transactions
already using the data the lock will be

878
00:21:54,609 --> 00:21:54,619
already using the data the lock will be
 

879
00:21:54,619 --> 00:21:57,070
already using the data the lock will be
held and we'll have to wait before we

880
00:21:57,070 --> 00:21:57,080
held and we'll have to wait before we
 

881
00:21:57,080 --> 00:21:58,899
held and we'll have to wait before we
can acquire the lock wait for the other

882
00:21:58,899 --> 00:21:58,909
can acquire the lock wait for the other
 

883
00:21:58,909 --> 00:22:02,889
can acquire the lock wait for the other
transaction to finish and in pessimistic

884
00:22:02,889 --> 00:22:02,899
transaction to finish and in pessimistic
 

885
00:22:02,899 --> 00:22:04,720
transaction to finish and in pessimistic
systems if there's locking conflicts

886
00:22:04,720 --> 00:22:04,730
systems if there's locking conflicts
 

887
00:22:04,730 --> 00:22:06,220
systems if there's locking conflicts
somebody else has the lock it'll cause

888
00:22:06,220 --> 00:22:06,230
somebody else has the lock it'll cause
 

889
00:22:06,230 --> 00:22:09,129
somebody else has the lock it'll cause
delays so you're sort of treating

890
00:22:09,129 --> 00:22:09,139
delays so you're sort of treating
 

891
00:22:09,139 --> 00:22:14,409
delays so you're sort of treating
performance for correctness the other

892
00:22:14,409 --> 00:22:14,419
performance for correctness the other
 

893
00:22:14,419 --> 00:22:21,440
performance for correctness the other
main approach is optimistic approaches

894
00:22:21,440 --> 00:22:21,450

 

895
00:22:21,450 --> 00:22:23,970

the basic idea here is you don't worry

896
00:22:23,970 --> 00:22:23,980
the basic idea here is you don't worry
 

897
00:22:23,980 --> 00:22:25,320
the basic idea here is you don't worry
about whether maybe some other

898
00:22:25,320 --> 00:22:25,330
about whether maybe some other
 

899
00:22:25,330 --> 00:22:26,970
about whether maybe some other
transactions reading or writing the data

900
00:22:26,970 --> 00:22:26,980
transactions reading or writing the data
 

901
00:22:26,980 --> 00:22:28,769
transactions reading or writing the data
at the same time as you you just go

902
00:22:28,769 --> 00:22:28,779
at the same time as you you just go
 

903
00:22:28,779 --> 00:22:30,299
at the same time as you you just go
ahead and do whatever reads and writes

904
00:22:30,299 --> 00:22:30,309
ahead and do whatever reads and writes
 

905
00:22:30,309 --> 00:22:32,190
ahead and do whatever reads and writes
you're gonna do although typically into

906
00:22:32,190 --> 00:22:32,200
you're gonna do although typically into
 

907
00:22:32,200 --> 00:22:33,930
you're gonna do although typically into
some sort of temporary area and then

908
00:22:33,930 --> 00:22:33,940
some sort of temporary area and then
 

909
00:22:33,940 --> 00:22:37,320
some sort of temporary area and then
only at the end you go and check whether

910
00:22:37,320 --> 00:22:37,330
only at the end you go and check whether
 

911
00:22:37,330 --> 00:22:38,789
only at the end you go and check whether
actually maybe some other transaction

912
00:22:38,789 --> 00:22:38,799
actually maybe some other transaction
 

913
00:22:38,799 --> 00:22:40,860
actually maybe some other transaction
might have been interfering and if

914
00:22:40,860 --> 00:22:40,870
might have been interfering and if
 

915
00:22:40,870 --> 00:22:42,299
might have been interfering and if
there's no other transaction now you're

916
00:22:42,299 --> 00:22:42,309
there's no other transaction now you're
 

917
00:22:42,309 --> 00:22:44,460
there's no other transaction now you're
done and you never had to go through any

918
00:22:44,460 --> 00:22:44,470
done and you never had to go through any
 

919
00:22:44,470 --> 00:22:46,019
done and you never had to go through any
of the overhead or weighting of taking

920
00:22:46,019 --> 00:22:46,029
of the overhead or weighting of taking
 

921
00:22:46,029 --> 00:22:47,940
of the overhead or weighting of taking
out locks the locks are reasonably

922
00:22:47,940 --> 00:22:47,950
out locks the locks are reasonably
 

923
00:22:47,950 --> 00:22:51,720
out locks the locks are reasonably
expensive to manipulate but if somebody

924
00:22:51,720 --> 00:22:51,730
expensive to manipulate but if somebody
 

925
00:22:51,730 --> 00:22:54,330
expensive to manipulate but if somebody
else was modifying the data in a

926
00:22:54,330 --> 00:22:54,340
else was modifying the data in a
 

927
00:22:54,340 --> 00:22:56,820
else was modifying the data in a
conflicting way at the same time you

928
00:22:56,820 --> 00:22:56,830
conflicting way at the same time you
 

929
00:22:56,830 --> 00:22:58,470
conflicting way at the same time you
were then you have to abort that

930
00:22:58,470 --> 00:22:58,480
were then you have to abort that
 

931
00:22:58,480 --> 00:23:05,299
were then you have to abort that
transaction and we try and the

932
00:23:05,299 --> 00:23:05,309
transaction and we try and the
 

933
00:23:05,309 --> 00:23:06,930
transaction and we try and the
abbreviation for this is often

934
00:23:06,930 --> 00:23:06,940
abbreviation for this is often
 

935
00:23:06,940 --> 00:23:10,110
abbreviation for this is often
optimistic concurrency control um it

936
00:23:10,110 --> 00:23:10,120
optimistic concurrency control um it
 

937
00:23:10,120 --> 00:23:11,070
optimistic concurrency control um it
turns out that under different

938
00:23:11,070 --> 00:23:11,080
turns out that under different
 

939
00:23:11,080 --> 00:23:12,749
turns out that under different
circumstances these two strategies one

940
00:23:12,749 --> 00:23:12,759
circumstances these two strategies one
 

941
00:23:12,759 --> 00:23:15,169
circumstances these two strategies one
can be faster than the other

942
00:23:15,169 --> 00:23:15,179
can be faster than the other
 

943
00:23:15,179 --> 00:23:17,820
can be faster than the other
if conflicts are very frequent you

944
00:23:17,820 --> 00:23:17,830
if conflicts are very frequent you
 

945
00:23:17,830 --> 00:23:18,570
if conflicts are very frequent you
probably actually want to use

946
00:23:18,570 --> 00:23:18,580
probably actually want to use
 

947
00:23:18,580 --> 00:23:20,669
probably actually want to use
pessimistic concurrency control not

948
00:23:20,669 --> 00:23:20,679
pessimistic concurrency control not
 

949
00:23:20,679 --> 00:23:22,110
pessimistic concurrency control not
because of conflicts are frequent you're

950
00:23:22,110 --> 00:23:22,120
because of conflicts are frequent you're
 

951
00:23:22,120 --> 00:23:23,519
because of conflicts are frequent you're
gonna get a lot of aborts due to

952
00:23:23,519 --> 00:23:23,529
gonna get a lot of aborts due to
 

953
00:23:23,529 --> 00:23:25,889
gonna get a lot of aborts due to
conflicts for optimistic seems if

954
00:23:25,889 --> 00:23:25,899
conflicts for optimistic seems if
 

955
00:23:25,899 --> 00:23:27,570
conflicts for optimistic seems if
complex are rare than optimistic

956
00:23:27,570 --> 00:23:27,580
complex are rare than optimistic
 

957
00:23:27,580 --> 00:23:29,970
complex are rare than optimistic
concurrency control can be faster

958
00:23:29,970 --> 00:23:29,980
concurrency control can be faster
 

959
00:23:29,980 --> 00:23:31,529
concurrency control can be faster
because it completely avoids locking

960
00:23:31,529 --> 00:23:31,539
because it completely avoids locking
 

961
00:23:31,539 --> 00:23:33,570
because it completely avoids locking
overhead today will be all about

962
00:23:33,570 --> 00:23:33,580
overhead today will be all about
 

963
00:23:33,580 --> 00:23:36,570
overhead today will be all about
pessimistic concurrency control and then

964
00:23:36,570 --> 00:23:36,580
pessimistic concurrency control and then
 

965
00:23:36,580 --> 00:23:39,600
pessimistic concurrency control and then
some later paper in particular farm in a

966
00:23:39,600 --> 00:23:39,610
some later paper in particular farm in a
 

967
00:23:39,610 --> 00:23:41,940
some later paper in particular farm in a
couple weeks we'll deal with an

968
00:23:41,940 --> 00:23:41,950
couple weeks we'll deal with an
 

969
00:23:41,950 --> 00:23:48,539
couple weeks we'll deal with an
optimistic scheme okay so today talking

970
00:23:48,539 --> 00:23:48,549
optimistic scheme okay so today talking
 

971
00:23:48,549 --> 00:23:51,180
optimistic scheme okay so today talking
about pessimistic schemes refers

972
00:23:51,180 --> 00:23:51,190
about pessimistic schemes refers
 

973
00:23:51,190 --> 00:23:53,490
about pessimistic schemes refers
basically to locking and in particular

974
00:23:53,490 --> 00:23:53,500
basically to locking and in particular
 

975
00:23:53,500 --> 00:23:54,690
basically to locking and in particular
for today the reading was about

976
00:23:54,690 --> 00:23:54,700
for today the reading was about
 

977
00:23:54,700 --> 00:23:57,049
for today the reading was about
two-phase locking which is the most

978
00:23:57,049 --> 00:23:57,059
two-phase locking which is the most
 

979
00:23:57,059 --> 00:24:07,630
two-phase locking which is the most
common type of locking

980
00:24:07,630 --> 00:24:07,640

 

981
00:24:07,640 --> 00:24:10,130

and the idea in two-phase locking for

982
00:24:10,130 --> 00:24:10,140
and the idea in two-phase locking for
 

983
00:24:10,140 --> 00:24:12,080
and the idea in two-phase locking for
transactions is that transactions gonna

984
00:24:12,080 --> 00:24:12,090
transactions is that transactions gonna
 

985
00:24:12,090 --> 00:24:14,270
transactions is that transactions gonna
use a bunch of Records like X&Y and our

986
00:24:14,270 --> 00:24:14,280
use a bunch of Records like X&Y and our
 

987
00:24:14,280 --> 00:24:19,130
use a bunch of Records like X&Y and our
example the first rule is that you

988
00:24:19,130 --> 00:24:19,140
example the first rule is that you
 

989
00:24:19,140 --> 00:24:25,340
example the first rule is that you
acquire a lock before using date any

990
00:24:25,340 --> 00:24:25,350
acquire a lock before using date any
 

991
00:24:25,350 --> 00:24:30,350
acquire a lock before using date any
piece of data we're reading or writing

992
00:24:30,350 --> 00:24:30,360
piece of data we're reading or writing
 

993
00:24:30,360 --> 00:24:35,390
piece of data we're reading or writing
any record and the second rule for

994
00:24:35,390 --> 00:24:35,400
any record and the second rule for
 

995
00:24:35,400 --> 00:24:37,700
any record and the second rule for
transactions is that a transaction must

996
00:24:37,700 --> 00:24:37,710
transactions is that a transaction must
 

997
00:24:37,710 --> 00:24:40,760
transactions is that a transaction must
hold any locks it acquires until after

998
00:24:40,760 --> 00:24:40,770
hold any locks it acquires until after
 

999
00:24:40,770 --> 00:24:43,640
hold any locks it acquires until after
it commits or aborts you're not allowed

1000
00:24:43,640 --> 00:24:43,650
it commits or aborts you're not allowed
 

1001
00:24:43,650 --> 00:24:44,810
it commits or aborts you're not allowed
to give up locks in the middle of the

1002
00:24:44,810 --> 00:24:44,820
to give up locks in the middle of the
 

1003
00:24:44,820 --> 00:24:46,010
to give up locks in the middle of the
transaction you have to hold them all

1004
00:24:46,010 --> 00:24:46,020
transaction you have to hold them all
 

1005
00:24:46,020 --> 00:24:48,260
transaction you have to hold them all
you can only accumulate them until

1006
00:24:48,260 --> 00:24:48,270
you can only accumulate them until
 

1007
00:24:48,270 --> 00:24:54,670
you can only accumulate them until
you're done until after you're done so

1008
00:24:54,670 --> 00:24:54,680

 

1009
00:24:54,680 --> 00:24:59,660

until Phoebe done so this is two-phase

1010
00:24:59,660 --> 00:24:59,670
until Phoebe done so this is two-phase
 

1011
00:24:59,670 --> 00:25:01,490
until Phoebe done so this is two-phase
locking the phases are the phases which

1012
00:25:01,490 --> 00:25:01,500
locking the phases are the phases which
 

1013
00:25:01,500 --> 00:25:03,560
locking the phases are the phases which
we acquire locks and then phase in which

1014
00:25:03,560 --> 00:25:03,570
we acquire locks and then phase in which
 

1015
00:25:03,570 --> 00:25:07,480
we acquire locks and then phase in which
we just hold onto them until we're done

1016
00:25:07,480 --> 00:25:07,490
we just hold onto them until we're done
 

1017
00:25:07,490 --> 00:25:11,630
we just hold onto them until we're done
so for two phase locking to sort of see

1018
00:25:11,630 --> 00:25:11,640
so for two phase locking to sort of see
 

1019
00:25:11,640 --> 00:25:15,800
so for two phase locking to sort of see
why locking works your typical locking

1020
00:25:15,800 --> 00:25:15,810
why locking works your typical locking
 

1021
00:25:15,810 --> 00:25:17,690
why locking works your typical locking
systems well there's a lot of variation

1022
00:25:17,690 --> 00:25:17,700
systems well there's a lot of variation
 

1023
00:25:17,700 --> 00:25:19,100
systems well there's a lot of variation
typical locking systems associate a

1024
00:25:19,100 --> 00:25:19,110
typical locking systems associate a
 

1025
00:25:19,110 --> 00:25:21,050
typical locking systems associate a
separate lock with each record in the

1026
00:25:21,050 --> 00:25:21,060
separate lock with each record in the
 

1027
00:25:21,060 --> 00:25:23,240
separate lock with each record in the
database with each row in each table for

1028
00:25:23,240 --> 00:25:23,250
database with each row in each table for
 

1029
00:25:23,250 --> 00:25:25,490
database with each row in each table for
example although they can be more more

1030
00:25:25,490 --> 00:25:25,500
example although they can be more more
 

1031
00:25:25,500 --> 00:25:28,490
example although they can be more more
coarse-grained these transactions start

1032
00:25:28,490 --> 00:25:28,500
coarse-grained these transactions start
 

1033
00:25:28,500 --> 00:25:29,900
coarse-grained these transactions start
out holding no locks let's say

1034
00:25:29,900 --> 00:25:29,910
out holding no locks let's say
 

1035
00:25:29,910 --> 00:25:31,460
out holding no locks let's say
transaction one starts out holding no

1036
00:25:31,460 --> 00:25:31,470
transaction one starts out holding no
 

1037
00:25:31,470 --> 00:25:34,490
transaction one starts out holding no
locks when it first uses X before so

1038
00:25:34,490 --> 00:25:34,500
locks when it first uses X before so
 

1039
00:25:34,500 --> 00:25:35,870
locks when it first uses X before so
I'll have to use it it has to acquire

1040
00:25:35,870 --> 00:25:35,880
I'll have to use it it has to acquire
 

1041
00:25:35,880 --> 00:25:38,530
I'll have to use it it has to acquire
the lock on X and it may have to wait

1042
00:25:38,530 --> 00:25:38,540
the lock on X and it may have to wait
 

1043
00:25:38,540 --> 00:25:41,120
the lock on X and it may have to wait
and when it first uses Y it acquires

1044
00:25:41,120 --> 00:25:41,130
and when it first uses Y it acquires
 

1045
00:25:41,130 --> 00:25:43,850
and when it first uses Y it acquires
another lock the lock on Y when it

1046
00:25:43,850 --> 00:25:43,860
another lock the lock on Y when it
 

1047
00:25:43,860 --> 00:25:45,740
another lock the lock on Y when it
finishes after it's done becoming these

1048
00:25:45,740 --> 00:25:45,750
finishes after it's done becoming these
 

1049
00:25:45,750 --> 00:25:48,170
finishes after it's done becoming these
both if we ran both these transactions

1050
00:25:48,170 --> 00:25:48,180
both if we ran both these transactions
 

1051
00:25:48,180 --> 00:25:50,750
both if we ran both these transactions
at the same time they're gonna basically

1052
00:25:50,750 --> 00:25:50,760
at the same time they're gonna basically
 

1053
00:25:50,760 --> 00:25:53,300
at the same time they're gonna basically
race to get the lock on X and whichever

1054
00:25:53,300 --> 00:25:53,310
race to get the lock on X and whichever
 

1055
00:25:53,310 --> 00:25:56,150
race to get the lock on X and whichever
of them gets the managed to get the lock

1056
00:25:56,150 --> 00:25:56,160
of them gets the managed to get the lock
 

1057
00:25:56,160 --> 00:25:59,390
of them gets the managed to get the lock
on X first it will proceed and finish

1058
00:25:59,390 --> 00:25:59,400
on X first it will proceed and finish
 

1059
00:25:59,400 --> 00:26:02,300
on X first it will proceed and finish
and commit meantime the other

1060
00:26:02,300 --> 00:26:02,310
and commit meantime the other
 

1061
00:26:02,310 --> 00:26:04,220
and commit meantime the other
transaction that didn't manage to get

1062
00:26:04,220 --> 00:26:04,230
transaction that didn't manage to get
 

1063
00:26:04,230 --> 00:26:05,600
transaction that didn't manage to get
the lock on X first it's going to see if

1064
00:26:05,600 --> 00:26:05,610
the lock on X first it's going to see if
 

1065
00:26:05,610 --> 00:26:08,900
the lock on X first it's going to see if
you're waiting before it what you does

1066
00:26:08,900 --> 00:26:08,910
you're waiting before it what you does
 

1067
00:26:08,910 --> 00:26:10,850
you're waiting before it what you does
anything with accent OA can acquire the

1068
00:26:10,850 --> 00:26:10,860
anything with accent OA can acquire the
 

1069
00:26:10,860 --> 00:26:13,190
anything with accent OA can acquire the
lock so transaction 2 actually got the

1070
00:26:13,190 --> 00:26:13,200
lock so transaction 2 actually got the
 

1071
00:26:13,200 --> 00:26:14,450
lock so transaction 2 actually got the
lock first

1072
00:26:14,450 --> 00:26:14,460
lock first
 

1073
00:26:14,460 --> 00:26:16,370
lock first
you would get the value of X get the

1074
00:26:16,370 --> 00:26:16,380
you would get the value of X get the
 

1075
00:26:16,380 --> 00:26:20,180
you would get the value of X get the
value of y cuz transaction one hasn't

1076
00:26:20,180 --> 00:26:20,190
value of y cuz transaction one hasn't
 

1077
00:26:20,190 --> 00:26:22,360
value of y cuz transaction one hasn't
gotten at this point hasn't locked Y yet

1078
00:26:22,360 --> 00:26:22,370
gotten at this point hasn't locked Y yet
 

1079
00:26:22,370 --> 00:26:24,530
gotten at this point hasn't locked Y yet
it'll print and it will finish and

1080
00:26:24,530 --> 00:26:24,540
it'll print and it will finish and
 

1081
00:26:24,540 --> 00:26:26,120
it'll print and it will finish and
release its locks and only then

1082
00:26:26,120 --> 00:26:26,130
release its locks and only then
 

1083
00:26:26,130 --> 00:26:28,550
release its locks and only then
transaction one will be able to acquire

1084
00:26:28,550 --> 00:26:28,560
transaction one will be able to acquire
 

1085
00:26:28,560 --> 00:26:30,950
transaction one will be able to acquire
the lock on X and as you can see that

1086
00:26:30,950 --> 00:26:30,960
the lock on X and as you can see that
 

1087
00:26:30,960 --> 00:26:33,740
the lock on X and as you can see that
basically forces a serial order because

1088
00:26:33,740 --> 00:26:33,750
basically forces a serial order because
 

1089
00:26:33,750 --> 00:26:35,210
basically forces a serial order because
it forced in this case it force the

1090
00:26:35,210 --> 00:26:35,220
it forced in this case it force the
 

1091
00:26:35,220 --> 00:26:38,540
it forced in this case it force the
order T two and then when T two finishes

1092
00:26:38,540 --> 00:26:38,550
order T two and then when T two finishes
 

1093
00:26:38,550 --> 00:26:43,070
order T two and then when T two finishes
only then T 1 so with it's explicitly

1094
00:26:43,070 --> 00:26:43,080
only then T 1 so with it's explicitly
 

1095
00:26:43,080 --> 00:26:47,320
only then T 1 so with it's explicitly
forcing an order which causes the that

1096
00:26:47,320 --> 00:26:47,330
forcing an order which causes the that
 

1097
00:26:47,330 --> 00:26:49,610
forcing an order which causes the that
execution to follow the definition of

1098
00:26:49,610 --> 00:26:49,620
execution to follow the definition of
 

1099
00:26:49,620 --> 00:26:51,440
execution to follow the definition of
serializability that you know really is

1100
00:26:51,440 --> 00:26:51,450
serializability that you know really is
 

1101
00:26:51,450 --> 00:26:54,350
serializability that you know really is
executing T 2 to completion and only

1102
00:26:54,350 --> 00:26:54,360
executing T 2 to completion and only
 

1103
00:26:54,360 --> 00:27:06,920
executing T 2 to completion and only
then T 1 so we do get correct execution

1104
00:27:06,920 --> 00:27:06,930

 

1105
00:27:06,930 --> 00:27:15,030

all right so one question is why you

1106
00:27:15,030 --> 00:27:15,040
all right so one question is why you
 

1107
00:27:15,040 --> 00:27:16,830
all right so one question is why you
need to hold the locks until the

1108
00:27:16,830 --> 00:27:16,840
need to hold the locks until the
 

1109
00:27:16,840 --> 00:27:19,050
need to hold the locks until the
transactions completely finished you

1110
00:27:19,050 --> 00:27:19,060
transactions completely finished you
 

1111
00:27:19,060 --> 00:27:22,200
transactions completely finished you
might think that you could just hold a

1112
00:27:22,200 --> 00:27:22,210
might think that you could just hold a
 

1113
00:27:22,210 --> 00:27:24,510
might think that you could just hold a
lock while you are actually using the

1114
00:27:24,510 --> 00:27:24,520
lock while you are actually using the
 

1115
00:27:24,520 --> 00:27:25,800
lock while you are actually using the
data and that would be more efficient

1116
00:27:25,800 --> 00:27:25,810
data and that would be more efficient
 

1117
00:27:25,810 --> 00:27:28,650
data and that would be more efficient
and indeed it would that is you know

1118
00:27:28,650 --> 00:27:28,660
and indeed it would that is you know
 

1119
00:27:28,660 --> 00:27:31,470
and indeed it would that is you know
maybe only hold the lock for the period

1120
00:27:31,470 --> 00:27:31,480
maybe only hold the lock for the period
 

1121
00:27:31,480 --> 00:27:34,020
maybe only hold the lock for the period
of time in which t2 is actually looking

1122
00:27:34,020 --> 00:27:34,030
of time in which t2 is actually looking
 

1123
00:27:34,030 --> 00:27:36,030
of time in which t2 is actually looking
at record X or maybe only hold the lock

1124
00:27:36,030 --> 00:27:36,040
at record X or maybe only hold the lock
 

1125
00:27:36,040 --> 00:27:39,170
at record X or maybe only hold the lock
on X here for the duration of the add

1126
00:27:39,170 --> 00:27:39,180
on X here for the duration of the add
 

1127
00:27:39,180 --> 00:27:41,670
on X here for the duration of the add
operation and then immediately release

1128
00:27:41,670 --> 00:27:41,680
operation and then immediately release
 

1129
00:27:41,680 --> 00:27:43,470
operation and then immediately release
it and in that case that what if we

1130
00:27:43,470 --> 00:27:43,480
it and in that case that what if we
 

1131
00:27:43,480 --> 00:27:45,270
it and in that case that what if we
transaction one immediately released a

1132
00:27:45,270 --> 00:27:45,280
transaction one immediately released a
 

1133
00:27:45,280 --> 00:27:47,130
transaction one immediately released a
lock on X there there by disobeying this

1134
00:27:47,130 --> 00:27:47,140
lock on X there there by disobeying this
 

1135
00:27:47,140 --> 00:27:48,900
lock on X there there by disobeying this
rule of course but if it immediately

1136
00:27:48,900 --> 00:27:48,910
rule of course but if it immediately
 

1137
00:27:48,910 --> 00:27:50,730
rule of course but if it immediately
release the lock on X then transaction

1138
00:27:50,730 --> 00:27:50,740
release the lock on X then transaction
 

1139
00:27:50,740 --> 00:27:51,960
release the lock on X then transaction
two might be able to start a little bit

1140
00:27:51,960 --> 00:27:51,970
two might be able to start a little bit
 

1141
00:27:51,970 --> 00:27:53,580
two might be able to start a little bit
earlier we get more concurrency more

1142
00:27:53,580 --> 00:27:53,590
earlier we get more concurrency more
 

1143
00:27:53,590 --> 00:27:55,230
earlier we get more concurrency more
higher performance so this rule

1144
00:27:55,230 --> 00:27:55,240
higher performance so this rule
 

1145
00:27:55,240 --> 00:27:57,810
higher performance so this rule
definitely you know bad for performance

1146
00:27:57,810 --> 00:27:57,820
definitely you know bad for performance
 

1147
00:27:57,820 --> 00:28:00,030
definitely you know bad for performance
so we want to make pretty sure that it's

1148
00:28:00,030 --> 00:28:00,040
so we want to make pretty sure that it's
 

1149
00:28:00,040 --> 00:28:02,520
so we want to make pretty sure that it's
it's good for that's required for

1150
00:28:02,520 --> 00:28:02,530
it's good for that's required for
 

1151
00:28:02,530 --> 00:28:05,210
it's good for that's required for
correctness

1152
00:28:05,210 --> 00:28:05,220

 

1153
00:28:05,220 --> 00:28:08,430

so what won't happen if transactions did

1154
00:28:08,430 --> 00:28:08,440
so what won't happen if transactions did
 

1155
00:28:08,440 --> 00:28:11,730
so what won't happen if transactions did
actually release locks as early as

1156
00:28:11,730 --> 00:28:11,740
actually release locks as early as
 

1157
00:28:11,740 --> 00:28:12,420
actually release locks as early as
possible

1158
00:28:12,420 --> 00:28:12,430
possible
 

1159
00:28:12,430 --> 00:28:15,930
possible
so suppose t2 here reads X and then

1160
00:28:15,930 --> 00:28:15,940
so suppose t2 here reads X and then
 

1161
00:28:15,940 --> 00:28:20,430
so suppose t2 here reads X and then
immediately releases this lock on X that

1162
00:28:20,430 --> 00:28:20,440
immediately releases this lock on X that
 

1163
00:28:20,440 --> 00:28:23,670
immediately releases this lock on X that
would allow t1 since at now at this

1164
00:28:23,670 --> 00:28:23,680
would allow t1 since at now at this
 

1165
00:28:23,680 --> 00:28:26,850
would allow t1 since at now at this
point in the execution t2 doesn't hold

1166
00:28:26,850 --> 00:28:26,860
point in the execution t2 doesn't hold
 

1167
00:28:26,860 --> 00:28:28,620
point in the execution t2 doesn't hold
any locks because it's just released it

1168
00:28:28,620 --> 00:28:28,630
any locks because it's just released it
 

1169
00:28:28,630 --> 00:28:31,410
any locks because it's just released it
illegally release the lock on X since it

1170
00:28:31,410 --> 00:28:31,420
illegally release the lock on X since it
 

1171
00:28:31,420 --> 00:28:33,030
illegally release the lock on X since it
holds a no locks that means t1 could

1172
00:28:33,030 --> 00:28:33,040
holds a no locks that means t1 could
 

1173
00:28:33,040 --> 00:28:36,600
holds a no locks that means t1 could
completely execute right here and we

1174
00:28:36,600 --> 00:28:36,610
completely execute right here and we
 

1175
00:28:36,610 --> 00:28:40,080
completely execute right here and we
already knew from from before that this

1176
00:28:40,080 --> 00:28:40,090
already knew from from before that this
 

1177
00:28:40,090 --> 00:28:42,060
already knew from from before that this
interleaving is not correct as it

1178
00:28:42,060 --> 00:28:42,070
interleaving is not correct as it
 

1179
00:28:42,070 --> 00:28:45,290
interleaving is not correct as it
doesn't produce either these two outputs

1180
00:28:45,290 --> 00:28:45,300
doesn't produce either these two outputs
 

1181
00:28:45,300 --> 00:28:52,590
doesn't produce either these two outputs
similarly if if t1 released this lock on

1182
00:28:52,590 --> 00:28:52,600
similarly if if t1 released this lock on
 

1183
00:28:52,600 --> 00:28:55,020
similarly if if t1 released this lock on
X after finished adding one to X that

1184
00:28:55,020 --> 00:28:55,030
X after finished adding one to X that
 

1185
00:28:55,030 --> 00:28:57,690
X after finished adding one to X that
would allow all of t2 to slip in right

1186
00:28:57,690 --> 00:28:57,700
would allow all of t2 to slip in right
 

1187
00:28:57,700 --> 00:28:59,760
would allow all of t2 to slip in right
here and we know also from before that

1188
00:28:59,760 --> 00:28:59,770
here and we know also from before that
 

1189
00:28:59,770 --> 00:29:07,610
here and we know also from before that
that results in in illegal results

1190
00:29:07,610 --> 00:29:07,620

 

1191
00:29:07,620 --> 00:29:12,560

there's a an additional kind of problem

1192
00:29:12,560 --> 00:29:12,570
there's a an additional kind of problem
 

1193
00:29:12,570 --> 00:29:14,000
there's a an additional kind of problem
that can come up with releasing locks

1194
00:29:14,000 --> 00:29:14,010
that can come up with releasing locks
 

1195
00:29:14,010 --> 00:29:18,680
that can come up with releasing locks
after modifying data if t1 were to

1196
00:29:18,680 --> 00:29:18,690
after modifying data if t1 were to
 

1197
00:29:18,690 --> 00:29:21,080
after modifying data if t1 were to
release the lock on X it might allow t2

1198
00:29:21,080 --> 00:29:21,090
release the lock on X it might allow t2
 

1199
00:29:21,090 --> 00:29:24,350
release the lock on X it might allow t2
to see the modified version of X here to

1200
00:29:24,350 --> 00:29:24,360
to see the modified version of X here to
 

1201
00:29:24,360 --> 00:29:26,720
to see the modified version of X here to
see the X after adding 1 to it and to

1202
00:29:26,720 --> 00:29:26,730
see the X after adding 1 to it and to
 

1203
00:29:26,730 --> 00:29:28,940
see the X after adding 1 to it and to
print that output and then for tteyuu to

1204
00:29:28,940 --> 00:29:28,950
print that output and then for tteyuu to
 

1205
00:29:28,950 --> 00:29:31,730
print that output and then for tteyuu to
complete after printing the incremented

1206
00:29:31,730 --> 00:29:31,740
complete after printing the incremented
 

1207
00:29:31,740 --> 00:29:33,890
complete after printing the incremented
value of x if transaction one were to

1208
00:29:33,890 --> 00:29:33,900
value of x if transaction one were to
 

1209
00:29:33,900 --> 00:29:36,019
value of x if transaction one were to
abort after that point maybe because

1210
00:29:36,019 --> 00:29:36,029
abort after that point maybe because
 

1211
00:29:36,029 --> 00:29:39,710
abort after that point maybe because
bank balance Y doesn't exist or maybe

1212
00:29:39,710 --> 00:29:39,720
bank balance Y doesn't exist or maybe
 

1213
00:29:39,720 --> 00:29:41,810
bank balance Y doesn't exist or maybe
bank bonds Y exists but its balance is

1214
00:29:41,810 --> 00:29:41,820
bank bonds Y exists but its balance is
 

1215
00:29:41,820 --> 00:29:43,760
bank bonds Y exists but its balance is
zero and you know we're not allowed to

1216
00:29:43,760 --> 00:29:43,770
zero and you know we're not allowed to
 

1217
00:29:43,770 --> 00:29:46,250
zero and you know we're not allowed to
decrement 0 for bank balances because

1218
00:29:46,250 --> 00:29:46,260
decrement 0 for bank balances because
 

1219
00:29:46,260 --> 00:29:48,860
decrement 0 for bank balances because
that's an overdraft so t1 might modify X

1220
00:29:48,860 --> 00:29:48,870
that's an overdraft so t1 might modify X
 

1221
00:29:48,870 --> 00:29:51,289
that's an overdraft so t1 might modify X
then abort and part of the abort has to

1222
00:29:51,289 --> 00:29:51,299
then abort and part of the abort has to
 

1223
00:29:51,299 --> 00:29:56,649
then abort and part of the abort has to
be undoing its update to X in order to

1224
00:29:56,649 --> 00:29:56,659
be undoing its update to X in order to
 

1225
00:29:56,659 --> 00:29:59,480
be undoing its update to X in order to
maintain atomicity and what that would

1226
00:29:59,480 --> 00:29:59,490
maintain atomicity and what that would
 

1227
00:29:59,490 --> 00:30:00,740
maintain atomicity and what that would
mean if it released the locks is that

1228
00:30:00,740 --> 00:30:00,750
mean if it released the locks is that
 

1229
00:30:00,750 --> 00:30:02,990
mean if it released the locks is that
transaction 2 would have seen this sort

1230
00:30:02,990 --> 00:30:03,000
transaction 2 would have seen this sort
 

1231
00:30:03,000 --> 00:30:05,480
transaction 2 would have seen this sort
of phantom value of 11 that went away

1232
00:30:05,480 --> 00:30:05,490
of phantom value of 11 that went away
 

1233
00:30:05,490 --> 00:30:08,690
of phantom value of 11 that went away
because t1 aborted you would have seen a

1234
00:30:08,690 --> 00:30:08,700
because t1 aborted you would have seen a
 

1235
00:30:08,700 --> 00:30:10,580
because t1 aborted you would have seen a
value that according to the rules never

1236
00:30:10,580 --> 00:30:10,590
value that according to the rules never
 

1237
00:30:10,590 --> 00:30:13,930
value that according to the rules never
existed right because then the

1238
00:30:13,930 --> 00:30:13,940
existed right because then the
 

1239
00:30:13,940 --> 00:30:16,760
existed right because then the
transaction 1 aborts then it's as if it

1240
00:30:16,760 --> 00:30:16,770
transaction 1 aborts then it's as if it
 

1241
00:30:16,770 --> 00:30:18,320
transaction 1 aborts then it's as if it
never existed and so that means the

1242
00:30:18,320 --> 00:30:18,330
never existed and so that means the
 

1243
00:30:18,330 --> 00:30:21,440
never existed and so that means the
results from t2 had better be as if t2

1244
00:30:21,440 --> 00:30:21,450
results from t2 had better be as if t2
 

1245
00:30:21,450 --> 00:30:24,950
results from t2 had better be as if t2
ran by itself without t1 at all but if

1246
00:30:24,950 --> 00:30:24,960
ran by itself without t1 at all but if
 

1247
00:30:24,960 --> 00:30:26,060
ran by itself without t1 at all but if
it sees the increment that it's gonna

1248
00:30:26,060 --> 00:30:26,070
it sees the increment that it's gonna
 

1249
00:30:26,070 --> 00:30:31,870
it sees the increment that it's gonna
print 11 for X 11 10 actually which is

1250
00:30:31,870 --> 00:30:31,880
print 11 for X 11 10 actually which is
 

1251
00:30:31,880 --> 00:30:34,370
print 11 for X 11 10 actually which is
just doesn't correspond to any state in

1252
00:30:34,370 --> 00:30:34,380
just doesn't correspond to any state in
 

1253
00:30:34,380 --> 00:30:37,750
just doesn't correspond to any state in
the database given that t1 didn't really

1254
00:30:37,750 --> 00:30:37,760
the database given that t1 didn't really
 

1255
00:30:37,760 --> 00:30:42,649
the database given that t1 didn't really
complete okay so that's why those are

1256
00:30:42,649 --> 00:30:42,659
complete okay so that's why those are
 

1257
00:30:42,659 --> 00:30:45,289
complete okay so that's why those are
two dangers that are averted due to

1258
00:30:45,289 --> 00:30:45,299
two dangers that are averted due to
 

1259
00:30:45,299 --> 00:30:47,990
two dangers that are averted due to
violations serialize ability that are

1260
00:30:47,990 --> 00:30:48,000
violations serialize ability that are
 

1261
00:30:48,000 --> 00:30:50,450
violations serialize ability that are
averted because transactions hold the

1262
00:30:50,450 --> 00:30:50,460
averted because transactions hold the
 

1263
00:30:50,460 --> 00:30:56,570
averted because transactions hold the
locks until they're done a further thing

1264
00:30:56,570 --> 00:30:56,580
locks until they're done a further thing
 

1265
00:30:56,580 --> 00:30:59,000
locks until they're done a further thing
to note about these rules or that it's

1266
00:30:59,000 --> 00:30:59,010
to note about these rules or that it's
 

1267
00:30:59,010 --> 00:31:01,159
to note about these rules or that it's
very easy for them to produce deadlock

1268
00:31:01,159 --> 00:31:01,169
very easy for them to produce deadlock
 

1269
00:31:01,169 --> 00:31:06,049
very easy for them to produce deadlock
so you know for example if we have two

1270
00:31:06,049 --> 00:31:06,059
so you know for example if we have two
 

1271
00:31:06,059 --> 00:31:12,740
so you know for example if we have two
transactions one of them reads record ax

1272
00:31:12,740 --> 00:31:12,750
transactions one of them reads record ax
 

1273
00:31:12,750 --> 00:31:15,700
transactions one of them reads record ax
and reads record y

1274
00:31:15,700 --> 00:31:15,710
and reads record y
 

1275
00:31:15,710 --> 00:31:19,899
and reads record y
and the other transaction reads Y and

1276
00:31:19,899 --> 00:31:19,909
and the other transaction reads Y and
 

1277
00:31:19,909 --> 00:31:26,440
and the other transaction reads Y and
then X that's that's just a deadlock if

1278
00:31:26,440 --> 00:31:26,450
then X that's that's just a deadlock if
 

1279
00:31:26,450 --> 00:31:28,870
then X that's that's just a deadlock if
they run at the same time they each of

1280
00:31:28,870 --> 00:31:28,880
they run at the same time they each of
 

1281
00:31:28,880 --> 00:31:32,049
they run at the same time they each of
them gets this lock on the record it

1282
00:31:32,049 --> 00:31:32,059
them gets this lock on the record it
 

1283
00:31:32,059 --> 00:31:34,299
them gets this lock on the record it
first read they don't release till the

1284
00:31:34,299 --> 00:31:34,309
first read they don't release till the
 

1285
00:31:34,309 --> 00:31:37,659
first read they don't release till the
transactions finish so they both sit

1286
00:31:37,659 --> 00:31:37,669
transactions finish so they both sit
 

1287
00:31:37,669 --> 00:31:39,279
transactions finish so they both sit
there waiting for the lock that's held

1288
00:31:39,279 --> 00:31:39,289
there waiting for the lock that's held
 

1289
00:31:39,289 --> 00:31:41,529
there waiting for the lock that's held
by the other transaction and unless the

1290
00:31:41,529 --> 00:31:41,539
by the other transaction and unless the
 

1291
00:31:41,539 --> 00:31:42,880
by the other transaction and unless the
database does something clever which it

1292
00:31:42,880 --> 00:31:42,890
database does something clever which it
 

1293
00:31:42,890 --> 00:31:44,620
database does something clever which it
will

1294
00:31:44,620 --> 00:31:44,630
will
 

1295
00:31:44,630 --> 00:31:46,149
will
they'll deadlock forever and in fact

1296
00:31:46,149 --> 00:31:46,159
they'll deadlock forever and in fact
 

1297
00:31:46,159 --> 00:31:47,560
they'll deadlock forever and in fact
transactions have various strategies

1298
00:31:47,560 --> 00:31:47,570
transactions have various strategies
 

1299
00:31:47,570 --> 00:31:50,830
transactions have various strategies
including tracing cycles or timeouts in

1300
00:31:50,830 --> 00:31:50,840
including tracing cycles or timeouts in
 

1301
00:31:50,840 --> 00:31:52,990
including tracing cycles or timeouts in
order to detect that they've gone into

1302
00:31:52,990 --> 00:31:53,000
order to detect that they've gone into
 

1303
00:31:53,000 --> 00:31:54,669
order to detect that they've gone into
the situation the database will abort

1304
00:31:54,669 --> 00:31:54,679
the situation the database will abort
 

1305
00:31:54,679 --> 00:31:56,919
the situation the database will abort
one of these two transactions and undo

1306
00:31:56,919 --> 00:31:56,929
one of these two transactions and undo
 

1307
00:31:56,929 --> 00:31:58,330
one of these two transactions and undo
all its changes and act as if that

1308
00:31:58,330 --> 00:31:58,340
all its changes and act as if that
 

1309
00:31:58,340 --> 00:32:02,529
all its changes and act as if that
transaction that never occurred okay so

1310
00:32:02,529 --> 00:32:02,539
transaction that never occurred okay so
 

1311
00:32:02,539 --> 00:32:04,750
transaction that never occurred okay so
that's concurrency control with

1312
00:32:04,750 --> 00:32:04,760
that's concurrency control with
 

1313
00:32:04,760 --> 00:32:12,430
that's concurrency control with
two-phase locking and this is just

1314
00:32:12,430 --> 00:32:12,440
two-phase locking and this is just
 

1315
00:32:12,440 --> 00:32:16,750
two-phase locking and this is just
completely standard database behavior so

1316
00:32:16,750 --> 00:32:16,760
completely standard database behavior so
 

1317
00:32:16,760 --> 00:32:22,389
completely standard database behavior so
far and it's the same in a single

1318
00:32:22,389 --> 00:32:22,399
far and it's the same in a single
 

1319
00:32:22,399 --> 00:32:24,720
far and it's the same in a single
machine databases as it will be and

1320
00:32:24,720 --> 00:32:24,730
machine databases as it will be and
 

1321
00:32:24,730 --> 00:32:26,799
machine databases as it will be and
distributed databases that are a little

1322
00:32:26,799 --> 00:32:26,809
distributed databases that are a little
 

1323
00:32:26,809 --> 00:32:30,070
distributed databases that are a little
more interest to us but our next topic

1324
00:32:30,070 --> 00:32:30,080
more interest to us but our next topic
 

1325
00:32:30,080 --> 00:32:32,610
more interest to us but our next topic
is a little is actually specific to

1326
00:32:32,610 --> 00:32:32,620
is a little is actually specific to
 

1327
00:32:32,620 --> 00:32:35,500
is a little is actually specific to
building databases or storage systems in

1328
00:32:35,500 --> 00:32:35,510
building databases or storage systems in
 

1329
00:32:35,510 --> 00:32:39,330
building databases or storage systems in
general that support transactions on

1330
00:32:39,330 --> 00:32:39,340
general that support transactions on
 

1331
00:32:39,340 --> 00:32:41,350
general that support transactions on
distributed setting that is splitting

1332
00:32:41,350 --> 00:32:41,360
distributed setting that is splitting
 

1333
00:32:41,360 --> 00:32:45,580
distributed setting that is splitting
the data over multiple machines so now

1334
00:32:45,580 --> 00:32:45,590
the data over multiple machines so now
 

1335
00:32:45,590 --> 00:32:47,980
the data over multiple machines so now
the topic is how to build distributed

1336
00:32:47,980 --> 00:32:47,990
the topic is how to build distributed
 

1337
00:32:47,990 --> 00:32:53,710
the topic is how to build distributed
distributed transactions and in

1338
00:32:53,710 --> 00:32:53,720
distributed transactions and in
 

1339
00:32:53,720 --> 00:32:56,010
distributed transactions and in
particular how to cope with failures and

1340
00:32:56,010 --> 00:32:56,020
particular how to cope with failures and
 

1341
00:32:56,020 --> 00:32:58,870
particular how to cope with failures and
more specifically the kind of partial

1342
00:32:58,870 --> 00:32:58,880
more specifically the kind of partial
 

1343
00:32:58,880 --> 00:33:00,580
more specifically the kind of partial
failures of just one of many servers

1344
00:33:00,580 --> 00:33:00,590
failures of just one of many servers
 

1345
00:33:00,590 --> 00:33:02,350
failures of just one of many servers
that you often see in distributed

1346
00:33:02,350 --> 00:33:02,360
that you often see in distributed
 

1347
00:33:02,360 --> 00:33:04,590
that you often see in distributed
systems so beyond distributed

1348
00:33:04,590 --> 00:33:04,600
systems so beyond distributed
 

1349
00:33:04,600 --> 00:33:07,240
systems so beyond distributed
transactions and we're worried about how

1350
00:33:07,240 --> 00:33:07,250
transactions and we're worried about how
 

1351
00:33:07,250 --> 00:33:09,880
transactions and we're worried about how
they behave you make sure they're

1352
00:33:09,880 --> 00:33:09,890
they behave you make sure they're
 

1353
00:33:09,890 --> 00:33:13,149
they behave you make sure they're
serializable and also have sort of

1354
00:33:13,149 --> 00:33:13,159
serializable and also have sort of
 

1355
00:33:13,159 --> 00:33:15,460
serializable and also have sort of
all-or-nothing ad Amissah T even in the

1356
00:33:15,460 --> 00:33:15,470
all-or-nothing ad Amissah T even in the
 

1357
00:33:15,470 --> 00:33:21,960
all-or-nothing ad Amissah T even in the
face of failures so

1358
00:33:21,960 --> 00:33:21,970
face of failures so
 

1359
00:33:21,970 --> 00:33:24,400
face of failures so
you know I you know what the way this

1360
00:33:24,400 --> 00:33:24,410
you know I you know what the way this
 

1361
00:33:24,410 --> 00:33:25,990
you know I you know what the way this
looks like is that we may have two

1362
00:33:25,990 --> 00:33:26,000
looks like is that we may have two
 

1363
00:33:26,000 --> 00:33:30,010
looks like is that we may have two
servers and we got server one and maybe

1364
00:33:30,010 --> 00:33:30,020
servers and we got server one and maybe
 

1365
00:33:30,020 --> 00:33:33,250
servers and we got server one and maybe
it stores record X in our bank and we

1366
00:33:33,250 --> 00:33:33,260
it stores record X in our bank and we
 

1367
00:33:33,260 --> 00:33:35,290
it stores record X in our bank and we
have server two and maybe it's stores

1368
00:33:35,290 --> 00:33:35,300
have server two and maybe it's stores
 

1369
00:33:35,300 --> 00:33:37,840
have server two and maybe it's stores
record Y so they all start out with

1370
00:33:37,840 --> 00:33:37,850
record Y so they all start out with
 

1371
00:33:37,850 --> 00:33:41,500
record Y so they all start out with
value 10 and we need to run these two

1372
00:33:41,500 --> 00:33:41,510
value 10 and we need to run these two
 

1373
00:33:41,510 --> 00:33:44,140
value 10 and we need to run these two
transactions that transaction 1 of

1374
00:33:44,140 --> 00:33:44,150
transactions that transaction 1 of
 

1375
00:33:44,150 --> 00:33:48,100
transactions that transaction 1 of
course modifies both x and y so now we

1376
00:33:48,100 --> 00:33:48,110
course modifies both x and y so now we
 

1377
00:33:48,110 --> 00:33:49,840
course modifies both x and y so now we
need to send messages the database is

1378
00:33:49,840 --> 00:33:49,850
need to send messages the database is
 

1379
00:33:49,850 --> 00:33:51,760
need to send messages the database is
saying oh please increment X please

1380
00:33:51,760 --> 00:33:51,770
saying oh please increment X please
 

1381
00:33:51,770 --> 00:33:55,180
saying oh please increment X please
decrement Y but it would be easy if we

1382
00:33:55,180 --> 00:33:55,190
decrement Y but it would be easy if we
 

1383
00:33:55,190 --> 00:33:56,560
decrement Y but it would be easy if we
weren't careful to get into a situation

1384
00:33:56,560 --> 00:33:56,570
weren't careful to get into a situation
 

1385
00:33:56,570 --> 00:33:59,380
weren't careful to get into a situation
where we had told server 1 to increase

1386
00:33:59,380 --> 00:33:59,390
where we had told server 1 to increase
 

1387
00:33:59,390 --> 00:34:01,420
where we had told server 1 to increase
the balance for X but then something

1388
00:34:01,420 --> 00:34:01,430
the balance for X but then something
 

1389
00:34:01,430 --> 00:34:03,520
the balance for X but then something
failed maybe the client sending the

1390
00:34:03,520 --> 00:34:03,530
failed maybe the client sending the
 

1391
00:34:03,530 --> 00:34:05,770
failed maybe the client sending the
requests or maybe server the server -

1392
00:34:05,770 --> 00:34:05,780
requests or maybe server the server -
 

1393
00:34:05,780 --> 00:34:07,720
requests or maybe server the server -
that's holding Y fails or something and

1394
00:34:07,720 --> 00:34:07,730
that's holding Y fails or something and
 

1395
00:34:07,730 --> 00:34:10,680
that's holding Y fails or something and
we never managed to do the second update

1396
00:34:10,680 --> 00:34:10,690
we never managed to do the second update
 

1397
00:34:10,690 --> 00:34:14,260
we never managed to do the second update
right so that's one problem is failure

1398
00:34:14,260 --> 00:34:14,270
right so that's one problem is failure
 

1399
00:34:14,270 --> 00:34:16,840
right so that's one problem is failure
somewhere may sort of cut the

1400
00:34:16,840 --> 00:34:16,850
somewhere may sort of cut the
 

1401
00:34:16,850 --> 00:34:19,389
somewhere may sort of cut the
transaction in half and if we're not

1402
00:34:19,389 --> 00:34:19,399
transaction in half and if we're not
 

1403
00:34:19,399 --> 00:34:20,710
transaction in half and if we're not
careful cause only half of the

1404
00:34:20,710 --> 00:34:20,720
careful cause only half of the
 

1405
00:34:20,720 --> 00:34:34,450
careful cause only half of the
transaction to actually take effect

1406
00:34:34,450 --> 00:34:34,460

 

1407
00:34:34,460 --> 00:34:36,980

this can happen even without crashes if

1408
00:34:36,980 --> 00:34:36,990
this can happen even without crashes if
 

1409
00:34:36,990 --> 00:34:39,139
this can happen even without crashes if
X does its part in the transaction it

1410
00:34:39,139 --> 00:34:39,149
X does its part in the transaction it
 

1411
00:34:39,149 --> 00:34:40,430
X does its part in the transaction it
could be that over on server-to-server

1412
00:34:40,430 --> 00:34:40,440
could be that over on server-to-server
 

1413
00:34:40,440 --> 00:34:42,909
could be that over on server-to-server
to actually gets the request to

1414
00:34:42,909 --> 00:34:42,919
to actually gets the request to
 

1415
00:34:42,919 --> 00:34:46,309
to actually gets the request to
decrement bank account y but maybe

1416
00:34:46,309 --> 00:34:46,319
decrement bank account y but maybe
 

1417
00:34:46,319 --> 00:34:47,750
decrement bank account y but maybe
server 2 discovers this bank account

1418
00:34:47,750 --> 00:34:47,760
server 2 discovers this bank account
 

1419
00:34:47,760 --> 00:34:50,089
server 2 discovers this bank account
doesn't exist or maybe it does exist and

1420
00:34:50,089 --> 00:34:50,099
doesn't exist or maybe it does exist and
 

1421
00:34:50,099 --> 00:34:52,069
doesn't exist or maybe it does exist and
it's balance is already 0 when it can't

1422
00:34:52,069 --> 00:34:52,079
it's balance is already 0 when it can't
 

1423
00:34:52,079 --> 00:34:53,960
it's balance is already 0 when it can't
be decrease and so it can't do its part

1424
00:34:53,960 --> 00:34:53,970
be decrease and so it can't do its part
 

1425
00:34:53,970 --> 00:34:56,029
be decrease and so it can't do its part
of the transaction but X look has

1426
00:34:56,029 --> 00:34:56,039
of the transaction but X look has
 

1427
00:34:56,039 --> 00:34:58,210
of the transaction but X look has
already done its part of the transaction

1428
00:34:58,210 --> 00:34:58,220
already done its part of the transaction
 

1429
00:34:58,220 --> 00:35:00,319
already done its part of the transaction
so that's a problem that needs to be

1430
00:35:00,319 --> 00:35:00,329
so that's a problem that needs to be
 

1431
00:35:00,329 --> 00:35:09,440
so that's a problem that needs to be
dealt with so the the property we want

1432
00:35:09,440 --> 00:35:09,450
dealt with so the the property we want
 

1433
00:35:09,450 --> 00:35:11,839
dealt with so the the property we want
as I mentioned before is that all the

1434
00:35:11,839 --> 00:35:11,849
as I mentioned before is that all the
 

1435
00:35:11,849 --> 00:35:13,640
as I mentioned before is that all the
pieces of the system either all the

1436
00:35:13,640 --> 00:35:13,650
pieces of the system either all the
 

1437
00:35:13,650 --> 00:35:15,049
pieces of the system either all the
pieces of the system should do their

1438
00:35:15,049 --> 00:35:15,059
pieces of the system should do their
 

1439
00:35:15,059 --> 00:35:18,079
pieces of the system should do their
part of the transaction or none right so

1440
00:35:18,079 --> 00:35:18,089
part of the transaction or none right so
 

1441
00:35:18,089 --> 00:35:20,839
part of the transaction or none right so
you know the kind of the thing we

1442
00:35:20,839 --> 00:35:20,849
you know the kind of the thing we
 

1443
00:35:20,849 --> 00:35:25,430
you know the kind of the thing we
violated here is what atomicity against

1444
00:35:25,430 --> 00:35:25,440
violated here is what atomicity against
 

1445
00:35:25,440 --> 00:35:33,019
violated here is what atomicity against
crashes versus failure where atomicity

1446
00:35:33,019 --> 00:35:33,029
crashes versus failure where atomicity
 

1447
00:35:33,029 --> 00:35:40,640
crashes versus failure where atomicity
is all or not all parts all parts of the

1448
00:35:40,640 --> 00:35:40,650
is all or not all parts all parts of the
 

1449
00:35:40,650 --> 00:35:42,200
is all or not all parts all parts of the
transaction that we're trying to execute

1450
00:35:42,200 --> 00:35:42,210
transaction that we're trying to execute
 

1451
00:35:42,210 --> 00:35:50,059
transaction that we're trying to execute
or none of them and for you more the

1452
00:35:50,059 --> 00:35:50,069
or none of them and for you more the
 

1453
00:35:50,069 --> 00:35:51,079
or none of them and for you more the
kind of solution we're going to be

1454
00:35:51,079 --> 00:35:51,089
kind of solution we're going to be
 

1455
00:35:51,089 --> 00:35:54,079
kind of solution we're going to be
looking at is atomic commitments atomic

1456
00:35:54,079 --> 00:35:54,089
looking at is atomic commitments atomic
 

1457
00:35:54,089 --> 00:35:59,289
looking at is atomic commitments atomic
commit protocols and the general kind of

1458
00:35:59,289 --> 00:35:59,299
commit protocols and the general kind of
 

1459
00:35:59,299 --> 00:36:01,759
commit protocols and the general kind of
flavor of atomic commit protocols is

1460
00:36:01,759 --> 00:36:01,769
flavor of atomic commit protocols is
 

1461
00:36:01,769 --> 00:36:02,930
flavor of atomic commit protocols is
that you have a bunch of computers

1462
00:36:02,930 --> 00:36:02,940
that you have a bunch of computers
 

1463
00:36:02,940 --> 00:36:04,549
that you have a bunch of computers
they're all doing different parts of

1464
00:36:04,549 --> 00:36:04,559
they're all doing different parts of
 

1465
00:36:04,559 --> 00:36:08,180
they're all doing different parts of
some larger task and the atomic commit

1466
00:36:08,180 --> 00:36:08,190
some larger task and the atomic commit
 

1467
00:36:08,190 --> 00:36:10,970
some larger task and the atomic commit
protocol is gonna help the computers

1468
00:36:10,970 --> 00:36:10,980
protocol is gonna help the computers
 

1469
00:36:10,980 --> 00:36:12,620
protocol is gonna help the computers
decide that either they're all going to

1470
00:36:12,620 --> 00:36:12,630
decide that either they're all going to
 

1471
00:36:12,630 --> 00:36:13,940
decide that either they're all going to
do they're they're all capable of doing

1472
00:36:13,940 --> 00:36:13,950
do they're they're all capable of doing
 

1473
00:36:13,950 --> 00:36:15,349
do they're they're all capable of doing
their part and they're actually gonna do

1474
00:36:15,349 --> 00:36:15,359
their part and they're actually gonna do
 

1475
00:36:15,359 --> 00:36:17,420
their part and they're actually gonna do
it or something has gone wrong and

1476
00:36:17,420 --> 00:36:17,430
it or something has gone wrong and
 

1477
00:36:17,430 --> 00:36:19,460
it or something has gone wrong and
they're all going to agree that oh

1478
00:36:19,460 --> 00:36:19,470
they're all going to agree that oh
 

1479
00:36:19,470 --> 00:36:21,109
they're all going to agree that oh
they're actually none of them are gonna

1480
00:36:21,109 --> 00:36:21,119
they're actually none of them are gonna
 

1481
00:36:21,119 --> 00:36:23,799
they're actually none of them are gonna
do their part of the whatever the

1482
00:36:23,799 --> 00:36:23,809
do their part of the whatever the
 

1483
00:36:23,809 --> 00:36:26,960
do their part of the whatever the
overall task is and the big challenges

1484
00:36:26,960 --> 00:36:26,970
overall task is and the big challenges
 

1485
00:36:26,970 --> 00:36:28,220
overall task is and the big challenges
are of course how to cope with various

1486
00:36:28,220 --> 00:36:28,230
are of course how to cope with various
 

1487
00:36:28,230 --> 00:36:29,960
are of course how to cope with various
failures machine failures loss of

1488
00:36:29,960 --> 00:36:29,970
failures machine failures loss of
 

1489
00:36:29,970 --> 00:36:32,079
failures machine failures loss of
messages and it'll turn out that

1490
00:36:32,079 --> 00:36:32,089
messages and it'll turn out that
 

1491
00:36:32,089 --> 00:36:35,420
messages and it'll turn out that
performance is also a little bit

1492
00:36:35,420 --> 00:36:35,430
performance is also a little bit
 

1493
00:36:35,430 --> 00:36:38,990
performance is also a little bit
difficult to do a good job with the

1494
00:36:38,990 --> 00:36:39,000
difficult to do a good job with the
 

1495
00:36:39,000 --> 00:36:40,430
difficult to do a good job with the
specific protocol we're gonna look at

1496
00:36:40,430 --> 00:36:40,440
specific protocol we're gonna look at
 

1497
00:36:40,440 --> 00:36:42,140
specific protocol we're gonna look at
and is the protocol explained in a

1498
00:36:42,140 --> 00:36:42,150
and is the protocol explained in a
 

1499
00:36:42,150 --> 00:36:52,910
and is the protocol explained in a
reading for today our two-phase commit

1500
00:36:52,910 --> 00:36:52,920

 

1501
00:36:52,920 --> 00:36:58,099

this is an atomic commitment protocol

1502
00:36:58,099 --> 00:36:58,109

 

1503
00:36:58,109 --> 00:37:00,450

and this is used both by distributed

1504
00:37:00,450 --> 00:37:00,460
and this is used both by distributed
 

1505
00:37:00,460 --> 00:37:02,609
and this is used both by distributed
databases and also by all kinds of other

1506
00:37:02,609 --> 00:37:02,619
databases and also by all kinds of other
 

1507
00:37:02,619 --> 00:37:05,279
databases and also by all kinds of other
distributed systems that might not have

1508
00:37:05,279 --> 00:37:05,289
distributed systems that might not have
 

1509
00:37:05,289 --> 00:37:07,190
distributed systems that might not have
first looked like traditional databases

1510
00:37:07,190 --> 00:37:07,200
first looked like traditional databases
 

1511
00:37:07,200 --> 00:37:10,160
first looked like traditional databases
the general setting is we assume that

1512
00:37:10,160 --> 00:37:10,170
the general setting is we assume that
 

1513
00:37:10,170 --> 00:37:13,319
the general setting is we assume that
that in one way or another the task we

1514
00:37:13,319 --> 00:37:13,329
that in one way or another the task we
 

1515
00:37:13,329 --> 00:37:15,000
that in one way or another the task we
need to perform is split up over

1516
00:37:15,000 --> 00:37:15,010
need to perform is split up over
 

1517
00:37:15,010 --> 00:37:16,650
need to perform is split up over
multiple servers each of which needs to

1518
00:37:16,650 --> 00:37:16,660
multiple servers each of which needs to
 

1519
00:37:16,660 --> 00:37:19,410
multiple servers each of which needs to
do some part a different part each one

1520
00:37:19,410 --> 00:37:19,420
do some part a different part each one
 

1521
00:37:19,420 --> 00:37:22,380
do some part a different part each one
of them so for example because I'm set

1522
00:37:22,380 --> 00:37:22,390
of them so for example because I'm set
 

1523
00:37:22,390 --> 00:37:24,660
of them so for example because I'm set
up I showed here in which the it's

1524
00:37:24,660 --> 00:37:24,670
up I showed here in which the it's
 

1525
00:37:24,670 --> 00:37:26,430
up I showed here in which the it's
really the data that split up and so the

1526
00:37:26,430 --> 00:37:26,440
really the data that split up and so the
 

1527
00:37:26,440 --> 00:37:28,500
really the data that split up and so the
tasks being split up our incrementing X

1528
00:37:28,500 --> 00:37:28,510
tasks being split up our incrementing X
 

1529
00:37:28,510 --> 00:37:34,680
tasks being split up our incrementing X
and decrementing Y D we're going to

1530
00:37:34,680 --> 00:37:34,690
and decrementing Y D we're going to
 

1531
00:37:34,690 --> 00:37:38,309
and decrementing Y D we're going to
assume that there's one computer that's

1532
00:37:38,309 --> 00:37:38,319
assume that there's one computer that's
 

1533
00:37:38,319 --> 00:37:40,200
assume that there's one computer that's
driving the transaction called the

1534
00:37:40,200 --> 00:37:40,210
driving the transaction called the
 

1535
00:37:40,210 --> 00:37:55,859
driving the transaction called the
transaction coordinator there's lots of

1536
00:37:55,859 --> 00:37:55,869
transaction coordinator there's lots of
 

1537
00:37:55,869 --> 00:37:57,450
transaction coordinator there's lots of
ways of arranging how the transaction

1538
00:37:57,450 --> 00:37:57,460
ways of arranging how the transaction
 

1539
00:37:57,460 --> 00:37:59,220
ways of arranging how the transaction
coordinator steps in but we'll just

1540
00:37:59,220 --> 00:37:59,230
coordinator steps in but we'll just
 

1541
00:37:59,230 --> 00:38:00,900
coordinator steps in but we'll just
imagine it as a computer that is

1542
00:38:00,900 --> 00:38:00,910
imagine it as a computer that is
 

1543
00:38:00,910 --> 00:38:03,120
imagine it as a computer that is
actually running the transaction there's

1544
00:38:03,120 --> 00:38:03,130
actually running the transaction there's
 

1545
00:38:03,130 --> 00:38:04,529
actually running the transaction there's
one computer the transaction coordinator

1546
00:38:04,529 --> 00:38:04,539
one computer the transaction coordinator
 

1547
00:38:04,539 --> 00:38:06,930
one computer the transaction coordinator
that's that's executing the sort of code

1548
00:38:06,930 --> 00:38:06,940
that's that's executing the sort of code
 

1549
00:38:06,940 --> 00:38:08,940
that's that's executing the sort of code
for the transaction like the puts and

1550
00:38:08,940 --> 00:38:08,950
for the transaction like the puts and
 

1551
00:38:08,950 --> 00:38:11,279
for the transaction like the puts and
the gets and the adds and it sends

1552
00:38:11,279 --> 00:38:11,289
the gets and the adds and it sends
 

1553
00:38:11,289 --> 00:38:14,579
the gets and the adds and it sends
messages to the computers that hold the

1554
00:38:14,579 --> 00:38:14,589
messages to the computers that hold the
 

1555
00:38:14,589 --> 00:38:16,200
messages to the computers that hold the
different pieces of data that need to

1556
00:38:16,200 --> 00:38:16,210
different pieces of data that need to
 

1557
00:38:16,210 --> 00:38:18,890
different pieces of data that need to
actually execute the different parts so

1558
00:38:18,890 --> 00:38:18,900
actually execute the different parts so
 

1559
00:38:18,900 --> 00:38:21,690
actually execute the different parts so
for our setup we're going to have one

1560
00:38:21,690 --> 00:38:21,700
for our setup we're going to have one
 

1561
00:38:21,700 --> 00:38:23,490
for our setup we're going to have one
computer of the transaction coordinator

1562
00:38:23,490 --> 00:38:23,500
computer of the transaction coordinator
 

1563
00:38:23,500 --> 00:38:28,289
computer of the transaction coordinator
and it's going to be these server one

1564
00:38:28,289 --> 00:38:28,299
and it's going to be these server one
 

1565
00:38:28,299 --> 00:38:33,420
and it's going to be these server one
and server two that hold X&Y transaction

1566
00:38:33,420 --> 00:38:33,430
and server two that hold X&Y transaction
 

1567
00:38:33,430 --> 00:38:34,920
and server two that hold X&Y transaction
coordinator we'll send a message to

1568
00:38:34,920 --> 00:38:34,930
coordinator we'll send a message to
 

1569
00:38:34,930 --> 00:38:36,539
coordinator we'll send a message to
server one saying oh please increment X

1570
00:38:36,539 --> 00:38:36,549
server one saying oh please increment X
 

1571
00:38:36,549 --> 00:38:38,880
server one saying oh please increment X
send a message to server Y saying oh

1572
00:38:38,880 --> 00:38:38,890
send a message to server Y saying oh
 

1573
00:38:38,890 --> 00:38:40,500
send a message to server Y saying oh
please decrement Y and then there'll be

1574
00:38:40,500 --> 00:38:40,510
please decrement Y and then there'll be
 

1575
00:38:40,510 --> 00:38:42,510
please decrement Y and then there'll be
more messages in order to make sure that

1576
00:38:42,510 --> 00:38:42,520
more messages in order to make sure that
 

1577
00:38:42,520 --> 00:38:44,670
more messages in order to make sure that
either they both do it or neither than

1578
00:38:44,670 --> 00:38:44,680
either they both do it or neither than
 

1579
00:38:44,680 --> 00:38:46,559
either they both do it or neither than
do it and that's where two-phase commit

1580
00:38:46,559 --> 00:38:46,569
do it and that's where two-phase commit
 

1581
00:38:46,569 --> 00:38:50,099
do it and that's where two-phase commit
steps in something to keep in the back

1582
00:38:50,099 --> 00:38:50,109
steps in something to keep in the back
 

1583
00:38:50,109 --> 00:38:52,170
steps in something to keep in the back
your mind is that in the full system

1584
00:38:52,170 --> 00:38:52,180
your mind is that in the full system
 

1585
00:38:52,180 --> 00:38:53,970
your mind is that in the full system
there may be many different transactions

1586
00:38:53,970 --> 00:38:53,980
there may be many different transactions
 

1587
00:38:53,980 --> 00:38:55,740
there may be many different transactions
running concurrently and many

1588
00:38:55,740 --> 00:38:55,750
running concurrently and many
 

1589
00:38:55,750 --> 00:38:57,880
running concurrently and many
transaction coordinators

1590
00:38:57,880 --> 00:38:57,890
transaction coordinators
 

1591
00:38:57,890 --> 00:39:00,880
transaction coordinators
sort of executing their own transactions

1592
00:39:00,880 --> 00:39:00,890
sort of executing their own transactions
 

1593
00:39:00,890 --> 00:39:03,309
sort of executing their own transactions
and so the various parties here need to

1594
00:39:03,309 --> 00:39:03,319
and so the various parties here need to
 

1595
00:39:03,319 --> 00:39:04,930
and so the various parties here need to
keep track of oh you know this is a

1596
00:39:04,930 --> 00:39:04,940
keep track of oh you know this is a
 

1597
00:39:04,940 --> 00:39:06,880
keep track of oh you know this is a
message for such-and-such a transaction

1598
00:39:06,880 --> 00:39:06,890
message for such-and-such a transaction
 

1599
00:39:06,890 --> 00:39:09,579
message for such-and-such a transaction
and where they keep state like these

1600
00:39:09,579 --> 00:39:09,589
and where they keep state like these
 

1601
00:39:09,589 --> 00:39:10,839
and where they keep state like these
turns out these servers are going to

1602
00:39:10,839 --> 00:39:10,849
turns out these servers are going to
 

1603
00:39:10,849 --> 00:39:12,700
turns out these servers are going to
maintain table two blocks for example

1604
00:39:12,700 --> 00:39:12,710
maintain table two blocks for example
 

1605
00:39:12,710 --> 00:39:14,650
maintain table two blocks for example
and they keep state like that they need

1606
00:39:14,650 --> 00:39:14,660
and they keep state like that they need
 

1607
00:39:14,660 --> 00:39:15,940
and they keep state like that they need
to keep track of oh this is a lock

1608
00:39:15,940 --> 00:39:15,950
to keep track of oh this is a lock
 

1609
00:39:15,950 --> 00:39:18,670
to keep track of oh this is a lock
that's being held for transactions 17 so

1610
00:39:18,670 --> 00:39:18,680
that's being held for transactions 17 so
 

1611
00:39:18,680 --> 00:39:28,650
that's being held for transactions 17 so
there's a notion of transaction IDs and

1612
00:39:28,650 --> 00:39:28,660
there's a notion of transaction IDs and
 

1613
00:39:28,660 --> 00:39:31,809
there's a notion of transaction IDs and
I'm just gonna assume although you know

1614
00:39:31,809 --> 00:39:31,819
I'm just gonna assume although you know
 

1615
00:39:31,819 --> 00:39:33,609
I'm just gonna assume although you know
I'm not actually show it that every

1616
00:39:33,609 --> 00:39:33,619
I'm not actually show it that every
 

1617
00:39:33,619 --> 00:39:35,620
I'm not actually show it that every
message in the system is tagged with the

1618
00:39:35,620 --> 00:39:35,630
message in the system is tagged with the
 

1619
00:39:35,630 --> 00:39:37,059
message in the system is tagged with the
transaction with the unique transaction

1620
00:39:37,059 --> 00:39:37,069
transaction with the unique transaction
 

1621
00:39:37,069 --> 00:39:39,460
transaction with the unique transaction
ID of the transaction it applies to and

1622
00:39:39,460 --> 00:39:39,470
ID of the transaction it applies to and
 

1623
00:39:39,470 --> 00:39:41,349
ID of the transaction it applies to and
these IDs are chosen by the transaction

1624
00:39:41,349 --> 00:39:41,359
these IDs are chosen by the transaction
 

1625
00:39:41,359 --> 00:39:43,089
these IDs are chosen by the transaction
coordinator when the transaction starts

1626
00:39:43,089 --> 00:39:43,099
coordinator when the transaction starts
 

1627
00:39:43,099 --> 00:39:44,980
coordinator when the transaction starts
the transaction coordinator will send

1628
00:39:44,980 --> 00:39:44,990
the transaction coordinator will send
 

1629
00:39:44,990 --> 00:39:47,410
the transaction coordinator will send
out oh this is a message for transaction

1630
00:39:47,410 --> 00:39:47,420
out oh this is a message for transaction
 

1631
00:39:47,420 --> 00:39:51,400
out oh this is a message for transaction
1995 and it'll keep all its state here

1632
00:39:51,400 --> 00:39:51,410
1995 and it'll keep all its state here
 

1633
00:39:51,410 --> 00:39:52,569
1995 and it'll keep all its state here
about the transaction will be tagged

1634
00:39:52,569 --> 00:39:52,579
about the transaction will be tagged
 

1635
00:39:52,579 --> 00:39:57,040
about the transaction will be tagged
with 95 and the various tables in the

1636
00:39:57,040 --> 00:39:57,050
with 95 and the various tables in the
 

1637
00:39:57,050 --> 00:39:59,200
with 95 and the various tables in the
different participants in the

1638
00:39:59,200 --> 00:39:59,210
different participants in the
 

1639
00:39:59,210 --> 00:40:01,599
different participants in the
transaction will be tagged with the

1640
00:40:01,599 --> 00:40:01,609
transaction will be tagged with the
 

1641
00:40:01,609 --> 00:40:04,030
transaction will be tagged with the
transaction IDs and so that's another

1642
00:40:04,030 --> 00:40:04,040
transaction IDs and so that's another
 

1643
00:40:04,040 --> 00:40:05,950
transaction IDs and so that's another
piece of terminology we got the

1644
00:40:05,950 --> 00:40:05,960
piece of terminology we got the
 

1645
00:40:05,960 --> 00:40:07,900
piece of terminology we got the
transaction coordinator and then the

1646
00:40:07,900 --> 00:40:07,910
transaction coordinator and then the
 

1647
00:40:07,910 --> 00:40:11,559
transaction coordinator and then the
other servers that are doing parts of

1648
00:40:11,559 --> 00:40:11,569
other servers that are doing parts of
 

1649
00:40:11,569 --> 00:40:20,010
other servers that are doing parts of
the transaction are called participants

1650
00:40:20,010 --> 00:40:20,020

 

1651
00:40:20,020 --> 00:40:21,370

all right

1652
00:40:21,370 --> 00:40:21,380
all right
 

1653
00:40:21,380 --> 00:40:24,579
all right
so let me draw out the two-phase commit

1654
00:40:24,579 --> 00:40:24,589
so let me draw out the two-phase commit
 

1655
00:40:24,589 --> 00:40:28,680
so let me draw out the two-phase commit
protocol example execution so this is

1656
00:40:28,680 --> 00:40:28,690
protocol example execution so this is
 

1657
00:40:28,690 --> 00:40:32,380
protocol example execution so this is
abbreviate this to PC for two-phase

1658
00:40:32,380 --> 00:40:32,390
abbreviate this to PC for two-phase
 

1659
00:40:32,390 --> 00:40:37,589
abbreviate this to PC for two-phase
commit the parties involved are the

1660
00:40:37,589 --> 00:40:37,599
commit the parties involved are the
 

1661
00:40:37,599 --> 00:40:40,120
commit the parties involved are the
transaction coordinator and we'll just

1662
00:40:40,120 --> 00:40:40,130
transaction coordinator and we'll just
 

1663
00:40:40,130 --> 00:40:42,220
transaction coordinator and we'll just
say there's two participants that is you

1664
00:40:42,220 --> 00:40:42,230
say there's two participants that is you
 

1665
00:40:42,230 --> 00:40:43,150
say there's two participants that is you
know maybe we're executing the

1666
00:40:43,150 --> 00:40:43,160
know maybe we're executing the
 

1667
00:40:43,160 --> 00:40:44,500
know maybe we're executing the
transactions I've shown next and why

1668
00:40:44,500 --> 00:40:44,510
transactions I've shown next and why
 

1669
00:40:44,510 --> 00:40:48,240
transactions I've shown next and why
aren't different servers maybe we've got

1670
00:40:48,240 --> 00:40:48,250
aren't different servers maybe we've got
 

1671
00:40:48,250 --> 00:40:53,530
aren't different servers maybe we've got
participant a and participant B these

1672
00:40:53,530 --> 00:40:53,540
participant a and participant B these
 

1673
00:40:53,540 --> 00:40:57,000
participant a and participant B these
are two different servers holding data

1674
00:40:57,000 --> 00:40:57,010
are two different servers holding data
 

1675
00:40:57,010 --> 00:40:59,530
are two different servers holding data
so the transaction coordinator it's

1676
00:40:59,530 --> 00:40:59,540
so the transaction coordinator it's
 

1677
00:40:59,540 --> 00:41:01,089
so the transaction coordinator it's
running the whole transaction it's it's

1678
00:41:01,089 --> 00:41:01,099
running the whole transaction it's it's
 

1679
00:41:01,099 --> 00:41:03,910
running the whole transaction it's it's
gonna send puts and gets to a and B to

1680
00:41:03,910 --> 00:41:03,920
gonna send puts and gets to a and B to
 

1681
00:41:03,920 --> 00:41:06,160
gonna send puts and gets to a and B to
tell them to you know read the value of

1682
00:41:06,160 --> 00:41:06,170
tell them to you know read the value of
 

1683
00:41:06,170 --> 00:41:09,069
tell them to you know read the value of
x or y or add one to X so we're going to

1684
00:41:09,069 --> 00:41:09,079
x or y or add one to X so we're going to
 

1685
00:41:09,079 --> 00:41:11,099
x or y or add one to X so we're going to
see at the beginning of the tree

1686
00:41:11,099 --> 00:41:11,109
see at the beginning of the tree
 

1687
00:41:11,109 --> 00:41:12,839
see at the beginning of the tree
action that the transaction coordinator

1688
00:41:12,839 --> 00:41:12,849
action that the transaction coordinator
 

1689
00:41:12,849 --> 00:41:15,299
action that the transaction coordinator
is sending for example maybe a get

1690
00:41:15,299 --> 00:41:15,309
is sending for example maybe a get
 

1691
00:41:15,309 --> 00:41:19,229
is sending for example maybe a get
requests to Trent participant a and it

1692
00:41:19,229 --> 00:41:19,239
requests to Trent participant a and it
 

1693
00:41:19,239 --> 00:41:21,150
requests to Trent participant a and it
gets a reply and then maybe it sends

1694
00:41:21,150 --> 00:41:21,160
gets a reply and then maybe it sends
 

1695
00:41:21,160 --> 00:41:27,960
gets a reply and then maybe it sends
that put for whatever I might see a long

1696
00:41:27,960 --> 00:41:27,970
that put for whatever I might see a long
 

1697
00:41:27,970 --> 00:41:29,160
that put for whatever I might see a long
sequence of these if there's a

1698
00:41:29,160 --> 00:41:29,170
sequence of these if there's a
 

1699
00:41:29,170 --> 00:41:33,749
sequence of these if there's a
complicated transaction then when

1700
00:41:33,749 --> 00:41:33,759
complicated transaction then when
 

1701
00:41:33,759 --> 00:41:35,400
complicated transaction then when
transaction coordinator gets to the end

1702
00:41:35,400 --> 00:41:35,410
transaction coordinator gets to the end
 

1703
00:41:35,410 --> 00:41:38,249
transaction coordinator gets to the end
of the transaction and wants to commit

1704
00:41:38,249 --> 00:41:38,259
of the transaction and wants to commit
 

1705
00:41:38,259 --> 00:41:40,769
of the transaction and wants to commit
it and be able to you know release all

1706
00:41:40,769 --> 00:41:40,779
it and be able to you know release all
 

1707
00:41:40,779 --> 00:41:42,120
it and be able to you know release all
those locks and make the transactions

1708
00:41:42,120 --> 00:41:42,130
those locks and make the transactions
 

1709
00:41:42,130 --> 00:41:44,130
those locks and make the transactions
results visible to the outside world and

1710
00:41:44,130 --> 00:41:44,140
results visible to the outside world and
 

1711
00:41:44,140 --> 00:41:47,279
results visible to the outside world and
maybe reply to a client or a human user

1712
00:41:47,279 --> 00:41:47,289
maybe reply to a client or a human user
 

1713
00:41:47,289 --> 00:41:49,559
maybe reply to a client or a human user
so they were assuming there's a sort of

1714
00:41:49,559 --> 00:41:49,569
so they were assuming there's a sort of
 

1715
00:41:49,569 --> 00:41:52,470
so they were assuming there's a sort of
external client or human that said oh

1716
00:41:52,470 --> 00:41:52,480
external client or human that said oh
 

1717
00:41:52,480 --> 00:41:54,150
external client or human that said oh
please run this transaction and it's

1718
00:41:54,150 --> 00:41:54,160
please run this transaction and it's
 

1719
00:41:54,160 --> 00:41:56,880
please run this transaction and it's
waiting for a response before we can do

1720
00:41:56,880 --> 00:41:56,890
waiting for a response before we can do
 

1721
00:41:56,890 --> 00:41:59,009
waiting for a response before we can do
any of that the transaction coordinate

1722
00:41:59,009 --> 00:41:59,019
any of that the transaction coordinate
 

1723
00:41:59,019 --> 00:42:02,069
any of that the transaction coordinate
coordinator has to make sure that all

1724
00:42:02,069 --> 00:42:02,079
coordinator has to make sure that all
 

1725
00:42:02,079 --> 00:42:04,109
coordinator has to make sure that all
the different participants can actually

1726
00:42:04,109 --> 00:42:04,119
the different participants can actually
 

1727
00:42:04,119 --> 00:42:07,319
the different participants can actually
do their part of the transaction and in

1728
00:42:07,319 --> 00:42:07,329
do their part of the transaction and in
 

1729
00:42:07,329 --> 00:42:08,940
do their part of the transaction and in
particular if there were any puts in the

1730
00:42:08,940 --> 00:42:08,950
particular if there were any puts in the
 

1731
00:42:08,950 --> 00:42:11,430
particular if there were any puts in the
transaction we need to make sure that

1732
00:42:11,430 --> 00:42:11,440
transaction we need to make sure that
 

1733
00:42:11,440 --> 00:42:14,220
transaction we need to make sure that
the participants who are doing those

1734
00:42:14,220 --> 00:42:14,230
the participants who are doing those
 

1735
00:42:14,230 --> 00:42:16,049
the participants who are doing those
puts well are actually still capable of

1736
00:42:16,049 --> 00:42:16,059
puts well are actually still capable of
 

1737
00:42:16,059 --> 00:42:19,499
puts well are actually still capable of
doing the puts so in order to find that

1738
00:42:19,499 --> 00:42:19,509
doing the puts so in order to find that
 

1739
00:42:19,509 --> 00:42:22,519
doing the puts so in order to find that
out the transaction coordinator sends

1740
00:42:22,519 --> 00:42:22,529
out the transaction coordinator sends
 

1741
00:42:22,529 --> 00:42:31,999
out the transaction coordinator sends
prepare messages to all of the

1742
00:42:31,999 --> 00:42:32,009
prepare messages to all of the
 

1743
00:42:32,009 --> 00:42:35,819
prepare messages to all of the
participants so we're going to send pair

1744
00:42:35,819 --> 00:42:35,829
participants so we're going to send pair
 

1745
00:42:35,829 --> 00:42:41,609
participants so we're going to send pair
messages to both a and B

1746
00:42:41,609 --> 00:42:41,619

 

1747
00:42:41,619 --> 00:42:44,589

and when a or B would receive a preparer

1748
00:42:44,589 --> 00:42:44,599
and when a or B would receive a preparer
 

1749
00:42:44,599 --> 00:42:45,640
and when a or B would receive a preparer
message you know they know the

1750
00:42:45,640 --> 00:42:45,650
message you know they know the
 

1751
00:42:45,650 --> 00:42:47,319
message you know they know the
transaction is nearing completion but

1752
00:42:47,319 --> 00:42:47,329
transaction is nearing completion but
 

1753
00:42:47,329 --> 00:42:49,079
transaction is nearing completion but
not not over yet

1754
00:42:49,079 --> 00:42:49,089
not not over yet
 

1755
00:42:49,089 --> 00:42:51,430
not not over yet
they look at their state and decide

1756
00:42:51,430 --> 00:42:51,440
they look at their state and decide
 

1757
00:42:51,440 --> 00:42:52,839
they look at their state and decide
whether they are actually able to

1758
00:42:52,839 --> 00:42:52,849
whether they are actually able to
 

1759
00:42:52,849 --> 00:42:54,190
whether they are actually able to
complete the transaction you know maybe

1760
00:42:54,190 --> 00:42:54,200
complete the transaction you know maybe
 

1761
00:42:54,200 --> 00:42:56,109
complete the transaction you know maybe
they needed to abort it break a deadlock

1762
00:42:56,109 --> 00:42:56,119
they needed to abort it break a deadlock
 

1763
00:42:56,119 --> 00:42:58,329
they needed to abort it break a deadlock
or maybe they've crashed and we started

1764
00:42:58,329 --> 00:42:58,339
or maybe they've crashed and we started
 

1765
00:42:58,339 --> 00:43:02,289
or maybe they've crashed and we started
but between you know when they did the

1766
00:43:02,289 --> 00:43:02,299
but between you know when they did the
 

1767
00:43:02,299 --> 00:43:04,059
but between you know when they did the
last operation are now and they've

1768
00:43:04,059 --> 00:43:04,069
last operation are now and they've
 

1769
00:43:04,069 --> 00:43:05,019
last operation are now and they've
completely forgotten about the

1770
00:43:05,019 --> 00:43:05,029
completely forgotten about the
 

1771
00:43:05,029 --> 00:43:07,029
completely forgotten about the
transaction and can't complete it so a

1772
00:43:07,029 --> 00:43:07,039
transaction and can't complete it so a
 

1773
00:43:07,039 --> 00:43:08,680
transaction and can't complete it so a
and B you know look at their state and

1774
00:43:08,680 --> 00:43:08,690
and B you know look at their state and
 

1775
00:43:08,690 --> 00:43:10,450
and B you know look at their state and
say oh I'm going to be able to or I'm

1776
00:43:10,450 --> 00:43:10,460
say oh I'm going to be able to or I'm
 

1777
00:43:10,460 --> 00:43:11,799
say oh I'm going to be able to or I'm
not gonna be able to do this transaction

1778
00:43:11,799 --> 00:43:11,809
not gonna be able to do this transaction
 

1779
00:43:11,809 --> 00:43:24,720
not gonna be able to do this transaction
and they respond with either yes or no

1780
00:43:24,720 --> 00:43:24,730

 

1781
00:43:24,730 --> 00:43:28,720

so the transaction coordinator is

1782
00:43:28,720 --> 00:43:28,730
so the transaction coordinator is
 

1783
00:43:28,730 --> 00:43:31,870
so the transaction coordinator is
waiting for these yes or no votes from

1784
00:43:31,870 --> 00:43:31,880
waiting for these yes or no votes from
 

1785
00:43:31,880 --> 00:43:35,319
waiting for these yes or no votes from
each of the participants if they all say

1786
00:43:35,319 --> 00:43:35,329
each of the participants if they all say
 

1787
00:43:35,329 --> 00:43:42,579
each of the participants if they all say
yes then the transaction can commit

1788
00:43:42,579 --> 00:43:42,589
yes then the transaction can commit
 

1789
00:43:42,589 --> 00:43:45,880
yes then the transaction can commit
nothing goes wrong the transaction can

1790
00:43:45,880 --> 00:43:45,890
nothing goes wrong the transaction can
 

1791
00:43:45,890 --> 00:43:47,829
nothing goes wrong the transaction can
commit and the transaction coordinator

1792
00:43:47,829 --> 00:43:47,839
commit and the transaction coordinator
 

1793
00:43:47,839 --> 00:43:57,279
commit and the transaction coordinator
sends out a commit message to each of

1794
00:43:57,279 --> 00:43:57,289
sends out a commit message to each of
 

1795
00:43:57,289 --> 00:44:02,829
sends out a commit message to each of
the participants and then the

1796
00:44:02,829 --> 00:44:02,839
the participants and then the
 

1797
00:44:02,839 --> 00:44:05,230
the participants and then the
participants usually reply with an

1798
00:44:05,230 --> 00:44:05,240
participants usually reply with an
 

1799
00:44:05,240 --> 00:44:07,870
participants usually reply with an
acknowledgement saying yes we now know

1800
00:44:07,870 --> 00:44:07,880
acknowledgement saying yes we now know
 

1801
00:44:07,880 --> 00:44:10,980
acknowledgement saying yes we now know
the outcome this is called the echnology

1802
00:44:10,980 --> 00:44:10,990
the outcome this is called the echnology
 

1803
00:44:10,990 --> 00:44:14,620
the outcome this is called the echnology
all right so they all transaction

1804
00:44:14,620 --> 00:44:14,630
all right so they all transaction
 

1805
00:44:14,630 --> 00:44:16,990
all right so they all transaction
coordinator since I preparers if all the

1806
00:44:16,990 --> 00:44:17,000
coordinator since I preparers if all the
 

1807
00:44:17,000 --> 00:44:19,150
coordinator since I preparers if all the
participants say yes it can commit if

1808
00:44:19,150 --> 00:44:19,160
participants say yes it can commit if
 

1809
00:44:19,160 --> 00:44:21,749
participants say yes it can commit if
anyone in any of them even a single one

1810
00:44:21,749 --> 00:44:21,759
anyone in any of them even a single one
 

1811
00:44:21,759 --> 00:44:24,279
anyone in any of them even a single one
says no actually I cannot complete this

1812
00:44:24,279 --> 00:44:24,289
says no actually I cannot complete this
 

1813
00:44:24,289 --> 00:44:27,120
says no actually I cannot complete this
transaction because I had a failure or

1814
00:44:27,120 --> 00:44:27,130
transaction because I had a failure or
 

1815
00:44:27,130 --> 00:44:29,319
transaction because I had a failure or
there was an inconsistency like a

1816
00:44:29,319 --> 00:44:29,329
there was an inconsistency like a
 

1817
00:44:29,329 --> 00:44:32,049
there was an inconsistency like a
missing record and I have to abort even

1818
00:44:32,049 --> 00:44:32,059
missing record and I have to abort even
 

1819
00:44:32,059 --> 00:44:34,089
missing record and I have to abort even
a single participant says no at this

1820
00:44:34,089 --> 00:44:34,099
a single participant says no at this
 

1821
00:44:34,099 --> 00:44:36,190
a single participant says no at this
point then the transaction coordinator

1822
00:44:36,190 --> 00:44:36,200
point then the transaction coordinator
 

1823
00:44:36,200 --> 00:44:38,380
point then the transaction coordinator
won't commit it'll send out a round of

1824
00:44:38,380 --> 00:44:38,390
won't commit it'll send out a round of
 

1825
00:44:38,390 --> 00:44:41,170
won't commit it'll send out a round of
abort messages saying oops please

1826
00:44:41,170 --> 00:44:41,180
abort messages saying oops please
 

1827
00:44:41,180 --> 00:44:47,370
abort messages saying oops please
retract this transaction either way the

1828
00:44:47,370 --> 00:44:47,380
retract this transaction either way the
 

1829
00:44:47,380 --> 00:44:51,400
retract this transaction either way the
after the commit sort of to two things

1830
00:44:51,400 --> 00:44:51,410
after the commit sort of to two things
 

1831
00:44:51,410 --> 00:44:52,690
after the commit sort of to two things
happen of interest to us

1832
00:44:52,690 --> 00:44:52,700
happen of interest to us
 

1833
00:44:52,700 --> 00:44:54,430
happen of interest to us
one is the transaction coordinator will

1834
00:44:54,430 --> 00:44:54,440
one is the transaction coordinator will
 

1835
00:44:54,440 --> 00:44:57,339
one is the transaction coordinator will
mint whatever the transactions output is

1836
00:44:57,339 --> 00:44:57,349
mint whatever the transactions output is
 

1837
00:44:57,349 --> 00:44:59,410
mint whatever the transactions output is
to the client or human that requested it

1838
00:44:59,410 --> 00:44:59,420
to the client or human that requested it
 

1839
00:44:59,420 --> 00:45:00,970
to the client or human that requested it
and say look oh yes the transactions

1840
00:45:00,970 --> 00:45:00,980
and say look oh yes the transactions
 

1841
00:45:00,980 --> 00:45:03,240
and say look oh yes the transactions
finish and so now if it didn't abort a

1842
00:45:03,240 --> 00:45:03,250
finish and so now if it didn't abort a
 

1843
00:45:03,250 --> 00:45:04,960
finish and so now if it didn't abort a
committed it's durable

1844
00:45:04,960 --> 00:45:04,970
committed it's durable
 

1845
00:45:04,970 --> 00:45:07,630
committed it's durable
the other interesting thing is that in

1846
00:45:07,630 --> 00:45:07,640
the other interesting thing is that in
 

1847
00:45:07,640 --> 00:45:12,880
the other interesting thing is that in
order to obey these locking rules the

1848
00:45:12,880 --> 00:45:12,890
order to obey these locking rules the
 

1849
00:45:12,890 --> 00:45:15,790
order to obey these locking rules the
participants unlock when they see either

1850
00:45:15,790 --> 00:45:15,800
participants unlock when they see either
 

1851
00:45:15,800 --> 00:45:23,230
participants unlock when they see either
commit or an abort and indeed in order

1852
00:45:23,230 --> 00:45:23,240
commit or an abort and indeed in order
 

1853
00:45:23,240 --> 00:45:27,160
commit or an abort and indeed in order
to obey the two phase locking rule each

1854
00:45:27,160 --> 00:45:27,170
to obey the two phase locking rule each
 

1855
00:45:27,170 --> 00:45:32,410
to obey the two phase locking rule each
participant locked any data that it read

1856
00:45:32,410 --> 00:45:32,420
participant locked any data that it read
 

1857
00:45:32,420 --> 00:45:33,880
participant locked any data that it read
as part of doing its part of the

1858
00:45:33,880 --> 00:45:33,890
as part of doing its part of the
 

1859
00:45:33,890 --> 00:45:35,980
as part of doing its part of the
transaction so we're imagining that in

1860
00:45:35,980 --> 00:45:35,990
transaction so we're imagining that in
 

1861
00:45:35,990 --> 00:45:37,930
transaction so we're imagining that in
each participant there's a table of the

1862
00:45:37,930 --> 00:45:37,940
each participant there's a table of the
 

1863
00:45:37,940 --> 00:45:40,359
each participant there's a table of the
locks associated with the data stored at

1864
00:45:40,359 --> 00:45:40,369
locks associated with the data stored at
 

1865
00:45:40,369 --> 00:45:43,000
locks associated with the data stored at
that participant and the participant

1866
00:45:43,000 --> 00:45:43,010
that participant and the participant
 

1867
00:45:43,010 --> 00:45:44,890
that participant and the participant
sort of lock things in those tables

1868
00:45:44,890 --> 00:45:44,900
sort of lock things in those tables
 

1869
00:45:44,900 --> 00:45:47,589
sort of lock things in those tables
remember oh this is you know this piece

1870
00:45:47,589 --> 00:45:47,599
remember oh this is you know this piece
 

1871
00:45:47,599 --> 00:45:49,030
remember oh this is you know this piece
of data this record is locked for

1872
00:45:49,030 --> 00:45:49,040
of data this record is locked for
 

1873
00:45:49,040 --> 00:45:51,220
of data this record is locked for
transaction twenty nine and one finally

1874
00:45:51,220 --> 00:45:51,230
transaction twenty nine and one finally
 

1875
00:45:51,230 --> 00:45:52,809
transaction twenty nine and one finally
the commit or abort comes back versions

1876
00:45:52,809 --> 00:45:52,819
the commit or abort comes back versions
 

1877
00:45:52,819 --> 00:45:55,480
the commit or abort comes back versions
action twenty-nine the participant

1878
00:45:55,480 --> 00:45:55,490
action twenty-nine the participant
 

1879
00:45:55,490 --> 00:45:57,160
action twenty-nine the participant
unlocks that data and then other

1880
00:45:57,160 --> 00:45:57,170
unlocks that data and then other
 

1881
00:45:57,170 --> 00:45:59,530
unlocks that data and then other
transactions can use so we may have to

1882
00:45:59,530 --> 00:45:59,540
transactions can use so we may have to
 

1883
00:45:59,540 --> 00:46:02,740
transactions can use so we may have to
wait here and this unlock may unblock

1884
00:46:02,740 --> 00:46:02,750
wait here and this unlock may unblock
 

1885
00:46:02,750 --> 00:46:06,130
wait here and this unlock may unblock
other transactions that's really part of

1886
00:46:06,130 --> 00:46:06,140
other transactions that's really part of
 

1887
00:46:06,140 --> 00:46:13,630
other transactions that's really part of
the serializability machinery so you

1888
00:46:13,630 --> 00:46:13,640
the serializability machinery so you
 

1889
00:46:13,640 --> 00:46:14,829
the serializability machinery so you
know so far the reason why this is

1890
00:46:14,829 --> 00:46:14,839
know so far the reason why this is
 

1891
00:46:14,839 --> 00:46:19,300
know so far the reason why this is
correct basically is that the if

1892
00:46:19,300 --> 00:46:19,310
correct basically is that the if
 

1893
00:46:19,310 --> 00:46:20,620
correct basically is that the if
everybody's following this protocol

1894
00:46:20,620 --> 00:46:20,630
everybody's following this protocol
 

1895
00:46:20,630 --> 00:46:23,470
everybody's following this protocol
there's no failures then the two

1896
00:46:23,470 --> 00:46:23,480
there's no failures then the two
 

1897
00:46:23,480 --> 00:46:25,270
there's no failures then the two
participants only commit if both of them

1898
00:46:25,270 --> 00:46:25,280
participants only commit if both of them
 

1899
00:46:25,280 --> 00:46:29,050
participants only commit if both of them
commit and if I them can't commit if

1900
00:46:29,050 --> 00:46:29,060
commit and if I them can't commit if
 

1901
00:46:29,060 --> 00:46:30,849
commit and if I them can't commit if
I've them has to abort then they both

1902
00:46:30,849 --> 00:46:30,859
I've them has to abort then they both
 

1903
00:46:30,859 --> 00:46:33,220
I've them has to abort then they both
abort so we get that either they all do

1904
00:46:33,220 --> 00:46:33,230
abort so we get that either they all do
 

1905
00:46:33,230 --> 00:46:36,370
abort so we get that either they all do
it or none of them do it result that we

1906
00:46:36,370 --> 00:46:36,380
it or none of them do it result that we
 

1907
00:46:36,380 --> 00:46:40,780
it or none of them do it result that we
wanted the atomicity result with this

1908
00:46:40,780 --> 00:46:40,790
wanted the atomicity result with this
 

1909
00:46:40,790 --> 00:46:43,329
wanted the atomicity result with this
protocol so far without without thinking

1910
00:46:43,329 --> 00:46:43,339
protocol so far without without thinking
 

1911
00:46:43,339 --> 00:46:47,260
protocol so far without without thinking
about failures and so now our job is to

1912
00:46:47,260 --> 00:46:47,270
about failures and so now our job is to
 

1913
00:46:47,270 --> 00:46:49,420
about failures and so now our job is to
think through in our head all sort of

1914
00:46:49,420 --> 00:46:49,430
think through in our head all sort of
 

1915
00:46:49,430 --> 00:46:50,500
think through in our head all sort of
the different kinds of failures that

1916
00:46:50,500 --> 00:46:50,510
the different kinds of failures that
 

1917
00:46:50,510 --> 00:46:53,890
the different kinds of failures that
might occur and figure out whether the

1918
00:46:53,890 --> 00:46:53,900
might occur and figure out whether the
 

1919
00:46:53,900 --> 00:46:56,800
might occur and figure out whether the
protocol still provides atomicity either

1920
00:46:56,800 --> 00:46:56,810
protocol still provides atomicity either
 

1921
00:46:56,810 --> 00:46:59,710
protocol still provides atomicity either
both do it or neither do it in the face

1922
00:46:59,710 --> 00:46:59,720
both do it or neither do it in the face
 

1923
00:46:59,720 --> 00:47:01,480
both do it or neither do it in the face
of these failures and how we have to

1924
00:47:01,480 --> 00:47:01,490
of these failures and how we have to
 

1925
00:47:01,490 --> 00:47:05,290
of these failures and how we have to
adjust or extend the protocol in order

1926
00:47:05,290 --> 00:47:05,300
adjust or extend the protocol in order
 

1927
00:47:05,300 --> 00:47:07,569
adjust or extend the protocol in order
to cause it to do the right thing so the

1928
00:47:07,569 --> 00:47:07,579
to cause it to do the right thing so the
 

1929
00:47:07,579 --> 00:47:08,229
to cause it to do the right thing so the
first thing I want

1930
00:47:08,229 --> 00:47:08,239
first thing I want
 

1931
00:47:08,239 --> 00:47:11,049
first thing I want
consider is what it be crashes and

1932
00:47:11,049 --> 00:47:11,059
consider is what it be crashes and
 

1933
00:47:11,059 --> 00:47:11,949
consider is what it be crashes and
restarts

1934
00:47:11,949 --> 00:47:11,959
restarts
 

1935
00:47:11,959 --> 00:47:15,729
restarts
I mean power failure or something be

1936
00:47:15,729 --> 00:47:15,739
I mean power failure or something be
 

1937
00:47:15,739 --> 00:47:17,649
I mean power failure or something be
just some suddenly stops executing and

1938
00:47:17,649 --> 00:47:17,659
just some suddenly stops executing and
 

1939
00:47:17,659 --> 00:47:20,259
just some suddenly stops executing and
then powers restored and it's brought

1940
00:47:20,259 --> 00:47:20,269
then powers restored and it's brought
 

1941
00:47:20,269 --> 00:47:22,299
then powers restored and it's brought
back to life and run some maybe some

1942
00:47:22,299 --> 00:47:22,309
back to life and run some maybe some
 

1943
00:47:22,309 --> 00:47:26,349
back to life and run some maybe some
sort of recovery software as part of the

1944
00:47:26,349 --> 00:47:26,359
sort of recovery software as part of the
 

1945
00:47:26,359 --> 00:47:28,719
sort of recovery software as part of the
transaction processing system well

1946
00:47:28,719 --> 00:47:28,729
transaction processing system well
 

1947
00:47:28,729 --> 00:47:32,049
transaction processing system well
there's really two scenarios we have to

1948
00:47:32,049 --> 00:47:32,059
there's really two scenarios we have to
 

1949
00:47:32,059 --> 00:47:35,079
there's really two scenarios we have to
worry about one is B might have crashed

1950
00:47:35,079 --> 00:47:35,089
worry about one is B might have crashed
 

1951
00:47:35,089 --> 00:47:41,879
worry about one is B might have crashed
before ascending it's yes message back

1952
00:47:41,879 --> 00:47:41,889

 

1953
00:47:41,889 --> 00:47:44,709

so B crash before sending its yes

1954
00:47:44,709 --> 00:47:44,719
so B crash before sending its yes
 

1955
00:47:44,719 --> 00:47:48,549
so B crash before sending its yes
message back then it never said yes so

1956
00:47:48,549 --> 00:47:48,559
message back then it never said yes so
 

1957
00:47:48,559 --> 00:47:50,019
message back then it never said yes so
the transaction coordinator couldn't

1958
00:47:50,019 --> 00:47:50,029
the transaction coordinator couldn't
 

1959
00:47:50,029 --> 00:47:53,469
the transaction coordinator couldn't
possibly have committed or be about to

1960
00:47:53,469 --> 00:47:53,479
possibly have committed or be about to
 

1961
00:47:53,479 --> 00:47:55,479
possibly have committed or be about to
commit because it has to wait for a yes

1962
00:47:55,479 --> 00:47:55,489
commit because it has to wait for a yes
 

1963
00:47:55,489 --> 00:47:57,789
commit because it has to wait for a yes
from all participants so if B can

1964
00:47:57,789 --> 00:47:57,799
from all participants so if B can
 

1965
00:47:57,799 --> 00:47:58,959
from all participants so if B can
convince itself that it could not

1966
00:47:58,959 --> 00:47:58,969
convince itself that it could not
 

1967
00:47:58,969 --> 00:48:02,019
convince itself that it could not
possibly have sent a yes back that is a

1968
00:48:02,019 --> 00:48:02,029
possibly have sent a yes back that is a
 

1969
00:48:02,029 --> 00:48:04,059
possibly have sent a yes back that is a
crash before sending the yes then B is

1970
00:48:04,059 --> 00:48:04,069
crash before sending the yes then B is
 

1971
00:48:04,069 --> 00:48:06,849
crash before sending the yes then B is
entitled to unilaterally abort the

1972
00:48:06,849 --> 00:48:06,859
entitled to unilaterally abort the
 

1973
00:48:06,859 --> 00:48:09,279
entitled to unilaterally abort the
transaction itself and forget about it

1974
00:48:09,279 --> 00:48:09,289
transaction itself and forget about it
 

1975
00:48:09,289 --> 00:48:11,109
transaction itself and forget about it
because it knows the transaction

1976
00:48:11,109 --> 00:48:11,119
because it knows the transaction
 

1977
00:48:11,119 --> 00:48:15,490
because it knows the transaction
coordinator can't possibly commit it so

1978
00:48:15,490 --> 00:48:15,500
coordinator can't possibly commit it so
 

1979
00:48:15,500 --> 00:48:18,149
coordinator can't possibly commit it so
[Music]

1980
00:48:18,149 --> 00:48:18,159
[Music]
 

1981
00:48:18,159 --> 00:48:19,959
[Music]
there's you know a number of ways of

1982
00:48:19,959 --> 00:48:19,969
there's you know a number of ways of
 

1983
00:48:19,969 --> 00:48:21,609
there's you know a number of ways of
implementing this one possibility is

1984
00:48:21,609 --> 00:48:21,619
implementing this one possibility is
 

1985
00:48:21,619 --> 00:48:23,799
implementing this one possibility is
that all of these information about

1986
00:48:23,799 --> 00:48:23,809
that all of these information about
 

1987
00:48:23,809 --> 00:48:25,539
that all of these information about
transactions that haven't reached this

1988
00:48:25,539 --> 00:48:25,549
transactions that haven't reached this
 

1989
00:48:25,549 --> 00:48:27,969
transactions that haven't reached this
point is in memory and it simply lost it

1990
00:48:27,969 --> 00:48:27,979
point is in memory and it simply lost it
 

1991
00:48:27,979 --> 00:48:30,069
point is in memory and it simply lost it
B crashes and reboots so B just won't

1992
00:48:30,069 --> 00:48:30,079
B crashes and reboots so B just won't
 

1993
00:48:30,079 --> 00:48:31,929
B crashes and reboots so B just won't
know anything about transactions that

1994
00:48:31,929 --> 00:48:31,939
know anything about transactions that
 

1995
00:48:31,939 --> 00:48:35,169
know anything about transactions that
haven't haven't sent yes back yet and

1996
00:48:35,169 --> 00:48:35,179
haven't haven't sent yes back yet and
 

1997
00:48:35,179 --> 00:48:37,089
haven't haven't sent yes back yet and
then if the transaction coordinator

1998
00:48:37,089 --> 00:48:37,099
then if the transaction coordinator
 

1999
00:48:37,099 --> 00:48:39,639
then if the transaction coordinator
sends a prepare message to a participant

2000
00:48:39,639 --> 00:48:39,649
sends a prepare message to a participant
 

2001
00:48:39,649 --> 00:48:41,109
sends a prepare message to a participant
that doesn't know anything about the

2002
00:48:41,109 --> 00:48:41,119
that doesn't know anything about the
 

2003
00:48:41,119 --> 00:48:42,429
that doesn't know anything about the
transaction because it crashed before

2004
00:48:42,429 --> 00:48:42,439
transaction because it crashed before
 

2005
00:48:42,439 --> 00:48:45,129
transaction because it crashed before
sending yes the the parties will say no

2006
00:48:45,129 --> 00:48:45,139
sending yes the the parties will say no
 

2007
00:48:45,139 --> 00:48:47,949
sending yes the the parties will say no
no I cannot possibly agree to that you

2008
00:48:47,949 --> 00:48:47,959
no I cannot possibly agree to that you
 

2009
00:48:47,959 --> 00:48:51,479
no I cannot possibly agree to that you
know please abort

2010
00:48:51,479 --> 00:48:51,489

 

2011
00:48:51,489 --> 00:48:55,089

okay but of course maybe B crashed after

2012
00:48:55,089 --> 00:48:55,099
okay but of course maybe B crashed after
 

2013
00:48:55,099 --> 00:49:00,579
okay but of course maybe B crashed after
sending a yes back so that's a little

2014
00:49:00,579 --> 00:49:00,589
sending a yes back so that's a little
 

2015
00:49:00,589 --> 00:49:02,499
sending a yes back so that's a little
more tricky so wasn't in the crash

2016
00:49:02,499 --> 00:49:02,509
more tricky so wasn't in the crash
 

2017
00:49:02,509 --> 00:49:05,469
more tricky so wasn't in the crash
this wasn't a B gets a prepare its it's

2018
00:49:05,469 --> 00:49:05,479
this wasn't a B gets a prepare its it's
 

2019
00:49:05,479 --> 00:49:07,179
this wasn't a B gets a prepare its it's
happy it says yes I'm going to commit

2020
00:49:07,179 --> 00:49:07,189
happy it says yes I'm going to commit
 

2021
00:49:07,189 --> 00:49:09,729
happy it says yes I'm going to commit
and then it crashes before it gets the

2022
00:49:09,729 --> 00:49:09,739
and then it crashes before it gets the
 

2023
00:49:09,739 --> 00:49:12,039
and then it crashes before it gets the
commit message from the transaction

2024
00:49:12,039 --> 00:49:12,049
commit message from the transaction
 

2025
00:49:12,049 --> 00:49:14,589
commit message from the transaction
employer coordinator well now we had

2026
00:49:14,589 --> 00:49:14,599
employer coordinator well now we had
 

2027
00:49:14,599 --> 00:49:16,779
employer coordinator well now we had
we're in a totally different situation B

2028
00:49:16,779 --> 00:49:16,789
we're in a totally different situation B
 

2029
00:49:16,789 --> 00:49:19,319
we're in a totally different situation B
is promised to commit if told to do so

2030
00:49:19,319 --> 00:49:19,329
is promised to commit if told to do so
 

2031
00:49:19,329 --> 00:49:21,760
is promised to commit if told to do so
because the send a yes back and for all

2032
00:49:21,760 --> 00:49:21,770
because the send a yes back and for all
 

2033
00:49:21,770 --> 00:49:23,350
because the send a yes back and for all
knows and indeed the most likely thing

2034
00:49:23,350 --> 00:49:23,360
knows and indeed the most likely thing
 

2035
00:49:23,360 --> 00:49:24,520
knows and indeed the most likely thing
that's happening is the transaction

2036
00:49:24,520 --> 00:49:24,530
that's happening is the transaction
 

2037
00:49:24,530 --> 00:49:26,950
that's happening is the transaction
coordinator got yeses from a and B and a

2038
00:49:26,950 --> 00:49:26,960
coordinator got yeses from a and B and a
 

2039
00:49:26,960 --> 00:49:28,660
coordinator got yeses from a and B and a
sent a commit message to a so that a

2040
00:49:28,660 --> 00:49:28,670
sent a commit message to a so that a
 

2041
00:49:28,670 --> 00:49:31,090
sent a commit message to a so that a
actually will do its part of the

2042
00:49:31,090 --> 00:49:31,100
actually will do its part of the
 

2043
00:49:31,100 --> 00:49:32,650
actually will do its part of the
transaction and make it permanent and

2044
00:49:32,650 --> 00:49:32,660
transaction and make it permanent and
 

2045
00:49:32,660 --> 00:49:35,290
transaction and make it permanent and
release locks and in that case in order

2046
00:49:35,290 --> 00:49:35,300
release locks and in that case in order
 

2047
00:49:35,300 --> 00:49:37,050
release locks and in that case in order
to honor all or nothing we're absolutely

2048
00:49:37,050 --> 00:49:37,060
to honor all or nothing we're absolutely
 

2049
00:49:37,060 --> 00:49:39,850
to honor all or nothing we're absolutely
required it B should crash at this point

2050
00:49:39,850 --> 00:49:39,860
required it B should crash at this point
 

2051
00:49:39,860 --> 00:49:42,520
required it B should crash at this point
that on recovery that it be still

2052
00:49:42,520 --> 00:49:42,530
that on recovery that it be still
 

2053
00:49:42,530 --> 00:49:44,650
that on recovery that it be still
prepared to complete its part of the

2054
00:49:44,650 --> 00:49:44,660
prepared to complete its part of the
 

2055
00:49:44,660 --> 00:49:45,400
prepared to complete its part of the
transaction

2056
00:49:45,400 --> 00:49:45,410
transaction
 

2057
00:49:45,410 --> 00:49:46,450
transaction
it doesn't actually know at that point

2058
00:49:46,450 --> 00:49:46,460
it doesn't actually know at that point
 

2059
00:49:46,460 --> 00:49:48,130
it doesn't actually know at that point
whether you know because it hasn't

2060
00:49:48,130 --> 00:49:48,140
whether you know because it hasn't
 

2061
00:49:48,140 --> 00:49:50,020
whether you know because it hasn't
received the committee ette and whether

2062
00:49:50,020 --> 00:49:50,030
received the committee ette and whether
 

2063
00:49:50,030 --> 00:49:51,100
received the committee ette and whether
it should commit or not but it must

2064
00:49:51,100 --> 00:49:51,110
it should commit or not but it must
 

2065
00:49:51,110 --> 00:49:53,200
it should commit or not but it must
still be prepared to commit and what

2066
00:49:53,200 --> 00:49:53,210
still be prepared to commit and what
 

2067
00:49:53,210 --> 00:49:57,100
still be prepared to commit and what
that means the fact that we can't lose

2068
00:49:57,100 --> 00:49:57,110
that means the fact that we can't lose
 

2069
00:49:57,110 --> 00:49:59,380
that means the fact that we can't lose
the state for a transaction across

2070
00:49:59,380 --> 00:49:59,390
the state for a transaction across
 

2071
00:49:59,390 --> 00:50:01,780
the state for a transaction across
crashes and reboots

2072
00:50:01,780 --> 00:50:01,790
crashes and reboots
 

2073
00:50:01,790 --> 00:50:07,570
crashes and reboots
is that before B replies to a prepare it

2074
00:50:07,570 --> 00:50:07,580
is that before B replies to a prepare it
 

2075
00:50:07,580 --> 00:50:13,180
is that before B replies to a prepare it
must make the transaction state this

2076
00:50:13,180 --> 00:50:13,190
must make the transaction state this
 

2077
00:50:13,190 --> 00:50:14,770
must make the transaction state this
sort of intermediate transaction state

2078
00:50:14,770 --> 00:50:14,780
sort of intermediate transaction state
 

2079
00:50:14,780 --> 00:50:16,390
sort of intermediate transaction state
the memory of all of the changes that's

2080
00:50:16,390 --> 00:50:16,400
the memory of all of the changes that's
 

2081
00:50:16,400 --> 00:50:17,950
the memory of all of the changes that's
made which may have to be undone if

2082
00:50:17,950 --> 00:50:17,960
made which may have to be undone if
 

2083
00:50:17,960 --> 00:50:20,230
made which may have to be undone if
there's an abort plus the record of all

2084
00:50:20,230 --> 00:50:20,240
there's an abort plus the record of all
 

2085
00:50:20,240 --> 00:50:22,030
there's an abort plus the record of all
the locks the transactions how it held

2086
00:50:22,030 --> 00:50:22,040
the locks the transactions how it held
 

2087
00:50:22,040 --> 00:50:26,200
the locks the transactions how it held
it must make that durable on disk in

2088
00:50:26,200 --> 00:50:26,210
it must make that durable on disk in
 

2089
00:50:26,210 --> 00:50:28,390
it must make that durable on disk in
between it's almost always in a log on

2090
00:50:28,390 --> 00:50:28,400
between it's almost always in a log on
 

2091
00:50:28,400 --> 00:50:33,610
between it's almost always in a log on
disk so before B replies yes before B

2092
00:50:33,610 --> 00:50:33,620
disk so before B replies yes before B
 

2093
00:50:33,620 --> 00:50:35,920
disk so before B replies yes before B
sends the s4 in reply to a prepare

2094
00:50:35,920 --> 00:50:35,930
sends the s4 in reply to a prepare
 

2095
00:50:35,930 --> 00:50:39,670
sends the s4 in reply to a prepare
message it first must write to disk in

2096
00:50:39,670 --> 00:50:39,680
message it first must write to disk in
 

2097
00:50:39,680 --> 00:50:42,010
message it first must write to disk in
its log all the information required to

2098
00:50:42,010 --> 00:50:42,020
its log all the information required to
 

2099
00:50:42,020 --> 00:50:44,320
its log all the information required to
commit that transaction that is all the

2100
00:50:44,320 --> 00:50:44,330
commit that transaction that is all the
 

2101
00:50:44,330 --> 00:50:48,250
commit that transaction that is all the
new values produced by put plus a full

2102
00:50:48,250 --> 00:50:48,260
new values produced by put plus a full
 

2103
00:50:48,260 --> 00:50:51,220
new values produced by put plus a full
list of locks on the disk or some other

2104
00:50:51,220 --> 00:50:51,230
list of locks on the disk or some other
 

2105
00:50:51,230 --> 00:50:53,740
list of locks on the disk or some other
persistent memory before applying with

2106
00:50:53,740 --> 00:50:53,750
persistent memory before applying with
 

2107
00:50:53,750 --> 00:50:55,870
persistent memory before applying with
yes and then if there should be if it

2108
00:50:55,870 --> 00:50:55,880
yes and then if there should be if it
 

2109
00:50:55,880 --> 00:50:58,240
yes and then if there should be if it
B's your crash after sanity yes that's

2110
00:50:58,240 --> 00:50:58,250
B's your crash after sanity yes that's
 

2111
00:50:58,250 --> 00:50:59,860
B's your crash after sanity yes that's
part of recovery when it restarts that a

2112
00:50:59,860 --> 00:50:59,870
part of recovery when it restarts that a
 

2113
00:50:59,870 --> 00:51:01,660
part of recovery when it restarts that a
look at his it's log and say oh gosh I

2114
00:51:01,660 --> 00:51:01,670
look at his it's log and say oh gosh I
 

2115
00:51:01,670 --> 00:51:03,130
look at his it's log and say oh gosh I
was in the middle of a transaction I had

2116
00:51:03,130 --> 00:51:03,140
was in the middle of a transaction I had
 

2117
00:51:03,140 --> 00:51:06,280
was in the middle of a transaction I had
replied yes for transaction 92 I mean

2118
00:51:06,280 --> 00:51:06,290
replied yes for transaction 92 I mean
 

2119
00:51:06,290 --> 00:51:07,780
replied yes for transaction 92 I mean
you know here's all the modifications it

2120
00:51:07,780 --> 00:51:07,790
you know here's all the modifications it
 

2121
00:51:07,790 --> 00:51:09,400
you know here's all the modifications it
should make if committed and all the

2122
00:51:09,400 --> 00:51:09,410
should make if committed and all the
 

2123
00:51:09,410 --> 00:51:10,240
should make if committed and all the
locks it held

2124
00:51:10,240 --> 00:51:10,250
locks it held
 

2125
00:51:10,250 --> 00:51:13,750
locks it held
I better restore that state and then

2126
00:51:13,750 --> 00:51:13,760
I better restore that state and then
 

2127
00:51:13,760 --> 00:51:15,730
I better restore that state and then
when he finally gets a commitment nor an

2128
00:51:15,730 --> 00:51:15,740
when he finally gets a commitment nor an
 

2129
00:51:15,740 --> 00:51:17,890
when he finally gets a commitment nor an
abort it'll know from having read its

2130
00:51:17,890 --> 00:51:17,900
abort it'll know from having read its
 

2131
00:51:17,900 --> 00:51:20,200
abort it'll know from having read its
log how to actually finish its part of

2132
00:51:20,200 --> 00:51:20,210
log how to actually finish its part of
 

2133
00:51:20,210 --> 00:51:23,050
log how to actually finish its part of
the transaction so so this is an

2134
00:51:23,050 --> 00:51:23,060
the transaction so so this is an
 

2135
00:51:23,060 --> 00:51:24,960
the transaction so so this is an
important thing I left out of the

2136
00:51:24,960 --> 00:51:24,970
important thing I left out of the
 

2137
00:51:24,970 --> 00:51:29,500
important thing I left out of the
original laying out of this protocol is

2138
00:51:29,500 --> 00:51:29,510
original laying out of this protocol is
 

2139
00:51:29,510 --> 00:51:32,740
original laying out of this protocol is
that B must write to its disk at this

2140
00:51:32,740 --> 00:51:32,750
that B must write to its disk at this
 

2141
00:51:32,750 --> 00:51:34,220
that B must write to its disk at this
point

2142
00:51:34,220 --> 00:51:34,230
point
 

2143
00:51:34,230 --> 00:51:36,500
point
and this is part of what makes two-phase

2144
00:51:36,500 --> 00:51:36,510
and this is part of what makes two-phase
 

2145
00:51:36,510 --> 00:51:38,990
and this is part of what makes two-phase
commit a little bit slow is that there's

2146
00:51:38,990 --> 00:51:39,000
commit a little bit slow is that there's
 

2147
00:51:39,000 --> 00:51:41,030
commit a little bit slow is that there's
these necessary persisting of

2148
00:51:41,030 --> 00:51:41,040
these necessary persisting of
 

2149
00:51:41,040 --> 00:51:47,390
these necessary persisting of
information here okay so we also have to

2150
00:51:47,390 --> 00:51:47,400
information here okay so we also have to
 

2151
00:51:47,400 --> 00:51:50,570
information here okay so we also have to
worry about okay and you know the final

2152
00:51:50,570 --> 00:51:50,580
worry about okay and you know the final
 

2153
00:51:50,580 --> 00:51:51,890
worry about okay and you know the final
place I guess where you might crash is

2154
00:51:51,890 --> 00:51:51,900
place I guess where you might crash is
 

2155
00:51:51,900 --> 00:51:54,349
place I guess where you might crash is
you might crash be my crashed after

2156
00:51:54,349 --> 00:51:54,359
you might crash be my crashed after
 

2157
00:51:54,359 --> 00:51:58,240
you might crash be my crashed after
receiving the commit or or after both

2158
00:51:58,240 --> 00:51:58,250
receiving the commit or or after both
 

2159
00:51:58,250 --> 00:52:00,170
receiving the commit or or after both
you might crash after actually

2160
00:52:00,170 --> 00:52:00,180
you might crash after actually
 

2161
00:52:00,180 --> 00:52:02,240
you might crash after actually
processing the commit and but in that

2162
00:52:02,240 --> 00:52:02,250
processing the commit and but in that
 

2163
00:52:02,250 --> 00:52:06,349
processing the commit and but in that
case it's made modifications that the

2164
00:52:06,349 --> 00:52:06,359
case it's made modifications that the
 

2165
00:52:06,359 --> 00:52:08,810
case it's made modifications that the
transaction means to make permanent in

2166
00:52:08,810 --> 00:52:08,820
transaction means to make permanent in
 

2167
00:52:08,820 --> 00:52:12,099
transaction means to make permanent in
its database presumably also on disk

2168
00:52:12,099 --> 00:52:12,109
its database presumably also on disk
 

2169
00:52:12,109 --> 00:52:15,140
its database presumably also on disk
before after it received a commit

2170
00:52:15,140 --> 00:52:15,150
before after it received a commit
 

2171
00:52:15,150 --> 00:52:16,940
before after it received a commit
message and in that case there's maybe

2172
00:52:16,940 --> 00:52:16,950
message and in that case there's maybe
 

2173
00:52:16,950 --> 00:52:18,650
message and in that case there's maybe
not anything to do if it restarts

2174
00:52:18,650 --> 00:52:18,660
not anything to do if it restarts
 

2175
00:52:18,660 --> 00:52:20,590
not anything to do if it restarts
because the transaction is finished so

2176
00:52:20,590 --> 00:52:20,600
because the transaction is finished so
 

2177
00:52:20,600 --> 00:52:23,840
because the transaction is finished so
when B receives the commit message it

2178
00:52:23,840 --> 00:52:23,850
when B receives the commit message it
 

2179
00:52:23,850 --> 00:52:28,060
when B receives the commit message it
probably writes the copies the

2180
00:52:28,060 --> 00:52:28,070
probably writes the copies the
 

2181
00:52:28,070 --> 00:52:29,900
probably writes the copies the
modifications from its log on to its

2182
00:52:29,900 --> 00:52:29,910
modifications from its log on to its
 

2183
00:52:29,910 --> 00:52:32,770
modifications from its log on to its
permanent storage releases this locks

2184
00:52:32,770 --> 00:52:32,780
permanent storage releases this locks
 

2185
00:52:32,780 --> 00:52:34,700
permanent storage releases this locks
erases the information about the

2186
00:52:34,700 --> 00:52:34,710
erases the information about the
 

2187
00:52:34,710 --> 00:52:36,170
erases the information about the
transaction of months log and then

2188
00:52:36,170 --> 00:52:36,180
transaction of months log and then
 

2189
00:52:36,180 --> 00:52:38,960
transaction of months log and then
replies and of course we have to worry

2190
00:52:38,960 --> 00:52:38,970
replies and of course we have to worry
 

2191
00:52:38,970 --> 00:52:40,849
replies and of course we have to worry
about you know what if it receives a

2192
00:52:40,849 --> 00:52:40,859
about you know what if it receives a
 

2193
00:52:40,859 --> 00:52:43,670
about you know what if it receives a
commit message twice probably the right

2194
00:52:43,670 --> 00:52:43,680
commit message twice probably the right
 

2195
00:52:43,680 --> 00:52:45,830
commit message twice probably the right
thing to do is either for B to remember

2196
00:52:45,830 --> 00:52:45,840
thing to do is either for B to remember
 

2197
00:52:45,840 --> 00:52:48,590
thing to do is either for B to remember
about the transaction that takes memory

2198
00:52:48,590 --> 00:52:48,600
about the transaction that takes memory
 

2199
00:52:48,600 --> 00:52:51,470
about the transaction that takes memory
so it turns out that it B simply forgets

2200
00:52:51,470 --> 00:52:51,480
so it turns out that it B simply forgets
 

2201
00:52:51,480 --> 00:52:53,090
so it turns out that it B simply forgets
about committed transactions that it's

2202
00:52:53,090 --> 00:52:53,100
about committed transactions that it's
 

2203
00:52:53,100 --> 00:52:56,390
about committed transactions that it's
made durable on disk it can reply to a

2204
00:52:56,390 --> 00:52:56,400
made durable on disk it can reply to a
 

2205
00:52:56,400 --> 00:52:58,730
made durable on disk it can reply to a
repeated commit message if it doesn't

2206
00:52:58,730 --> 00:52:58,740
repeated commit message if it doesn't
 

2207
00:52:58,740 --> 00:53:00,320
repeated commit message if it doesn't
know anything about that transaction by

2208
00:53:00,320 --> 00:53:00,330
know anything about that transaction by
 

2209
00:53:00,330 --> 00:53:03,410
know anything about that transaction by
simply acknowledging it again and

2210
00:53:03,410 --> 00:53:03,420
simply acknowledging it again and
 

2211
00:53:03,420 --> 00:53:04,940
simply acknowledging it again and
that'll be an important a little bit

2212
00:53:04,940 --> 00:53:04,950
that'll be an important a little bit
 

2213
00:53:04,950 --> 00:53:08,240
that'll be an important a little bit
later on ok so that's the story of one

2214
00:53:08,240 --> 00:53:08,250
later on ok so that's the story of one
 

2215
00:53:08,250 --> 00:53:10,310
later on ok so that's the story of one
of the participants crashes at various

2216
00:53:10,310 --> 00:53:10,320
of the participants crashes at various
 

2217
00:53:10,320 --> 00:53:12,920
of the participants crashes at various
awkward points what about the

2218
00:53:12,920 --> 00:53:12,930
awkward points what about the
 

2219
00:53:12,930 --> 00:53:14,630
awkward points what about the
transaction coordinator it's also just a

2220
00:53:14,630 --> 00:53:14,640
transaction coordinator it's also just a
 

2221
00:53:14,640 --> 00:53:16,460
transaction coordinator it's also just a
single computer sorry you know if it

2222
00:53:16,460 --> 00:53:16,470
single computer sorry you know if it
 

2223
00:53:16,470 --> 00:53:26,050
single computer sorry you know if it
fails might be a problem okay so again

2224
00:53:26,050 --> 00:53:26,060
fails might be a problem okay so again
 

2225
00:53:26,060 --> 00:53:29,450
fails might be a problem okay so again
the critical where things start getting

2226
00:53:29,450 --> 00:53:29,460
the critical where things start getting
 

2227
00:53:29,460 --> 00:53:32,720
the critical where things start getting
critical is if any party might have

2228
00:53:32,720 --> 00:53:32,730
critical is if any party might have
 

2229
00:53:32,730 --> 00:53:36,890
critical is if any party might have
committed then we cannot forget about

2230
00:53:36,890 --> 00:53:36,900
committed then we cannot forget about
 

2231
00:53:36,900 --> 00:53:39,349
committed then we cannot forget about
that if any either of these participants

2232
00:53:39,349 --> 00:53:39,359
that if any either of these participants
 

2233
00:53:39,359 --> 00:53:41,359
that if any either of these participants
might have committed or if the

2234
00:53:41,359 --> 00:53:41,369
might have committed or if the
 

2235
00:53:41,369 --> 00:53:43,190
might have committed or if the
transaction coordinator might have

2236
00:53:43,190 --> 00:53:43,200
transaction coordinator might have
 

2237
00:53:43,200 --> 00:53:47,490
transaction coordinator might have
replied to the client then we cannot

2238
00:53:47,490 --> 00:53:47,500
replied to the client then we cannot
 

2239
00:53:47,500 --> 00:53:50,820
replied to the client then we cannot
have that transaction go away right if a

2240
00:53:50,820 --> 00:53:50,830
have that transaction go away right if a
 

2241
00:53:50,830 --> 00:53:52,830
have that transaction go away right if a
is committed but maybe its transaction

2242
00:53:52,830 --> 00:53:52,840
is committed but maybe its transaction
 

2243
00:53:52,840 --> 00:53:54,300
is committed but maybe its transaction
the coordinator sent out a commit

2244
00:53:54,300 --> 00:53:54,310
the coordinator sent out a commit
 

2245
00:53:54,310 --> 00:53:56,040
the coordinator sent out a commit
message to a but hadn't gotten around to

2246
00:53:56,040 --> 00:53:56,050
message to a but hadn't gotten around to
 

2247
00:53:56,050 --> 00:53:58,230
message to a but hadn't gotten around to
sending a commitment to be the crashes

2248
00:53:58,230 --> 00:53:58,240
sending a commitment to be the crashes
 

2249
00:53:58,240 --> 00:53:59,760
sending a commitment to be the crashes
at that point the transaction

2250
00:53:59,760 --> 00:53:59,770
at that point the transaction
 

2251
00:53:59,770 --> 00:54:02,550
at that point the transaction
coordinator must be prepared on restart

2252
00:54:02,550 --> 00:54:02,560
coordinator must be prepared on restart
 

2253
00:54:02,560 --> 00:54:05,220
coordinator must be prepared on restart
to resend the commit messages to make

2254
00:54:05,220 --> 00:54:05,230
to resend the commit messages to make
 

2255
00:54:05,230 --> 00:54:08,280
to resend the commit messages to make
sure that both parties know that the

2256
00:54:08,280 --> 00:54:08,290
sure that both parties know that the
 

2257
00:54:08,290 --> 00:54:14,700
sure that both parties know that the
transaction is committed so okay so you

2258
00:54:14,700 --> 00:54:14,710
transaction is committed so okay so you
 

2259
00:54:14,710 --> 00:54:16,080
transaction is committed so okay so you
know whether that matters depends on

2260
00:54:16,080 --> 00:54:16,090
know whether that matters depends on
 

2261
00:54:16,090 --> 00:54:17,130
know whether that matters depends on
where the transaction coordinator

2262
00:54:17,130 --> 00:54:17,140
where the transaction coordinator
 

2263
00:54:17,140 --> 00:54:20,040
where the transaction coordinator
crashes if the crash is before sending

2264
00:54:20,040 --> 00:54:20,050
crashes if the crash is before sending
 

2265
00:54:20,050 --> 00:54:21,900
crashes if the crash is before sending
commit messages it doesn't really matter

2266
00:54:21,900 --> 00:54:21,910
commit messages it doesn't really matter
 

2267
00:54:21,910 --> 00:54:24,750
commit messages it doesn't really matter
neither party if you know since the

2268
00:54:24,750 --> 00:54:24,760
neither party if you know since the
 

2269
00:54:24,760 --> 00:54:26,610
neither party if you know since the
transaction coordinator didn't send

2270
00:54:26,610 --> 00:54:26,620
transaction coordinator didn't send
 

2271
00:54:26,620 --> 00:54:29,130
transaction coordinator didn't send
commit messages before crashing it can

2272
00:54:29,130 --> 00:54:29,140
commit messages before crashing it can
 

2273
00:54:29,140 --> 00:54:33,110
commit messages before crashing it can
just abort the transaction and if either

2274
00:54:33,110 --> 00:54:33,120
just abort the transaction and if either
 

2275
00:54:33,120 --> 00:54:35,280
just abort the transaction and if either
participant asks about that transaction

2276
00:54:35,280 --> 00:54:35,290
participant asks about that transaction
 

2277
00:54:35,290 --> 00:54:36,660
participant asks about that transaction
because they you know see it's in their

2278
00:54:36,660 --> 00:54:36,670
because they you know see it's in their
 

2279
00:54:36,670 --> 00:54:38,310
because they you know see it's in their
log but they never got a commit message

2280
00:54:38,310 --> 00:54:38,320
log but they never got a commit message
 

2281
00:54:38,320 --> 00:54:40,560
log but they never got a commit message
the transaction coordinator can say I

2282
00:54:40,560 --> 00:54:40,570
the transaction coordinator can say I
 

2283
00:54:40,570 --> 00:54:41,220
the transaction coordinator can say I
don't know anything about that

2284
00:54:41,220 --> 00:54:41,230
don't know anything about that
 

2285
00:54:41,230 --> 00:54:43,260
don't know anything about that
transaction it must have been aborted

2286
00:54:43,260 --> 00:54:43,270
transaction it must have been aborted
 

2287
00:54:43,270 --> 00:54:46,140
transaction it must have been aborted
possibly due to a crash so that's what

2288
00:54:46,140 --> 00:54:46,150
possibly due to a crash so that's what
 

2289
00:54:46,150 --> 00:54:47,670
possibly due to a crash so that's what
happens if the transaction coordinator

2290
00:54:47,670 --> 00:54:47,680
happens if the transaction coordinator
 

2291
00:54:47,680 --> 00:54:50,340
happens if the transaction coordinator
crashes before the commit but if a

2292
00:54:50,340 --> 00:54:50,350
crashes before the commit but if a
 

2293
00:54:50,350 --> 00:54:52,560
crashes before the commit but if a
crashes after sending one or more

2294
00:54:52,560 --> 00:54:52,570
crashes after sending one or more
 

2295
00:54:52,570 --> 00:54:59,940
crashes after sending one or more
commits message then it cannot defends

2296
00:54:59,940 --> 00:54:59,950
commits message then it cannot defends
 

2297
00:54:59,950 --> 00:55:02,160
commits message then it cannot defends
action coordinator can't be allowed to

2298
00:55:02,160 --> 00:55:02,170
action coordinator can't be allowed to
 

2299
00:55:02,170 --> 00:55:05,310
action coordinator can't be allowed to
forget about the transaction and what

2300
00:55:05,310 --> 00:55:05,320
forget about the transaction and what
 

2301
00:55:05,320 --> 00:55:08,250
forget about the transaction and what
that means is that at this point when

2302
00:55:08,250 --> 00:55:08,260
that means is that at this point when
 

2303
00:55:08,260 --> 00:55:09,690
that means is that at this point when
that after the transaction coordinator

2304
00:55:09,690 --> 00:55:09,700
that after the transaction coordinator
 

2305
00:55:09,700 --> 00:55:11,910
that after the transaction coordinator
it's made its commit versus abort

2306
00:55:11,910 --> 00:55:11,920
it's made its commit versus abort
 

2307
00:55:11,920 --> 00:55:13,680
it's made its commit versus abort
decision on the basis of these yes/no

2308
00:55:13,680 --> 00:55:13,690
decision on the basis of these yes/no
 

2309
00:55:13,690 --> 00:55:16,050
decision on the basis of these yes/no
votes before sending out any commit

2310
00:55:16,050 --> 00:55:16,060
votes before sending out any commit
 

2311
00:55:16,060 --> 00:55:20,090
votes before sending out any commit
messages it must first write information

2312
00:55:20,090 --> 00:55:20,100
messages it must first write information
 

2313
00:55:20,100 --> 00:55:22,950
messages it must first write information
about the transaction to its login in

2314
00:55:22,950 --> 00:55:22,960
about the transaction to its login in
 

2315
00:55:22,960 --> 00:55:26,130
about the transaction to its login in
persistent storage like a disk that will

2316
00:55:26,130 --> 00:55:26,140
persistent storage like a disk that will
 

2317
00:55:26,140 --> 00:55:27,840
persistent storage like a disk that will
still be there if it crashes and

2318
00:55:27,840 --> 00:55:27,850
still be there if it crashes and
 

2319
00:55:27,850 --> 00:55:30,750
still be there if it crashes and
restarts so transaction coordinator

2320
00:55:30,750 --> 00:55:30,760
restarts so transaction coordinator
 

2321
00:55:30,760 --> 00:55:32,790
restarts so transaction coordinator
after receives a full set of yeses or

2322
00:55:32,790 --> 00:55:32,800
after receives a full set of yeses or
 

2323
00:55:32,800 --> 00:55:35,670
after receives a full set of yeses or
noes writes the outcome and the

2324
00:55:35,670 --> 00:55:35,680
noes writes the outcome and the
 

2325
00:55:35,680 --> 00:55:38,010
noes writes the outcome and the
transaction ID to its log on disk and

2326
00:55:38,010 --> 00:55:38,020
transaction ID to its log on disk and
 

2327
00:55:38,020 --> 00:55:40,050
transaction ID to its log on disk and
only then it starts to send out commit

2328
00:55:40,050 --> 00:55:40,060
only then it starts to send out commit
 

2329
00:55:40,060 --> 00:55:41,910
only then it starts to send out commit
messages and that way if a crash is at

2330
00:55:41,910 --> 00:55:41,920
messages and that way if a crash is at
 

2331
00:55:41,920 --> 00:55:45,630
messages and that way if a crash is at
any point maybe before its end the first

2332
00:55:45,630 --> 00:55:45,640
any point maybe before its end the first
 

2333
00:55:45,640 --> 00:55:47,700
any point maybe before its end the first
commit message or after its sent one or

2334
00:55:47,700 --> 00:55:47,710
commit message or after its sent one or
 

2335
00:55:47,710 --> 00:55:49,560
commit message or after its sent one or
maybe even after sent all of them if it

2336
00:55:49,560 --> 00:55:49,570
maybe even after sent all of them if it
 

2337
00:55:49,570 --> 00:55:51,630
maybe even after sent all of them if it
crashes that point its recovery software

2338
00:55:51,630 --> 00:55:51,640
crashes that point its recovery software
 

2339
00:55:51,640 --> 00:55:53,970
crashes that point its recovery software
will see in the log AHA which is in the

2340
00:55:53,970 --> 00:55:53,980
will see in the log AHA which is in the
 

2341
00:55:53,980 --> 00:55:55,620
will see in the log AHA which is in the
middle of a transaction the transaction

2342
00:55:55,620 --> 00:55:55,630
middle of a transaction the transaction
 

2343
00:55:55,630 --> 00:55:57,870
middle of a transaction the transaction
was either known to have been committed

2344
00:55:57,870 --> 00:55:57,880
was either known to have been committed
 

2345
00:55:57,880 --> 00:55:59,460
was either known to have been committed
or aborted

2346
00:55:59,460 --> 00:55:59,470
or aborted
 

2347
00:55:59,470 --> 00:56:01,580
or aborted
and as part of recovery it will resend

2348
00:56:01,580 --> 00:56:01,590
and as part of recovery it will resend
 

2349
00:56:01,590 --> 00:56:04,339
and as part of recovery it will resend
commit messages to all the participants

2350
00:56:04,339 --> 00:56:04,349
commit messages to all the participants
 

2351
00:56:04,349 --> 00:56:06,930
commit messages to all the participants
or abort messages whatever the decision

2352
00:56:06,930 --> 00:56:06,940
or abort messages whatever the decision
 

2353
00:56:06,940 --> 00:56:10,410
or abort messages whatever the decision
was in case it hadn't sent them before

2354
00:56:10,410 --> 00:56:10,420
was in case it hadn't sent them before
 

2355
00:56:10,420 --> 00:56:12,380
was in case it hadn't sent them before
it crashed and that's one reason why the

2356
00:56:12,380 --> 00:56:12,390
it crashed and that's one reason why the
 

2357
00:56:12,390 --> 00:56:14,510
it crashed and that's one reason why the
participants have to be prepared to

2358
00:56:14,510 --> 00:56:14,520
participants have to be prepared to
 

2359
00:56:14,520 --> 00:56:27,440
participants have to be prepared to
receive duplicated commit messages okay

2360
00:56:27,440 --> 00:56:27,450

 

2361
00:56:27,450 --> 00:56:31,070

so there's some other so those are the

2362
00:56:31,070 --> 00:56:31,080
so there's some other so those are the
 

2363
00:56:31,080 --> 00:56:34,109
so there's some other so those are the
main crash stories we also have to worry

2364
00:56:34,109 --> 00:56:34,119
main crash stories we also have to worry
 

2365
00:56:34,119 --> 00:56:35,970
main crash stories we also have to worry
about what happens if messages are lost

2366
00:56:35,970 --> 00:56:35,980
about what happens if messages are lost
 

2367
00:56:35,980 --> 00:56:37,500
about what happens if messages are lost
in the network you might send a message

2368
00:56:37,500 --> 00:56:37,510
in the network you might send a message
 

2369
00:56:37,510 --> 00:56:39,599
in the network you might send a message
maybe the message never got there you

2370
00:56:39,599 --> 00:56:39,609
maybe the message never got there you
 

2371
00:56:39,609 --> 00:56:40,980
maybe the message never got there you
might send a message and be waiting for

2372
00:56:40,980 --> 00:56:40,990
might send a message and be waiting for
 

2373
00:56:40,990 --> 00:56:44,460
might send a message and be waiting for
a reply maybe the reply was sent but the

2374
00:56:44,460 --> 00:56:44,470
a reply maybe the reply was sent but the
 

2375
00:56:44,470 --> 00:56:45,870
a reply maybe the reply was sent but the
reply was dropped so any one of these

2376
00:56:45,870 --> 00:56:45,880
reply was dropped so any one of these
 

2377
00:56:45,880 --> 00:56:47,790
reply was dropped so any one of these
messages may be dropped and need to

2378
00:56:47,790 --> 00:56:47,800
messages may be dropped and need to
 

2379
00:56:47,800 --> 00:56:52,020
messages may be dropped and need to
think through what to actually do in

2380
00:56:52,020 --> 00:56:52,030
think through what to actually do in
 

2381
00:56:52,030 --> 00:56:56,070
think through what to actually do in
each of these cases so for example

2382
00:56:56,070 --> 00:56:56,080
each of these cases so for example
 

2383
00:56:56,080 --> 00:56:57,480
each of these cases so for example
supposing the transaction coordinator

2384
00:56:57,480 --> 00:56:57,490
supposing the transaction coordinator
 

2385
00:56:57,490 --> 00:57:00,030
supposing the transaction coordinator
sent out prepare messages but hasn't

2386
00:57:00,030 --> 00:57:00,040
sent out prepare messages but hasn't
 

2387
00:57:00,040 --> 00:57:02,250
sent out prepare messages but hasn't
gotten some of the yes or no replies

2388
00:57:02,250 --> 00:57:02,260
gotten some of the yes or no replies
 

2389
00:57:02,260 --> 00:57:04,260
gotten some of the yes or no replies
from participants what are the

2390
00:57:04,260 --> 00:57:04,270
from participants what are the
 

2391
00:57:04,270 --> 00:57:06,060
from participants what are the
transaction coordinators options at that

2392
00:57:06,060 --> 00:57:06,070
transaction coordinators options at that
 

2393
00:57:06,070 --> 00:57:08,640
transaction coordinators options at that
point well one thing I could do is send

2394
00:57:08,640 --> 00:57:08,650
point well one thing I could do is send
 

2395
00:57:08,650 --> 00:57:11,670
point well one thing I could do is send
out a new set of prepare messages saying

2396
00:57:11,670 --> 00:57:11,680
out a new set of prepare messages saying
 

2397
00:57:11,680 --> 00:57:13,230
out a new set of prepare messages saying
you know I didn't get your answer please

2398
00:57:13,230 --> 00:57:13,240
you know I didn't get your answer please
 

2399
00:57:13,240 --> 00:57:15,690
you know I didn't get your answer please
tell me your answer yes or no and you

2400
00:57:15,690 --> 00:57:15,700
tell me your answer yes or no and you
 

2401
00:57:15,700 --> 00:57:17,010
tell me your answer yes or no and you
know I could keep on doing that for a

2402
00:57:17,010 --> 00:57:17,020
know I could keep on doing that for a
 

2403
00:57:17,020 --> 00:57:20,310
know I could keep on doing that for a
while but if one of the partisans is

2404
00:57:20,310 --> 00:57:20,320
while but if one of the partisans is
 

2405
00:57:20,320 --> 00:57:21,390
while but if one of the partisans is
down for a long time we don't want to

2406
00:57:21,390 --> 00:57:21,400
down for a long time we don't want to
 

2407
00:57:21,400 --> 00:57:24,960
down for a long time we don't want to
sit there waiting with locks held right

2408
00:57:24,960 --> 00:57:24,970
sit there waiting with locks held right
 

2409
00:57:24,970 --> 00:57:27,120
sit there waiting with locks held right
because you know supposing a is

2410
00:57:27,120 --> 00:57:27,130
because you know supposing a is
 

2411
00:57:27,130 --> 00:57:30,180
because you know supposing a is
unresponsive but but B is up but because

2412
00:57:30,180 --> 00:57:30,190
unresponsive but but B is up but because
 

2413
00:57:30,190 --> 00:57:31,950
unresponsive but but B is up but because
that we haven't committed or aborted B

2414
00:57:31,950 --> 00:57:31,960
that we haven't committed or aborted B
 

2415
00:57:31,960 --> 00:57:33,450
that we haven't committed or aborted B
is still holding locks and that may

2416
00:57:33,450 --> 00:57:33,460
is still holding locks and that may
 

2417
00:57:33,460 --> 00:57:35,220
is still holding locks and that may
cause other transactions to be waiting

2418
00:57:35,220 --> 00:57:35,230
cause other transactions to be waiting
 

2419
00:57:35,230 --> 00:57:37,680
cause other transactions to be waiting
so we don't want to wait forever if we

2420
00:57:37,680 --> 00:57:37,690
so we don't want to wait forever if we
 

2421
00:57:37,690 --> 00:57:39,839
so we don't want to wait forever if we
can possibly avoid it so if the

2422
00:57:39,839 --> 00:57:39,849
can possibly avoid it so if the
 

2423
00:57:39,849 --> 00:57:41,520
can possibly avoid it so if the
transaction coordinator hasn't gotten

2424
00:57:41,520 --> 00:57:41,530
transaction coordinator hasn't gotten
 

2425
00:57:41,530 --> 00:57:43,920
transaction coordinator hasn't gotten
yes or no responses after some amount of

2426
00:57:43,920 --> 00:57:43,930
yes or no responses after some amount of
 

2427
00:57:43,930 --> 00:57:47,579
yes or no responses after some amount of
time from the participants then it can

2428
00:57:47,579 --> 00:57:47,589
time from the participants then it can
 

2429
00:57:47,589 --> 00:57:49,800
time from the participants then it can
simply unilaterally decide we're gonna

2430
00:57:49,800 --> 00:57:49,810
simply unilaterally decide we're gonna
 

2431
00:57:49,810 --> 00:57:52,050
simply unilaterally decide we're gonna
abort this transaction because it knows

2432
00:57:52,050 --> 00:57:52,060
abort this transaction because it knows
 

2433
00:57:52,060 --> 00:57:54,089
abort this transaction because it knows
since it didn't get a full set of yes or

2434
00:57:54,089 --> 00:57:54,099
since it didn't get a full set of yes or
 

2435
00:57:54,099 --> 00:57:55,740
since it didn't get a full set of yes or
no messages of course that can't

2436
00:57:55,740 --> 00:57:55,750
no messages of course that can't
 

2437
00:57:55,750 --> 00:57:57,420
no messages of course that can't
possibly have sent a commit yet so no

2438
00:57:57,420 --> 00:57:57,430
possibly have sent a commit yet so no
 

2439
00:57:57,430 --> 00:58:00,240
possibly have sent a commit yet so no
participant could have committed so it's

2440
00:58:00,240 --> 00:58:00,250
participant could have committed so it's
 

2441
00:58:00,250 --> 00:58:03,300
participant could have committed so it's
always valid to abort if the transaction

2442
00:58:03,300 --> 00:58:03,310
always valid to abort if the transaction
 

2443
00:58:03,310 --> 00:58:05,910
always valid to abort if the transaction
coordinator hasn't yet committed so the

2444
00:58:05,910 --> 00:58:05,920
coordinator hasn't yet committed so the
 

2445
00:58:05,920 --> 00:58:07,079
coordinator hasn't yet committed so the
transaction coordinator times out

2446
00:58:07,079 --> 00:58:07,089
transaction coordinator times out
 

2447
00:58:07,089 --> 00:58:09,089
transaction coordinator times out
waiting for yes or no x' this messages

2448
00:58:09,089 --> 00:58:09,099
waiting for yes or no x' this messages
 

2449
00:58:09,099 --> 00:58:11,099
waiting for yes or no x' this messages
were lost or somebody crashed or

2450
00:58:11,099 --> 00:58:11,109
were lost or somebody crashed or
 

2451
00:58:11,109 --> 00:58:12,140
were lost or somebody crashed or
something

2452
00:58:12,140 --> 00:58:12,150
something
 

2453
00:58:12,150 --> 00:58:13,400
something
it can just decide alright we're

2454
00:58:13,400 --> 00:58:13,410
it can just decide alright we're
 

2455
00:58:13,410 --> 00:58:15,260
it can just decide alright we're
aborting this transaction we'll send out

2456
00:58:15,260 --> 00:58:15,270
aborting this transaction we'll send out
 

2457
00:58:15,270 --> 00:58:17,750
aborting this transaction we'll send out
a round of abort messages and if some

2458
00:58:17,750 --> 00:58:17,760
a round of abort messages and if some
 

2459
00:58:17,760 --> 00:58:19,190
a round of abort messages and if some
participant comes back to life and says

2460
00:58:19,190 --> 00:58:19,200
participant comes back to life and says
 

2461
00:58:19,200 --> 00:58:21,260
participant comes back to life and says
oh you know I didn't hear back from you

2462
00:58:21,260 --> 00:58:21,270
oh you know I didn't hear back from you
 

2463
00:58:21,270 --> 00:58:25,670
oh you know I didn't hear back from you
about transaction 95 the transaction

2464
00:58:25,670 --> 00:58:25,680
about transaction 95 the transaction
 

2465
00:58:25,680 --> 00:58:26,779
about transaction 95 the transaction
coordinator will see you oh well I don't

2466
00:58:26,779 --> 00:58:26,789
coordinator will see you oh well I don't
 

2467
00:58:26,789 --> 00:58:28,190
coordinator will see you oh well I don't
know anything about transaction 95

2468
00:58:28,190 --> 00:58:28,200
know anything about transaction 95
 

2469
00:58:28,200 --> 00:58:30,799
know anything about transaction 95
because it aborted it and erased its

2470
00:58:30,799 --> 00:58:30,809
because it aborted it and erased its
 

2471
00:58:30,809 --> 00:58:32,690
because it aborted it and erased its
State for that transaction and it will

2472
00:58:32,690 --> 00:58:32,700
State for that transaction and it will
 

2473
00:58:32,700 --> 00:58:35,000
State for that transaction and it will
tell the participant you know you should

2474
00:58:35,000 --> 00:58:35,010
tell the participant you know you should
 

2475
00:58:35,010 --> 00:58:42,319
tell the participant you know you should
abort this transaction too similarly if

2476
00:58:42,319 --> 00:58:42,329
abort this transaction too similarly if
 

2477
00:58:42,329 --> 00:58:44,180
abort this transaction too similarly if
one of the participants times out

2478
00:58:44,180 --> 00:58:44,190
one of the participants times out
 

2479
00:58:44,190 --> 00:58:47,269
one of the participants times out
waiting for the preparer here then you

2480
00:58:47,269 --> 00:58:47,279
waiting for the preparer here then you
 

2481
00:58:47,279 --> 00:58:49,579
waiting for the preparer here then you
know for participant hasn't received a

2482
00:58:49,579 --> 00:58:49,589
know for participant hasn't received a
 

2483
00:58:49,589 --> 00:58:51,529
know for participant hasn't received a
preparer that means it hasn't send a yes

2484
00:58:51,529 --> 00:58:51,539
preparer that means it hasn't send a yes
 

2485
00:58:51,539 --> 00:58:53,150
preparer that means it hasn't send a yes
message back and that means the

2486
00:58:53,150 --> 00:58:53,160
message back and that means the
 

2487
00:58:53,160 --> 00:58:54,890
message back and that means the
coordinator can't possibly have sent any

2488
00:58:54,890 --> 00:58:54,900
coordinator can't possibly have sent any
 

2489
00:58:54,900 --> 00:58:55,789
coordinator can't possibly have sent any
commit messages

2490
00:58:55,789 --> 00:58:55,799
commit messages
 

2491
00:58:55,799 --> 00:58:58,039
commit messages
so if participant chimes out here

2492
00:58:58,039 --> 00:58:58,049
so if participant chimes out here
 

2493
00:58:58,049 --> 00:58:59,839
so if participant chimes out here
waiting for the preparer it's also

2494
00:58:59,839 --> 00:58:59,849
waiting for the preparer it's also
 

2495
00:58:59,849 --> 00:59:03,109
waiting for the preparer it's also
always allowed to just bail out and

2496
00:59:03,109 --> 00:59:03,119
always allowed to just bail out and
 

2497
00:59:03,119 --> 00:59:05,390
always allowed to just bail out and
decide to abort the transaction and if

2498
00:59:05,390 --> 00:59:05,400
decide to abort the transaction and if
 

2499
00:59:05,400 --> 00:59:07,069
decide to abort the transaction and if
it's some future time the transaction

2500
00:59:07,069 --> 00:59:07,079
it's some future time the transaction
 

2501
00:59:07,079 --> 00:59:09,200
it's some future time the transaction
coordinator comes back to life and sends

2502
00:59:09,200 --> 00:59:09,210
coordinator comes back to life and sends
 

2503
00:59:09,210 --> 00:59:11,930
coordinator comes back to life and sends
out preparer messages then B will say no

2504
00:59:11,930 --> 00:59:11,940
out preparer messages then B will say no
 

2505
00:59:11,940 --> 00:59:12,829
out preparer messages then B will say no
I don't know anything about that

2506
00:59:12,829 --> 00:59:12,839
I don't know anything about that
 

2507
00:59:12,839 --> 00:59:15,260
I don't know anything about that
transaction so I'm voting no and that's

2508
00:59:15,260 --> 00:59:15,270
transaction so I'm voting no and that's
 

2509
00:59:15,270 --> 00:59:16,849
transaction so I'm voting no and that's
okay because it can't possibly have

2510
00:59:16,849 --> 00:59:16,859
okay because it can't possibly have
 

2511
00:59:16,859 --> 00:59:19,789
okay because it can't possibly have
committed started to commit anywhere so

2512
00:59:19,789 --> 00:59:19,799
committed started to commit anywhere so
 

2513
00:59:19,799 --> 00:59:21,440
committed started to commit anywhere so
again if something goes wrong with the

2514
00:59:21,440 --> 00:59:21,450
again if something goes wrong with the
 

2515
00:59:21,450 --> 00:59:22,789
again if something goes wrong with the
network or the transaction coordinator

2516
00:59:22,789 --> 00:59:22,799
network or the transaction coordinator
 

2517
00:59:22,799 --> 00:59:24,349
network or the transaction coordinator
is down for a while

2518
00:59:24,349 --> 00:59:24,359
is down for a while
 

2519
00:59:24,359 --> 00:59:26,450
is down for a while
and the participants are still waiting

2520
00:59:26,450 --> 00:59:26,460
and the participants are still waiting
 

2521
00:59:26,460 --> 00:59:29,269
and the participants are still waiting
for prepares it's always valid for

2522
00:59:29,269 --> 00:59:29,279
for prepares it's always valid for
 

2523
00:59:29,279 --> 00:59:31,010
for prepares it's always valid for
participants to abort and thereby

2524
00:59:31,010 --> 00:59:31,020
participants to abort and thereby
 

2525
00:59:31,020 --> 00:59:32,539
participants to abort and thereby
release the locks that other

2526
00:59:32,539 --> 00:59:32,549
release the locks that other
 

2527
00:59:32,549 --> 00:59:34,940
release the locks that other
transactions may be waiting for and that

2528
00:59:34,940 --> 00:59:34,950
transactions may be waiting for and that
 

2529
00:59:34,950 --> 00:59:39,579
transactions may be waiting for and that
can be very important in a busy system

2530
00:59:39,579 --> 00:59:39,589

 

2531
00:59:39,589 --> 00:59:44,450

so that's the good news about if the

2532
00:59:44,450 --> 00:59:44,460
so that's the good news about if the
 

2533
00:59:44,460 --> 00:59:45,620
so that's the good news about if the
participants or the transaction

2534
00:59:45,620 --> 00:59:45,630
participants or the transaction
 

2535
00:59:45,630 --> 00:59:47,240
participants or the transaction
coordinators time out waiting for

2536
00:59:47,240 --> 00:59:47,250
coordinators time out waiting for
 

2537
00:59:47,250 --> 00:59:52,809
coordinators time out waiting for
messages from the other parties however

2538
00:59:52,809 --> 00:59:52,819
messages from the other parties however
 

2539
00:59:52,819 --> 00:59:56,599
messages from the other parties however
suppose participant B has received a

2540
00:59:56,599 --> 00:59:56,609
suppose participant B has received a
 

2541
00:59:56,609 --> 01:00:00,289
suppose participant B has received a
preparer and sent its yes and so is in

2542
01:00:00,289 --> 01:00:00,299
preparer and sent its yes and so is in
 

2543
01:00:00,299 --> 01:00:01,970
preparer and sent its yes and so is in
somewhere around here but it hasn't

2544
01:00:01,970 --> 01:00:01,980
somewhere around here but it hasn't
 

2545
01:00:01,980 --> 01:00:03,500
somewhere around here but it hasn't
received a commit and it's waiting and

2546
01:00:03,500 --> 01:00:03,510
received a commit and it's waiting and
 

2547
01:00:03,510 --> 01:00:05,089
received a commit and it's waiting and
waiting and it hasn't gotten to commit

2548
01:00:05,089 --> 01:00:05,099
waiting and it hasn't gotten to commit
 

2549
01:00:05,099 --> 01:00:06,740
waiting and it hasn't gotten to commit
back maybe something's wrong with the

2550
01:00:06,740 --> 01:00:06,750
back maybe something's wrong with the
 

2551
01:00:06,750 --> 01:00:08,720
back maybe something's wrong with the
network maybe the transaction

2552
01:00:08,720 --> 01:00:08,730
network maybe the transaction
 

2553
01:00:08,730 --> 01:00:10,849
network maybe the transaction
coordinator is its network connection

2554
01:00:10,849 --> 01:00:10,859
coordinator is its network connection
 

2555
01:00:10,859 --> 01:00:13,010
coordinator is its network connection
has fallen out or its powers failed or

2556
01:00:13,010 --> 01:00:13,020
has fallen out or its powers failed or
 

2557
01:00:13,020 --> 01:00:14,630
has fallen out or its powers failed or
something but for whatever reason B is

2558
01:00:14,630 --> 01:00:14,640
something but for whatever reason B is
 

2559
01:00:14,640 --> 01:00:15,980
something but for whatever reason B is
waited a long time and it still hasn't

2560
01:00:15,980 --> 01:00:15,990
waited a long time and it still hasn't
 

2561
01:00:15,990 --> 01:00:18,140
waited a long time and it still hasn't
heard a commit now but it's sitting

2562
01:00:18,140 --> 01:00:18,150
heard a commit now but it's sitting
 

2563
01:00:18,150 --> 01:00:19,880
heard a commit now but it's sitting
there holding locks is still holding on

2564
01:00:19,880 --> 01:00:19,890
there holding locks is still holding on
 

2565
01:00:19,890 --> 01:00:21,589
there holding locks is still holding on
to those locks for all the records that

2566
01:00:21,589 --> 01:00:21,599
to those locks for all the records that
 

2567
01:00:21,599 --> 01:00:22,640
to those locks for all the records that
were used and it's part of the

2568
01:00:22,640 --> 01:00:22,650
were used and it's part of the
 

2569
01:00:22,650 --> 01:00:24,049
were used and it's part of the
transaction and that means other

2570
01:00:24,049 --> 01:00:24,059
transaction and that means other
 

2571
01:00:24,059 --> 01:00:25,640
transaction and that means other
transactions may be also

2572
01:00:25,640 --> 01:00:25,650
transactions may be also
 

2573
01:00:25,650 --> 01:00:27,650
transactions may be also
blocked waiting for those locks to be

2574
01:00:27,650 --> 01:00:27,660
blocked waiting for those locks to be
 

2575
01:00:27,660 --> 01:00:30,470
blocked waiting for those locks to be
released so we're like pretty eager to a

2576
01:00:30,470 --> 01:00:30,480
released so we're like pretty eager to a
 

2577
01:00:30,480 --> 01:00:32,930
released so we're like pretty eager to a
border if we possibly can or release the

2578
01:00:32,930 --> 01:00:32,940
border if we possibly can or release the
 

2579
01:00:32,940 --> 01:00:35,299
border if we possibly can or release the
locks and so the question is if B has

2580
01:00:35,299 --> 01:00:35,309
locks and so the question is if B has
 

2581
01:00:35,309 --> 01:00:37,880
locks and so the question is if B has
received prepare and replied with yes

2582
01:00:37,880 --> 01:00:37,890
received prepare and replied with yes
 

2583
01:00:37,890 --> 01:00:40,339
received prepare and replied with yes
isn't entitle to unilaterally abort

2584
01:00:40,339 --> 01:00:40,349
isn't entitle to unilaterally abort
 

2585
01:00:40,349 --> 01:00:42,950
isn't entitle to unilaterally abort
after it's waited say you know 10

2586
01:00:42,950 --> 01:00:42,960
after it's waited say you know 10
 

2587
01:00:42,960 --> 01:00:45,349
after it's waited say you know 10
seconds or 10 minutes or something to

2588
01:00:45,349 --> 01:00:45,359
seconds or 10 minutes or something to
 

2589
01:00:45,359 --> 01:00:48,680
seconds or 10 minutes or something to
get the commit message and the answer to

2590
01:00:48,680 --> 01:00:48,690
get the commit message and the answer to
 

2591
01:00:48,690 --> 01:00:54,170
get the commit message and the answer to
that unfortunately is no in this region

2592
01:00:54,170 --> 01:00:54,180
that unfortunately is no in this region
 

2593
01:00:54,180 --> 01:00:56,750
that unfortunately is no in this region
after receiving the prepare we're out

2594
01:00:56,750 --> 01:00:56,760
after receiving the prepare we're out
 

2595
01:00:56,760 --> 01:00:58,940
after receiving the prepare we're out
really after sending the yes and before

2596
01:00:58,940 --> 01:00:58,950
really after sending the yes and before
 

2597
01:00:58,950 --> 01:01:01,730
really after sending the yes and before
getting the commit it's your time out

2598
01:01:01,730 --> 01:01:01,740
getting the commit it's your time out
 

2599
01:01:01,740 --> 01:01:06,260
getting the commit it's your time out
waiting for the commit you're not

2600
01:01:06,260 --> 01:01:06,270
waiting for the commit you're not
 

2601
01:01:06,270 --> 01:01:08,150
waiting for the commit you're not
allowed to abort you must keep waiting

2602
01:01:08,150 --> 01:01:08,160
allowed to abort you must keep waiting
 

2603
01:01:08,160 --> 01:01:12,230
allowed to abort you must keep waiting
you must usually called block so in this

2604
01:01:12,230 --> 01:01:12,240
you must usually called block so in this
 

2605
01:01:12,240 --> 01:01:14,240
you must usually called block so in this
region of the protocol if you don't

2606
01:01:14,240 --> 01:01:14,250
region of the protocol if you don't
 

2607
01:01:14,250 --> 01:01:15,410
region of the protocol if you don't
receive the commit you have to wait

2608
01:01:15,410 --> 01:01:15,420
receive the commit you have to wait
 

2609
01:01:15,420 --> 01:01:17,920
receive the commit you have to wait
indefinitely and the reason is that

2610
01:01:17,920 --> 01:01:17,930
indefinitely and the reason is that
 

2611
01:01:17,930 --> 01:01:21,529
indefinitely and the reason is that
since be sent back a yes that means the

2612
01:01:21,529 --> 01:01:21,539
since be sent back a yes that means the
 

2613
01:01:21,539 --> 01:01:22,940
since be sent back a yes that means the
transaction coordinator may have

2614
01:01:22,940 --> 01:01:22,950
transaction coordinator may have
 

2615
01:01:22,950 --> 01:01:24,529
transaction coordinator may have
received the yes it may have received

2616
01:01:24,529 --> 01:01:24,539
received the yes it may have received
 

2617
01:01:24,539 --> 01:01:26,779
received the yes it may have received
yes from all of the participants and it

2618
01:01:26,779 --> 01:01:26,789
yes from all of the participants and it
 

2619
01:01:26,789 --> 01:01:28,250
yes from all of the participants and it
may have started sending out commit

2620
01:01:28,250 --> 01:01:28,260
may have started sending out commit
 

2621
01:01:28,260 --> 01:01:30,589
may have started sending out commit
messages to some of the participants and

2622
01:01:30,589 --> 01:01:30,599
messages to some of the participants and
 

2623
01:01:30,599 --> 01:01:32,720
messages to some of the participants and
that means that a may have actually seen

2624
01:01:32,720 --> 01:01:32,730
that means that a may have actually seen
 

2625
01:01:32,730 --> 01:01:34,130
that means that a may have actually seen
the commit message and committed and

2626
01:01:34,130 --> 01:01:34,140
the commit message and committed and
 

2627
01:01:34,140 --> 01:01:35,839
the commit message and committed and
made us changes permanent and unlocked

2628
01:01:35,839 --> 01:01:35,849
made us changes permanent and unlocked
 

2629
01:01:35,849 --> 01:01:37,460
made us changes permanent and unlocked
and showing the changes to other

2630
01:01:37,460 --> 01:01:37,470
and showing the changes to other
 

2631
01:01:37,470 --> 01:01:39,529
and showing the changes to other
transactions and since that could be the

2632
01:01:39,529 --> 01:01:39,539
transactions and since that could be the
 

2633
01:01:39,539 --> 01:01:42,109
transactions and since that could be the
case for all B knows in this region of

2634
01:01:42,109 --> 01:01:42,119
case for all B knows in this region of
 

2635
01:01:42,119 --> 01:01:44,480
case for all B knows in this region of
the protocol B cannot unilaterally

2636
01:01:44,480 --> 01:01:44,490
the protocol B cannot unilaterally
 

2637
01:01:44,490 --> 01:01:47,029
the protocol B cannot unilaterally
decide to abort at the times out it must

2638
01:01:47,029 --> 01:01:47,039
decide to abort at the times out it must
 

2639
01:01:47,039 --> 01:01:49,940
decide to abort at the times out it must
wait indefinitely to hear from the

2640
01:01:49,940 --> 01:01:49,950
wait indefinitely to hear from the
 

2641
01:01:49,950 --> 01:01:51,650
wait indefinitely to hear from the
transaction coordinator as long as it

2642
01:01:51,650 --> 01:01:51,660
transaction coordinator as long as it
 

2643
01:01:51,660 --> 01:01:54,410
transaction coordinator as long as it
takes some human may have to come and

2644
01:01:54,410 --> 01:01:54,420
takes some human may have to come and
 

2645
01:01:54,420 --> 01:01:56,390
takes some human may have to come and
repair the transaction coordinator and

2646
01:01:56,390 --> 01:01:56,400
repair the transaction coordinator and
 

2647
01:01:56,400 --> 01:01:57,920
repair the transaction coordinator and
finally get it started again and have it

2648
01:01:57,920 --> 01:01:57,930
finally get it started again and have it
 

2649
01:01:57,930 --> 01:02:00,680
finally get it started again and have it
read this log and see oh yes you

2650
01:02:00,680 --> 01:02:00,690
read this log and see oh yes you
 

2651
01:02:00,690 --> 01:02:02,390
read this log and see oh yes you
committed that transaction and finally

2652
01:02:02,390 --> 01:02:02,400
committed that transaction and finally
 

2653
01:02:02,400 --> 01:02:13,609
committed that transaction and finally
send long delayed commit messages so and

2654
01:02:13,609 --> 01:02:13,619
send long delayed commit messages so and
 

2655
01:02:13,619 --> 01:02:23,870
send long delayed commit messages so and
similarly if on a time I you can't you

2656
01:02:23,870 --> 01:02:23,880
similarly if on a time I you can't you
 

2657
01:02:23,880 --> 01:02:25,910
similarly if on a time I you can't you
can't unilaterally abort it turns out

2658
01:02:25,910 --> 01:02:25,920
can't unilaterally abort it turns out
 

2659
01:02:25,920 --> 01:02:27,380
can't unilaterally abort it turns out
you can't unilaterally commit either

2660
01:02:27,380 --> 01:02:27,390
you can't unilaterally commit either
 

2661
01:02:27,390 --> 01:02:29,839
you can't unilaterally commit either
because for all B knows a might have

2662
01:02:29,839 --> 01:02:29,849
because for all B knows a might have
 

2663
01:02:29,849 --> 01:02:31,789
because for all B knows a might have
voted no but he just hasn't got the

2664
01:02:31,789 --> 01:02:31,799
voted no but he just hasn't got the
 

2665
01:02:31,799 --> 01:02:33,529
voted no but he just hasn't got the
important message yet so you could in

2666
01:02:33,529 --> 01:02:33,539
important message yet so you could in
 

2667
01:02:33,539 --> 01:02:35,930
important message yet so you could in
this region you can either abort nor

2668
01:02:35,930 --> 01:02:35,940
this region you can either abort nor
 

2669
01:02:35,940 --> 01:02:36,880
this region you can either abort nor
commit

2670
01:02:36,880 --> 01:02:36,890
commit
 

2671
01:02:36,890 --> 01:02:43,990
commit
on a timeout and so this actually this

2672
01:02:43,990 --> 01:02:44,000
on a timeout and so this actually this
 

2673
01:02:44,000 --> 01:02:47,860
on a timeout and so this actually this
this blocking behavior is sort of

2674
01:02:47,860 --> 01:02:47,870
this blocking behavior is sort of
 

2675
01:02:47,870 --> 01:02:51,060
this blocking behavior is sort of
critical property of two-phase commit

2676
01:02:51,060 --> 01:02:51,070
critical property of two-phase commit
 

2677
01:02:51,070 --> 01:02:53,800
critical property of two-phase commit
and it's not a happy property

2678
01:02:53,800 --> 01:02:53,810
and it's not a happy property
 

2679
01:02:53,810 --> 01:02:56,770
and it's not a happy property
it means if things go wrong you can

2680
01:02:56,770 --> 01:02:56,780
it means if things go wrong you can
 

2681
01:02:56,780 --> 01:02:58,060
it means if things go wrong you can
easily be in the situation where you

2682
01:02:58,060 --> 01:02:58,070
easily be in the situation where you
 

2683
01:02:58,070 --> 01:02:59,560
easily be in the situation where you
have to wait for a long time with locks

2684
01:02:59,560 --> 01:02:59,570
have to wait for a long time with locks
 

2685
01:02:59,570 --> 01:03:01,930
have to wait for a long time with locks
held and holding up other transactions

2686
01:03:01,930 --> 01:03:01,940
held and holding up other transactions
 

2687
01:03:01,940 --> 01:03:05,410
held and holding up other transactions
and so among other things people try

2688
01:03:05,410 --> 01:03:05,420
and so among other things people try
 

2689
01:03:05,420 --> 01:03:08,170
and so among other things people try
really hard to make this part of

2690
01:03:08,170 --> 01:03:08,180
really hard to make this part of
 

2691
01:03:08,180 --> 01:03:10,720
really hard to make this part of
two-phase commit acts as fast as humanly

2692
01:03:10,720 --> 01:03:10,730
two-phase commit acts as fast as humanly
 

2693
01:03:10,730 --> 01:03:13,510
two-phase commit acts as fast as humanly
possible so that the window of time in

2694
01:03:13,510 --> 01:03:13,520
possible so that the window of time in
 

2695
01:03:13,520 --> 01:03:17,050
possible so that the window of time in
which a failure might cause you to block

2696
01:03:17,050 --> 01:03:17,060
which a failure might cause you to block
 

2697
01:03:17,060 --> 01:03:20,500
which a failure might cause you to block
with locks held for a long time is as

2698
01:03:20,500 --> 01:03:20,510
with locks held for a long time is as
 

2699
01:03:20,510 --> 01:03:22,030
with locks held for a long time is as
small as possible so they try to make

2700
01:03:22,030 --> 01:03:22,040
small as possible so they try to make
 

2701
01:03:22,040 --> 01:03:23,290
small as possible so they try to make
this part of the protocol very

2702
01:03:23,290 --> 01:03:23,300
this part of the protocol very
 

2703
01:03:23,300 --> 01:03:26,260
this part of the protocol very
lightweight or even have variants of the

2704
01:03:26,260 --> 01:03:26,270
lightweight or even have variants of the
 

2705
01:03:26,270 --> 01:03:27,940
lightweight or even have variants of the
protocols that for certain special cases

2706
01:03:27,940 --> 01:03:27,950
protocols that for certain special cases
 

2707
01:03:27,950 --> 01:03:33,580
protocols that for certain special cases
may not have to wait at all okay so

2708
01:03:33,580 --> 01:03:33,590
may not have to wait at all okay so
 

2709
01:03:33,590 --> 01:03:37,420
may not have to wait at all okay so
that's the basic protocol one thing to

2710
01:03:37,420 --> 01:03:37,430
that's the basic protocol one thing to
 

2711
01:03:37,430 --> 01:03:41,350
that's the basic protocol one thing to
notice about this that is a fundamental

2712
01:03:41,350 --> 01:03:41,360
notice about this that is a fundamental
 

2713
01:03:41,360 --> 01:03:44,050
notice about this that is a fundamental
part of why we're able to get to

2714
01:03:44,050 --> 01:03:44,060
part of why we're able to get to
 

2715
01:03:44,060 --> 01:03:46,810
part of why we're able to get to
actually build a protocol that allows a

2716
01:03:46,810 --> 01:03:46,820
actually build a protocol that allows a
 

2717
01:03:46,820 --> 01:03:49,660
actually build a protocol that allows a
and B to sort of both you know they both

2718
01:03:49,660 --> 01:03:49,670
and B to sort of both you know they both
 

2719
01:03:49,670 --> 01:03:53,050
and B to sort of both you know they both
commit or they both have or abort one

2720
01:03:53,050 --> 01:03:53,060
commit or they both have or abort one
 

2721
01:03:53,060 --> 01:03:54,760
commit or they both have or abort one
reason for that is that really the

2722
01:03:54,760 --> 01:03:54,770
reason for that is that really the
 

2723
01:03:54,770 --> 01:03:56,920
reason for that is that really the
decision is made by a single entity it's

2724
01:03:56,920 --> 01:03:56,930
decision is made by a single entity it's
 

2725
01:03:56,930 --> 01:03:58,090
decision is made by a single entity it's
made by the transaction coordinator

2726
01:03:58,090 --> 01:03:58,100
made by the transaction coordinator
 

2727
01:03:58,100 --> 01:04:01,630
made by the transaction coordinator
alone a and B are neither of them you

2728
01:04:01,630 --> 01:04:01,640
alone a and B are neither of them you
 

2729
01:04:01,640 --> 01:04:05,140
alone a and B are neither of them you
know except that they vote no neither a

2730
01:04:05,140 --> 01:04:05,150
know except that they vote no neither a
 

2731
01:04:05,150 --> 01:04:09,400
know except that they vote no neither a
nor B is deciding whether to commit or

2732
01:04:09,400 --> 01:04:09,410
nor B is deciding whether to commit or
 

2733
01:04:09,410 --> 01:04:11,890
nor B is deciding whether to commit or
not and they certainly are not engaged

2734
01:04:11,890 --> 01:04:11,900
not and they certainly are not engaged
 

2735
01:04:11,900 --> 01:04:13,630
not and they certainly are not engaged
in a conversation with each other to try

2736
01:04:13,630 --> 01:04:13,640
in a conversation with each other to try
 

2737
01:04:13,640 --> 01:04:15,490
in a conversation with each other to try
to reach agreement about what is the

2738
01:04:15,490 --> 01:04:15,500
to reach agreement about what is the
 

2739
01:04:15,500 --> 01:04:17,080
to reach agreement about what is the
other thinking or they thinking commit

2740
01:04:17,080 --> 01:04:17,090
other thinking or they thinking commit
 

2741
01:04:17,090 --> 01:04:19,750
other thinking or they thinking commit
may be all commit to instead we have

2742
01:04:19,750 --> 01:04:19,760
may be all commit to instead we have
 

2743
01:04:19,760 --> 01:04:22,630
may be all commit to instead we have
this much is quite sort of fundamentally

2744
01:04:22,630 --> 01:04:22,640
this much is quite sort of fundamentally
 

2745
01:04:22,640 --> 01:04:25,600
this much is quite sort of fundamentally
simple protocol in which only the

2746
01:04:25,600 --> 01:04:25,610
simple protocol in which only the
 

2747
01:04:25,610 --> 01:04:27,040
simple protocol in which only the
transaction coordinator makes the

2748
01:04:27,040 --> 01:04:27,050
transaction coordinator makes the
 

2749
01:04:27,050 --> 01:04:29,140
transaction coordinator makes the
decision a single entity and it just

2750
01:04:29,140 --> 01:04:29,150
decision a single entity and it just
 

2751
01:04:29,150 --> 01:04:31,330
decision a single entity and it just
tells the other party here's my decision

2752
01:04:31,330 --> 01:04:31,340
tells the other party here's my decision
 

2753
01:04:31,340 --> 01:04:38,380
tells the other party here's my decision
please go do it the penalty for that for

2754
01:04:38,380 --> 01:04:38,390
please go do it the penalty for that for
 

2755
01:04:38,390 --> 01:04:39,780
please go do it the penalty for that for
having the transaction coordinator

2756
01:04:39,780 --> 01:04:39,790
having the transaction coordinator
 

2757
01:04:39,790 --> 01:04:42,190
having the transaction coordinator
really the single entity make the final

2758
01:04:42,190 --> 01:04:42,200
really the single entity make the final
 

2759
01:04:42,200 --> 01:04:45,310
really the single entity make the final
decision again is the fact that you have

2760
01:04:45,310 --> 01:04:45,320
decision again is the fact that you have
 

2761
01:04:45,320 --> 01:04:46,690
decision again is the fact that you have
to block there's some points in which

2762
01:04:46,690 --> 01:04:46,700
to block there's some points in which
 

2763
01:04:46,700 --> 01:04:47,950
to block there's some points in which
you have to block waiting for the

2764
01:04:47,950 --> 01:04:47,960
you have to block waiting for the
 

2765
01:04:47,960 --> 01:04:49,630
you have to block waiting for the
transaction recording coordinator to

2766
01:04:49,630 --> 01:04:49,640
transaction recording coordinator to
 

2767
01:04:49,640 --> 01:04:50,620
transaction recording coordinator to
tell you what the decision

2768
01:04:50,620 --> 01:04:50,630
tell you what the decision
 

2769
01:04:50,630 --> 01:04:57,999
tell you what the decision
was one further question is that we know

2770
01:04:57,999 --> 01:04:58,009
was one further question is that we know
 

2771
01:04:58,009 --> 01:04:59,319
was one further question is that we know
the transaction coordinator must

2772
01:04:59,319 --> 01:04:59,329
the transaction coordinator must
 

2773
01:04:59,329 --> 01:05:02,049
the transaction coordinator must
remember information about transactions

2774
01:05:02,049 --> 01:05:02,059
remember information about transactions
 

2775
01:05:02,059 --> 01:05:05,440
remember information about transactions
and its log in case it crashes and so

2776
01:05:05,440 --> 01:05:05,450
and its log in case it crashes and so
 

2777
01:05:05,450 --> 01:05:06,880
and its log in case it crashes and so
one question is when the transaction

2778
01:05:06,880 --> 01:05:06,890
one question is when the transaction
 

2779
01:05:06,890 --> 01:05:10,029
one question is when the transaction
coordinator can forget about information

2780
01:05:10,029 --> 01:05:10,039
coordinator can forget about information
 

2781
01:05:10,039 --> 01:05:11,769
coordinator can forget about information
in its log about transactions and the

2782
01:05:11,769 --> 01:05:11,779
in its log about transactions and the
 

2783
01:05:11,779 --> 01:05:14,019
in its log about transactions and the
answer to that is that if it manages to

2784
01:05:14,019 --> 01:05:14,029
answer to that is that if it manages to
 

2785
01:05:14,029 --> 01:05:16,390
answer to that is that if it manages to
get a full set of acknowledgments from

2786
01:05:16,390 --> 01:05:16,400
get a full set of acknowledgments from
 

2787
01:05:16,400 --> 01:05:18,549
get a full set of acknowledgments from
the participants then it knows that all

2788
01:05:18,549 --> 01:05:18,559
the participants then it knows that all
 

2789
01:05:18,559 --> 01:05:19,960
the participants then it knows that all
the participants know that that

2790
01:05:19,960 --> 01:05:19,970
the participants know that that
 

2791
01:05:19,970 --> 01:05:22,240
the participants know that that
transaction committed or aborted that

2792
01:05:22,240 --> 01:05:22,250
transaction committed or aborted that
 

2793
01:05:22,250 --> 01:05:24,249
transaction committed or aborted that
all the transactions no participants

2794
01:05:24,249 --> 01:05:24,259
all the transactions no participants
 

2795
01:05:24,259 --> 01:05:25,809
all the transactions no participants
knew the fate of that transaction and

2796
01:05:25,809 --> 01:05:25,819
knew the fate of that transaction and
 

2797
01:05:25,819 --> 01:05:27,549
knew the fate of that transaction and
have done their part in it and will

2798
01:05:27,549 --> 01:05:27,559
have done their part in it and will
 

2799
01:05:27,559 --> 01:05:29,049
have done their part in it and will
never need to know that information

2800
01:05:29,049 --> 01:05:29,059
never need to know that information
 

2801
01:05:29,059 --> 01:05:31,150
never need to know that information
right as they both acknowledged it so

2802
01:05:31,150 --> 01:05:31,160
right as they both acknowledged it so
 

2803
01:05:31,160 --> 01:05:33,339
right as they both acknowledged it so
when the transaction coordinator gets

2804
01:05:33,339 --> 01:05:33,349
when the transaction coordinator gets
 

2805
01:05:33,349 --> 01:05:35,140
when the transaction coordinator gets
acknowledgements it can erase all

2806
01:05:35,140 --> 01:05:35,150
acknowledgements it can erase all
 

2807
01:05:35,150 --> 01:05:39,509
acknowledgements it can erase all
information all memory the transaction

2808
01:05:39,509 --> 01:05:39,519

 

2809
01:05:39,519 --> 01:05:42,069

similarly participants once they

2810
01:05:42,069 --> 01:05:42,079
similarly participants once they
 

2811
01:05:42,079 --> 01:05:44,289
similarly participants once they
received a commit or abort message and

2812
01:05:44,289 --> 01:05:44,299
received a commit or abort message and
 

2813
01:05:44,299 --> 01:05:46,150
received a commit or abort message and
done their part of the transaction and

2814
01:05:46,150 --> 01:05:46,160
done their part of the transaction and
 

2815
01:05:46,160 --> 01:05:48,039
done their part of the transaction and
made their updates permanent and

2816
01:05:48,039 --> 01:05:48,049
made their updates permanent and
 

2817
01:05:48,049 --> 01:05:50,319
made their updates permanent and
released their locks at that point the

2818
01:05:50,319 --> 01:05:50,329
released their locks at that point the
 

2819
01:05:50,329 --> 01:05:53,170
released their locks at that point the
participants also can completely forget

2820
01:05:53,170 --> 01:05:53,180
participants also can completely forget
 

2821
01:05:53,180 --> 01:05:57,579
participants also can completely forget
about that transaction after they send

2822
01:05:57,579 --> 01:05:57,589
about that transaction after they send
 

2823
01:05:57,589 --> 01:05:59,130
about that transaction after they send
their acknowledgment back to the

2824
01:05:59,130 --> 01:05:59,140
their acknowledgment back to the
 

2825
01:05:59,140 --> 01:06:01,870
their acknowledgment back to the
transaction coordinator now of course

2826
01:06:01,870 --> 01:06:01,880
transaction coordinator now of course
 

2827
01:06:01,880 --> 01:06:03,940
transaction coordinator now of course
the transaction coordinator may not get

2828
01:06:03,940 --> 01:06:03,950
the transaction coordinator may not get
 

2829
01:06:03,950 --> 01:06:05,589
the transaction coordinator may not get
their acknowledgement and may send and

2830
01:06:05,589 --> 01:06:05,599
their acknowledgement and may send and
 

2831
01:06:05,599 --> 01:06:07,809
their acknowledgement and may send and
may therefore decide to resend the

2832
01:06:07,809 --> 01:06:07,819
may therefore decide to resend the
 

2833
01:06:07,819 --> 01:06:09,339
may therefore decide to resend the
commit message on the theory that maybe

2834
01:06:09,339 --> 01:06:09,349
commit message on the theory that maybe
 

2835
01:06:09,349 --> 01:06:11,559
commit message on the theory that maybe
it was lost and in that case a

2836
01:06:11,559 --> 01:06:11,569
it was lost and in that case a
 

2837
01:06:11,569 --> 01:06:13,029
it was lost and in that case a
participant if it receives a commit

2838
01:06:13,029 --> 01:06:13,039
participant if it receives a commit
 

2839
01:06:13,039 --> 01:06:14,950
participant if it receives a commit
message for a transaction which it know

2840
01:06:14,950 --> 01:06:14,960
message for a transaction which it know
 

2841
01:06:14,960 --> 01:06:16,930
message for a transaction which it know
nothing about because it's forgotten

2842
01:06:16,930 --> 01:06:16,940
nothing about because it's forgotten
 

2843
01:06:16,940 --> 01:06:21,400
nothing about because it's forgotten
about it then the participant can just

2844
01:06:21,400 --> 01:06:21,410
about it then the participant can just
 

2845
01:06:21,410 --> 01:06:22,690
about it then the participant can just
send another acknowledgement back

2846
01:06:22,690 --> 01:06:22,700
send another acknowledgement back
 

2847
01:06:22,700 --> 01:06:25,690
send another acknowledgement back
because it knows that it gets a commit

2848
01:06:25,690 --> 01:06:25,700
because it knows that it gets a commit
 

2849
01:06:25,700 --> 01:06:27,220
because it knows that it gets a commit
message for an unknown transaction it

2850
01:06:27,220 --> 01:06:27,230
message for an unknown transaction it
 

2851
01:06:27,230 --> 01:06:28,569
message for an unknown transaction it
must be because it had forgotten about

2852
01:06:28,569 --> 01:06:28,579
must be because it had forgotten about
 

2853
01:06:28,579 --> 01:06:30,309
must be because it had forgotten about
it because it already knew whether it

2854
01:06:30,309 --> 01:06:30,319
it because it already knew whether it
 

2855
01:06:30,319 --> 01:06:37,749
it because it already knew whether it
committed or aborted okay so that's

2856
01:06:37,749 --> 01:06:37,759
committed or aborted okay so that's
 

2857
01:06:37,759 --> 01:06:41,789
committed or aborted okay so that's
two-phase commit for atomic commitment

2858
01:06:41,789 --> 01:06:41,799
two-phase commit for atomic commitment
 

2859
01:06:41,799 --> 01:06:44,440
two-phase commit for atomic commitment
for a little perspective two-phase

2860
01:06:44,440 --> 01:06:44,450
for a little perspective two-phase
 

2861
01:06:44,450 --> 01:06:47,950
for a little perspective two-phase
commit is used in a lot of sharded

2862
01:06:47,950 --> 01:06:47,960
commit is used in a lot of sharded
 

2863
01:06:47,960 --> 01:06:50,529
commit is used in a lot of sharded
databases that have split up their data

2864
01:06:50,529 --> 01:06:50,539
databases that have split up their data
 

2865
01:06:50,539 --> 01:06:54,039
databases that have split up their data
among multiple servers and it's used

2866
01:06:54,039 --> 01:06:54,049
among multiple servers and it's used
 

2867
01:06:54,049 --> 01:06:58,509
among multiple servers and it's used
specifically in databases or storage

2868
01:06:58,509 --> 01:06:58,519
specifically in databases or storage
 

2869
01:06:58,519 --> 01:07:00,299
specifically in databases or storage
systems that need to support

2870
01:07:00,299 --> 01:07:00,309
systems that need to support
 

2871
01:07:00,309 --> 01:07:03,309
systems that need to support
transactions in which records in which

2872
01:07:03,309 --> 01:07:03,319
transactions in which records in which
 

2873
01:07:03,319 --> 01:07:03,960
transactions in which records in which
multiple

2874
01:07:03,960 --> 01:07:03,970
multiple
 

2875
01:07:03,970 --> 01:07:06,300
multiple
records may be read or written there's a

2876
01:07:06,300 --> 01:07:06,310
records may be read or written there's a
 

2877
01:07:06,310 --> 01:07:09,000
records may be read or written there's a
lot of some more specialized storage

2878
01:07:09,000 --> 01:07:09,010
lot of some more specialized storage
 

2879
01:07:09,010 --> 01:07:12,630
lot of some more specialized storage
systems that don't allow you to have

2880
01:07:12,630 --> 01:07:12,640
systems that don't allow you to have
 

2881
01:07:12,640 --> 01:07:15,359
systems that don't allow you to have
transactions on multiple records and for

2882
01:07:15,359 --> 01:07:15,369
transactions on multiple records and for
 

2883
01:07:15,369 --> 01:07:17,130
transactions on multiple records and for
them you don't need it you no need this

2884
01:07:17,130 --> 01:07:17,140
them you don't need it you no need this
 

2885
01:07:17,140 --> 01:07:18,750
them you don't need it you no need this
kind of you don't need two-phase commit

2886
01:07:18,750 --> 01:07:18,760
kind of you don't need two-phase commit
 

2887
01:07:18,760 --> 01:07:21,990
kind of you don't need two-phase commit
if the storage system doesn't allow

2888
01:07:21,990 --> 01:07:22,000
if the storage system doesn't allow
 

2889
01:07:22,000 --> 01:07:24,599
if the storage system doesn't allow
multi record transactions but if you

2890
01:07:24,599 --> 01:07:24,609
multi record transactions but if you
 

2891
01:07:24,609 --> 01:07:26,310
multi record transactions but if you
have multi record transactions and you

2892
01:07:26,310 --> 01:07:26,320
have multi record transactions and you
 

2893
01:07:26,320 --> 01:07:27,990
have multi record transactions and you
shard the data across multiple servers

2894
01:07:27,990 --> 01:07:28,000
shard the data across multiple servers
 

2895
01:07:28,000 --> 01:07:30,150
shard the data across multiple servers
then you need to support either

2896
01:07:30,150 --> 01:07:30,160
then you need to support either
 

2897
01:07:30,160 --> 01:07:31,589
then you need to support either
toothpaste you need to support two in

2898
01:07:31,589 --> 01:07:31,599
toothpaste you need to support two in
 

2899
01:07:31,599 --> 01:07:34,230
toothpaste you need to support two in
pace commit if you want to get asset

2900
01:07:34,230 --> 01:07:34,240
pace commit if you want to get asset
 

2901
01:07:34,240 --> 01:07:36,140
pace commit if you want to get asset
transactions

2902
01:07:36,140 --> 01:07:36,150
transactions
 

2903
01:07:36,150 --> 01:07:39,120
transactions
however two-phase commit has an evil

2904
01:07:39,120 --> 01:07:39,130
however two-phase commit has an evil
 

2905
01:07:39,130 --> 01:07:43,859
however two-phase commit has an evil
reputation one reason is it's slow due

2906
01:07:43,859 --> 01:07:43,869
reputation one reason is it's slow due
 

2907
01:07:43,869 --> 01:07:45,480
reputation one reason is it's slow due
to multiple rounds of messages there's a

2908
01:07:45,480 --> 01:07:45,490
to multiple rounds of messages there's a
 

2909
01:07:45,490 --> 01:07:48,260
to multiple rounds of messages there's a
lot of chitchat here in order to get a

2910
01:07:48,260 --> 01:07:48,270
lot of chitchat here in order to get a
 

2911
01:07:48,270 --> 01:07:50,550
lot of chitchat here in order to get a
transaction that involves multiple

2912
01:07:50,550 --> 01:07:50,560
transaction that involves multiple
 

2913
01:07:50,560 --> 01:07:53,609
transaction that involves multiple
participants to finish theirs in

2914
01:07:53,609 --> 01:07:53,619
participants to finish theirs in
 

2915
01:07:53,619 --> 01:07:55,290
participants to finish theirs in
addition a lot of disk writes both a and

2916
01:07:55,290 --> 01:07:55,300
addition a lot of disk writes both a and
 

2917
01:07:55,300 --> 01:07:58,380
addition a lot of disk writes both a and
B have to not just write data to their

2918
01:07:58,380 --> 01:07:58,390
B have to not just write data to their
 

2919
01:07:58,390 --> 01:08:01,109
B have to not just write data to their
disk between the prepare and the sending

2920
01:08:01,109 --> 01:08:01,119
disk between the prepare and the sending
 

2921
01:08:01,119 --> 01:08:02,609
disk between the prepare and the sending
of the yes they have to wait for that

2922
01:08:02,609 --> 01:08:02,619
of the yes they have to wait for that
 

2923
01:08:02,619 --> 01:08:04,830
of the yes they have to wait for that
disk rate to finish so certainly if

2924
01:08:04,830 --> 01:08:04,840
disk rate to finish so certainly if
 

2925
01:08:04,840 --> 01:08:06,390
disk rate to finish so certainly if
you're using a mechanical Drive that

2926
01:08:06,390 --> 01:08:06,400
you're using a mechanical Drive that
 

2927
01:08:06,400 --> 01:08:09,120
you're using a mechanical Drive that
takes 10 milliseconds to append to the

2928
01:08:09,120 --> 01:08:09,130
takes 10 milliseconds to append to the
 

2929
01:08:09,130 --> 01:08:11,670
takes 10 milliseconds to append to the
log that puts a real serious limit on

2930
01:08:11,670 --> 01:08:11,680
log that puts a real serious limit on
 

2931
01:08:11,680 --> 01:08:14,490
log that puts a real serious limit on
how fast participants can process

2932
01:08:14,490 --> 01:08:14,500
how fast participants can process
 

2933
01:08:14,500 --> 01:08:16,620
how fast participants can process
transactions you know 10 milliseconds a

2934
01:08:16,620 --> 01:08:16,630
transactions you know 10 milliseconds a
 

2935
01:08:16,630 --> 01:08:19,709
transactions you know 10 milliseconds a
pop means no without some cleverness

2936
01:08:19,709 --> 01:08:19,719
pop means no without some cleverness
 

2937
01:08:19,719 --> 01:08:21,420
pop means no without some cleverness
you're limited to 100 transactions per

2938
01:08:21,420 --> 01:08:21,430
you're limited to 100 transactions per
 

2939
01:08:21,430 --> 01:08:23,849
you're limited to 100 transactions per
second which is pretty slow and in

2940
01:08:23,849 --> 01:08:23,859
second which is pretty slow and in
 

2941
01:08:23,859 --> 01:08:25,140
second which is pretty slow and in
addition the transaction coordinator

2942
01:08:25,140 --> 01:08:25,150
addition the transaction coordinator
 

2943
01:08:25,150 --> 01:08:28,800
addition the transaction coordinator
also has a point in which it must after

2944
01:08:28,800 --> 01:08:28,810
also has a point in which it must after
 

2945
01:08:28,810 --> 01:08:30,959
also has a point in which it must after
it receives the last yes they must first

2946
01:08:30,959 --> 01:08:30,969
it receives the last yes they must first
 

2947
01:08:30,969 --> 01:08:33,420
it receives the last yes they must first
write to its log make sure the data is

2948
01:08:33,420 --> 01:08:33,430
write to its log make sure the data is
 

2949
01:08:33,430 --> 01:08:35,789
write to its log make sure the data is
safe on disk and only then is that

2950
01:08:35,789 --> 01:08:35,799
safe on disk and only then is that
 

2951
01:08:35,799 --> 01:08:38,430
safe on disk and only then is that
allowed to send that commit messages and

2952
01:08:38,430 --> 01:08:38,440
allowed to send that commit messages and
 

2953
01:08:38,440 --> 01:08:41,370
allowed to send that commit messages and
that's another 10 milliseconds and both

2954
01:08:41,370 --> 01:08:41,380
that's another 10 milliseconds and both
 

2955
01:08:41,380 --> 01:08:43,019
that's another 10 milliseconds and both
of these are 10 millisecond periods in

2956
01:08:43,019 --> 01:08:43,029
of these are 10 millisecond periods in
 

2957
01:08:43,029 --> 01:08:45,269
of these are 10 millisecond periods in
which locks are held in the participants

2958
01:08:45,269 --> 01:08:45,279
which locks are held in the participants
 

2959
01:08:45,279 --> 01:08:47,459
which locks are held in the participants
and other transactions are slowed up and

2960
01:08:47,459 --> 01:08:47,469
and other transactions are slowed up and
 

2961
01:08:47,469 --> 01:08:48,780
and other transactions are slowed up and
I keep mentioning that but it's very

2962
01:08:48,780 --> 01:08:48,790
I keep mentioning that but it's very
 

2963
01:08:48,790 --> 01:08:51,300
I keep mentioning that but it's very
important because in a busy transaction

2964
01:08:51,300 --> 01:08:51,310
important because in a busy transaction
 

2965
01:08:51,310 --> 01:08:53,010
important because in a busy transaction
processing system there's lots and lots

2966
01:08:53,010 --> 01:08:53,020
processing system there's lots and lots
 

2967
01:08:53,020 --> 01:08:55,860
processing system there's lots and lots
of transactions and many of them may be

2968
01:08:55,860 --> 01:08:55,870
of transactions and many of them may be
 

2969
01:08:55,870 --> 01:08:57,720
of transactions and many of them may be
waiting for the same data and we'd

2970
01:08:57,720 --> 01:08:57,730
waiting for the same data and we'd
 

2971
01:08:57,730 --> 01:09:01,110
waiting for the same data and we'd
really prefer not to hold locks over

2972
01:09:01,110 --> 01:09:01,120
really prefer not to hold locks over
 

2973
01:09:01,120 --> 01:09:02,880
really prefer not to hold locks over
long periods of time in which there's

2974
01:09:02,880 --> 01:09:02,890
long periods of time in which there's
 

2975
01:09:02,890 --> 01:09:04,979
long periods of time in which there's
lots of messages going back and forth

2976
01:09:04,979 --> 01:09:04,989
lots of messages going back and forth
 

2977
01:09:04,989 --> 01:09:06,950
lots of messages going back and forth
then we have to wait for long disgrace

2978
01:09:06,950 --> 01:09:06,960
then we have to wait for long disgrace
 

2979
01:09:06,960 --> 01:09:09,809
then we have to wait for long disgrace
but two-phase commit forces us to do

2980
01:09:09,809 --> 01:09:09,819
but two-phase commit forces us to do
 

2981
01:09:09,819 --> 01:09:13,559
but two-phase commit forces us to do
those weights

2982
01:09:13,559 --> 01:09:13,569

 

2983
01:09:13,569 --> 01:09:16,530

and a further problem with it is that if

2984
01:09:16,530 --> 01:09:16,540
and a further problem with it is that if
 

2985
01:09:16,540 --> 01:09:18,180
and a further problem with it is that if
anything goes wrong messages are lost

2986
01:09:18,180 --> 01:09:18,190
anything goes wrong messages are lost
 

2987
01:09:18,190 --> 01:09:21,660
anything goes wrong messages are lost
something crashes then if you're not if

2988
01:09:21,660 --> 01:09:21,670
something crashes then if you're not if
 

2989
01:09:21,670 --> 01:09:23,550
something crashes then if you're not if
you're a little bit unlucky then the

2990
01:09:23,550 --> 01:09:23,560
you're a little bit unlucky then the
 

2991
01:09:23,560 --> 01:09:25,140
you're a little bit unlucky then the
participants have to wait for long times

2992
01:09:25,140 --> 01:09:25,150
participants have to wait for long times
 

2993
01:09:25,150 --> 01:09:26,609
participants have to wait for long times
with locks held

2994
01:09:26,609 --> 01:09:26,619
with locks held
 

2995
01:09:26,619 --> 01:09:30,390
with locks held
so therefore to face commit you really

2996
01:09:30,390 --> 01:09:30,400
so therefore to face commit you really
 

2997
01:09:30,400 --> 01:09:32,339
so therefore to face commit you really
only see it within relatively small

2998
01:09:32,339 --> 01:09:32,349
only see it within relatively small
 

2999
01:09:32,349 --> 01:09:34,200
only see it within relatively small
domains within a single machine room

3000
01:09:34,200 --> 01:09:34,210
domains within a single machine room
 

3001
01:09:34,210 --> 01:09:36,809
domains within a single machine room
within a single organization you don't

3002
01:09:36,809 --> 01:09:36,819
within a single organization you don't
 

3003
01:09:36,819 --> 01:09:39,660
within a single organization you don't
see it for example did you transfers

3004
01:09:39,660 --> 01:09:39,670
see it for example did you transfers
 

3005
01:09:39,670 --> 01:09:42,209
see it for example did you transfers
between banks between different banks

3006
01:09:42,209 --> 01:09:42,219
between banks between different banks
 

3007
01:09:42,219 --> 01:09:44,390
between banks between different banks
you might possibly see it within a bank

3008
01:09:44,390 --> 01:09:44,400
you might possibly see it within a bank
 

3009
01:09:44,400 --> 01:09:47,339
you might possibly see it within a bank
if it's charted its database but you

3010
01:09:47,339 --> 01:09:47,349
if it's charted its database but you
 

3011
01:09:47,349 --> 01:09:48,930
if it's charted its database but you
would never see two days can it run

3012
01:09:48,930 --> 01:09:48,940
would never see two days can it run
 

3013
01:09:48,940 --> 01:09:51,990
would never see two days can it run
between distinct organizations that were

3014
01:09:51,990 --> 01:09:52,000
between distinct organizations that were
 

3015
01:09:52,000 --> 01:09:53,879
between distinct organizations that were
maybe physically separate because of

3016
01:09:53,879 --> 01:09:53,889
maybe physically separate because of
 

3017
01:09:53,889 --> 01:09:56,310
maybe physically separate because of
this blocking business you don't want to

3018
01:09:56,310 --> 01:09:56,320
this blocking business you don't want to
 

3019
01:09:56,320 --> 01:09:58,890
this blocking business you don't want to
put the fate of you know your database

3020
01:09:58,890 --> 01:09:58,900
put the fate of you know your database
 

3021
01:09:58,900 --> 01:10:00,600
put the fate of you know your database
and whether it's operational in the

3022
01:10:00,600 --> 01:10:00,610
and whether it's operational in the
 

3023
01:10:00,610 --> 01:10:02,970
and whether it's operational in the
hands of some other organization where

3024
01:10:02,970 --> 01:10:02,980
hands of some other organization where
 

3025
01:10:02,980 --> 01:10:04,919
hands of some other organization where
they crash at the wrong time you're

3026
01:10:04,919 --> 01:10:04,929
they crash at the wrong time you're
 

3027
01:10:04,929 --> 01:10:07,379
they crash at the wrong time you're
forced your database was forced to hold

3028
01:10:07,379 --> 01:10:07,389
forced your database was forced to hold
 

3029
01:10:07,389 --> 01:10:12,720
forced your database was forced to hold
locks for a long time and because it's

3030
01:10:12,720 --> 01:10:12,730
locks for a long time and because it's
 

3031
01:10:12,730 --> 01:10:15,450
locks for a long time and because it's
so slow also there's a lot a lot of

3032
01:10:15,450 --> 01:10:15,460
so slow also there's a lot a lot of
 

3033
01:10:15,460 --> 01:10:19,169
so slow also there's a lot a lot of
research has gone into either making it

3034
01:10:19,169 --> 01:10:19,179
research has gone into either making it
 

3035
01:10:19,179 --> 01:10:21,959
research has gone into either making it
fast or relaxing the rules in various

3036
01:10:21,959 --> 01:10:21,969
fast or relaxing the rules in various
 

3037
01:10:21,969 --> 01:10:24,379
fast or relaxing the rules in various
ways to allow to be faster or

3038
01:10:24,379 --> 01:10:24,389
ways to allow to be faster or
 

3039
01:10:24,389 --> 01:10:27,510
ways to allow to be faster or
specializing two-phase commit for very

3040
01:10:27,510 --> 01:10:27,520
specializing two-phase commit for very
 

3041
01:10:27,520 --> 01:10:31,169
specializing two-phase commit for very
specific situations in which you know

3042
01:10:31,169 --> 01:10:31,179
specific situations in which you know
 

3043
01:10:31,179 --> 01:10:33,180
specific situations in which you know
you can shave a message or write to the

3044
01:10:33,180 --> 01:10:33,190
you can shave a message or write to the
 

3045
01:10:33,190 --> 01:10:34,560
you can shave a message or write to the
disk or something off it because you

3046
01:10:34,560 --> 01:10:34,570
disk or something off it because you
 

3047
01:10:34,570 --> 01:10:36,600
disk or something off it because you
know you're only supporting a certain

3048
01:10:36,600 --> 01:10:36,610
know you're only supporting a certain
 

3049
01:10:36,610 --> 01:10:39,060
know you're only supporting a certain
limited kind of transaction so well

3050
01:10:39,060 --> 01:10:39,070
limited kind of transaction so well
 

3051
01:10:39,070 --> 01:10:40,530
limited kind of transaction so well
we'll see fair amount of this and the

3052
01:10:40,530 --> 01:10:40,540
we'll see fair amount of this and the
 

3053
01:10:40,540 --> 01:10:45,689
we'll see fair amount of this and the
rest of the course one question that

3054
01:10:45,689 --> 01:10:45,699
rest of the course one question that
 

3055
01:10:45,699 --> 01:10:51,600
rest of the course one question that
comes up a lot this exchange here where

3056
01:10:51,600 --> 01:10:51,610
comes up a lot this exchange here where
 

3057
01:10:51,610 --> 01:10:53,550
comes up a lot this exchange here where
you have a leader essentially and it

3058
01:10:53,550 --> 01:10:53,560
you have a leader essentially and it
 

3059
01:10:53,560 --> 01:10:56,010
you have a leader essentially and it
sends these messages to the followers

3060
01:10:56,010 --> 01:10:56,020
sends these messages to the followers
 

3061
01:10:56,020 --> 01:11:00,120
sends these messages to the followers
and you know we can only go forward if

3062
01:11:00,120 --> 01:11:00,130
and you know we can only go forward if
 

3063
01:11:00,130 --> 01:11:02,010
and you know we can only go forward if
the leader can only proceed if it

3064
01:11:02,010 --> 01:11:02,020
the leader can only proceed if it
 

3065
01:11:02,020 --> 01:11:04,169
the leader can only proceed if it
receives you know acknowledgments

3066
01:11:04,169 --> 01:11:04,179
receives you know acknowledgments
 

3067
01:11:04,179 --> 01:11:07,740
receives you know acknowledgments
replies from enough of the followers

3068
01:11:07,740 --> 01:11:07,750
replies from enough of the followers
 

3069
01:11:07,750 --> 01:11:11,310
replies from enough of the followers
this looks a lot like raft this

3070
01:11:11,310 --> 01:11:11,320
this looks a lot like raft this
 

3071
01:11:11,320 --> 01:11:13,280
this looks a lot like raft this
construction looks a lot like raft

3072
01:11:13,280 --> 01:11:13,290
construction looks a lot like raft
 

3073
01:11:13,290 --> 01:11:17,040
construction looks a lot like raft
however the properties of the protocol

3074
01:11:17,040 --> 01:11:17,050
however the properties of the protocol
 

3075
01:11:17,050 --> 01:11:18,689
however the properties of the protocol
and what you get out of it turn out to

3076
01:11:18,689 --> 01:11:18,699
and what you get out of it turn out to
 

3077
01:11:18,699 --> 01:11:20,910
and what you get out of it turn out to
be quite different from what we get out

3078
01:11:20,910 --> 01:11:20,920
be quite different from what we get out
 

3079
01:11:20,920 --> 01:11:24,419
be quite different from what we get out
of raft they solve very different

3080
01:11:24,419 --> 01:11:24,429
of raft they solve very different
 

3081
01:11:24,429 --> 01:11:25,629
of raft they solve very different
problems

3082
01:11:25,629 --> 01:11:25,639
problems
 

3083
01:11:25,639 --> 01:11:28,609
problems
so the way to think about it is that you

3084
01:11:28,609 --> 01:11:28,619
so the way to think about it is that you
 

3085
01:11:28,619 --> 01:11:31,459
so the way to think about it is that you
use raft to get high-availability by

3086
01:11:31,459 --> 01:11:31,469
use raft to get high-availability by
 

3087
01:11:31,469 --> 01:11:34,459
use raft to get high-availability by
replicating data on multiple

3088
01:11:34,459 --> 01:11:34,469
replicating data on multiple
 

3089
01:11:34,469 --> 01:11:37,790
replicating data on multiple
participants on multiple peers that is

3090
01:11:37,790 --> 01:11:37,800
participants on multiple peers that is
 

3091
01:11:37,800 --> 01:11:39,410
participants on multiple peers that is
the point of raft is to be able to

3092
01:11:39,410 --> 01:11:39,420
the point of raft is to be able to
 

3093
01:11:39,420 --> 01:11:42,379
the point of raft is to be able to
operate even though some of the server's

3094
01:11:42,379 --> 01:11:42,389
operate even though some of the server's
 

3095
01:11:42,389 --> 01:11:44,180
operate even though some of the server's
involved have crashed or are not

3096
01:11:44,180 --> 01:11:44,190
involved have crashed or are not
 

3097
01:11:44,190 --> 01:11:47,120
involved have crashed or are not
reachable and you can do this in raft

3098
01:11:47,120 --> 01:11:47,130
reachable and you can do this in raft
 

3099
01:11:47,130 --> 01:11:49,040
reachable and you can do this in raft
raft can do this because all the service

3100
01:11:49,040 --> 01:11:49,050
raft can do this because all the service
 

3101
01:11:49,050 --> 01:11:51,620
raft can do this because all the service
are doing the same thing they're doing

3102
01:11:51,620 --> 01:11:51,630
are doing the same thing they're doing
 

3103
01:11:51,630 --> 01:11:53,300
are doing the same thing they're doing
the same thing so we don't need all of

3104
01:11:53,300 --> 01:11:53,310
the same thing so we don't need all of
 

3105
01:11:53,310 --> 01:11:55,910
the same thing so we don't need all of
them to participate we only need a

3106
01:11:55,910 --> 01:11:55,920
them to participate we only need a
 

3107
01:11:55,920 --> 01:12:00,379
them to participate we only need a
majority two-phase commit however the

3108
01:12:00,379 --> 01:12:00,389
majority two-phase commit however the
 

3109
01:12:00,389 --> 01:12:02,629
majority two-phase commit however the
participants are not at all doing the

3110
01:12:02,629 --> 01:12:02,639
participants are not at all doing the
 

3111
01:12:02,639 --> 01:12:04,280
participants are not at all doing the
same thing the participants are each

3112
01:12:04,280 --> 01:12:04,290
same thing the participants are each
 

3113
01:12:04,290 --> 01:12:05,839
same thing the participants are each
doing a different part of the

3114
01:12:05,839 --> 01:12:05,849
doing a different part of the
 

3115
01:12:05,849 --> 01:12:07,669
doing a different part of the
transaction you know a maybe

3116
01:12:07,669 --> 01:12:07,679
transaction you know a maybe
 

3117
01:12:07,679 --> 01:12:10,250
transaction you know a maybe
incrementing record X and B maybe

3118
01:12:10,250 --> 01:12:10,260
incrementing record X and B maybe
 

3119
01:12:10,260 --> 01:12:13,339
incrementing record X and B maybe
decrementing record Y so two-phase

3120
01:12:13,339 --> 01:12:13,349
decrementing record Y so two-phase
 

3121
01:12:13,349 --> 01:12:17,030
decrementing record Y so two-phase
commit all the train all the participant

3122
01:12:17,030 --> 01:12:17,040
commit all the train all the participant
 

3123
01:12:17,040 --> 01:12:20,629
commit all the train all the participant
they all have to do their part in order

3124
01:12:20,629 --> 01:12:20,639
they all have to do their part in order
 

3125
01:12:20,639 --> 01:12:22,910
they all have to do their part in order
for the transaction to finish you really

3126
01:12:22,910 --> 01:12:22,920
for the transaction to finish you really
 

3127
01:12:22,920 --> 01:12:24,470
for the transaction to finish you really
need to wait for every single one of the

3128
01:12:24,470 --> 01:12:24,480
need to wait for every single one of the
 

3129
01:12:24,480 --> 01:12:31,160
need to wait for every single one of the
participants to do their thing so okay

3130
01:12:31,160 --> 01:12:31,170
participants to do their thing so okay
 

3131
01:12:31,170 --> 01:12:34,220
participants to do their thing so okay
so we got you know raft is replicating

3132
01:12:34,220 --> 01:12:34,230
so we got you know raft is replicating
 

3133
01:12:34,230 --> 01:12:35,959
so we got you know raft is replicating
doesn't need everybody to do their thing

3134
01:12:35,959 --> 01:12:35,969
doesn't need everybody to do their thing
 

3135
01:12:35,969 --> 01:12:37,070
doesn't need everybody to do their thing
two-phase commit

3136
01:12:37,070 --> 01:12:37,080
two-phase commit
 

3137
01:12:37,080 --> 01:12:39,260
two-phase commit
everybody's doing something different

3138
01:12:39,260 --> 01:12:39,270
everybody's doing something different
 

3139
01:12:39,270 --> 01:12:42,040
everybody's doing something different
that has to get done two-phase commit

3140
01:12:42,040 --> 01:12:42,050
that has to get done two-phase commit
 

3141
01:12:42,050 --> 01:12:44,780
that has to get done two-phase commit
does not help at all with availability

3142
01:12:44,780 --> 01:12:44,790
does not help at all with availability
 

3143
01:12:44,790 --> 01:12:46,370
does not help at all with availability
you know raft is all about availability

3144
01:12:46,370 --> 01:12:46,380
you know raft is all about availability
 

3145
01:12:46,380 --> 01:12:48,229
you know raft is all about availability
you can go on even if some of the

3146
01:12:48,229 --> 01:12:48,239
you can go on even if some of the
 

3147
01:12:48,239 --> 01:12:50,439
you can go on even if some of the
participants are not responding

3148
01:12:50,439 --> 01:12:50,449
participants are not responding
 

3149
01:12:50,449 --> 01:12:53,990
participants are not responding
two-phase commit is actually not at all

3150
01:12:53,990 --> 01:12:54,000
two-phase commit is actually not at all
 

3151
01:12:54,000 --> 01:12:56,060
two-phase commit is actually not at all
available it's not highly available at

3152
01:12:56,060 --> 01:12:56,070
available it's not highly available at
 

3153
01:12:56,070 --> 01:12:58,339
available it's not highly available at
all if anything goes wrong we risk

3154
01:12:58,339 --> 01:12:58,349
all if anything goes wrong we risk
 

3155
01:12:58,349 --> 01:13:00,379
all if anything goes wrong we risk
having to wait until that's repaired if

3156
01:13:00,379 --> 01:13:00,389
having to wait until that's repaired if
 

3157
01:13:00,389 --> 01:13:02,030
having to wait until that's repaired if
the transaction coordinator crashes at

3158
01:13:02,030 --> 01:13:02,040
the transaction coordinator crashes at
 

3159
01:13:02,040 --> 01:13:03,680
the transaction coordinator crashes at
the wrong time we simply have to wait

3160
01:13:03,680 --> 01:13:03,690
the wrong time we simply have to wait
 

3161
01:13:03,690 --> 01:13:05,570
the wrong time we simply have to wait
for to come up and read its log and send

3162
01:13:05,570 --> 01:13:05,580
for to come up and read its log and send
 

3163
01:13:05,580 --> 01:13:08,149
for to come up and read its log and send
out the commit messages right if if one

3164
01:13:08,149 --> 01:13:08,159
out the commit messages right if if one
 

3165
01:13:08,159 --> 01:13:11,180
out the commit messages right if if one
of these participants you know crashes

3166
01:13:11,180 --> 01:13:11,190
of these participants you know crashes
 

3167
01:13:11,190 --> 01:13:12,950
of these participants you know crashes
at the wrong time you know if we're

3168
01:13:12,950 --> 01:13:12,960
at the wrong time you know if we're
 

3169
01:13:12,960 --> 01:13:15,140
at the wrong time you know if we're
lucky we simply have to abort then we're

3170
01:13:15,140 --> 01:13:15,150
lucky we simply have to abort then we're
 

3171
01:13:15,150 --> 01:13:16,820
lucky we simply have to abort then we're
not lucky we have to say did you finish

3172
01:13:16,820 --> 01:13:16,830
not lucky we have to say did you finish
 

3173
01:13:16,830 --> 01:13:19,399
not lucky we have to say did you finish
that did you finish that so two-phase

3174
01:13:19,399 --> 01:13:19,409
that did you finish that so two-phase
 

3175
01:13:19,409 --> 01:13:21,050
that did you finish that so two-phase
commit is not at all about high

3176
01:13:21,050 --> 01:13:21,060
commit is not at all about high
 

3177
01:13:21,060 --> 01:13:23,629
commit is not at all about high
availability in fact it's it's a it's

3178
01:13:23,629 --> 01:13:23,639
availability in fact it's it's a it's
 

3179
01:13:23,639 --> 01:13:25,640
availability in fact it's it's a it's
quite low availability as such things go

3180
01:13:25,640 --> 01:13:25,650
quite low availability as such things go
 

3181
01:13:25,650 --> 01:13:28,810
quite low availability as such things go
any crash can hold up the whole system

3182
01:13:28,810 --> 01:13:28,820
any crash can hold up the whole system
 

3183
01:13:28,820 --> 01:13:33,560
any crash can hold up the whole system
and of course raft doesn't ensure that

3184
01:13:33,560 --> 01:13:33,570
and of course raft doesn't ensure that
 

3185
01:13:33,570 --> 01:13:36,620
and of course raft doesn't ensure that
all the participants do whatever the

3186
01:13:36,620 --> 01:13:36,630
all the participants do whatever the
 

3187
01:13:36,630 --> 01:13:38,180
all the participants do whatever the
operation is it only requires a majority

3188
01:13:38,180 --> 01:13:38,190
operation is it only requires a majority
 

3189
01:13:38,190 --> 01:13:38,990
operation is it only requires a majority
there may be

3190
01:13:38,990 --> 01:13:39,000
there may be
 

3191
01:13:39,000 --> 01:13:40,400
there may be
minority that totally didn't do the

3192
01:13:40,400 --> 01:13:40,410
minority that totally didn't do the
 

3193
01:13:40,410 --> 01:13:42,950
minority that totally didn't do the
operation at all and that's how the fact

3194
01:13:42,950 --> 01:13:42,960
operation at all and that's how the fact
 

3195
01:13:42,960 --> 01:13:44,750
operation at all and that's how the fact
that raft all the participants do the

3196
01:13:44,750 --> 01:13:44,760
that raft all the participants do the
 

3197
01:13:44,760 --> 01:13:46,280
that raft all the participants do the
same thing we don't have to wait for all

3198
01:13:46,280 --> 01:13:46,290
same thing we don't have to wait for all
 

3199
01:13:46,290 --> 01:13:47,960
same thing we don't have to wait for all
of them is why raft gets high

3200
01:13:47,960 --> 01:13:47,970
of them is why raft gets high
 

3201
01:13:47,970 --> 01:13:51,380
of them is why raft gets high
availability so these are quite

3202
01:13:51,380 --> 01:13:51,390
availability so these are quite
 

3203
01:13:51,390 --> 01:13:55,400
availability so these are quite
different protocols um it is however

3204
01:13:55,400 --> 01:13:55,410
different protocols um it is however
 

3205
01:13:55,410 --> 01:13:58,040
different protocols um it is however
possible to to usefully combine them

3206
01:13:58,040 --> 01:13:58,050
possible to to usefully combine them
 

3207
01:13:58,050 --> 01:14:01,700
possible to to usefully combine them
like two-phase commit is you know really

3208
01:14:01,700 --> 01:14:01,710
like two-phase commit is you know really
 

3209
01:14:01,710 --> 01:14:04,220
like two-phase commit is you know really
vulnerable to failures it's correct with

3210
01:14:04,220 --> 01:14:04,230
vulnerable to failures it's correct with
 

3211
01:14:04,230 --> 01:14:06,230
vulnerable to failures it's correct with
failures but it's not available with the

3212
01:14:06,230 --> 01:14:06,240
failures but it's not available with the
 

3213
01:14:06,240 --> 01:14:08,150
failures but it's not available with the
others so the question is could you

3214
01:14:08,150 --> 01:14:08,160
others so the question is could you
 

3215
01:14:08,160 --> 01:14:12,370
others so the question is could you
build some sort of combined system that

3216
01:14:12,370 --> 01:14:12,380
build some sort of combined system that
 

3217
01:14:12,380 --> 01:14:14,840
build some sort of combined system that
has the high availability of RAF to

3218
01:14:14,840 --> 01:14:14,850
has the high availability of RAF to
 

3219
01:14:14,850 --> 01:14:19,070
has the high availability of RAF to
replication but has two phase commits

3220
01:14:19,070 --> 01:14:19,080
replication but has two phase commits
 

3221
01:14:19,080 --> 01:14:21,560
replication but has two phase commits
ability to call as various different

3222
01:14:21,560 --> 01:14:21,570
ability to call as various different
 

3223
01:14:21,570 --> 01:14:23,270
ability to call as various different
parties each to do their part of the

3224
01:14:23,270 --> 01:14:23,280
parties each to do their part of the
 

3225
01:14:23,280 --> 01:14:25,220
parties each to do their part of the
transaction and the construction you

3226
01:14:25,220 --> 01:14:25,230
transaction and the construction you
 

3227
01:14:25,230 --> 01:14:27,590
transaction and the construction you
want actually is to use raft or paxos or

3228
01:14:27,590 --> 01:14:27,600
want actually is to use raft or paxos or
 

3229
01:14:27,600 --> 01:14:31,490
want actually is to use raft or paxos or
some other protocol like that to rep

3230
01:14:31,490 --> 01:14:31,500
some other protocol like that to rep
 

3231
01:14:31,500 --> 01:14:33,830
some other protocol like that to rep
individually replicate each of the

3232
01:14:33,830 --> 01:14:33,840
individually replicate each of the
 

3233
01:14:33,840 --> 01:14:37,160
individually replicate each of the
different parties so then we would for

3234
01:14:37,160 --> 01:14:37,170
different parties so then we would for
 

3235
01:14:37,170 --> 01:14:38,990
different parties so then we would for
this set up we would have like three

3236
01:14:38,990 --> 01:14:39,000
this set up we would have like three
 

3237
01:14:39,000 --> 01:14:41,540
this set up we would have like three
different clusters the transaction

3238
01:14:41,540 --> 01:14:41,550
different clusters the transaction
 

3239
01:14:41,550 --> 01:14:43,190
different clusters the transaction
coordinator would actually be replicated

3240
01:14:43,190 --> 01:14:43,200
coordinator would actually be replicated
 

3241
01:14:43,200 --> 01:14:50,710
coordinator would actually be replicated
service with you know three servers and

3242
01:14:50,710 --> 01:14:50,720
service with you know three servers and
 

3243
01:14:50,720 --> 01:14:53,150
service with you know three servers and
you know we'd run raft on these three

3244
01:14:53,150 --> 01:14:53,160
you know we'd run raft on these three
 

3245
01:14:53,160 --> 01:14:54,560
you know we'd run raft on these three
servers one will be elected as leader

3246
01:14:54,560 --> 01:14:54,570
servers one will be elected as leader
 

3247
01:14:54,570 --> 01:14:56,750
servers one will be elected as leader
they'd have replicated state they'd have

3248
01:14:56,750 --> 01:14:56,760
they'd have replicated state they'd have
 

3249
01:14:56,760 --> 01:14:58,940
they'd have replicated state they'd have
a log that helped them replicate we

3250
01:14:58,940 --> 01:14:58,950
a log that helped them replicate we
 

3251
01:14:58,950 --> 01:15:00,770
a log that helped them replicate we
don't only have to wait for a majority

3252
01:15:00,770 --> 01:15:00,780
don't only have to wait for a majority
 

3253
01:15:00,780 --> 01:15:02,270
don't only have to wait for a majority
the leader we'd only have to have a

3254
01:15:02,270 --> 01:15:02,280
the leader we'd only have to have a
 

3255
01:15:02,280 --> 01:15:04,850
the leader we'd only have to have a
minority of these to be up in order for

3256
01:15:04,850 --> 01:15:04,860
minority of these to be up in order for
 

3257
01:15:04,860 --> 01:15:06,350
minority of these to be up in order for
the transaction coordinator to do its

3258
01:15:06,350 --> 01:15:06,360
the transaction coordinator to do its
 

3259
01:15:06,360 --> 01:15:08,120
the transaction coordinator to do its
work and of course they would all and

3260
01:15:08,120 --> 01:15:08,130
work and of course they would all and
 

3261
01:15:08,130 --> 01:15:10,580
work and of course they would all and
you know sort of execute through the

3262
01:15:10,580 --> 01:15:10,590
you know sort of execute through the
 

3263
01:15:10,590 --> 01:15:12,470
you know sort of execute through the
various stages of the transaction and

3264
01:15:12,470 --> 01:15:12,480
various stages of the transaction and
 

3265
01:15:12,480 --> 01:15:16,670
various stages of the transaction and
the two-phase commit protocol by

3266
01:15:16,670 --> 01:15:16,680
the two-phase commit protocol by
 

3267
01:15:16,680 --> 01:15:19,490
the two-phase commit protocol by
basically by appending relevant records

3268
01:15:19,490 --> 01:15:19,500
basically by appending relevant records
 

3269
01:15:19,500 --> 01:15:21,380
basically by appending relevant records
to their logs and then each of the

3270
01:15:21,380 --> 01:15:21,390
to their logs and then each of the
 

3271
01:15:21,390 --> 01:15:25,070
to their logs and then each of the
participants would also be a cluster of

3272
01:15:25,070 --> 01:15:25,080
participants would also be a cluster of
 

3273
01:15:25,080 --> 01:15:40,910
participants would also be a cluster of
a rep our raft replicated cluster

3274
01:15:40,910 --> 01:15:40,920

 

3275
01:15:40,920 --> 01:15:43,920

so we would end up and they would chain

3276
01:15:43,920 --> 01:15:43,930
so we would end up and they would chain
 

3277
01:15:43,930 --> 01:15:46,920
so we would end up and they would chain
exchange messages back and forth you

3278
01:15:46,920 --> 01:15:46,930
exchange messages back and forth you
 

3279
01:15:46,930 --> 01:15:49,310
exchange messages back and forth you
know we'd send a commit message from the

3280
01:15:49,310 --> 01:15:49,320
know we'd send a commit message from the
 

3281
01:15:49,320 --> 01:15:51,210
know we'd send a commit message from the
replicated transaction coordinator

3282
01:15:51,210 --> 01:15:51,220
replicated transaction coordinator
 

3283
01:15:51,220 --> 01:15:53,850
replicated transaction coordinator
service to the replicated a server and

3284
01:15:53,850 --> 01:15:53,860
service to the replicated a server and
 

3285
01:15:53,860 --> 01:15:57,990
service to the replicated a server and
the replicated B server and this is you

3286
01:15:57,990 --> 01:15:58,000
the replicated B server and this is you
 

3287
01:15:58,000 --> 01:15:59,130
the replicated B server and this is you
know this is admittedly somewhat

3288
01:15:59,130 --> 01:15:59,140
know this is admittedly somewhat
 

3289
01:15:59,140 --> 01:16:01,680
know this is admittedly somewhat
elaborate but it does show you that you

3290
01:16:01,680 --> 01:16:01,690
elaborate but it does show you that you
 

3291
01:16:01,690 --> 01:16:03,570
elaborate but it does show you that you
can combine these ideas to get the

3292
01:16:03,570 --> 01:16:03,580
can combine these ideas to get the
 

3293
01:16:03,580 --> 01:16:05,730
can combine these ideas to get the
combination of high availability because

3294
01:16:05,730 --> 01:16:05,740
combination of high availability because
 

3295
01:16:05,740 --> 01:16:07,650
combination of high availability because
any one of these servers can crash and

3296
01:16:07,650 --> 01:16:07,660
any one of these servers can crash and
 

3297
01:16:07,660 --> 01:16:09,870
any one of these servers can crash and
the remaining two you keep operating

3298
01:16:09,870 --> 01:16:09,880
the remaining two you keep operating
 

3299
01:16:09,880 --> 01:16:12,630
the remaining two you keep operating
plus we get on this atomic commitment of

3300
01:16:12,630 --> 01:16:12,640
plus we get on this atomic commitment of
 

3301
01:16:12,640 --> 01:16:14,940
plus we get on this atomic commitment of
a and B are doing complete different

3302
01:16:14,940 --> 01:16:14,950
a and B are doing complete different
 

3303
01:16:14,950 --> 01:16:17,130
a and B are doing complete different
parts of the same transaction and we can

3304
01:16:17,130 --> 01:16:17,140
parts of the same transaction and we can
 

3305
01:16:17,140 --> 01:16:19,200
parts of the same transaction and we can
use two-phase commit to have the

3306
01:16:19,200 --> 01:16:19,210
use two-phase commit to have the
 

3307
01:16:19,210 --> 01:16:21,120
use two-phase commit to have the
transaction coordinator ensure that you

3308
01:16:21,120 --> 01:16:21,130
transaction coordinator ensure that you
 

3309
01:16:21,130 --> 01:16:22,590
transaction coordinator ensure that you
know that either both commit the whole

3310
01:16:22,590 --> 01:16:22,600
know that either both commit the whole
 

3311
01:16:22,600 --> 01:16:25,050
know that either both commit the whole
thing or they both abort their parts of

3312
01:16:25,050 --> 01:16:25,060
thing or they both abort their parts of
 

3313
01:16:25,060 --> 01:16:30,240
thing or they both abort their parts of
the transaction you'll actually build

3314
01:16:30,240 --> 01:16:30,250
the transaction you'll actually build
 

3315
01:16:30,250 --> 01:16:33,360
the transaction you'll actually build
something very much like this as part of

3316
01:16:33,360 --> 01:16:33,370
something very much like this as part of
 

3317
01:16:33,370 --> 01:16:35,130
something very much like this as part of
lab form which you will indeed build a

3318
01:16:35,130 --> 01:16:35,140
lab form which you will indeed build a
 

3319
01:16:35,140 --> 01:16:37,290
lab form which you will indeed build a
shard a database where each shard is

3320
01:16:37,290 --> 01:16:37,300
shard a database where each shard is
 

3321
01:16:37,300 --> 01:16:40,320
shard a database where each shard is
replicated in this form and there's a

3322
01:16:40,320 --> 01:16:40,330
replicated in this form and there's a
 

3323
01:16:40,330 --> 01:16:42,330
replicated in this form and there's a
basically a configuration manager which

3324
01:16:42,330 --> 01:16:42,340
basically a configuration manager which
 

3325
01:16:42,340 --> 01:16:45,930
basically a configuration manager which
will allow essentially transactional

3326
01:16:45,930 --> 01:16:45,940
will allow essentially transactional
 

3327
01:16:45,940 --> 01:16:48,810
will allow essentially transactional
shifting of chunks of shards of data

3328
01:16:48,810 --> 01:16:48,820
shifting of chunks of shards of data
 

3329
01:16:48,820 --> 01:16:52,350
shifting of chunks of shards of data
from one raft cluster to another under

3330
01:16:52,350 --> 01:16:52,360
from one raft cluster to another under
 

3331
01:16:52,360 --> 01:16:55,650
from one raft cluster to another under
the control of something that looks a

3332
01:16:55,650 --> 01:16:55,660
the control of something that looks a
 

3333
01:16:55,660 --> 01:17:00,120
the control of something that looks a
lot like a transaction coordinator so

3334
01:17:00,120 --> 01:17:00,130
lot like a transaction coordinator so
 

3335
01:17:00,130 --> 01:17:05,910
lot like a transaction coordinator so
lab 4 is like this and in addition in a

3336
01:17:05,910 --> 01:17:05,920
lab 4 is like this and in addition in a
 

3337
01:17:05,920 --> 01:17:07,110
lab 4 is like this and in addition in a
little bit we'll be reading a paper

3338
01:17:07,110 --> 01:17:07,120
little bit we'll be reading a paper
 

3339
01:17:07,120 --> 01:17:08,670
little bit we'll be reading a paper
called spanner which describes a

3340
01:17:08,670 --> 01:17:08,680
called spanner which describes a
 

3341
01:17:08,680 --> 01:17:11,270
called spanner which describes a
real-life database used by Google that

3342
01:17:11,270 --> 01:17:11,280
real-life database used by Google that
 

3343
01:17:11,280 --> 01:17:14,010
real-life database used by Google that
users also uses this construction in

3344
01:17:14,010 --> 01:17:14,020
users also uses this construction in
 

3345
01:17:14,020 --> 01:17:16,890
users also uses this construction in
order to do transactional writes to a

3346
01:17:16,890 --> 01:17:16,900
order to do transactional writes to a
 

3347
01:17:16,900 --> 01:17:21,690
order to do transactional writes to a
database all right thank you

