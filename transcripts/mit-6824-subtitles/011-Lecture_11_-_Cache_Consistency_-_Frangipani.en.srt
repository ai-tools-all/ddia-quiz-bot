1
00:00:00,900 --> 00:00:04,110

today the paper I'm going to discuss

2
00:00:04,110 --> 00:00:04,120
today the paper I'm going to discuss
 

3
00:00:04,120 --> 00:00:16,349
today the paper I'm going to discuss
this frangipani this is a fairly old

4
00:00:16,349 --> 00:00:16,359
this frangipani this is a fairly old
 

5
00:00:16,359 --> 00:00:18,390
this frangipani this is a fairly old
distributed file system paper the reason

6
00:00:18,390 --> 00:00:18,400
distributed file system paper the reason
 

7
00:00:18,400 --> 00:00:21,089
distributed file system paper the reason
why were reading it though is because it

8
00:00:21,089 --> 00:00:21,099
why were reading it though is because it
 

9
00:00:21,099 --> 00:00:23,429
why were reading it though is because it
has a lot of interesting and good design

10
00:00:23,429 --> 00:00:23,439
has a lot of interesting and good design
 

11
00:00:23,439 --> 00:00:25,819
has a lot of interesting and good design
having to do with cache coherence and

12
00:00:25,819 --> 00:00:25,829
having to do with cache coherence and
 

13
00:00:25,829 --> 00:00:28,829
having to do with cache coherence and
distributed transactions and distributed

14
00:00:28,829 --> 00:00:28,839
distributed transactions and distributed
 

15
00:00:28,839 --> 00:00:31,019
distributed transactions and distributed
crash recovery as well as the

16
00:00:31,019 --> 00:00:31,029
crash recovery as well as the
 

17
00:00:31,029 --> 00:00:33,410
crash recovery as well as the
interactions between them so those are

18
00:00:33,410 --> 00:00:33,420
interactions between them so those are
 

19
00:00:33,420 --> 00:00:35,490
interactions between them so those are
those are the really the ideas behind

20
00:00:35,490 --> 00:00:35,500
those are the really the ideas behind
 

21
00:00:35,500 --> 00:00:38,130
those are the really the ideas behind
this that we're gonna try to tease out

22
00:00:38,130 --> 00:00:38,140
this that we're gonna try to tease out
 

23
00:00:38,140 --> 00:00:42,689
this that we're gonna try to tease out
so these are it's really a lot of our

24
00:00:42,689 --> 00:00:42,699
so these are it's really a lot of our
 

25
00:00:42,699 --> 00:00:47,520
so these are it's really a lot of our
caching coherence is really the idea of

26
00:00:47,520 --> 00:00:47,530
caching coherence is really the idea of
 

27
00:00:47,530 --> 00:00:50,669
caching coherence is really the idea of
if I have something cached that

28
00:00:50,669 --> 00:00:50,679
if I have something cached that
 

29
00:00:50,679 --> 00:00:52,889
if I have something cached that
nevertheless if you modify it despite me

30
00:00:52,889 --> 00:00:52,899
nevertheless if you modify it despite me
 

31
00:00:52,899 --> 00:00:54,360
nevertheless if you modify it despite me
having a cache you know something will

32
00:00:54,360 --> 00:00:54,370
having a cache you know something will
 

33
00:00:54,370 --> 00:00:56,400
having a cache you know something will
happen so I can see your your

34
00:00:56,400 --> 00:00:56,410
happen so I can see your your
 

35
00:00:56,410 --> 00:00:58,799
happen so I can see your your
modifications and we also have

36
00:00:58,799 --> 00:00:58,809
modifications and we also have
 

37
00:00:58,809 --> 00:01:04,410
modifications and we also have
distributed its actions which are needed

38
00:01:04,410 --> 00:01:04,420
distributed its actions which are needed
 

39
00:01:04,420 --> 00:01:06,900
distributed its actions which are needed
internally to file systems to be able to

40
00:01:06,900 --> 00:01:06,910
internally to file systems to be able to
 

41
00:01:06,910 --> 00:01:09,120
internally to file systems to be able to
make complex updates to the file system

42
00:01:09,120 --> 00:01:09,130
make complex updates to the file system
 

43
00:01:09,130 --> 00:01:14,550
make complex updates to the file system
data structures and because the file

44
00:01:14,550 --> 00:01:14,560
data structures and because the file
 

45
00:01:14,560 --> 00:01:16,590
data structures and because the file
system is essentially split up among a

46
00:01:16,590 --> 00:01:16,600
system is essentially split up among a
 

47
00:01:16,600 --> 00:01:19,260
system is essentially split up among a
bunch of servers it's critical to be

48
00:01:19,260 --> 00:01:19,270
bunch of servers it's critical to be
 

49
00:01:19,270 --> 00:01:20,910
bunch of servers it's critical to be
able to recover from crashes and those

50
00:01:20,910 --> 00:01:20,920
able to recover from crashes and those
 

51
00:01:20,920 --> 00:01:30,120
able to recover from crashes and those
servers the overall design a friend

52
00:01:30,120 --> 00:01:30,130
servers the overall design a friend
 

53
00:01:30,130 --> 00:01:34,290
servers the overall design a friend
pammi it's a network file system it's

54
00:01:34,290 --> 00:01:34,300
pammi it's a network file system it's
 

55
00:01:34,300 --> 00:01:37,830
pammi it's a network file system it's
intended to look to existing

56
00:01:37,830 --> 00:01:37,840
intended to look to existing
 

57
00:01:37,840 --> 00:01:39,390
intended to look to existing
applications this is intended to work

58
00:01:39,390 --> 00:01:39,400
applications this is intended to work
 

59
00:01:39,400 --> 00:01:41,040
applications this is intended to work
with existing applications like UNIX

60
00:01:41,040 --> 00:01:41,050
with existing applications like UNIX
 

61
00:01:41,050 --> 00:01:43,260
with existing applications like UNIX
programs ordinary UNIX programs we're

62
00:01:43,260 --> 00:01:43,270
programs ordinary UNIX programs we're
 

63
00:01:43,270 --> 00:01:47,610
programs ordinary UNIX programs we're
running on people's workstations much

64
00:01:47,610 --> 00:01:47,620
running on people's workstations much
 

65
00:01:47,620 --> 00:01:51,300
running on people's workstations much
like Athena's AFS lets you get at your

66
00:01:51,300 --> 00:01:51,310
like Athena's AFS lets you get at your
 

67
00:01:51,310 --> 00:01:53,490
like Athena's AFS lets you get at your
Athena home directory and various

68
00:01:53,490 --> 00:01:53,500
Athena home directory and various
 

69
00:01:53,500 --> 00:01:56,460
Athena home directory and various
project directories from any Athena

70
00:01:56,460 --> 00:01:56,470
project directories from any Athena
 

71
00:01:56,470 --> 00:01:58,680
project directories from any Athena
workstation so the kind of overall

72
00:01:58,680 --> 00:01:58,690
workstation so the kind of overall
 

73
00:01:58,690 --> 00:02:00,540
workstation so the kind of overall
picture is that you have a bunch of

74
00:02:00,540 --> 00:02:00,550
picture is that you have a bunch of
 

75
00:02:00,550 --> 00:02:06,000
picture is that you have a bunch of
users each user in the papers world is

76
00:02:06,000 --> 00:02:06,010
users each user in the papers world is
 

77
00:02:06,010 --> 00:02:07,290
users each user in the papers world is
sitting in front of a workstation which

78
00:02:07,290 --> 00:02:07,300
sitting in front of a workstation which
 

79
00:02:07,300 --> 00:02:09,359
sitting in front of a workstation which
is you know real not a laptop in those

80
00:02:09,359 --> 00:02:09,369
is you know real not a laptop in those
 

81
00:02:09,369 --> 00:02:10,800
is you know real not a laptop in those
days but sort of computer with a

82
00:02:10,800 --> 00:02:10,810
days but sort of computer with a
 

83
00:02:10,810 --> 00:02:12,420
days but sort of computer with a
keyboard and display in a mouse and

84
00:02:12,420 --> 00:02:12,430
keyboard and display in a mouse and
 

85
00:02:12,430 --> 00:02:14,010
keyboard and display in a mouse and
Windows system at all so each one is

86
00:02:14,010 --> 00:02:14,020
Windows system at all so each one is
 

87
00:02:14,020 --> 00:02:14,480
Windows system at all so each one is
sitting

88
00:02:14,480 --> 00:02:14,490
sitting
 

89
00:02:14,490 --> 00:02:17,360
sitting
front of a computer workstation I'm

90
00:02:17,360 --> 00:02:17,370
front of a computer workstation I'm
 

91
00:02:17,370 --> 00:02:19,250
front of a computer workstation I'm
gonna call the workstations you know

92
00:02:19,250 --> 00:02:19,260
gonna call the workstations you know
 

93
00:02:19,260 --> 00:02:24,710
gonna call the workstations you know
workstation one more station to each

94
00:02:24,710 --> 00:02:24,720
workstation one more station to each
 

95
00:02:24,720 --> 00:02:27,590
workstation one more station to each
workstation runs an instance of the

96
00:02:27,590 --> 00:02:27,600
workstation runs an instance of the
 

97
00:02:27,600 --> 00:02:30,500
workstation runs an instance of the
frangipani server I meant so a huge

98
00:02:30,500 --> 00:02:30,510
frangipani server I meant so a huge
 

99
00:02:30,510 --> 00:02:32,920
frangipani server I meant so a huge
amount of the you know almost all of the

100
00:02:32,920 --> 00:02:32,930
amount of the you know almost all of the
 

101
00:02:32,930 --> 00:02:36,800
amount of the you know almost all of the
stuff that happens in this paper goes on

102
00:02:36,800 --> 00:02:36,810
stuff that happens in this paper goes on
 

103
00:02:36,810 --> 00:02:40,430
stuff that happens in this paper goes on
in the frangipani software in each

104
00:02:40,430 --> 00:02:40,440
in the frangipani software in each
 

105
00:02:40,440 --> 00:02:42,830
in the frangipani software in each
workstation so maybe they're sitting in

106
00:02:42,830 --> 00:02:42,840
workstation so maybe they're sitting in
 

107
00:02:42,840 --> 00:02:44,480
workstation so maybe they're sitting in
front of a workstation and they might be

108
00:02:44,480 --> 00:02:44,490
front of a workstation and they might be
 

109
00:02:44,490 --> 00:02:47,030
front of a workstation and they might be
running ordinary programs like a text

110
00:02:47,030 --> 00:02:47,040
running ordinary programs like a text
 

111
00:02:47,040 --> 00:02:48,530
running ordinary programs like a text
editor that's reading and writing files

112
00:02:48,530 --> 00:02:48,540
editor that's reading and writing files
 

113
00:02:48,540 --> 00:02:50,510
editor that's reading and writing files
and maybe when they finished editing a

114
00:02:50,510 --> 00:02:50,520
and maybe when they finished editing a
 

115
00:02:50,520 --> 00:02:51,530
and maybe when they finished editing a
source file they run it through the

116
00:02:51,530 --> 00:02:51,540
source file they run it through the
 

117
00:02:51,540 --> 00:02:53,480
source file they run it through the
compiler that the Reiser source file

118
00:02:53,480 --> 00:02:53,490
compiler that the Reiser source file
 

119
00:02:53,490 --> 00:02:57,560
compiler that the Reiser source file
when these ordinary programs make file

120
00:02:57,560 --> 00:02:57,570
when these ordinary programs make file
 

121
00:02:57,570 --> 00:02:59,930
when these ordinary programs make file
system calls inside the kernel there's a

122
00:02:59,930 --> 00:02:59,940
system calls inside the kernel there's a
 

123
00:02:59,940 --> 00:03:08,030
system calls inside the kernel there's a
frangipani module that implements the

124
00:03:08,030 --> 00:03:08,040
frangipani module that implements the
 

125
00:03:08,040 --> 00:03:10,460
frangipani module that implements the
file system inside of all of these

126
00:03:10,460 --> 00:03:10,470
file system inside of all of these
 

127
00:03:10,470 --> 00:03:15,680
file system inside of all of these
workstations each other on copy and then

128
00:03:15,680 --> 00:03:15,690
workstations each other on copy and then
 

129
00:03:15,690 --> 00:03:17,990
workstations each other on copy and then
the real storage of the file system data

130
00:03:17,990 --> 00:03:18,000
the real storage of the file system data
 

131
00:03:18,000 --> 00:03:19,970
the real storage of the file system data
structures things like certainly file

132
00:03:19,970 --> 00:03:19,980
structures things like certainly file
 

133
00:03:19,980 --> 00:03:22,100
structures things like certainly file
contents but also I nodes and

134
00:03:22,100 --> 00:03:22,110
contents but also I nodes and
 

135
00:03:22,110 --> 00:03:24,110
contents but also I nodes and
directories and alissa file and each

136
00:03:24,110 --> 00:03:24,120
directories and alissa file and each
 

137
00:03:24,120 --> 00:03:26,750
directories and alissa file and each
directory and the information about what

138
00:03:26,750 --> 00:03:26,760
directory and the information about what
 

139
00:03:26,760 --> 00:03:28,700
directory and the information about what
I knows and what blocks are free all

140
00:03:28,700 --> 00:03:28,710
I knows and what blocks are free all
 

141
00:03:28,710 --> 00:03:32,960
I knows and what blocks are free all
that's stored in a shared virtual disk

142
00:03:32,960 --> 00:03:32,970
that's stored in a shared virtual disk
 

143
00:03:32,970 --> 00:03:37,550
that's stored in a shared virtual disk
surface called petal it's on a separate

144
00:03:37,550 --> 00:03:37,560
surface called petal it's on a separate
 

145
00:03:37,560 --> 00:03:38,960
surface called petal it's on a separate
set of machines that are you know

146
00:03:38,960 --> 00:03:38,970
set of machines that are you know
 

147
00:03:38,970 --> 00:03:40,640
set of machines that are you know
probably server machines and a machine

148
00:03:40,640 --> 00:03:40,650
probably server machines and a machine
 

149
00:03:40,650 --> 00:03:42,230
probably server machines and a machine
room rather than workstations on

150
00:03:42,230 --> 00:03:42,240
room rather than workstations on
 

151
00:03:42,240 --> 00:03:45,080
room rather than workstations on
people's desks pedal among many other

152
00:03:45,080 --> 00:03:45,090
people's desks pedal among many other
 

153
00:03:45,090 --> 00:03:46,700
people's desks pedal among many other
things replicates data so you can sort

154
00:03:46,700 --> 00:03:46,710
things replicates data so you can sort
 

155
00:03:46,710 --> 00:03:48,500
things replicates data so you can sort
of think of pedal servers is coming in

156
00:03:48,500 --> 00:03:48,510
of think of pedal servers is coming in
 

157
00:03:48,510 --> 00:03:55,460
of think of pedal servers is coming in
pairs and one crashes we can still get

158
00:03:55,460 --> 00:03:55,470
pairs and one crashes we can still get
 

159
00:03:55,470 --> 00:03:58,010
pairs and one crashes we can still get
at our data and so when frangipani

160
00:03:58,010 --> 00:03:58,020
at our data and so when frangipani
 

161
00:03:58,020 --> 00:04:00,380
at our data and so when frangipani
needs to read or write a you know read a

162
00:04:00,380 --> 00:04:00,390
needs to read or write a you know read a
 

163
00:04:00,390 --> 00:04:02,360
needs to read or write a you know read a
directory or something it sends a remote

164
00:04:02,360 --> 00:04:02,370
directory or something it sends a remote
 

165
00:04:02,370 --> 00:04:04,250
directory or something it sends a remote
procedure call off to the correct pedal

166
00:04:04,250 --> 00:04:04,260
procedure call off to the correct pedal
 

167
00:04:04,260 --> 00:04:06,350
procedure call off to the correct pedal
server to say well here's the block that

168
00:04:06,350 --> 00:04:06,360
server to say well here's the block that
 

169
00:04:06,360 --> 00:04:08,270
server to say well here's the block that
I need you know please read it for me

170
00:04:08,270 --> 00:04:08,280
I need you know please read it for me
 

171
00:04:08,280 --> 00:04:10,640
I need you know please read it for me
please return that block and for the

172
00:04:10,640 --> 00:04:10,650
please return that block and for the
 

173
00:04:10,650 --> 00:04:13,970
please return that block and for the
most part petal is acting like a disk

174
00:04:13,970 --> 00:04:13,980
most part petal is acting like a disk
 

175
00:04:13,980 --> 00:04:16,099
most part petal is acting like a disk
drive you can think of it as a kind of

176
00:04:16,099 --> 00:04:16,109
drive you can think of it as a kind of
 

177
00:04:16,109 --> 00:04:22,250
drive you can think of it as a kind of
shared as a shared disk drive that all

178
00:04:22,250 --> 00:04:22,260
shared as a shared disk drive that all
 

179
00:04:22,260 --> 00:04:25,790
shared as a shared disk drive that all
these frangipane knees talk to and it's

180
00:04:25,790 --> 00:04:25,800
these frangipane knees talk to and it's
 

181
00:04:25,800 --> 00:04:31,820
these frangipane knees talk to and it's
called a virtual disk

182
00:04:31,820 --> 00:04:31,830

 

183
00:04:31,830 --> 00:04:33,990

from our point of view for most of this

184
00:04:33,990 --> 00:04:34,000
from our point of view for most of this
 

185
00:04:34,000 --> 00:04:35,430
from our point of view for most of this
discussion we're just going to imagine

186
00:04:35,430 --> 00:04:35,440
discussion we're just going to imagine
 

187
00:04:35,440 --> 00:04:37,680
discussion we're just going to imagine
pedal is just being a disk ride that's

188
00:04:37,680 --> 00:04:37,690
pedal is just being a disk ride that's
 

189
00:04:37,690 --> 00:04:39,570
pedal is just being a disk ride that's
used over the network by all these

190
00:04:39,570 --> 00:04:39,580
used over the network by all these
 

191
00:04:39,580 --> 00:04:41,909
used over the network by all these
friends of Handy's and so it has you

192
00:04:41,909 --> 00:04:41,919
friends of Handy's and so it has you
 

193
00:04:41,919 --> 00:04:44,940
friends of Handy's and so it has you
read and write it by giving it a block

194
00:04:44,940 --> 00:04:44,950
read and write it by giving it a block
 

195
00:04:44,950 --> 00:04:46,680
read and write it by giving it a block
number or an address on the disk and

196
00:04:46,680 --> 00:04:46,690
number or an address on the disk and
 

197
00:04:46,690 --> 00:04:47,909
number or an address on the disk and
seem like I'd like to read that block

198
00:04:47,909 --> 00:04:47,919
seem like I'd like to read that block
 

199
00:04:47,919 --> 00:04:56,870
seem like I'd like to read that block
just like an ordinary hard drive okay so

200
00:04:56,870 --> 00:04:56,880
just like an ordinary hard drive okay so
 

201
00:04:56,880 --> 00:05:00,720
just like an ordinary hard drive okay so
the intended use for this file so the

202
00:05:00,720 --> 00:05:00,730
the intended use for this file so the
 

203
00:05:00,730 --> 00:05:02,810
the intended use for this file so the
use that the authors intended is

204
00:05:02,810 --> 00:05:02,820
use that the authors intended is
 

205
00:05:02,820 --> 00:05:05,580
use that the authors intended is
actually reasonably important driver in

206
00:05:05,580 --> 00:05:05,590
actually reasonably important driver in
 

207
00:05:05,590 --> 00:05:08,190
actually reasonably important driver in
the design what they wanted was to

208
00:05:08,190 --> 00:05:08,200
the design what they wanted was to
 

209
00:05:08,200 --> 00:05:10,680
the design what they wanted was to
support their own activities and what

210
00:05:10,680 --> 00:05:10,690
support their own activities and what
 

211
00:05:10,690 --> 00:05:12,720
support their own activities and what
they were were were members of a

212
00:05:12,720 --> 00:05:12,730
they were were were members of a
 

213
00:05:12,730 --> 00:05:16,590
they were were were members of a
research lab of maybe say 50 people in

214
00:05:16,590 --> 00:05:16,600
research lab of maybe say 50 people in
 

215
00:05:16,600 --> 00:05:18,930
research lab of maybe say 50 people in
this research lab and they were used to

216
00:05:18,930 --> 00:05:18,940
this research lab and they were used to
 

217
00:05:18,940 --> 00:05:20,880
this research lab and they were used to
shared infrastructure things like time

218
00:05:20,880 --> 00:05:20,890
shared infrastructure things like time
 

219
00:05:20,890 --> 00:05:24,540
shared infrastructure things like time
sharing machines or workstations using

220
00:05:24,540 --> 00:05:24,550
sharing machines or workstations using
 

221
00:05:24,550 --> 00:05:27,060
sharing machines or workstations using
previous network file systems to share

222
00:05:27,060 --> 00:05:27,070
previous network file systems to share
 

223
00:05:27,070 --> 00:05:29,010
previous network file systems to share
files among cooperating groups of

224
00:05:29,010 --> 00:05:29,020
files among cooperating groups of
 

225
00:05:29,020 --> 00:05:30,990
files among cooperating groups of
researchers so they both wanted they

226
00:05:30,990 --> 00:05:31,000
researchers so they both wanted they
 

227
00:05:31,000 --> 00:05:32,790
researchers so they both wanted they
they wanted a file system that they

228
00:05:32,790 --> 00:05:32,800
they wanted a file system that they
 

229
00:05:32,800 --> 00:05:33,960
they wanted a file system that they
could use to store their own home

230
00:05:33,960 --> 00:05:33,970
could use to store their own home
 

231
00:05:33,970 --> 00:05:37,260
could use to store their own home
directories in as well as storing shared

232
00:05:37,260 --> 00:05:37,270
directories in as well as storing shared
 

233
00:05:37,270 --> 00:05:39,540
directories in as well as storing shared
project files and so that meant that if

234
00:05:39,540 --> 00:05:39,550
project files and so that meant that if
 

235
00:05:39,550 --> 00:05:41,250
project files and so that meant that if
I edit a file I'd really like the other

236
00:05:41,250 --> 00:05:41,260
I edit a file I'd really like the other
 

237
00:05:41,260 --> 00:05:43,260
I edit a file I'd really like the other
people my work and the other people I

238
00:05:43,260 --> 00:05:43,270
people my work and the other people I
 

239
00:05:43,270 --> 00:05:45,180
people my work and the other people I
work with to be able to read the file I

240
00:05:45,180 --> 00:05:45,190
work with to be able to read the file I
 

241
00:05:45,190 --> 00:05:47,310
work with to be able to read the file I
just edited so we want that kind of

242
00:05:47,310 --> 00:05:47,320
just edited so we want that kind of
 

243
00:05:47,320 --> 00:05:51,180
just edited so we want that kind of
sharing and in addition it's great if I

244
00:05:51,180 --> 00:05:51,190
sharing and in addition it's great if I
 

245
00:05:51,190 --> 00:05:52,770
sharing and in addition it's great if I
can sit down at any workstation my

246
00:05:52,770 --> 00:05:52,780
can sit down at any workstation my
 

247
00:05:52,780 --> 00:05:54,900
can sit down at any workstation my
workstation your workstation a public

248
00:05:54,900 --> 00:05:54,910
workstation your workstation a public
 

249
00:05:54,910 --> 00:05:57,540
workstation your workstation a public
workstation in the library and still get

250
00:05:57,540 --> 00:05:57,550
workstation in the library and still get
 

251
00:05:57,550 --> 00:05:59,430
workstation in the library and still get
at all of the files of all my home

252
00:05:59,430 --> 00:05:59,440
at all of the files of all my home
 

253
00:05:59,440 --> 00:06:01,230
at all of the files of all my home
directory everything I need in my

254
00:06:01,230 --> 00:06:01,240
directory everything I need in my
 

255
00:06:01,240 --> 00:06:03,330
directory everything I need in my
environment so they're really interested

256
00:06:03,330 --> 00:06:03,340
environment so they're really interested
 

257
00:06:03,340 --> 00:06:06,990
environment so they're really interested
in a shared file system for human users

258
00:06:06,990 --> 00:06:07,000
in a shared file system for human users
 

259
00:06:07,000 --> 00:06:11,370
in a shared file system for human users
in a relatively small organization small

260
00:06:11,370 --> 00:06:11,380
in a relatively small organization small
 

261
00:06:11,380 --> 00:06:12,810
in a relatively small organization small
enough that everybody was trusted all

262
00:06:12,810 --> 00:06:12,820
enough that everybody was trusted all
 

263
00:06:12,820 --> 00:06:14,730
enough that everybody was trusted all
the people all the computers so really

264
00:06:14,730 --> 00:06:14,740
the people all the computers so really
 

265
00:06:14,740 --> 00:06:16,800
the people all the computers so really
the design has essentially nothing to

266
00:06:16,800 --> 00:06:16,810
the design has essentially nothing to
 

267
00:06:16,810 --> 00:06:19,650
the design has essentially nothing to
say about security and indeed arguably

268
00:06:19,650 --> 00:06:19,660
say about security and indeed arguably
 

269
00:06:19,660 --> 00:06:21,810
say about security and indeed arguably
would not work in an environment like

270
00:06:21,810 --> 00:06:21,820
would not work in an environment like
 

271
00:06:21,820 --> 00:06:23,820
would not work in an environment like
Athena where you can't really trust the

272
00:06:23,820 --> 00:06:23,830
Athena where you can't really trust the
 

273
00:06:23,830 --> 00:06:26,400
Athena where you can't really trust the
users or the workstations so it's really

274
00:06:26,400 --> 00:06:26,410
users or the workstations so it's really
 

275
00:06:26,410 --> 00:06:29,940
users or the workstations so it's really
very much designed for their their

276
00:06:29,940 --> 00:06:29,950
very much designed for their their
 

277
00:06:29,950 --> 00:06:34,440
very much designed for their their
environment now as far as performance

278
00:06:34,440 --> 00:06:34,450
environment now as far as performance
 

279
00:06:34,450 --> 00:06:36,120
environment now as far as performance
their environment was also important you

280
00:06:36,120 --> 00:06:36,130
their environment was also important you
 

281
00:06:36,130 --> 00:06:37,620
their environment was also important you
know it turns out that the way most

282
00:06:37,620 --> 00:06:37,630
know it turns out that the way most
 

283
00:06:37,630 --> 00:06:39,029
know it turns out that the way most
people use computers are leased

284
00:06:39,029 --> 00:06:39,039
people use computers are leased
 

285
00:06:39,039 --> 00:06:40,559
people use computers are leased
workstations they sit in front of is

286
00:06:40,559 --> 00:06:40,569
workstations they sit in front of is
 

287
00:06:40,569 --> 00:06:41,909
workstations they sit in front of is
that they mostly read and write their

288
00:06:41,909 --> 00:06:41,919
that they mostly read and write their
 

289
00:06:41,919 --> 00:06:44,669
that they mostly read and write their
own files and they may read some shared

290
00:06:44,669 --> 00:06:44,679
own files and they may read some shared
 

291
00:06:44,679 --> 00:06:47,999
own files and they may read some shared
files you know programs or some project

292
00:06:47,999 --> 00:06:48,009
files you know programs or some project
 

293
00:06:48,009 --> 00:06:50,279
files you know programs or some project
files or something but most of the time

294
00:06:50,279 --> 00:06:50,289
files or something but most of the time
 

295
00:06:50,289 --> 00:06:51,899
files or something but most of the time
I'm reading and writing my files and

296
00:06:51,899 --> 00:06:51,909
I'm reading and writing my files and
 

297
00:06:51,909 --> 00:06:53,760
I'm reading and writing my files and
you're reading and writing your files on

298
00:06:53,760 --> 00:06:53,770
you're reading and writing your files on
 

299
00:06:53,770 --> 00:06:55,559
you're reading and writing your files on
your workstation and you know it's

300
00:06:55,559 --> 00:06:55,569
your workstation and you know it's
 

301
00:06:55,569 --> 00:06:57,179
your workstation and you know it's
really the exception that we're actively

302
00:06:57,179 --> 00:06:57,189
really the exception that we're actively
 

303
00:06:57,189 --> 00:06:59,309
really the exception that we're actively
sharing files so it makes a huge amount

304
00:06:59,309 --> 00:06:59,319
sharing files so it makes a huge amount
 

305
00:06:59,319 --> 00:07:01,619
sharing files so it makes a huge amount
of sense to be able to one way or

306
00:07:01,619 --> 00:07:01,629
of sense to be able to one way or
 

307
00:07:01,629 --> 00:07:04,649
of sense to be able to one way or
another even though officially the real

308
00:07:04,649 --> 00:07:04,659
another even though officially the real
 

309
00:07:04,659 --> 00:07:06,089
another even though officially the real
copies of files are stored in this

310
00:07:06,089 --> 00:07:06,099
copies of files are stored in this
 

311
00:07:06,099 --> 00:07:08,279
copies of files are stored in this
shared disk it's fantastic if we can

312
00:07:08,279 --> 00:07:08,289
shared disk it's fantastic if we can
 

313
00:07:08,289 --> 00:07:11,489
shared disk it's fantastic if we can
have some kind of caching so that after

314
00:07:11,489 --> 00:07:11,499
have some kind of caching so that after
 

315
00:07:11,499 --> 00:07:12,989
have some kind of caching so that after
I log in and I use my files for a while

316
00:07:12,989 --> 00:07:12,999
I log in and I use my files for a while
 

317
00:07:12,999 --> 00:07:15,600
I log in and I use my files for a while
they're locally cached here so they can

318
00:07:15,600 --> 00:07:15,610
they're locally cached here so they can
 

319
00:07:15,610 --> 00:07:17,369
they're locally cached here so they can
be gotten gotten that and you know

320
00:07:17,369 --> 00:07:17,379
be gotten gotten that and you know
 

321
00:07:17,379 --> 00:07:20,159
be gotten gotten that and you know
microseconds instead of milliseconds if

322
00:07:20,159 --> 00:07:20,169
microseconds instead of milliseconds if
 

323
00:07:20,169 --> 00:07:22,049
microseconds instead of milliseconds if
we have to fetch them from the file

324
00:07:22,049 --> 00:07:22,059
we have to fetch them from the file
 

325
00:07:22,059 --> 00:07:27,629
we have to fetch them from the file
servers ok so French Pyrenees supported

326
00:07:27,629 --> 00:07:27,639
servers ok so French Pyrenees supported
 

327
00:07:27,639 --> 00:07:29,609
servers ok so French Pyrenees supported
this this kind of caching furthermore it

328
00:07:29,609 --> 00:07:29,619
this this kind of caching furthermore it
 

329
00:07:29,619 --> 00:07:33,839
this this kind of caching furthermore it
supported right-back caching not only

330
00:07:33,839 --> 00:07:33,849
supported right-back caching not only
 

331
00:07:33,849 --> 00:07:38,339
supported right-back caching not only
caching in each in each workstation and

332
00:07:38,339 --> 00:07:38,349
caching in each in each workstation and
 

333
00:07:38,349 --> 00:07:40,469
caching in each in each workstation and
each frangipani server we also have

334
00:07:40,469 --> 00:07:40,479
each frangipani server we also have
 

335
00:07:40,479 --> 00:07:46,259
each frangipani server we also have
right back caching which means that if I

336
00:07:46,259 --> 00:07:46,269
right back caching which means that if I
 

337
00:07:46,269 --> 00:07:49,139
right back caching which means that if I
want to modify something if I modify a

338
00:07:49,139 --> 00:07:49,149
want to modify something if I modify a
 

339
00:07:49,149 --> 00:07:51,149
want to modify something if I modify a
file or even create a file in a

340
00:07:51,149 --> 00:07:51,159
file or even create a file in a
 

341
00:07:51,159 --> 00:07:53,399
file or even create a file in a
directory or delete a file or basically

342
00:07:53,399 --> 00:07:53,409
directory or delete a file or basically
 

343
00:07:53,409 --> 00:07:55,859
directory or delete a file or basically
do any other operation as long as nobody

344
00:07:55,859 --> 00:07:55,869
do any other operation as long as nobody
 

345
00:07:55,869 --> 00:07:57,929
do any other operation as long as nobody
else no other workstation needs to see

346
00:07:57,929 --> 00:07:57,939
else no other workstation needs to see
 

347
00:07:57,939 --> 00:07:59,029
else no other workstation needs to see
it

348
00:07:59,029 --> 00:07:59,039
it
 

349
00:07:59,039 --> 00:08:01,649
it
frangipani acts with a write back cache

350
00:08:01,649 --> 00:08:01,659
frangipani acts with a write back cache
 

351
00:08:01,659 --> 00:08:05,100
frangipani acts with a write back cache
and that means that my writes stay only

352
00:08:05,100 --> 00:08:05,110
and that means that my writes stay only
 

353
00:08:05,110 --> 00:08:07,230
and that means that my writes stay only
local in the cache if I create a file at

354
00:08:07,230 --> 00:08:07,240
local in the cache if I create a file at
 

355
00:08:07,240 --> 00:08:09,420
local in the cache if I create a file at
least initially the information about

356
00:08:09,420 --> 00:08:09,430
least initially the information about
 

357
00:08:09,430 --> 00:08:11,730
least initially the information about
the newly created file said a newly

358
00:08:11,730 --> 00:08:11,740
the newly created file said a newly
 

359
00:08:11,740 --> 00:08:13,980
the newly created file said a newly
allocated inode with initialized

360
00:08:13,980 --> 00:08:13,990
allocated inode with initialized
 

361
00:08:13,990 --> 00:08:16,799
allocated inode with initialized
contents and you know a new entry added

362
00:08:16,799 --> 00:08:16,809
contents and you know a new entry added
 

363
00:08:16,809 --> 00:08:19,439
contents and you know a new entry added
to a new name attitudes to my home

364
00:08:19,439 --> 00:08:19,449
to a new name attitudes to my home
 

365
00:08:19,449 --> 00:08:21,209
to a new name attitudes to my home
directory all those modifications

366
00:08:21,209 --> 00:08:21,219
directory all those modifications
 

367
00:08:21,219 --> 00:08:23,429
directory all those modifications
initially are just done in the cache and

368
00:08:23,429 --> 00:08:23,439
initially are just done in the cache and
 

369
00:08:23,439 --> 00:08:25,379
initially are just done in the cache and
therefore things like creating a file

370
00:08:25,379 --> 00:08:25,389
therefore things like creating a file
 

371
00:08:25,389 --> 00:08:27,779
therefore things like creating a file
can be done extremely rapidly they just

372
00:08:27,779 --> 00:08:27,789
can be done extremely rapidly they just
 

373
00:08:27,789 --> 00:08:30,290
can be done extremely rapidly they just
require modifying local memory in this

374
00:08:30,290 --> 00:08:30,300
require modifying local memory in this
 

375
00:08:30,300 --> 00:08:32,610
require modifying local memory in this
machine's disk cache and they're not

376
00:08:32,610 --> 00:08:32,620
machine's disk cache and they're not
 

377
00:08:32,620 --> 00:08:34,620
machine's disk cache and they're not
written back in general to peddle until

378
00:08:34,620 --> 00:08:34,630
written back in general to peddle until
 

379
00:08:34,630 --> 00:08:37,290
written back in general to peddle until
later so at least initially we can do

380
00:08:37,290 --> 00:08:37,300
later so at least initially we can do
 

381
00:08:37,300 --> 00:08:39,509
later so at least initially we can do
all kinds of modifications to the file

382
00:08:39,509 --> 00:08:39,519
all kinds of modifications to the file
 

383
00:08:39,519 --> 00:08:41,699
all kinds of modifications to the file
system at least to my own directories my

384
00:08:41,699 --> 00:08:41,709
system at least to my own directories my
 

385
00:08:41,709 --> 00:08:44,879
system at least to my own directories my
own files completely locally and that's

386
00:08:44,879 --> 00:08:44,889
own files completely locally and that's
 

387
00:08:44,889 --> 00:08:47,129
own files completely locally and that's
enormous ly helpful for performance it's

388
00:08:47,129 --> 00:08:47,139
enormous ly helpful for performance it's
 

389
00:08:47,139 --> 00:08:48,629
enormous ly helpful for performance it's
like a you know factor of a thousand

390
00:08:48,629 --> 00:08:48,639
like a you know factor of a thousand
 

391
00:08:48,639 --> 00:08:50,309
like a you know factor of a thousand
difference being able to modify

392
00:08:50,309 --> 00:08:50,319
difference being able to modify
 

393
00:08:50,319 --> 00:08:52,139
difference being able to modify
something in local memory versus having

394
00:08:52,139 --> 00:08:52,149
something in local memory versus having
 

395
00:08:52,149 --> 00:08:54,420
something in local memory versus having
to send a remote procedure calls to send

396
00:08:54,420 --> 00:08:54,430
to send a remote procedure calls to send
 

397
00:08:54,430 --> 00:08:59,460
to send a remote procedure calls to send
server now one serious consequence of

398
00:08:59,460 --> 00:08:59,470
server now one serious consequence of
 

399
00:08:59,470 --> 00:09:03,860
server now one serious consequence of
that it's extremely determinative of the

400
00:09:03,860 --> 00:09:03,870
that it's extremely determinative of the
 

401
00:09:03,870 --> 00:09:06,120
that it's extremely determinative of the
architecture here is that that meant

402
00:09:06,120 --> 00:09:06,130
architecture here is that that meant
 

403
00:09:06,130 --> 00:09:09,389
architecture here is that that meant
that the logic of the file system has to

404
00:09:09,389 --> 00:09:09,399
that the logic of the file system has to
 

405
00:09:09,399 --> 00:09:11,850
that the logic of the file system has to
be in each workstation in order for my

406
00:09:11,850 --> 00:09:11,860
be in each workstation in order for my
 

407
00:09:11,860 --> 00:09:13,230
be in each workstation in order for my
workstation to be able to implement

408
00:09:13,230 --> 00:09:13,240
workstation to be able to implement
 

409
00:09:13,240 --> 00:09:15,690
workstation to be able to implement
things like create a file just operating

410
00:09:15,690 --> 00:09:15,700
things like create a file just operating
 

411
00:09:15,700 --> 00:09:17,550
things like create a file just operating
out of its local cache it means all the

412
00:09:17,550 --> 00:09:17,560
out of its local cache it means all the
 

413
00:09:17,560 --> 00:09:20,730
out of its local cache it means all the
logic all the intelligence for the file

414
00:09:20,730 --> 00:09:20,740
logic all the intelligence for the file
 

415
00:09:20,740 --> 00:09:22,170
logic all the intelligence for the file
system has to be sitting here in my

416
00:09:22,170 --> 00:09:22,180
system has to be sitting here in my
 

417
00:09:22,180 --> 00:09:24,060
system has to be sitting here in my
workstation and in their design

418
00:09:24,060 --> 00:09:24,070
workstation and in their design
 

419
00:09:24,070 --> 00:09:26,100
workstation and in their design
basically to a first approximation the

420
00:09:26,100 --> 00:09:26,110
basically to a first approximation the
 

421
00:09:26,110 --> 00:09:28,710
basically to a first approximation the
pedal shared storage system knows

422
00:09:28,710 --> 00:09:28,720
pedal shared storage system knows
 

423
00:09:28,720 --> 00:09:31,320
pedal shared storage system knows
absolutely nothing about file systems or

424
00:09:31,320 --> 00:09:31,330
absolutely nothing about file systems or
 

425
00:09:31,330 --> 00:09:34,440
absolutely nothing about file systems or
files or directories all that logic this

426
00:09:34,440 --> 00:09:34,450
files or directories all that logic this
 

427
00:09:34,450 --> 00:09:35,790
files or directories all that logic this
is a very in a sense very

428
00:09:35,790 --> 00:09:35,800
is a very in a sense very
 

429
00:09:35,800 --> 00:09:38,910
is a very in a sense very
straightforward simple system and all

430
00:09:38,910 --> 00:09:38,920
straightforward simple system and all
 

431
00:09:38,920 --> 00:09:41,340
straightforward simple system and all
the complexity is here in the frangipani

432
00:09:41,340 --> 00:09:41,350
the complexity is here in the frangipani
 

433
00:09:41,350 --> 00:09:46,079
the complexity is here in the frangipani
in each client so it's a very kind of

434
00:09:46,079 --> 00:09:46,089
in each client so it's a very kind of
 

435
00:09:46,089 --> 00:09:49,019
in each client so it's a very kind of
decentralized scheme and one of the

436
00:09:49,019 --> 00:09:49,029
decentralized scheme and one of the
 

437
00:09:49,029 --> 00:09:50,760
decentralized scheme and one of the
reasons is - because that's what you

438
00:09:50,760 --> 00:09:50,770
reasons is - because that's what you
 

439
00:09:50,770 --> 00:09:53,790
reasons is - because that's what you
really need or these that was a design

440
00:09:53,790 --> 00:09:53,800
really need or these that was a design
 

441
00:09:53,800 --> 00:09:56,329
really need or these that was a design
they could think of to allow them to do

442
00:09:56,329 --> 00:09:56,339
they could think of to allow them to do
 

443
00:09:56,339 --> 00:09:58,350
they could think of to allow them to do
modifications purely locally in each

444
00:09:58,350 --> 00:09:58,360
modifications purely locally in each
 

445
00:09:58,360 --> 00:10:00,600
modifications purely locally in each
workstation it does have the nice side

446
00:10:00,600 --> 00:10:00,610
workstation it does have the nice side
 

447
00:10:00,610 --> 00:10:03,449
workstation it does have the nice side
effect though that I'm since most of the

448
00:10:03,449 --> 00:10:03,459
effect though that I'm since most of the
 

449
00:10:03,459 --> 00:10:05,460
effect though that I'm since most of the
complexity and most of the CPU time

450
00:10:05,460 --> 00:10:05,470
complexity and most of the CPU time
 

451
00:10:05,470 --> 00:10:07,829
complexity and most of the CPU time
spent is spent here it means that as you

452
00:10:07,829 --> 00:10:07,839
spent is spent here it means that as you
 

453
00:10:07,839 --> 00:10:09,960
spent is spent here it means that as you
add workstations as you add users to the

454
00:10:09,960 --> 00:10:09,970
add workstations as you add users to the
 

455
00:10:09,970 --> 00:10:13,620
add workstations as you add users to the
system you automatically get more CPU

456
00:10:13,620 --> 00:10:13,630
system you automatically get more CPU
 

457
00:10:13,630 --> 00:10:16,860
system you automatically get more CPU
capacity to run those new users file

458
00:10:16,860 --> 00:10:16,870
capacity to run those new users file
 

459
00:10:16,870 --> 00:10:18,840
capacity to run those new users file
system operations because most file

460
00:10:18,840 --> 00:10:18,850
system operations because most file
 

461
00:10:18,850 --> 00:10:21,540
system operations because most file
system operations happen just locally in

462
00:10:21,540 --> 00:10:21,550
system operations happen just locally in
 

463
00:10:21,550 --> 00:10:23,040
system operations happen just locally in
the workstation that's most of the CPU

464
00:10:23,040 --> 00:10:23,050
the workstation that's most of the CPU
 

465
00:10:23,050 --> 00:10:25,680
the workstation that's most of the CPU
time is spent here so the system does

466
00:10:25,680 --> 00:10:25,690
time is spent here so the system does
 

467
00:10:25,690 --> 00:10:27,480
time is spent here so the system does
have a certain degree of natural scaling

468
00:10:27,480 --> 00:10:27,490
have a certain degree of natural scaling
 

469
00:10:27,490 --> 00:10:30,540
have a certain degree of natural scaling
scalability as you add workstations each

470
00:10:30,540 --> 00:10:30,550
scalability as you add workstations each
 

471
00:10:30,550 --> 00:10:32,010
scalability as you add workstations each
new workstation is a bit more load from

472
00:10:32,010 --> 00:10:32,020
new workstation is a bit more load from
 

473
00:10:32,020 --> 00:10:33,449
new workstation is a bit more load from
a new user but it's also a bit more

474
00:10:33,449 --> 00:10:33,459
a new user but it's also a bit more
 

475
00:10:33,459 --> 00:10:35,910
a new user but it's also a bit more
available CPU time to run that users

476
00:10:35,910 --> 00:10:35,920
available CPU time to run that users
 

477
00:10:35,920 --> 00:10:38,250
available CPU time to run that users
file system operations of course at some

478
00:10:38,250 --> 00:10:38,260
file system operations of course at some
 

479
00:10:38,260 --> 00:10:40,769
file system operations of course at some
point you're gonna run out of gas here

480
00:10:40,769 --> 00:10:40,779
point you're gonna run out of gas here
 

481
00:10:40,779 --> 00:10:44,790
point you're gonna run out of gas here
in the central storage system and you

482
00:10:44,790 --> 00:10:44,800
in the central storage system and you
 

483
00:10:44,800 --> 00:10:46,110
in the central storage system and you
know then you may need to add more

484
00:10:46,110 --> 00:10:46,120
know then you may need to add more
 

485
00:10:46,120 --> 00:10:54,820
know then you may need to add more
storage servers to all right

486
00:10:54,820 --> 00:10:54,830

 

487
00:10:54,830 --> 00:10:59,329

so okay so we have the system that does

488
00:10:59,329 --> 00:10:59,339
so okay so we have the system that does
 

489
00:10:59,339 --> 00:11:01,310
so okay so we have the system that does
serious caching here and furthermore

490
00:11:01,310 --> 00:11:01,320
serious caching here and furthermore
 

491
00:11:01,320 --> 00:11:05,329
serious caching here and furthermore
does the modifications in the cache that

492
00:11:05,329 --> 00:11:05,339
does the modifications in the cache that
 

493
00:11:05,339 --> 00:11:06,740
does the modifications in the cache that
actually these immediately to some

494
00:11:06,740 --> 00:11:06,750
actually these immediately to some
 

495
00:11:06,750 --> 00:11:09,650
actually these immediately to some
serious challenges in the design and the

496
00:11:09,650 --> 00:11:09,660
serious challenges in the design and the
 

497
00:11:09,660 --> 00:11:11,660
serious challenges in the design and the
design is mostly about solving the

498
00:11:11,660 --> 00:11:11,670
design is mostly about solving the
 

499
00:11:11,670 --> 00:11:15,500
design is mostly about solving the
challenges I'm about to lay out these

500
00:11:15,500 --> 00:11:15,510
challenges I'm about to lay out these
 

501
00:11:15,510 --> 00:11:20,329
challenges I'm about to lay out these
are largely count challenges of that's

502
00:11:20,329 --> 00:11:20,339
are largely count challenges of that's
 

503
00:11:20,339 --> 00:11:26,120
are largely count challenges of that's
come from caching and this sort of

504
00:11:26,120 --> 00:11:26,130
come from caching and this sort of
 

505
00:11:26,130 --> 00:11:28,370
come from caching and this sort of
decentralized architecture where most of

506
00:11:28,370 --> 00:11:28,380
decentralized architecture where most of
 

507
00:11:28,380 --> 00:11:30,650
decentralized architecture where most of
the intelligence is sitting in the

508
00:11:30,650 --> 00:11:30,660
the intelligence is sitting in the
 

509
00:11:30,660 --> 00:11:45,490
the intelligence is sitting in the
clients so the first challenge is that

510
00:11:45,490 --> 00:11:45,500

 

511
00:11:45,500 --> 00:11:49,160

suppose workstation one creates a file

512
00:11:49,160 --> 00:11:49,170
suppose workstation one creates a file
 

513
00:11:49,170 --> 00:11:55,880
suppose workstation one creates a file
in you know maybe a file say /a a new

514
00:11:55,880 --> 00:11:55,890
in you know maybe a file say /a a new
 

515
00:11:55,890 --> 00:11:59,480
in you know maybe a file say /a a new
file /a and initially it just creates

516
00:11:59,480 --> 00:11:59,490
file /a and initially it just creates
 

517
00:11:59,490 --> 00:12:01,370
file /a and initially it just creates
this in its local cache so that you know

518
00:12:01,370 --> 00:12:01,380
this in its local cache so that you know
 

519
00:12:01,380 --> 00:12:03,019
this in its local cache so that you know
first it may need to fetch the current

520
00:12:03,019 --> 00:12:03,029
first it may need to fetch the current
 

521
00:12:03,029 --> 00:12:05,000
first it may need to fetch the current
contents of the slash directory from

522
00:12:05,000 --> 00:12:05,010
contents of the slash directory from
 

523
00:12:05,010 --> 00:12:06,920
contents of the slash directory from
petal nom but then when it creates a

524
00:12:06,920 --> 00:12:06,930
petal nom but then when it creates a
 

525
00:12:06,930 --> 00:12:10,100
petal nom but then when it creates a
file just modifies its cached copy and

526
00:12:10,100 --> 00:12:10,110
file just modifies its cached copy and
 

527
00:12:10,110 --> 00:12:11,240
file just modifies its cached copy and
doesn't immediately send it back to

528
00:12:11,240 --> 00:12:11,250
doesn't immediately send it back to
 

529
00:12:11,250 --> 00:12:14,449
doesn't immediately send it back to
peddle then there's an immediate problem

530
00:12:14,449 --> 00:12:14,459
peddle then there's an immediate problem
 

531
00:12:14,459 --> 00:12:17,240
peddle then there's an immediate problem
here suppose the user on workstation 2

532
00:12:17,240 --> 00:12:17,250
here suppose the user on workstation 2
 

533
00:12:17,250 --> 00:12:19,699
here suppose the user on workstation 2
tries to get a directory listing of the

534
00:12:19,699 --> 00:12:19,709
tries to get a directory listing of the
 

535
00:12:19,709 --> 00:12:21,920
tries to get a directory listing of the
directory slash right we'd really like

536
00:12:21,920 --> 00:12:21,930
directory slash right we'd really like
 

537
00:12:21,930 --> 00:12:24,710
directory slash right we'd really like
to be able to this user see the newly

538
00:12:24,710 --> 00:12:24,720
to be able to this user see the newly
 

539
00:12:24,720 --> 00:12:27,710
to be able to this user see the newly
created file right and that's what users

540
00:12:27,710 --> 00:12:27,720
created file right and that's what users
 

541
00:12:27,720 --> 00:12:29,329
created file right and that's what users
are gonna expect and users will be very

542
00:12:29,329 --> 00:12:29,339
are gonna expect and users will be very
 

543
00:12:29,339 --> 00:12:31,970
are gonna expect and users will be very
confused if you know person down the

544
00:12:31,970 --> 00:12:31,980
confused if you know person down the
 

545
00:12:31,980 --> 00:12:33,410
confused if you know person down the
hall from me created a file and said oh

546
00:12:33,410 --> 00:12:33,420
hall from me created a file and said oh
 

547
00:12:33,420 --> 00:12:34,400
hall from me created a file and said oh
you know I put all this interesting

548
00:12:34,400 --> 00:12:34,410
you know I put all this interesting
 

549
00:12:34,410 --> 00:12:36,350
you know I put all this interesting
information in this new file /a why

550
00:12:36,350 --> 00:12:36,360
information in this new file /a why
 

551
00:12:36,360 --> 00:12:37,850
information in this new file /a why
don't you go read it and then I try to

552
00:12:37,850 --> 00:12:37,860
don't you go read it and then I try to
 

553
00:12:37,860 --> 00:12:41,030
don't you go read it and then I try to
read it and it's totally not there so we

554
00:12:41,030 --> 00:12:41,040
read it and it's totally not there so we
 

555
00:12:41,040 --> 00:12:43,460
read it and it's totally not there so we
absolutely want very strong consistency

556
00:12:43,460 --> 00:12:43,470
absolutely want very strong consistency
 

557
00:12:43,470 --> 00:12:44,990
absolutely want very strong consistency
if the person down the hall says they've

558
00:12:44,990 --> 00:12:45,000
if the person down the hall says they've
 

559
00:12:45,000 --> 00:12:46,460
if the person down the hall says they've
done something in the file system I

560
00:12:46,460 --> 00:12:46,470
done something in the file system I
 

561
00:12:46,470 --> 00:12:49,190
done something in the file system I
should be able to see it and if I edit a

562
00:12:49,190 --> 00:12:49,200
should be able to see it and if I edit a
 

563
00:12:49,200 --> 00:12:51,710
should be able to see it and if I edit a
file on one work station and then maybe

564
00:12:51,710 --> 00:12:51,720
file on one work station and then maybe
 

565
00:12:51,720 --> 00:12:54,320
file on one work station and then maybe
compile it on a computer on another

566
00:12:54,320 --> 00:12:54,330
compile it on a computer on another
 

567
00:12:54,330 --> 00:12:56,840
compile it on a computer on another
computer I want the compiler to see the

568
00:12:56,840 --> 00:12:56,850
computer I want the compiler to see the
 

569
00:12:56,850 --> 00:12:58,490
computer I want the compiler to see the
modifications I just made to my file

570
00:12:58,490 --> 00:12:58,500
modifications I just made to my file
 

571
00:12:58,500 --> 00:13:01,069
modifications I just made to my file
which means that the file system has to

572
00:13:01,069 --> 00:13:01,079
which means that the file system has to
 

573
00:13:01,079 --> 00:13:05,530
which means that the file system has to
do something to ensure that readers see

574
00:13:05,530 --> 00:13:05,540
do something to ensure that readers see
 

575
00:13:05,540 --> 00:13:09,800
do something to ensure that readers see
even the most recent rights so we've

576
00:13:09,800 --> 00:13:09,810
even the most recent rights so we've
 

577
00:13:09,810 --> 00:13:11,269
even the most recent rights so we've
been talking about this as we've been

578
00:13:11,269 --> 00:13:11,279
been talking about this as we've been
 

579
00:13:11,279 --> 00:13:13,309
been talking about this as we've been
calling this you know strong strong

580
00:13:13,309 --> 00:13:13,319
calling this you know strong strong
 

581
00:13:13,319 --> 00:13:15,730
calling this you know strong strong
consistency and linearize ability before

582
00:13:15,730 --> 00:13:15,740
consistency and linearize ability before
 

583
00:13:15,740 --> 00:13:18,769
consistency and linearize ability before
and that's basically what we want in the

584
00:13:18,769 --> 00:13:18,779
and that's basically what we want in the
 

585
00:13:18,779 --> 00:13:20,840
and that's basically what we want in the
context of caches though like the issue

586
00:13:20,840 --> 00:13:20,850
context of caches though like the issue
 

587
00:13:20,850 --> 00:13:22,970
context of caches though like the issue
here is not really about the storage

588
00:13:22,970 --> 00:13:22,980
here is not really about the storage
 

589
00:13:22,980 --> 00:13:24,470
here is not really about the storage
server necessarily it's about the fact

590
00:13:24,470 --> 00:13:24,480
server necessarily it's about the fact
 

591
00:13:24,480 --> 00:13:26,360
server necessarily it's about the fact
that there was a modification here that

592
00:13:26,360 --> 00:13:26,370
that there was a modification here that
 

593
00:13:26,370 --> 00:13:28,850
that there was a modification here that
needs to be seen somewhere else and now

594
00:13:28,850 --> 00:13:28,860
needs to be seen somewhere else and now
 

595
00:13:28,860 --> 00:13:30,860
needs to be seen somewhere else and now
for historical reasons that's usually

596
00:13:30,860 --> 00:13:30,870
for historical reasons that's usually
 

597
00:13:30,870 --> 00:13:38,780
for historical reasons that's usually
called cache coherence that is the

598
00:13:38,780 --> 00:13:38,790
called cache coherence that is the
 

599
00:13:38,790 --> 00:13:41,869
called cache coherence that is the
property of a caching system that even

600
00:13:41,869 --> 00:13:41,879
property of a caching system that even
 

601
00:13:41,879 --> 00:13:43,639
property of a caching system that even
if I have an old version of something

602
00:13:43,639 --> 00:13:43,649
if I have an old version of something
 

603
00:13:43,649 --> 00:13:46,460
if I have an old version of something
cached if someone else modifies it in

604
00:13:46,460 --> 00:13:46,470
cached if someone else modifies it in
 

605
00:13:46,470 --> 00:13:48,259
cached if someone else modifies it in
their cache then my cache will

606
00:13:48,259 --> 00:13:48,269
their cache then my cache will
 

607
00:13:48,269 --> 00:13:50,780
their cache then my cache will
automatically reflect their

608
00:13:50,780 --> 00:13:50,790
automatically reflect their
 

609
00:13:50,790 --> 00:13:53,540
automatically reflect their
modifications so we want this cache

610
00:13:53,540 --> 00:13:53,550
modifications so we want this cache
 

611
00:13:53,550 --> 00:13:58,340
modifications so we want this cache
coherence property another issue you

612
00:13:58,340 --> 00:13:58,350
coherence property another issue you
 

613
00:13:58,350 --> 00:14:01,879
coherence property another issue you
have is that the you know everything all

614
00:14:01,879 --> 00:14:01,889
have is that the you know everything all
 

615
00:14:01,889 --> 00:14:03,860
have is that the you know everything all
the files and directories are shared we

616
00:14:03,860 --> 00:14:03,870
the files and directories are shared we
 

617
00:14:03,870 --> 00:14:05,869
the files and directories are shared we
could easily have a situation where two

618
00:14:05,869 --> 00:14:05,879
could easily have a situation where two
 

619
00:14:05,879 --> 00:14:09,049
could easily have a situation where two
different workstations are modifying the

620
00:14:09,049 --> 00:14:09,059
different workstations are modifying the
 

621
00:14:09,059 --> 00:14:11,210
different workstations are modifying the
same directory at the same time so

622
00:14:11,210 --> 00:14:11,220
same directory at the same time so
 

623
00:14:11,220 --> 00:14:14,240
same directory at the same time so
suppose again maybe the user one on

624
00:14:14,240 --> 00:14:14,250
suppose again maybe the user one on
 

625
00:14:14,250 --> 00:14:16,009
suppose again maybe the user one on
their workstation wants to create a file

626
00:14:16,009 --> 00:14:16,019
their workstation wants to create a file
 

627
00:14:16,019 --> 00:14:18,199
their workstation wants to create a file
/a which is a new file in the directory

628
00:14:18,199 --> 00:14:18,209
/a which is a new file in the directory
 

629
00:14:18,209 --> 00:14:20,179
/a which is a new file in the directory
slash in the new in the root directory

630
00:14:20,179 --> 00:14:20,189
slash in the new in the root directory
 

631
00:14:20,189 --> 00:14:24,019
slash in the new in the root directory
and at the same time user two wants to

632
00:14:24,019 --> 00:14:24,029
and at the same time user two wants to
 

633
00:14:24,029 --> 00:14:27,199
and at the same time user two wants to
create a new file called slash B so at

634
00:14:27,199 --> 00:14:27,209
create a new file called slash B so at
 

635
00:14:27,209 --> 00:14:29,240
create a new file called slash B so at
some level you know they're creating

636
00:14:29,240 --> 00:14:29,250
some level you know they're creating
 

637
00:14:29,250 --> 00:14:32,090
some level you know they're creating
different files alright a and B but they

638
00:14:32,090 --> 00:14:32,100
different files alright a and B but they
 

639
00:14:32,100 --> 00:14:33,530
different files alright a and B but they
both need to modify the root directory

640
00:14:33,530 --> 00:14:33,540
both need to modify the root directory
 

641
00:14:33,540 --> 00:14:35,389
both need to modify the root directory
to add a new name to the root directory

642
00:14:35,389 --> 00:14:35,399
to add a new name to the root directory
 

643
00:14:35,399 --> 00:14:38,030
to add a new name to the root directory
and so the question is even if they do

644
00:14:38,030 --> 00:14:38,040
and so the question is even if they do
 

645
00:14:38,040 --> 00:14:40,910
and so the question is even if they do
this simultaneously you know to file

646
00:14:40,910 --> 00:14:40,920
this simultaneously you know to file
 

647
00:14:40,920 --> 00:14:42,860
this simultaneously you know to file
creations of differently named files but

648
00:14:42,860 --> 00:14:42,870
creations of differently named files but
 

649
00:14:42,870 --> 00:14:44,329
creations of differently named files but
in the same directory from different

650
00:14:44,329 --> 00:14:44,339
in the same directory from different
 

651
00:14:44,339 --> 00:14:46,280
in the same directory from different
workstations will the system be able to

652
00:14:46,280 --> 00:14:46,290
workstations will the system be able to
 

653
00:14:46,290 --> 00:14:51,019
workstations will the system be able to
sort out these concurrent modifications

654
00:14:51,019 --> 00:14:51,029
sort out these concurrent modifications
 

655
00:14:51,029 --> 00:14:52,879
sort out these concurrent modifications
to the same directory and arrive at some

656
00:14:52,879 --> 00:14:52,889
to the same directory and arrive at some
 

657
00:14:52,889 --> 00:14:54,230
to the same directory and arrive at some
sensible result and of course the

658
00:14:54,230 --> 00:14:54,240
sensible result and of course the
 

659
00:14:54,240 --> 00:14:56,509
sensible result and of course the
sensible result we want is that both a

660
00:14:56,509 --> 00:14:56,519
sensible result we want is that both a
 

661
00:14:56,519 --> 00:14:58,939
sensible result we want is that both a
and B end up existing we don't want to

662
00:14:58,939 --> 00:14:58,949
and B end up existing we don't want to
 

663
00:14:58,949 --> 00:15:01,879
and B end up existing we don't want to
end up with some you know situation in

664
00:15:01,879 --> 00:15:01,889
end up with some you know situation in
 

665
00:15:01,889 --> 00:15:04,220
end up with some you know situation in
which only one of them ends up existing

666
00:15:04,220 --> 00:15:04,230
which only one of them ends up existing
 

667
00:15:04,230 --> 00:15:06,319
which only one of them ends up existing
because the second modification

668
00:15:06,319 --> 00:15:06,329
because the second modification
 

669
00:15:06,329 --> 00:15:10,249
because the second modification
overwrote and sort of superseded the

670
00:15:10,249 --> 00:15:10,259
overwrote and sort of superseded the
 

671
00:15:10,259 --> 00:15:15,430
overwrote and sort of superseded the
first modification

672
00:15:15,430 --> 00:15:15,440

 

673
00:15:15,440 --> 00:15:19,850

and so this is again it goes by a lot of

674
00:15:19,850 --> 00:15:19,860
and so this is again it goes by a lot of
 

675
00:15:19,860 --> 00:15:21,140
and so this is again it goes by a lot of
different names but we'll call it a de

676
00:15:21,140 --> 00:15:21,150
different names but we'll call it a de
 

677
00:15:21,150 --> 00:15:26,000
different names but we'll call it a de
Missa T we want operations such as

678
00:15:26,000 --> 00:15:26,010
Missa T we want operations such as
 

679
00:15:26,010 --> 00:15:28,760
Missa T we want operations such as
create a file to lead a file to act as

680
00:15:28,760 --> 00:15:28,770
create a file to lead a file to act as
 

681
00:15:28,770 --> 00:15:31,510
create a file to lead a file to act as
if they just are instantaneous

682
00:15:31,510 --> 00:15:31,520
if they just are instantaneous
 

683
00:15:31,520 --> 00:15:34,610
if they just are instantaneous
instantaneous and time and don't ever

684
00:15:34,610 --> 00:15:34,620
instantaneous and time and don't ever
 

685
00:15:34,620 --> 00:15:37,030
instantaneous and time and don't ever
therefore don't ever interfere with

686
00:15:37,030 --> 00:15:37,040
therefore don't ever interfere with
 

687
00:15:37,040 --> 00:15:39,920
therefore don't ever interfere with
operations that occur at similar times

688
00:15:39,920 --> 00:15:39,930
operations that occur at similar times
 

689
00:15:39,930 --> 00:15:41,450
operations that occur at similar times
by other workstations

690
00:15:41,450 --> 00:15:41,460
by other workstations
 

691
00:15:41,460 --> 00:15:43,460
by other workstations
well things to happen just at a point in

692
00:15:43,460 --> 00:15:43,470
well things to happen just at a point in
 

693
00:15:43,470 --> 00:15:46,070
well things to happen just at a point in
time and not be spread over even if

694
00:15:46,070 --> 00:15:46,080
time and not be spread over even if
 

695
00:15:46,080 --> 00:15:47,660
time and not be spread over even if
they're complex operations and involve

696
00:15:47,660 --> 00:15:47,670
they're complex operations and involve
 

697
00:15:47,670 --> 00:15:50,750
they're complex operations and involve
touching a lot of state we want them to

698
00:15:50,750 --> 00:15:50,760
touching a lot of state we want them to
 

699
00:15:50,760 --> 00:15:54,760
touching a lot of state we want them to
appear as if they occur instantaneously

700
00:15:54,760 --> 00:15:54,770
appear as if they occur instantaneously
 

701
00:15:54,770 --> 00:16:00,620
appear as if they occur instantaneously
at a final problem we have is suppose

702
00:16:00,620 --> 00:16:00,630
at a final problem we have is suppose
 

703
00:16:00,630 --> 00:16:04,220
at a final problem we have is suppose
you know my workstation is modified a

704
00:16:04,220 --> 00:16:04,230
you know my workstation is modified a
 

705
00:16:04,230 --> 00:16:05,540
you know my workstation is modified a
lot of stuff and maybe it's

706
00:16:05,540 --> 00:16:05,550
lot of stuff and maybe it's
 

707
00:16:05,550 --> 00:16:07,579
lot of stuff and maybe it's
modifications are or many of its

708
00:16:07,579 --> 00:16:07,589
modifications are or many of its
 

709
00:16:07,589 --> 00:16:10,250
modifications are or many of its
modifications are done only in the local

710
00:16:10,250 --> 00:16:10,260
modifications are done only in the local
 

711
00:16:10,260 --> 00:16:12,410
modifications are done only in the local
cache because of this right back caching

712
00:16:12,410 --> 00:16:12,420
cache because of this right back caching
 

713
00:16:12,420 --> 00:16:16,160
cache because of this right back caching
if my were station crashes after having

714
00:16:16,160 --> 00:16:16,170
if my were station crashes after having
 

715
00:16:16,170 --> 00:16:18,440
if my were station crashes after having
modified some stuff in its local cache

716
00:16:18,440 --> 00:16:18,450
modified some stuff in its local cache
 

717
00:16:18,450 --> 00:16:20,390
modified some stuff in its local cache
and maybe reflected some but not all

718
00:16:20,390 --> 00:16:20,400
and maybe reflected some but not all
 

719
00:16:20,400 --> 00:16:22,160
and maybe reflected some but not all
those modifications back to storage

720
00:16:22,160 --> 00:16:22,170
those modifications back to storage
 

721
00:16:22,170 --> 00:16:27,290
those modifications back to storage
pedal other workstations are still

722
00:16:27,290 --> 00:16:27,300
pedal other workstations are still
 

723
00:16:27,300 --> 00:16:29,510
pedal other workstations are still
executing and they still need to be able

724
00:16:29,510 --> 00:16:29,520
executing and they still need to be able
 

725
00:16:29,520 --> 00:16:32,000
executing and they still need to be able
to make sense of the file system so the

726
00:16:32,000 --> 00:16:32,010
to make sense of the file system so the
 

727
00:16:32,010 --> 00:16:34,280
to make sense of the file system so the
fact that my workstation crashed while I

728
00:16:34,280 --> 00:16:34,290
fact that my workstation crashed while I
 

729
00:16:34,290 --> 00:16:35,690
fact that my workstation crashed while I
was in the middle of something had

730
00:16:35,690 --> 00:16:35,700
was in the middle of something had
 

731
00:16:35,700 --> 00:16:38,300
was in the middle of something had
better not wreck the entire file system

732
00:16:38,300 --> 00:16:38,310
better not wreck the entire file system
 

733
00:16:38,310 --> 00:16:39,980
better not wreck the entire file system
for everybody else or even any part of

734
00:16:39,980 --> 00:16:39,990
for everybody else or even any part of
 

735
00:16:39,990 --> 00:16:45,320
for everybody else or even any part of
it so that means what we need is crash

736
00:16:45,320 --> 00:16:45,330
it so that means what we need is crash
 

737
00:16:45,330 --> 00:16:49,280
it so that means what we need is crash
recovery of individual servers we won't

738
00:16:49,280 --> 00:16:49,290
recovery of individual servers we won't
 

739
00:16:49,290 --> 00:16:51,070
recovery of individual servers we won't
be able to have my workstation crash

740
00:16:51,070 --> 00:16:51,080
be able to have my workstation crash
 

741
00:16:51,080 --> 00:16:53,840
be able to have my workstation crash
without disturbing the activity of

742
00:16:53,840 --> 00:16:53,850
without disturbing the activity of
 

743
00:16:53,850 --> 00:16:55,490
without disturbing the activity of
anybody else using the same shared

744
00:16:55,490 --> 00:16:55,500
anybody else using the same shared
 

745
00:16:55,500 --> 00:16:57,260
anybody else using the same shared
system even if they look at my directory

746
00:16:57,260 --> 00:16:57,270
system even if they look at my directory
 

747
00:16:57,270 --> 00:16:58,640
system even if they look at my directory
in my files they should see something

748
00:16:58,640 --> 00:16:58,650
in my files they should see something
 

749
00:16:58,650 --> 00:17:00,500
in my files they should see something
sensible maybe it won't include the very

750
00:17:00,500 --> 00:17:00,510
sensible maybe it won't include the very
 

751
00:17:00,510 --> 00:17:02,829
sensible maybe it won't include the very
last things I did but they should see a

752
00:17:02,829 --> 00:17:02,839
last things I did but they should see a
 

753
00:17:02,839 --> 00:17:06,140
last things I did but they should see a
consistent file system and not a rekt

754
00:17:06,140 --> 00:17:06,150
consistent file system and not a rekt
 

755
00:17:06,150 --> 00:17:08,240
consistent file system and not a rekt
file system data structure so we want

756
00:17:08,240 --> 00:17:08,250
file system data structure so we want
 

757
00:17:08,250 --> 00:17:13,850
file system data structure so we want
crash recovery

758
00:17:13,850 --> 00:17:13,860

 

759
00:17:13,860 --> 00:17:16,380

as always with distributed systems

760
00:17:16,380 --> 00:17:16,390
as always with distributed systems
 

761
00:17:16,390 --> 00:17:18,750
as always with distributed systems
that's made more complex because we can

762
00:17:18,750 --> 00:17:18,760
that's made more complex because we can
 

763
00:17:18,760 --> 00:17:20,550
that's made more complex because we can
easily have a situation where only one

764
00:17:20,550 --> 00:17:20,560
easily have a situation where only one
 

765
00:17:20,560 --> 00:17:22,890
easily have a situation where only one
of the servers crashes but the others

766
00:17:22,890 --> 00:17:22,900
of the servers crashes but the others
 

767
00:17:22,900 --> 00:17:27,210
of the servers crashes but the others
are running and again for all of these

768
00:17:27,210 --> 00:17:27,220
are running and again for all of these
 

769
00:17:27,220 --> 00:17:30,150
are running and again for all of these
things for all three of these challenges

770
00:17:30,150 --> 00:17:30,160
things for all three of these challenges
 

771
00:17:30,160 --> 00:17:32,160
things for all three of these challenges
they're really challenged we're in this

772
00:17:32,160 --> 00:17:32,170
they're really challenged we're in this
 

773
00:17:32,170 --> 00:17:34,290
they're really challenged we're in this
discussion their challenges about how

774
00:17:34,290 --> 00:17:34,300
discussion their challenges about how
 

775
00:17:34,300 --> 00:17:36,290
discussion their challenges about how
frangipani works and how these

776
00:17:36,290 --> 00:17:36,300
frangipani works and how these
 

777
00:17:36,300 --> 00:17:38,180
frangipani works and how these
frangipani

778
00:17:38,180 --> 00:17:38,190
frangipani
 

779
00:17:38,190 --> 00:17:40,800
frangipani
software inside the workstations work

780
00:17:40,800 --> 00:17:40,810
software inside the workstations work
 

781
00:17:40,810 --> 00:17:42,120
software inside the workstations work
and so when I talk about a crash I'm

782
00:17:42,120 --> 00:17:42,130
and so when I talk about a crash I'm
 

783
00:17:42,130 --> 00:17:43,470
and so when I talk about a crash I'm
talking about a crash of a workstation

784
00:17:43,470 --> 00:17:43,480
talking about a crash of a workstation
 

785
00:17:43,480 --> 00:17:46,620
talking about a crash of a workstation
and it's frangipani you know the pedal

786
00:17:46,620 --> 00:17:46,630
and it's frangipani you know the pedal
 

787
00:17:46,630 --> 00:17:50,070
and it's frangipani you know the pedal
virtual disk has many similar questions

788
00:17:50,070 --> 00:17:50,080
virtual disk has many similar questions
 

789
00:17:50,080 --> 00:17:51,840
virtual disk has many similar questions
associated with it but there are not

790
00:17:51,840 --> 00:17:51,850
associated with it but there are not
 

791
00:17:51,850 --> 00:17:55,460
associated with it but there are not
really the focus today it has a

792
00:17:55,460 --> 00:17:55,470
really the focus today it has a
 

793
00:17:55,470 --> 00:17:59,220
really the focus today it has a
completely separate set of R'lyeh fault

794
00:17:59,220 --> 00:17:59,230
completely separate set of R'lyeh fault
 

795
00:17:59,230 --> 00:18:02,580
completely separate set of R'lyeh fault
tolerance machinery built into pedal and

796
00:18:02,580 --> 00:18:02,590
tolerance machinery built into pedal and
 

797
00:18:02,590 --> 00:18:04,710
tolerance machinery built into pedal and
it's actually a lot like the chain

798
00:18:04,710 --> 00:18:04,720
it's actually a lot like the chain
 

799
00:18:04,720 --> 00:18:06,660
it's actually a lot like the chain
replication kind of systems we talked

800
00:18:06,660 --> 00:18:06,670
replication kind of systems we talked
 

801
00:18:06,670 --> 00:18:12,450
replication kind of systems we talked
about earlier ok so I'm going to talk

802
00:18:12,450 --> 00:18:12,460
about earlier ok so I'm going to talk
 

803
00:18:12,460 --> 00:18:15,260
about earlier ok so I'm going to talk
about each of these challenges in turn

804
00:18:15,260 --> 00:18:15,270
about each of these challenges in turn
 

805
00:18:15,270 --> 00:18:22,040
about each of these challenges in turn
the first challenge is cache coherence

806
00:18:22,040 --> 00:18:22,050

 

807
00:18:22,050 --> 00:18:29,610

and the game here is to get both the

808
00:18:29,610 --> 00:18:29,620
and the game here is to get both the
 

809
00:18:29,620 --> 00:18:32,670
and the game here is to get both the
benefits of both linearize ability that

810
00:18:32,670 --> 00:18:32,680
benefits of both linearize ability that
 

811
00:18:32,680 --> 00:18:35,160
benefits of both linearize ability that
is when I read when I look at anything

812
00:18:35,160 --> 00:18:35,170
is when I read when I look at anything
 

813
00:18:35,170 --> 00:18:36,840
is when I read when I look at anything
in the filesystem I always see fresh

814
00:18:36,840 --> 00:18:36,850
in the filesystem I always see fresh
 

815
00:18:36,850 --> 00:18:38,700
in the filesystem I always see fresh
data I always see the very latest data

816
00:18:38,700 --> 00:18:38,710
data I always see the very latest data
 

817
00:18:38,710 --> 00:18:42,200
data I always see the very latest data
so we got both linearize ability and

818
00:18:42,200 --> 00:18:42,210
so we got both linearize ability and
 

819
00:18:42,210 --> 00:18:45,360
so we got both linearize ability and
caching not caching that's good caching

820
00:18:45,360 --> 00:18:45,370
caching not caching that's good caching
 

821
00:18:45,370 --> 00:18:48,090
caching not caching that's good caching
as we can get for performance so somehow

822
00:18:48,090 --> 00:18:48,100
as we can get for performance so somehow
 

823
00:18:48,100 --> 00:18:50,220
as we can get for performance so somehow
we you know we need to get the benefits

824
00:18:50,220 --> 00:18:50,230
we you know we need to get the benefits
 

825
00:18:50,230 --> 00:18:56,460
we you know we need to get the benefits
of both of these and the kind of that

826
00:18:56,460 --> 00:18:56,470
of both of these and the kind of that
 

827
00:18:56,470 --> 00:18:59,000
of both of these and the kind of that
people implement cache coherence that is

828
00:18:59,000 --> 00:18:59,010
people implement cache coherence that is
 

829
00:18:59,010 --> 00:19:01,110
people implement cache coherence that is
using what are called cache coherence

830
00:19:01,110 --> 00:19:01,120
using what are called cache coherence
 

831
00:19:01,120 --> 00:19:02,850
using what are called cache coherence
protocols and it turns out these

832
00:19:02,850 --> 00:19:02,860
protocols and it turns out these
 

833
00:19:02,860 --> 00:19:04,500
protocols and it turns out these
protocols are used a lot in many

834
00:19:04,500 --> 00:19:04,510
protocols are used a lot in many
 

835
00:19:04,510 --> 00:19:06,210
protocols are used a lot in many
different situations not just

836
00:19:06,210 --> 00:19:06,220
different situations not just
 

837
00:19:06,220 --> 00:19:08,760
different situations not just
distributed file systems but also things

838
00:19:08,760 --> 00:19:08,770
distributed file systems but also things
 

839
00:19:08,770 --> 00:19:12,540
distributed file systems but also things
like the caches in multi-core the per

840
00:19:12,540 --> 00:19:12,550
like the caches in multi-core the per
 

841
00:19:12,550 --> 00:19:14,870
like the caches in multi-core the per
core caches in multi core processors

842
00:19:14,870 --> 00:19:14,880
core caches in multi core processors
 

843
00:19:14,880 --> 00:19:17,550
core caches in multi core processors
also use cache coherence protocols which

844
00:19:17,550 --> 00:19:17,560
also use cache coherence protocols which
 

845
00:19:17,560 --> 00:19:20,610
also use cache coherence protocols which
are going to be not unlike the protocols

846
00:19:20,610 --> 00:19:20,620
are going to be not unlike the protocols
 

847
00:19:20,620 --> 00:19:23,340
are going to be not unlike the protocols
I'm going to describe for frangipani all

848
00:19:23,340 --> 00:19:23,350
I'm going to describe for frangipani all
 

849
00:19:23,350 --> 00:19:23,690
I'm going to describe for frangipani all
right

850
00:19:23,690 --> 00:19:23,700
right
 

851
00:19:23,700 --> 00:19:29,090
right
so it turns out that frangipani x' cache

852
00:19:29,090 --> 00:19:29,100
so it turns out that frangipani x' cache
 

853
00:19:29,100 --> 00:19:32,120
so it turns out that frangipani x' cache
coherence is driven by its use of locks

854
00:19:32,120 --> 00:19:32,130
coherence is driven by its use of locks
 

855
00:19:32,130 --> 00:19:34,669
coherence is driven by its use of locks
and we'll see locks come up later in

856
00:19:34,669 --> 00:19:34,679
and we'll see locks come up later in
 

857
00:19:34,679 --> 00:19:37,159
and we'll see locks come up later in
both actually for both atomicity and

858
00:19:37,159 --> 00:19:37,169
both actually for both atomicity and
 

859
00:19:37,169 --> 00:19:39,470
both actually for both atomicity and
crash recovery but the particular use of

860
00:19:39,470 --> 00:19:39,480
crash recovery but the particular use of
 

861
00:19:39,480 --> 00:19:41,120
crash recovery but the particular use of
locks I'm going to talk about for now is

862
00:19:41,120 --> 00:19:41,130
locks I'm going to talk about for now is
 

863
00:19:41,130 --> 00:19:43,190
locks I'm going to talk about for now is
a use of blocks to drive cache coherence

864
00:19:43,190 --> 00:19:43,200
a use of blocks to drive cache coherence
 

865
00:19:43,200 --> 00:19:45,139
a use of blocks to drive cache coherence
to help workstations ensure that even

866
00:19:45,139 --> 00:19:45,149
to help workstations ensure that even
 

867
00:19:45,149 --> 00:19:46,909
to help workstations ensure that even
though they're caching data they're

868
00:19:46,909 --> 00:19:46,919
though they're caching data they're
 

869
00:19:46,919 --> 00:19:51,019
though they're caching data they're
caching the latest data so as well as

870
00:19:51,019 --> 00:19:51,029
caching the latest data so as well as
 

871
00:19:51,029 --> 00:19:52,940
caching the latest data so as well as
the frangipani servers and workstations

872
00:19:52,940 --> 00:19:52,950
the frangipani servers and workstations
 

873
00:19:52,950 --> 00:19:55,879
the frangipani servers and workstations
and pedal servers there's a third kind

874
00:19:55,879 --> 00:19:55,889
and pedal servers there's a third kind
 

875
00:19:55,889 --> 00:19:59,779
and pedal servers there's a third kind
of server in the frangipani system

876
00:19:59,779 --> 00:19:59,789
of server in the frangipani system
 

877
00:19:59,789 --> 00:20:02,720
of server in the frangipani system
there's lock servers and so we're I'm

878
00:20:02,720 --> 00:20:02,730
there's lock servers and so we're I'm
 

879
00:20:02,730 --> 00:20:04,549
there's lock servers and so we're I'm
just gonna pretend there's one lock

880
00:20:04,549 --> 00:20:04,559
just gonna pretend there's one lock
 

881
00:20:04,559 --> 00:20:06,860
just gonna pretend there's one lock
server although you could shard the

882
00:20:06,860 --> 00:20:06,870
server although you could shard the
 

883
00:20:06,870 --> 00:20:10,039
server although you could shard the
locks over multiple servers so here's a

884
00:20:10,039 --> 00:20:10,049
locks over multiple servers so here's a
 

885
00:20:10,049 --> 00:20:16,460
locks over multiple servers so here's a
lock server it's a separate you know

886
00:20:16,460 --> 00:20:16,470
lock server it's a separate you know
 

887
00:20:16,470 --> 00:20:17,899
lock server it's a separate you know
it's logically at least a separate

888
00:20:17,899 --> 00:20:17,909
it's logically at least a separate
 

889
00:20:17,909 --> 00:20:19,490
it's logically at least a separate
computer although I think they ran them

890
00:20:19,490 --> 00:20:19,500
computer although I think they ran them
 

891
00:20:19,500 --> 00:20:21,259
computer although I think they ran them
on the same hardware as the pedal

892
00:20:21,259 --> 00:20:21,269
on the same hardware as the pedal
 

893
00:20:21,269 --> 00:20:24,649
on the same hardware as the pedal
servers but it basically just has a

894
00:20:24,649 --> 00:20:24,659
servers but it basically just has a
 

895
00:20:24,659 --> 00:20:29,659
servers but it basically just has a
table of named locks and locks are named

896
00:20:29,659 --> 00:20:29,669
table of named locks and locks are named
 

897
00:20:29,669 --> 00:20:32,060
table of named locks and locks are named
we'll consider them to be named after a

898
00:20:32,060 --> 00:20:32,070
we'll consider them to be named after a
 

899
00:20:32,070 --> 00:20:34,669
we'll consider them to be named after a
named as after file names although in

900
00:20:34,669 --> 00:20:34,679
named as after file names although in
 

901
00:20:34,679 --> 00:20:37,129
named as after file names although in
fact they're named after I numbers so we

902
00:20:37,129 --> 00:20:37,139
fact they're named after I numbers so we
 

903
00:20:37,139 --> 00:20:43,610
fact they're named after I numbers so we
have for every file we have a lock

904
00:20:43,610 --> 00:20:43,620
have for every file we have a lock
 

905
00:20:43,620 --> 00:20:48,620
have for every file we have a lock
potentially and each lock is possibly

906
00:20:48,620 --> 00:20:48,630
potentially and each lock is possibly
 

907
00:20:48,630 --> 00:20:51,529
potentially and each lock is possibly
owned by some owner for this discussion

908
00:20:51,529 --> 00:20:51,539
owned by some owner for this discussion
 

909
00:20:51,539 --> 00:20:54,230
owned by some owner for this discussion
I'm just gonna assume I'm gonna describe

910
00:20:54,230 --> 00:20:54,240
I'm just gonna assume I'm gonna describe
 

911
00:20:54,240 --> 00:20:56,120
I'm just gonna assume I'm gonna describe
it as if the locks were exclusive locks

912
00:20:56,120 --> 00:20:56,130
it as if the locks were exclusive locks
 

913
00:20:56,130 --> 00:20:58,759
it as if the locks were exclusive locks
although in fact frangipani has a more

914
00:20:58,759 --> 00:20:58,769
although in fact frangipani has a more
 

915
00:20:58,769 --> 00:21:01,039
although in fact frangipani has a more
complicated scheme for locks that allow

916
00:21:01,039 --> 00:21:01,049
complicated scheme for locks that allow
 

917
00:21:01,049 --> 00:21:03,889
complicated scheme for locks that allow
either one writer or multiple readers so

918
00:21:03,889 --> 00:21:03,899
either one writer or multiple readers so
 

919
00:21:03,899 --> 00:21:08,269
either one writer or multiple readers so
for example maybe file X has recently

920
00:21:08,269 --> 00:21:08,279
for example maybe file X has recently
 

921
00:21:08,279 --> 00:21:10,519
for example maybe file X has recently
been used by workstation 1 and

922
00:21:10,519 --> 00:21:10,529
been used by workstation 1 and
 

923
00:21:10,529 --> 00:21:15,019
been used by workstation 1 and
workstation 1 has a lock on it and maybe

924
00:21:15,019 --> 00:21:15,029
workstation 1 has a lock on it and maybe
 

925
00:21:15,029 --> 00:21:17,509
workstation 1 has a lock on it and maybe
file Y is recently used by workstation 2

926
00:21:17,509 --> 00:21:17,519
file Y is recently used by workstation 2
 

927
00:21:17,519 --> 00:21:20,029
file Y is recently used by workstation 2
and workstation 2 has a lock on it and

928
00:21:20,029 --> 00:21:20,039
and workstation 2 has a lock on it and
 

929
00:21:20,039 --> 00:21:21,500
and workstation 2 has a lock on it and
the lock server will remember off or

930
00:21:21,500 --> 00:21:21,510
the lock server will remember off or
 

931
00:21:21,510 --> 00:21:22,190
the lock server will remember off or
each file

932
00:21:22,190 --> 00:21:22,200
each file
 

933
00:21:22,200 --> 00:21:24,289
each file
who has the lock if anyone maybe nobody

934
00:21:24,289 --> 00:21:24,299
who has the lock if anyone maybe nobody
 

935
00:21:24,299 --> 00:21:28,250
who has the lock if anyone maybe nobody
does on that file and then in each

936
00:21:28,250 --> 00:21:28,260
does on that file and then in each
 

937
00:21:28,260 --> 00:21:29,860
does on that file and then in each
workstation

938
00:21:29,860 --> 00:21:29,870
workstation
 

939
00:21:29,870 --> 00:21:33,769
workstation
each workstation keeps track of which

940
00:21:33,769 --> 00:21:33,779
each workstation keeps track of which
 

941
00:21:33,779 --> 00:21:36,080
each workstation keeps track of which
locks it holds and this is tightly tied

942
00:21:36,080 --> 00:21:36,090
locks it holds and this is tightly tied
 

943
00:21:36,090 --> 00:21:37,100
locks it holds and this is tightly tied
to it

944
00:21:37,100 --> 00:21:37,110
to it
 

945
00:21:37,110 --> 00:21:38,989
to it
I'm keeping track of cache data as well

946
00:21:38,989 --> 00:21:38,999
I'm keeping track of cache data as well
 

947
00:21:38,999 --> 00:21:42,430
I'm keeping track of cache data as well
so in each workstations frangipani

948
00:21:42,430 --> 00:21:42,440
so in each workstations frangipani
 

949
00:21:42,440 --> 00:21:52,989
so in each workstations frangipani
module there's also a lock table and

950
00:21:52,989 --> 00:21:52,999

 

951
00:21:52,999 --> 00:21:55,879

record what file the more session to

952
00:21:55,879 --> 00:21:55,889
record what file the more session to
 

953
00:21:55,889 --> 00:21:59,979
record what file the more session to
lock for what kind of lock it has and

954
00:21:59,979 --> 00:21:59,989
lock for what kind of lock it has and
 

955
00:21:59,989 --> 00:22:03,200
lock for what kind of lock it has and
the contents the cached contents of that

956
00:22:03,200 --> 00:22:03,210
the contents the cached contents of that
 

957
00:22:03,210 --> 00:22:04,700
the contents the cached contents of that
file so that might be a whole bunch of

958
00:22:04,700 --> 00:22:04,710
file so that might be a whole bunch of
 

959
00:22:04,710 --> 00:22:07,279
file so that might be a whole bunch of
data blocks or maybe directory contents

960
00:22:07,279 --> 00:22:07,289
data blocks or maybe directory contents
 

961
00:22:07,289 --> 00:22:10,310
data blocks or maybe directory contents
for example so there's a lot of content

962
00:22:10,310 --> 00:22:10,320
for example so there's a lot of content
 

963
00:22:10,320 --> 00:22:14,450
for example so there's a lot of content
here so Linda frangipani server decides

964
00:22:14,450 --> 00:22:14,460
here so Linda frangipani server decides
 

965
00:22:14,460 --> 00:22:17,090
here so Linda frangipani server decides
oh it needs to read it needs to use the

966
00:22:17,090 --> 00:22:17,100
oh it needs to read it needs to use the
 

967
00:22:17,100 --> 00:22:19,310
oh it needs to read it needs to use the
directory slash or look at the file a or

968
00:22:19,310 --> 00:22:19,320
directory slash or look at the file a or
 

969
00:22:19,320 --> 00:22:22,669
directory slash or look at the file a or
look at an inode it first gets asked the

970
00:22:22,669 --> 00:22:22,679
look at an inode it first gets asked the
 

971
00:22:22,679 --> 00:22:24,379
look at an inode it first gets asked the
lock server for a lock on whatever it's

972
00:22:24,379 --> 00:22:24,389
lock server for a lock on whatever it's
 

973
00:22:24,389 --> 00:22:26,989
lock server for a lock on whatever it's
about to use and then it asks petal to

974
00:22:26,989 --> 00:22:26,999
about to use and then it asks petal to
 

975
00:22:26,999 --> 00:22:30,139
about to use and then it asks petal to
get the data for whatever that file or

976
00:22:30,139 --> 00:22:30,149
get the data for whatever that file or
 

977
00:22:30,149 --> 00:22:32,359
get the data for whatever that file or
directory or whatever it is and it needs

978
00:22:32,359 --> 00:22:32,369
directory or whatever it is and it needs
 

979
00:22:32,369 --> 00:22:34,399
directory or whatever it is and it needs
to read and then the workstation

980
00:22:34,399 --> 00:22:34,409
to read and then the workstation
 

981
00:22:34,409 --> 00:22:36,529
to read and then the workstation
remembers oh ho you know I have a copy

982
00:22:36,529 --> 00:22:36,539
remembers oh ho you know I have a copy
 

983
00:22:36,539 --> 00:22:41,599
remembers oh ho you know I have a copy
of file X its content is whatever the

984
00:22:41,599 --> 00:22:41,609
of file X its content is whatever the
 

985
00:22:41,609 --> 00:22:46,580
of file X its content is whatever the
content of file X is cached and it turns

986
00:22:46,580 --> 00:22:46,590
content of file X is cached and it turns
 

987
00:22:46,590 --> 00:22:48,590
content of file X is cached and it turns
out that workstations can have a lock in

988
00:22:48,590 --> 00:22:48,600
out that workstations can have a lock in
 

989
00:22:48,600 --> 00:22:51,950
out that workstations can have a lock in
at least two different modes what the

990
00:22:51,950 --> 00:22:51,960
at least two different modes what the
 

991
00:22:51,960 --> 00:22:54,649
at least two different modes what the
workstation can be actively reading or

992
00:22:54,649 --> 00:22:54,659
workstation can be actively reading or
 

993
00:22:54,659 --> 00:22:56,960
workstation can be actively reading or
writing whatever that file or directory

994
00:22:56,960 --> 00:22:56,970
writing whatever that file or directory
 

995
00:22:56,970 --> 00:22:59,119
writing whatever that file or directory
is right now that it's in the middle of

996
00:22:59,119 --> 00:22:59,129
is right now that it's in the middle of
 

997
00:22:59,129 --> 00:23:01,789
is right now that it's in the middle of
a file creation operation or deletion or

998
00:23:01,789 --> 00:23:01,799
a file creation operation or deletion or
 

999
00:23:01,799 --> 00:23:05,389
a file creation operation or deletion or
rename or something so in that case I'll

1000
00:23:05,389 --> 00:23:05,399
rename or something so in that case I'll
 

1001
00:23:05,399 --> 00:23:09,369
rename or something so in that case I'll
say that the lock is held by the

1002
00:23:09,369 --> 00:23:09,379
say that the lock is held by the
 

1003
00:23:09,379 --> 00:23:12,759
say that the lock is held by the
workstation and is busy it could also be

1004
00:23:12,759 --> 00:23:12,769
workstation and is busy it could also be
 

1005
00:23:12,769 --> 00:23:16,039
workstation and is busy it could also be
after a workstation has done some

1006
00:23:16,039 --> 00:23:16,049
after a workstation has done some
 

1007
00:23:16,049 --> 00:23:17,989
after a workstation has done some
operation like create a file or maybe

1008
00:23:17,989 --> 00:23:17,999
operation like create a file or maybe
 

1009
00:23:17,999 --> 00:23:18,769
operation like create a file or maybe
read a file

1010
00:23:18,769 --> 00:23:18,779
read a file
 

1011
00:23:18,779 --> 00:23:20,629
read a file
you know then release the lock as soon

1012
00:23:20,629 --> 00:23:20,639
you know then release the lock as soon
 

1013
00:23:20,639 --> 00:23:22,129
you know then release the lock as soon
as it's done with that system call

1014
00:23:22,129 --> 00:23:22,139
as it's done with that system call
 

1015
00:23:22,139 --> 00:23:24,139
as it's done with that system call
whatever system call like rename or read

1016
00:23:24,139 --> 00:23:24,149
whatever system call like rename or read
 

1017
00:23:24,149 --> 00:23:25,849
whatever system call like rename or read
or write or create as soon as the system

1018
00:23:25,849 --> 00:23:25,859
or write or create as soon as the system
 

1019
00:23:25,859 --> 00:23:27,649
or write or create as soon as the system
calls over the workstation will give up

1020
00:23:27,649 --> 00:23:27,659
calls over the workstation will give up
 

1021
00:23:27,659 --> 00:23:31,970
calls over the workstation will give up
the lock at least internally it's not

1022
00:23:31,970 --> 00:23:31,980
the lock at least internally it's not
 

1023
00:23:31,980 --> 00:23:34,279
the lock at least internally it's not
actively using that file anymore but

1024
00:23:34,279 --> 00:23:34,289
actively using that file anymore but
 

1025
00:23:34,289 --> 00:23:36,109
actively using that file anymore but
it'll as far as the lock server is

1026
00:23:36,109 --> 00:23:36,119
it'll as far as the lock server is
 

1027
00:23:36,119 --> 00:23:37,729
it'll as far as the lock server is
concerned the workstation will hold the

1028
00:23:37,729 --> 00:23:37,739
concerned the workstation will hold the
 

1029
00:23:37,739 --> 00:23:39,799
concerned the workstation will hold the
lock but the workstation notes for it

1030
00:23:39,799 --> 00:23:39,809
lock but the workstation notes for it
 

1031
00:23:39,809 --> 00:23:42,889
lock but the workstation notes for it
its own use that it's not actively using

1032
00:23:42,889 --> 00:23:42,899
its own use that it's not actively using
 

1033
00:23:42,899 --> 00:23:45,259
its own use that it's not actively using
that lock anymore as well call that the

1034
00:23:45,259 --> 00:23:45,269
that lock anymore as well call that the
 

1035
00:23:45,269 --> 00:23:49,160
that lock anymore as well call that the
lock is still held by the workstation

1036
00:23:49,160 --> 00:23:49,170
lock is still held by the workstation
 

1037
00:23:49,170 --> 00:23:54,420
lock is still held by the workstation
I'm just but the work station isn't

1038
00:23:54,420 --> 00:23:54,430
I'm just but the work station isn't
 

1039
00:23:54,430 --> 00:23:57,120
I'm just but the work station isn't
really using it and that'll be important

1040
00:23:57,120 --> 00:23:57,130
really using it and that'll be important
 

1041
00:23:57,130 --> 00:24:01,350
really using it and that'll be important
in a moment okay so I think these two

1042
00:24:01,350 --> 00:24:01,360
in a moment okay so I think these two
 

1043
00:24:01,360 --> 00:24:02,910
in a moment okay so I think these two
are set up consistently if we assume

1044
00:24:02,910 --> 00:24:02,920
are set up consistently if we assume
 

1045
00:24:02,920 --> 00:24:05,040
are set up consistently if we assume
this is workstation one the lock server

1046
00:24:05,040 --> 00:24:05,050
this is workstation one the lock server
 

1047
00:24:05,050 --> 00:24:07,410
this is workstation one the lock server
knows Oh locks for x and y exists and

1048
00:24:07,410 --> 00:24:07,420
knows Oh locks for x and y exists and
 

1049
00:24:07,420 --> 00:24:08,610
knows Oh locks for x and y exists and
they're both held by workstation one

1050
00:24:08,610 --> 00:24:08,620
they're both held by workstation one
 

1051
00:24:08,620 --> 00:24:11,460
they're both held by workstation one
workstation one has equivalent

1052
00:24:11,460 --> 00:24:11,470
workstation one has equivalent
 

1053
00:24:11,470 --> 00:24:13,080
workstation one has equivalent
information in its table it knows it's

1054
00:24:13,080 --> 00:24:13,090
information in its table it knows it's
 

1055
00:24:13,090 --> 00:24:15,780
information in its table it knows it's
holding these two blocks and furthermore

1056
00:24:15,780 --> 00:24:15,790
holding these two blocks and furthermore
 

1057
00:24:15,790 --> 00:24:18,000
holding these two blocks and furthermore
it has the it's remembering the content

1058
00:24:18,000 --> 00:24:18,010
it has the it's remembering the content
 

1059
00:24:18,010 --> 00:24:20,430
it has the it's remembering the content
is cached for the filers of directories

1060
00:24:20,430 --> 00:24:20,440
is cached for the filers of directories
 

1061
00:24:20,440 --> 00:24:26,550
is cached for the filers of directories
that the two locks cover there's a

1062
00:24:26,550 --> 00:24:26,560
that the two locks cover there's a
 

1063
00:24:26,560 --> 00:24:28,980
that the two locks cover there's a
number of rules here that in that

1064
00:24:28,980 --> 00:24:28,990
number of rules here that in that
 

1065
00:24:28,990 --> 00:24:32,670
number of rules here that in that
frangipani follows that caused it to use

1066
00:24:32,670 --> 00:24:32,680
frangipani follows that caused it to use
 

1067
00:24:32,680 --> 00:24:35,100
frangipani follows that caused it to use
locks in a way that provide cache

1068
00:24:35,100 --> 00:24:35,110
locks in a way that provide cache
 

1069
00:24:35,110 --> 00:24:36,840
locks in a way that provide cache
coherence then sure nobody's ever

1070
00:24:36,840 --> 00:24:36,850
coherence then sure nobody's ever
 

1071
00:24:36,850 --> 00:24:38,850
coherence then sure nobody's ever
meaning using stale data from their

1072
00:24:38,850 --> 00:24:38,860
meaning using stale data from their
 

1073
00:24:38,860 --> 00:24:46,100
meaning using stale data from their
cache so so these are basically rules

1074
00:24:46,100 --> 00:24:46,110

 

1075
00:24:46,110 --> 00:24:48,300

that are using conjunction with the

1076
00:24:48,300 --> 00:24:48,310
that are using conjunction with the
 

1077
00:24:48,310 --> 00:24:53,460
that are using conjunction with the
locks and cache data so one the really

1078
00:24:53,460 --> 00:24:53,470
locks and cache data so one the really
 

1079
00:24:53,470 --> 00:24:58,230
locks and cache data so one the really
overriding invariant here is that no

1080
00:24:58,230 --> 00:24:58,240
overriding invariant here is that no
 

1081
00:24:58,240 --> 00:25:00,600
overriding invariant here is that no
workstation is allowed to cache data to

1082
00:25:00,600 --> 00:25:00,610
workstation is allowed to cache data to
 

1083
00:25:00,610 --> 00:25:02,460
workstation is allowed to cache data to
hold any cached data unless it also

1084
00:25:02,460 --> 00:25:02,470
hold any cached data unless it also
 

1085
00:25:02,470 --> 00:25:05,430
hold any cached data unless it also
holds the lock associated with that data

1086
00:25:05,430 --> 00:25:05,440
holds the lock associated with that data
 

1087
00:25:05,440 --> 00:25:13,470
holds the lock associated with that data
so basically it's no cache data without

1088
00:25:13,470 --> 00:25:13,480
so basically it's no cache data without
 

1089
00:25:13,480 --> 00:25:17,730
so basically it's no cache data without
a lock without the lock that protects

1090
00:25:17,730 --> 00:25:17,740
a lock without the lock that protects
 

1091
00:25:17,740 --> 00:25:21,510
a lock without the lock that protects
that data and operationally what this

1092
00:25:21,510 --> 00:25:21,520
that data and operationally what this
 

1093
00:25:21,520 --> 00:25:25,140
that data and operationally what this
means is a workstation before it uses

1094
00:25:25,140 --> 00:25:25,150
means is a workstation before it uses
 

1095
00:25:25,150 --> 00:25:27,360
means is a workstation before it uses
data it first acquires the lock on the

1096
00:25:27,360 --> 00:25:27,370
data it first acquires the lock on the
 

1097
00:25:27,370 --> 00:25:29,580
data it first acquires the lock on the
data from the lock server and after the

1098
00:25:29,580 --> 00:25:29,590
data from the lock server and after the
 

1099
00:25:29,590 --> 00:25:32,340
data from the lock server and after the
workstation has the lock only then does

1100
00:25:32,340 --> 00:25:32,350
workstation has the lock only then does
 

1101
00:25:32,350 --> 00:25:34,590
workstation has the lock only then does
the workstation read the data from petal

1102
00:25:34,590 --> 00:25:34,600
the workstation read the data from petal
 

1103
00:25:34,600 --> 00:25:40,050
the workstation read the data from petal
and put it and put it in its cache so so

1104
00:25:40,050 --> 00:25:40,060
and put it and put it in its cache so so
 

1105
00:25:40,060 --> 00:25:41,820
and put it and put it in its cache so so
the sequence is you can acquire a lock

1106
00:25:41,820 --> 00:25:41,830
the sequence is you can acquire a lock
 

1107
00:25:41,830 --> 00:25:50,460
the sequence is you can acquire a lock
and then read from petal

1108
00:25:50,460 --> 00:25:50,470

 

1109
00:25:50,470 --> 00:25:53,620

I'll tell you at the lock of course you

1110
00:25:53,620 --> 00:25:53,630
I'll tell you at the lock of course you
 

1111
00:25:53,630 --> 00:25:55,210
I'll tell you at the lock of course you
know you weren't passing the data you

1112
00:25:55,210 --> 00:25:55,220
know you weren't passing the data you
 

1113
00:25:55,220 --> 00:25:56,470
know you weren't passing the data you
want to catch the data you first got to

1114
00:25:56,470 --> 00:25:56,480
want to catch the data you first got to
 

1115
00:25:56,480 --> 00:25:58,030
want to catch the data you first got to
get the lock and only strictly

1116
00:25:58,030 --> 00:25:58,040
get the lock and only strictly
 

1117
00:25:58,040 --> 00:26:02,290
get the lock and only strictly
afterwards read from petal and if you

1118
00:26:02,290 --> 00:26:02,300
afterwards read from petal and if you
 

1119
00:26:02,300 --> 00:26:05,950
afterwards read from petal and if you
ever release a lock then the rule is

1120
00:26:05,950 --> 00:26:05,960
ever release a lock then the rule is
 

1121
00:26:05,960 --> 00:26:07,990
ever release a lock then the rule is
that before releasing a lock you first

1122
00:26:07,990 --> 00:26:08,000
that before releasing a lock you first
 

1123
00:26:08,000 --> 00:26:10,090
that before releasing a lock you first
have to write if you modified the lock

1124
00:26:10,090 --> 00:26:10,100
have to write if you modified the lock
 

1125
00:26:10,100 --> 00:26:13,330
have to write if you modified the lock
data in your cache before you release

1126
00:26:13,330 --> 00:26:13,340
data in your cache before you release
 

1127
00:26:13,340 --> 00:26:15,430
data in your cache before you release
the lock you have to write the data back

1128
00:26:15,430 --> 00:26:15,440
the lock you have to write the data back
 

1129
00:26:15,440 --> 00:26:18,190
the lock you have to write the data back
to modify data back to petal and then

1130
00:26:18,190 --> 00:26:18,200
to modify data back to petal and then
 

1131
00:26:18,200 --> 00:26:20,230
to modify data back to petal and then
only when petals as yes I got the data

1132
00:26:20,230 --> 00:26:20,240
only when petals as yes I got the data
 

1133
00:26:20,240 --> 00:26:22,060
only when petals as yes I got the data
only then you'll have to release the

1134
00:26:22,060 --> 00:26:22,070
only then you'll have to release the
 

1135
00:26:22,070 --> 00:26:23,830
only then you'll have to release the
lock that is gives a lock back to the

1136
00:26:23,830 --> 00:26:23,840
lock that is gives a lock back to the
 

1137
00:26:23,840 --> 00:26:27,120
lock that is gives a lock back to the
lock server so the sequence is always

1138
00:26:27,120 --> 00:26:27,130
lock server so the sequence is always
 

1139
00:26:27,130 --> 00:26:31,920
lock server so the sequence is always
first you write the cache dated a petal

1140
00:26:31,920 --> 00:26:31,930
first you write the cache dated a petal
 

1141
00:26:31,930 --> 00:26:40,680
first you write the cache dated a petal
storage system and then release the lock

1142
00:26:40,680 --> 00:26:40,690

 

1143
00:26:40,690 --> 00:26:43,750

and erase the entry whoops

1144
00:26:43,750 --> 00:26:43,760
and erase the entry whoops
 

1145
00:26:43,760 --> 00:26:45,400
and erase the entry whoops
erase the entry and the cat and the

1146
00:26:45,400 --> 00:26:45,410
erase the entry and the cat and the
 

1147
00:26:45,410 --> 00:26:47,590
erase the entry and the cat and the
cache data from your from that

1148
00:26:47,590 --> 00:26:47,600
cache data from your from that
 

1149
00:26:47,600 --> 00:26:52,150
cache data from your from that
workstations lock table what this

1150
00:26:52,150 --> 00:26:52,160
workstations lock table what this
 

1151
00:26:52,160 --> 00:26:55,240
workstations lock table what this
results in the the protocol between the

1152
00:26:55,240 --> 00:26:55,250
results in the the protocol between the
 

1153
00:26:55,250 --> 00:26:57,940
results in the the protocol between the
lock server and between the workstations

1154
00:26:57,940 --> 00:26:57,950
lock server and between the workstations
 

1155
00:26:57,950 --> 00:27:01,930
lock server and between the workstations
and the lock server consists of four

1156
00:27:01,930 --> 00:27:01,940
and the lock server consists of four
 

1157
00:27:01,940 --> 00:27:04,060
and the lock server consists of four
different kinds of messages this is the

1158
00:27:04,060 --> 00:27:04,070
different kinds of messages this is the
 

1159
00:27:04,070 --> 00:27:11,710
different kinds of messages this is the
coherence protocol these are just

1160
00:27:11,710 --> 00:27:11,720
coherence protocol these are just
 

1161
00:27:11,720 --> 00:27:13,180
coherence protocol these are just
network you can think of them as

1162
00:27:13,180 --> 00:27:13,190
network you can think of them as
 

1163
00:27:13,190 --> 00:27:14,530
network you can think of them as
essentially sort of one-way Network

1164
00:27:14,530 --> 00:27:14,540
essentially sort of one-way Network
 

1165
00:27:14,540 --> 00:27:20,850
essentially sort of one-way Network
messages there's a request message from

1166
00:27:20,850 --> 00:27:20,860
messages there's a request message from
 

1167
00:27:20,860 --> 00:27:24,990
messages there's a request message from
from workstations to the lock server

1168
00:27:24,990 --> 00:27:25,000
from workstations to the lock server
 

1169
00:27:25,000 --> 00:27:27,580
from workstations to the lock server
request message says oh hey lock server

1170
00:27:27,580 --> 00:27:27,590
request message says oh hey lock server
 

1171
00:27:27,590 --> 00:27:30,940
request message says oh hey lock server
I'd like to get this lock when the lock

1172
00:27:30,940 --> 00:27:30,950
I'd like to get this lock when the lock
 

1173
00:27:30,950 --> 00:27:34,450
I'd like to get this lock when the lock
server is willing to give you the lock

1174
00:27:34,450 --> 00:27:34,460
server is willing to give you the lock
 

1175
00:27:34,460 --> 00:27:35,950
server is willing to give you the lock
and of course if somebody else holds if

1176
00:27:35,950 --> 00:27:35,960
and of course if somebody else holds if
 

1177
00:27:35,960 --> 00:27:37,600
and of course if somebody else holds if
the lock server can't immediately give

1178
00:27:37,600 --> 00:27:37,610
the lock server can't immediately give
 

1179
00:27:37,610 --> 00:27:39,190
the lock server can't immediately give
you the lock but if when the lock

1180
00:27:39,190 --> 00:27:39,200
you the lock but if when the lock
 

1181
00:27:39,200 --> 00:27:41,350
you the lock but if when the lock
becomes free the lock server will

1182
00:27:41,350 --> 00:27:41,360
becomes free the lock server will
 

1183
00:27:41,360 --> 00:27:46,960
becomes free the lock server will
respond we have a grant message then the

1184
00:27:46,960 --> 00:27:46,970
respond we have a grant message then the
 

1185
00:27:46,970 --> 00:27:49,390
respond we have a grant message then the
lock server back to the workstation in

1186
00:27:49,390 --> 00:27:49,400
lock server back to the workstation in
 

1187
00:27:49,400 --> 00:27:51,970
lock server back to the workstation in
response to an earlier request well if

1188
00:27:51,970 --> 00:27:51,980
response to an earlier request well if
 

1189
00:27:51,980 --> 00:27:53,890
response to an earlier request well if
you request a lock for the lock server

1190
00:27:53,890 --> 00:27:53,900
you request a lock for the lock server
 

1191
00:27:53,900 --> 00:27:55,600
you request a lock for the lock server
and someone else holds the lock right

1192
00:27:55,600 --> 00:27:55,610
and someone else holds the lock right
 

1193
00:27:55,610 --> 00:27:58,000
and someone else holds the lock right
now that other workstation has to first

1194
00:27:58,000 --> 00:27:58,010
now that other workstation has to first
 

1195
00:27:58,010 --> 00:27:59,440
now that other workstation has to first
give up the lock we can't have two

1196
00:27:59,440 --> 00:27:59,450
give up the lock we can't have two
 

1197
00:27:59,450 --> 00:28:02,170
give up the lock we can't have two
people owning the same lock so how are

1198
00:28:02,170 --> 00:28:02,180
people owning the same lock so how are
 

1199
00:28:02,180 --> 00:28:03,430
people owning the same lock so how are
we going to get that works

1200
00:28:03,430 --> 00:28:03,440
we going to get that works
 

1201
00:28:03,440 --> 00:28:07,240
we going to get that works
the lock well what I said here is that

1202
00:28:07,240 --> 00:28:07,250
the lock well what I said here is that
 

1203
00:28:07,250 --> 00:28:08,680
the lock well what I said here is that
when a lock station is you know when

1204
00:28:08,680 --> 00:28:08,690
when a lock station is you know when
 

1205
00:28:08,690 --> 00:28:09,879
when a lock station is you know when
it's actually using the lock and

1206
00:28:09,879 --> 00:28:09,889
it's actually using the lock and
 

1207
00:28:09,889 --> 00:28:11,769
it's actually using the lock and
actively reading or writing something it

1208
00:28:11,769 --> 00:28:11,779
actively reading or writing something it
 

1209
00:28:11,779 --> 00:28:13,509
actively reading or writing something it
has the lock and it's marked it busy but

1210
00:28:13,509 --> 00:28:13,519
has the lock and it's marked it busy but
 

1211
00:28:13,519 --> 00:28:15,700
has the lock and it's marked it busy but
the workstations don't give up their

1212
00:28:15,700 --> 00:28:15,710
the workstations don't give up their
 

1213
00:28:15,710 --> 00:28:18,279
the workstations don't give up their
locks ordinarily when they're done using

1214
00:28:18,279 --> 00:28:18,289
locks ordinarily when they're done using
 

1215
00:28:18,289 --> 00:28:21,639
locks ordinarily when they're done using
them so if I if I create a file and then

1216
00:28:21,639 --> 00:28:21,649
them so if I if I create a file and then
 

1217
00:28:21,649 --> 00:28:24,669
them so if I if I create a file and then
create system call finishes I'll still

1218
00:28:24,669 --> 00:28:24,679
create system call finishes I'll still
 

1219
00:28:24,679 --> 00:28:26,499
create system call finishes I'll still
have that file that new file locked and

1220
00:28:26,499 --> 00:28:26,509
have that file that new file locked and
 

1221
00:28:26,509 --> 00:28:28,360
have that file that new file locked and
also own the lock for that my

1222
00:28:28,360 --> 00:28:28,370
also own the lock for that my
 

1223
00:28:28,370 --> 00:28:29,560
also own the lock for that my
workstation will still all in the lock

1224
00:28:29,560 --> 00:28:29,570
workstation will still all in the lock
 

1225
00:28:29,570 --> 00:28:31,539
workstation will still all in the lock
for that file it'll just be in state

1226
00:28:31,539 --> 00:28:31,549
for that file it'll just be in state
 

1227
00:28:31,549 --> 00:28:33,610
for that file it'll just be in state
idle instead of busy but as far as the

1228
00:28:33,610 --> 00:28:33,620
idle instead of busy but as far as the
 

1229
00:28:33,620 --> 00:28:34,720
idle instead of busy but as far as the
lock server is concerned

1230
00:28:34,720 --> 00:28:34,730
lock server is concerned
 

1231
00:28:34,730 --> 00:28:36,399
lock server is concerned
well my workstation still has the lock

1232
00:28:36,399 --> 00:28:36,409
well my workstation still has the lock
 

1233
00:28:36,409 --> 00:28:38,259
well my workstation still has the lock
and the reason for this the reason to be

1234
00:28:38,259 --> 00:28:38,269
and the reason for this the reason to be
 

1235
00:28:38,269 --> 00:28:40,149
and the reason for this the reason to be
lazy about handing locks back to the

1236
00:28:40,149 --> 00:28:40,159
lazy about handing locks back to the
 

1237
00:28:40,159 --> 00:28:42,310
lazy about handing locks back to the
lock server is that if I create a file

1238
00:28:42,310 --> 00:28:42,320
lock server is that if I create a file
 

1239
00:28:42,320 --> 00:28:43,840
lock server is that if I create a file
called Y on my workstation

1240
00:28:43,840 --> 00:28:43,850
called Y on my workstation
 

1241
00:28:43,850 --> 00:28:46,149
called Y on my workstation
I'm almost certainly going to be about

1242
00:28:46,149 --> 00:28:46,159
I'm almost certainly going to be about
 

1243
00:28:46,159 --> 00:28:48,940
I'm almost certainly going to be about
to use Y for other purposes like maybe

1244
00:28:48,940 --> 00:28:48,950
to use Y for other purposes like maybe
 

1245
00:28:48,950 --> 00:28:51,100
to use Y for other purposes like maybe
write some data to it or read from it or

1246
00:28:51,100 --> 00:28:51,110
write some data to it or read from it or
 

1247
00:28:51,110 --> 00:28:53,129
write some data to it or read from it or
something so it's extremely advantageous

1248
00:28:53,129 --> 00:28:53,139
something so it's extremely advantageous
 

1249
00:28:53,139 --> 00:28:55,480
something so it's extremely advantageous
for the workstation to sort of

1250
00:28:55,480 --> 00:28:55,490
for the workstation to sort of
 

1251
00:28:55,490 --> 00:28:58,930
for the workstation to sort of
accumulate locks for all of the recently

1252
00:28:58,930 --> 00:28:58,940
accumulate locks for all of the recently
 

1253
00:28:58,940 --> 00:29:00,580
accumulate locks for all of the recently
used files in the workstation and not

1254
00:29:00,580 --> 00:29:00,590
used files in the workstation and not
 

1255
00:29:00,590 --> 00:29:02,889
used files in the workstation and not
give them back unless it really has to

1256
00:29:02,889 --> 00:29:02,899
give them back unless it really has to
 

1257
00:29:02,899 --> 00:29:05,169
give them back unless it really has to
and so in the ordinary in the common

1258
00:29:05,169 --> 00:29:05,179
and so in the ordinary in the common
 

1259
00:29:05,179 --> 00:29:07,060
and so in the ordinary in the common
case in which I use a bunch of files in

1260
00:29:07,060 --> 00:29:07,070
case in which I use a bunch of files in
 

1261
00:29:07,070 --> 00:29:09,940
case in which I use a bunch of files in
my home directory and nobody else on any

1262
00:29:09,940 --> 00:29:09,950
my home directory and nobody else on any
 

1263
00:29:09,950 --> 00:29:11,950
my home directory and nobody else on any
other workstation ever looks at them my

1264
00:29:11,950 --> 00:29:11,960
other workstation ever looks at them my
 

1265
00:29:11,960 --> 00:29:13,990
other workstation ever looks at them my
workstation ends up accumulating dozens

1266
00:29:13,990 --> 00:29:14,000
workstation ends up accumulating dozens
 

1267
00:29:14,000 --> 00:29:16,269
workstation ends up accumulating dozens
or hundreds of locks in idle state for

1268
00:29:16,269 --> 00:29:16,279
or hundreds of locks in idle state for
 

1269
00:29:16,279 --> 00:29:18,220
or hundreds of locks in idle state for
my files but if somebody else does look

1270
00:29:18,220 --> 00:29:18,230
my files but if somebody else does look
 

1271
00:29:18,230 --> 00:29:20,830
my files but if somebody else does look
at one of my files they need to first

1272
00:29:20,830 --> 00:29:20,840
at one of my files they need to first
 

1273
00:29:20,840 --> 00:29:22,330
at one of my files they need to first
get the lock and I have to give up the

1274
00:29:22,330 --> 00:29:22,340
get the lock and I have to give up the
 

1275
00:29:22,340 --> 00:29:24,999
get the lock and I have to give up the
lock so the way that works is that if

1276
00:29:24,999 --> 00:29:25,009
lock so the way that works is that if
 

1277
00:29:25,009 --> 00:29:27,340
lock so the way that works is that if
the lock server receives a lock request

1278
00:29:27,340 --> 00:29:27,350
the lock server receives a lock request
 

1279
00:29:27,350 --> 00:29:30,070
the lock server receives a lock request
and it sees in the lock server table AHA

1280
00:29:30,070 --> 00:29:30,080
and it sees in the lock server table AHA
 

1281
00:29:30,080 --> 00:29:31,869
and it sees in the lock server table AHA
you know that lock is currently owned by

1282
00:29:31,869 --> 00:29:31,879
you know that lock is currently owned by
 

1283
00:29:31,879 --> 00:29:34,450
you know that lock is currently owned by
workstation 1 the lock server will send

1284
00:29:34,450 --> 00:29:34,460
workstation 1 the lock server will send
 

1285
00:29:34,460 --> 00:29:38,529
workstation 1 the lock server will send
a revoke message to whoever the

1286
00:29:38,529 --> 00:29:38,539
a revoke message to whoever the
 

1287
00:29:38,539 --> 00:29:40,659
a revoke message to whoever the
workstation that currently owns that

1288
00:29:40,659 --> 00:29:40,669
workstation that currently owns that
 

1289
00:29:40,669 --> 00:29:42,879
workstation that currently owns that
lock saying look you know somebody else

1290
00:29:42,879 --> 00:29:42,889
lock saying look you know somebody else
 

1291
00:29:42,889 --> 00:29:47,350
lock saying look you know somebody else
wants it please give up the lock when a

1292
00:29:47,350 --> 00:29:47,360
wants it please give up the lock when a
 

1293
00:29:47,360 --> 00:29:49,570
wants it please give up the lock when a
workstation receives a revoke request if

1294
00:29:49,570 --> 00:29:49,580
workstation receives a revoke request if
 

1295
00:29:49,580 --> 00:29:54,399
workstation receives a revoke request if
the lock is idle then if the cache data

1296
00:29:54,399 --> 00:29:54,409
the lock is idle then if the cache data
 

1297
00:29:54,409 --> 00:29:56,409
the lock is idle then if the cache data
is dirty the workstation will first

1298
00:29:56,409 --> 00:29:56,419
is dirty the workstation will first
 

1299
00:29:56,419 --> 00:30:00,220
is dirty the workstation will first
write the cat dirty data that modified

1300
00:30:00,220 --> 00:30:00,230
write the cat dirty data that modified
 

1301
00:30:00,230 --> 00:30:01,749
write the cat dirty data that modified
data from his cache back to peddle

1302
00:30:01,749 --> 00:30:01,759
data from his cache back to peddle
 

1303
00:30:01,759 --> 00:30:04,600
data from his cache back to peddle
because the rule says the rule that in

1304
00:30:04,600 --> 00:30:04,610
because the rule says the rule that in
 

1305
00:30:04,610 --> 00:30:06,249
because the rule says the rule that in
order to never cache data without a lock

1306
00:30:06,249 --> 00:30:06,259
order to never cache data without a lock
 

1307
00:30:06,259 --> 00:30:08,740
order to never cache data without a lock
says we got our right the modify dated

1308
00:30:08,740 --> 00:30:08,750
says we got our right the modify dated
 

1309
00:30:08,750 --> 00:30:11,409
says we got our right the modify dated
back to peddle before releasing so if

1310
00:30:11,409 --> 00:30:11,419
back to peddle before releasing so if
 

1311
00:30:11,419 --> 00:30:13,149
back to peddle before releasing so if
the locks idle would first write back

1312
00:30:13,149 --> 00:30:13,159
the locks idle would first write back
 

1313
00:30:13,159 --> 00:30:16,509
the locks idle would first write back
the data if it's modified back to peddle

1314
00:30:16,509 --> 00:30:16,519
the data if it's modified back to peddle
 

1315
00:30:16,519 --> 00:30:17,350
the data if it's modified back to peddle
and

1316
00:30:17,350 --> 00:30:17,360
and
 

1317
00:30:17,360 --> 00:30:22,240
and
then send a message back to the lock

1318
00:30:22,240 --> 00:30:22,250
then send a message back to the lock
 

1319
00:30:22,250 --> 00:30:24,880
then send a message back to the lock
server saying it's okay we give up this

1320
00:30:24,880 --> 00:30:24,890
server saying it's okay we give up this
 

1321
00:30:24,890 --> 00:30:35,799
server saying it's okay we give up this
lock so the response to revoke send to a

1322
00:30:35,799 --> 00:30:35,809
lock so the response to revoke send to a
 

1323
00:30:35,809 --> 00:30:37,930
lock so the response to revoke send to a
workstation is the worst station sends

1324
00:30:37,930 --> 00:30:37,940
workstation is the worst station sends
 

1325
00:30:37,940 --> 00:30:39,190
workstation is the worst station sends
it released of course if the worst

1326
00:30:39,190 --> 00:30:39,200
it released of course if the worst
 

1327
00:30:39,200 --> 00:30:40,840
it released of course if the worst
station gets a revoke while it's

1328
00:30:40,840 --> 00:30:40,850
station gets a revoke while it's
 

1329
00:30:40,850 --> 00:30:42,610
station gets a revoke while it's
actively using a lock while it's in the

1330
00:30:42,610 --> 00:30:42,620
actively using a lock while it's in the
 

1331
00:30:42,620 --> 00:30:44,620
actively using a lock while it's in the
middle of a delete or rename or

1332
00:30:44,620 --> 00:30:44,630
middle of a delete or rename or
 

1333
00:30:44,630 --> 00:30:49,180
middle of a delete or rename or
something that affects the locked file

1334
00:30:49,180 --> 00:30:49,190
something that affects the locked file
 

1335
00:30:49,190 --> 00:30:51,940
something that affects the locked file
the worst station will not give us a

1336
00:30:51,940 --> 00:30:51,950
the worst station will not give us a
 

1337
00:30:51,950 --> 00:30:53,710
the worst station will not give us a
lock until it's it's done using and

1338
00:30:53,710 --> 00:30:53,720
lock until it's it's done using and
 

1339
00:30:53,720 --> 00:30:55,000
lock until it's it's done using and
until it's finished that file system

1340
00:30:55,000 --> 00:30:55,010
until it's finished that file system
 

1341
00:30:55,010 --> 00:30:56,799
until it's finished that file system
operation whatever system call it was

1342
00:30:56,799 --> 00:30:56,809
operation whatever system call it was
 

1343
00:30:56,809 --> 00:30:58,960
operation whatever system call it was
that was using this file and then the

1344
00:30:58,960 --> 00:30:58,970
that was using this file and then the
 

1345
00:30:58,970 --> 00:31:00,820
that was using this file and then the
lock in the worst stations lock state

1346
00:31:00,820 --> 00:31:00,830
lock in the worst stations lock state
 

1347
00:31:00,830 --> 00:31:03,490
lock in the worst stations lock state
will transition to idle and then you'll

1348
00:31:03,490 --> 00:31:03,500
will transition to idle and then you'll
 

1349
00:31:03,500 --> 00:31:07,180
will transition to idle and then you'll
be able to pay attention to the revoke

1350
00:31:07,180 --> 00:31:07,190
be able to pay attention to the revoke
 

1351
00:31:07,190 --> 00:31:10,000
be able to pay attention to the revoke
request and after writing to peddle if

1352
00:31:10,000 --> 00:31:10,010
request and after writing to peddle if
 

1353
00:31:10,010 --> 00:31:12,940
request and after writing to peddle if
need be released the lock alright so

1354
00:31:12,940 --> 00:31:12,950
need be released the lock alright so
 

1355
00:31:12,950 --> 00:31:17,640
need be released the lock alright so
this is the is the coherence protocol

1356
00:31:17,640 --> 00:31:17,650
this is the is the coherence protocol
 

1357
00:31:17,650 --> 00:31:21,400
this is the is the coherence protocol
that fringe that well this is a

1358
00:31:21,400 --> 00:31:21,410
that fringe that well this is a
 

1359
00:31:21,410 --> 00:31:23,049
that fringe that well this is a
simplification of the coherence protocol

1360
00:31:23,049 --> 00:31:23,059
simplification of the coherence protocol
 

1361
00:31:23,059 --> 00:31:24,789
simplification of the coherence protocol
that frangipani uses as I mentioned

1362
00:31:24,789 --> 00:31:24,799
that frangipani uses as I mentioned
 

1363
00:31:24,799 --> 00:31:26,289
that frangipani uses as I mentioned
before what's missing from all this is

1364
00:31:26,289 --> 00:31:26,299
before what's missing from all this is
 

1365
00:31:26,299 --> 00:31:28,419
before what's missing from all this is
the fact that locks can be either

1366
00:31:28,419 --> 00:31:28,429
the fact that locks can be either
 

1367
00:31:28,429 --> 00:31:31,090
the fact that locks can be either
exclusive for writers or shared for

1368
00:31:31,090 --> 00:31:31,100
exclusive for writers or shared for
 

1369
00:31:31,100 --> 00:31:38,980
exclusive for writers or shared for
read-only access and just like petal is

1370
00:31:38,980 --> 00:31:38,990
read-only access and just like petal is
 

1371
00:31:38,990 --> 00:31:41,049
read-only access and just like petal is
a block server and doesn't understand

1372
00:31:41,049 --> 00:31:41,059
a block server and doesn't understand
 

1373
00:31:41,059 --> 00:31:44,140
a block server and doesn't understand
anything about file systems the lock

1374
00:31:44,140 --> 00:31:44,150
anything about file systems the lock
 

1375
00:31:44,150 --> 00:31:47,200
anything about file systems the lock
server also these IDs these are really

1376
00:31:47,200 --> 00:31:47,210
server also these IDs these are really
 

1377
00:31:47,210 --> 00:31:49,419
server also these IDs these are really
lock identifiers and the locks are

1378
00:31:49,419 --> 00:31:49,429
lock identifiers and the locks are
 

1379
00:31:49,429 --> 00:31:51,970
lock identifiers and the locks are
doesn't know anything about files or

1380
00:31:51,970 --> 00:31:51,980
doesn't know anything about files or
 

1381
00:31:51,980 --> 00:31:53,799
doesn't know anything about files or
directories or file system it just has

1382
00:31:53,799 --> 00:31:53,809
directories or file system it just has
 

1383
00:31:53,809 --> 00:31:55,750
directories or file system it just has
these it's just has this table with

1384
00:31:55,750 --> 00:31:55,760
these it's just has this table with
 

1385
00:31:55,760 --> 00:31:58,780
these it's just has this table with
opaque IDs and who owns you know that

1386
00:31:58,780 --> 00:31:58,790
opaque IDs and who owns you know that
 

1387
00:31:58,790 --> 00:32:01,180
opaque IDs and who owns you know that
name locks and who owns those locks and

1388
00:32:01,180 --> 00:32:01,190
name locks and who owns those locks and
 

1389
00:32:01,190 --> 00:32:03,220
name locks and who owns those locks and
it's frangipani that knows ah you know

1390
00:32:03,220 --> 00:32:03,230
it's frangipani that knows ah you know
 

1391
00:32:03,230 --> 00:32:05,230
it's frangipani that knows ah you know
the lock that I associate was he given a

1392
00:32:05,230 --> 00:32:05,240
the lock that I associate was he given a
 

1393
00:32:05,240 --> 00:32:08,320
the lock that I associate was he given a
file has such and such an identifier and

1394
00:32:08,320 --> 00:32:08,330
file has such and such an identifier and
 

1395
00:32:08,330 --> 00:32:11,440
file has such and such an identifier and
as it happens prin Japan uses unix-style

1396
00:32:11,440 --> 00:32:11,450
as it happens prin Japan uses unix-style
 

1397
00:32:11,450 --> 00:32:14,260
as it happens prin Japan uses unix-style
I numbers or the numbers associated with

1398
00:32:14,260 --> 00:32:14,270
I numbers or the numbers associated with
 

1399
00:32:14,270 --> 00:32:20,380
I numbers or the numbers associated with
files instead of names for locks so just

1400
00:32:20,380 --> 00:32:20,390
files instead of names for locks so just
 

1401
00:32:20,390 --> 00:32:25,750
files instead of names for locks so just
to make this coherence protocol concrete

1402
00:32:25,750 --> 00:32:25,760
to make this coherence protocol concrete
 

1403
00:32:25,760 --> 00:32:28,570
to make this coherence protocol concrete
and to illustrate again the relationship

1404
00:32:28,570 --> 00:32:28,580
and to illustrate again the relationship
 

1405
00:32:28,580 --> 00:32:31,090
and to illustrate again the relationship
between petal operations

1406
00:32:31,090 --> 00:32:31,100
between petal operations
 

1407
00:32:31,100 --> 00:32:33,610
between petal operations
and lock server operations let me just

1408
00:32:33,610 --> 00:32:33,620
and lock server operations let me just
 

1409
00:32:33,620 --> 00:32:35,380
and lock server operations let me just
run through what happens if one

1410
00:32:35,380 --> 00:32:35,390
run through what happens if one
 

1411
00:32:35,390 --> 00:32:37,840
run through what happens if one
workstation modifies some file system

1412
00:32:37,840 --> 00:32:37,850
workstation modifies some file system
 

1413
00:32:37,850 --> 00:32:40,350
workstation modifies some file system
data and then in another workstation

1414
00:32:40,350 --> 00:32:40,360
data and then in another workstation
 

1415
00:32:40,360 --> 00:32:43,120
data and then in another workstation
means to look at it so we have two

1416
00:32:43,120 --> 00:32:43,130
means to look at it so we have two
 

1417
00:32:43,130 --> 00:32:50,830
means to look at it so we have two
workstations the lock server so the way

1418
00:32:50,830 --> 00:32:50,840
workstations the lock server so the way
 

1419
00:32:50,840 --> 00:32:52,900
workstations the lock server so the way
the protocol plays out if workstation

1420
00:32:52,900 --> 00:32:52,910
the protocol plays out if workstation
 

1421
00:32:52,910 --> 00:32:56,289
the protocol plays out if workstation
one wants to read since a workstation

1422
00:32:56,289 --> 00:32:56,299
one wants to read since a workstation
 

1423
00:32:56,299 --> 00:32:58,960
one wants to read since a workstation
one wants to read and then modify files

1424
00:32:58,960 --> 00:32:58,970
one wants to read and then modify files
 

1425
00:32:58,970 --> 00:33:02,110
one wants to read and then modify files
e so before it can even read anything

1426
00:33:02,110 --> 00:33:02,120
e so before it can even read anything
 

1427
00:33:02,120 --> 00:33:06,930
e so before it can even read anything
about Z from peddle it must first

1428
00:33:06,930 --> 00:33:06,940
about Z from peddle it must first
 

1429
00:33:06,940 --> 00:33:11,500
about Z from peddle it must first
acquire the lock for Z so it sends an

1430
00:33:11,500 --> 00:33:11,510
acquire the lock for Z so it sends an
 

1431
00:33:11,510 --> 00:33:13,510
acquire the lock for Z so it sends an
acquire request to the lock server maybe

1432
00:33:13,510 --> 00:33:13,520
acquire request to the lock server maybe
 

1433
00:33:13,520 --> 00:33:15,340
acquire request to the lock server maybe
nobody holds the lock or lock servers

1434
00:33:15,340 --> 00:33:15,350
nobody holds the lock or lock servers
 

1435
00:33:15,350 --> 00:33:16,680
nobody holds the lock or lock servers
never heard anything about it

1436
00:33:16,680 --> 00:33:16,690
never heard anything about it
 

1437
00:33:16,690 --> 00:33:19,240
never heard anything about it
so the locks are makes a new entry for Z

1438
00:33:19,240 --> 00:33:19,250
so the locks are makes a new entry for Z
 

1439
00:33:19,250 --> 00:33:21,909
so the locks are makes a new entry for Z
and it stable returns our reply saying

1440
00:33:21,909 --> 00:33:21,919
and it stable returns our reply saying
 

1441
00:33:21,919 --> 00:33:24,419
and it stable returns our reply saying
yes

1442
00:33:24,419 --> 00:33:24,429
yes
 

1443
00:33:24,429 --> 00:33:33,190
yes
you own the grant for lock C and at this

1444
00:33:33,190 --> 00:33:33,200
you own the grant for lock C and at this
 

1445
00:33:33,200 --> 00:33:34,779
you own the grant for lock C and at this
point the workstation says it has the

1446
00:33:34,779 --> 00:33:34,789
point the workstation says it has the
 

1447
00:33:34,789 --> 00:33:37,299
point the workstation says it has the
lock on file Z isn't entitled to read

1448
00:33:37,299 --> 00:33:37,309
lock on file Z isn't entitled to read
 

1449
00:33:37,309 --> 00:33:40,210
lock on file Z isn't entitled to read
information about it from petal so at

1450
00:33:40,210 --> 00:33:40,220
information about it from petal so at
 

1451
00:33:40,220 --> 00:33:52,020
information about it from petal so at
this point we're gonna read Z from petal

1452
00:33:52,020 --> 00:33:52,030

 

1453
00:33:52,030 --> 00:33:55,149

and indeed workstation one can modify it

1454
00:33:55,149 --> 00:33:55,159
and indeed workstation one can modify it
 

1455
00:33:55,159 --> 00:33:57,610
and indeed workstation one can modify it
locally in their cache at some later

1456
00:33:57,610 --> 00:33:57,620
locally in their cache at some later
 

1457
00:33:57,620 --> 00:33:59,740
locally in their cache at some later
point maybe the human being and sitting

1458
00:33:59,740 --> 00:33:59,750
point maybe the human being and sitting
 

1459
00:33:59,750 --> 00:34:01,870
point maybe the human being and sitting
in front of workstation two wants to

1460
00:34:01,870 --> 00:34:01,880
in front of workstation two wants to
 

1461
00:34:01,880 --> 00:34:04,000
in front of workstation two wants to
also to read file Z while the

1462
00:34:04,000 --> 00:34:04,010
also to read file Z while the
 

1463
00:34:04,010 --> 00:34:06,100
also to read file Z while the
workstation two doesn't have the lock

1464
00:34:06,100 --> 00:34:06,110
workstation two doesn't have the lock
 

1465
00:34:06,110 --> 00:34:07,570
workstation two doesn't have the lock
for files the ISA the very first thing

1466
00:34:07,570 --> 00:34:07,580
for files the ISA the very first thing
 

1467
00:34:07,580 --> 00:34:09,580
for files the ISA the very first thing
it needs to do is send a message the

1468
00:34:09,580 --> 00:34:09,590
it needs to do is send a message the
 

1469
00:34:09,590 --> 00:34:12,550
it needs to do is send a message the
lock server saying oh yeah I'd like to

1470
00:34:12,550 --> 00:34:12,560
lock server saying oh yeah I'd like to
 

1471
00:34:12,560 --> 00:34:16,599
lock server saying oh yeah I'd like to
get the lock for file Z the lock server

1472
00:34:16,599 --> 00:34:16,609
get the lock for file Z the lock server
 

1473
00:34:16,609 --> 00:34:18,700
get the lock for file Z the lock server
knows it can't reply yes yet because

1474
00:34:18,700 --> 00:34:18,710
knows it can't reply yes yet because
 

1475
00:34:18,710 --> 00:34:20,619
knows it can't reply yes yet because
somebody else has the lock namely

1476
00:34:20,619 --> 00:34:20,629
somebody else has the lock namely
 

1477
00:34:20,629 --> 00:34:23,230
somebody else has the lock namely
workstation one my the lock server sends

1478
00:34:23,230 --> 00:34:23,240
workstation one my the lock server sends
 

1479
00:34:23,240 --> 00:34:30,590
workstation one my the lock server sends
in response a revoke

1480
00:34:30,590 --> 00:34:30,600

 

1481
00:34:30,600 --> 00:34:33,990

the workstation one workstation one not

1482
00:34:33,990 --> 00:34:34,000
the workstation one workstation one not
 

1483
00:34:34,000 --> 00:34:35,700
the workstation one workstation one not
allowed to give up the lock until it

1484
00:34:35,700 --> 00:34:35,710
allowed to give up the lock until it
 

1485
00:34:35,710 --> 00:34:37,800
allowed to give up the lock until it
writes any modified data back to the

1486
00:34:37,800 --> 00:34:37,810
writes any modified data back to the
 

1487
00:34:37,810 --> 00:34:42,270
writes any modified data back to the
pedal so it's now gonna write the model

1488
00:34:42,270 --> 00:34:42,280
pedal so it's now gonna write the model
 

1489
00:34:42,280 --> 00:34:45,450
pedal so it's now gonna write the model
anything modified content the actual

1490
00:34:45,450 --> 00:34:45,460
anything modified content the actual
 

1491
00:34:45,460 --> 00:34:46,440
anything modified content the actual
contents of the file with always

1492
00:34:46,440 --> 00:34:46,450
contents of the file with always
 

1493
00:34:46,450 --> 00:34:51,360
contents of the file with always
modified back to pedal only then is

1494
00:34:51,360 --> 00:34:51,370
modified back to pedal only then is
 

1495
00:34:51,370 --> 00:34:54,830
modified back to pedal only then is
workstation two allowed to send a

1496
00:34:54,830 --> 00:34:54,840
workstation two allowed to send a
 

1497
00:34:54,840 --> 00:35:02,250
workstation two allowed to send a
release back to the lock server the lock

1498
00:35:02,250 --> 00:35:02,260
release back to the lock server the lock
 

1499
00:35:02,260 --> 00:35:04,140
release back to the lock server the lock
server with must have kept a record in

1500
00:35:04,140 --> 00:35:04,150
server with must have kept a record in
 

1501
00:35:04,150 --> 00:35:05,580
server with must have kept a record in
some table saying well you know there's

1502
00:35:05,580 --> 00:35:05,590
some table saying well you know there's
 

1503
00:35:05,590 --> 00:35:07,890
some table saying well you know there's
somebody waiting for lock Z as soon as

1504
00:35:07,890 --> 00:35:07,900
somebody waiting for lock Z as soon as
 

1505
00:35:07,900 --> 00:35:10,380
somebody waiting for lock Z as soon as
its current holder releases that we need

1506
00:35:10,380 --> 00:35:10,390
its current holder releases that we need
 

1507
00:35:10,390 --> 00:35:14,580
its current holder releases that we need
to reply and so this receipt of this

1508
00:35:14,580 --> 00:35:14,590
to reply and so this receipt of this
 

1509
00:35:14,590 --> 00:35:17,130
to reply and so this receipt of this
release will cause the lock server to

1510
00:35:17,130 --> 00:35:17,140
release will cause the lock server to
 

1511
00:35:17,140 --> 00:35:19,790
release will cause the lock server to
update its tables and finally send the

1512
00:35:19,790 --> 00:35:19,800
update its tables and finally send the
 

1513
00:35:19,800 --> 00:35:26,490
update its tables and finally send the
grant back to or station two and at this

1514
00:35:26,490 --> 00:35:26,500
grant back to or station two and at this
 

1515
00:35:26,500 --> 00:35:28,710
grant back to or station two and at this
point now our station two can finally

1516
00:35:28,710 --> 00:35:28,720
point now our station two can finally
 

1517
00:35:28,720 --> 00:35:36,570
point now our station two can finally
read files even pedal this is how the

1518
00:35:36,570 --> 00:35:36,580
read files even pedal this is how the
 

1519
00:35:36,580 --> 00:35:39,360
read files even pedal this is how the
cache coherence protocol plays out to

1520
00:35:39,360 --> 00:35:39,370
cache coherence protocol plays out to
 

1521
00:35:39,370 --> 00:35:43,610
cache coherence protocol plays out to
ensure that everybody who does a read

1522
00:35:43,610 --> 00:35:43,620
ensure that everybody who does a read
 

1523
00:35:43,620 --> 00:35:46,950
ensure that everybody who does a read
doesn't read the data until whoever the

1524
00:35:46,950 --> 00:35:46,960
doesn't read the data until whoever the
 

1525
00:35:46,960 --> 00:35:49,380
doesn't read the data until whoever the
previous until anybody who might have

1526
00:35:49,380 --> 00:35:49,390
previous until anybody who might have
 

1527
00:35:49,390 --> 00:35:52,560
previous until anybody who might have
had the data modified privately in their

1528
00:35:52,560 --> 00:35:52,570
had the data modified privately in their
 

1529
00:35:52,570 --> 00:35:54,690
had the data modified privately in their
cache first writes the data back to

1530
00:35:54,690 --> 00:35:54,700
cache first writes the data back to
 

1531
00:35:54,700 --> 00:36:01,050
cache first writes the data back to
pedal all right so the locking machinery

1532
00:36:01,050 --> 00:36:01,060
pedal all right so the locking machinery
 

1533
00:36:01,060 --> 00:36:04,290
pedal all right so the locking machinery
forces reads to see the latest right so

1534
00:36:04,290 --> 00:36:04,300
forces reads to see the latest right so
 

1535
00:36:04,300 --> 00:36:12,530
forces reads to see the latest right so
what's going on there's a number of the

1536
00:36:12,530 --> 00:36:12,540
what's going on there's a number of the
 

1537
00:36:12,540 --> 00:36:14,760
what's going on there's a number of the
optimizations that are possible in these

1538
00:36:14,760 --> 00:36:14,770
optimizations that are possible in these
 

1539
00:36:14,770 --> 00:36:16,560
optimizations that are possible in these
kind of cache coherence protocols

1540
00:36:16,560 --> 00:36:16,570
kind of cache coherence protocols
 

1541
00:36:16,570 --> 00:36:18,240
kind of cache coherence protocols
I mean I've actually already described

1542
00:36:18,240 --> 00:36:18,250
I mean I've actually already described
 

1543
00:36:18,250 --> 00:36:20,250
I mean I've actually already described
one this idle state the fact that

1544
00:36:20,250 --> 00:36:20,260
one this idle state the fact that
 

1545
00:36:20,260 --> 00:36:22,260
one this idle state the fact that
workstations hold onto locks that

1546
00:36:22,260 --> 00:36:22,270
workstations hold onto locks that
 

1547
00:36:22,270 --> 00:36:23,820
workstations hold onto locks that
they're not using right now instead of

1548
00:36:23,820 --> 00:36:23,830
they're not using right now instead of
 

1549
00:36:23,830 --> 00:36:25,410
they're not using right now instead of
immediately releasing them that's

1550
00:36:25,410 --> 00:36:25,420
immediately releasing them that's
 

1551
00:36:25,420 --> 00:36:28,110
immediately releasing them that's
already an optimization to the simplest

1552
00:36:28,110 --> 00:36:28,120
already an optimization to the simplest
 

1553
00:36:28,120 --> 00:36:30,720
already an optimization to the simplest
protocol you can think of and the other

1554
00:36:30,720 --> 00:36:30,730
protocol you can think of and the other
 

1555
00:36:30,730 --> 00:36:33,780
protocol you can think of and the other
main optimization is that the frangipani

1556
00:36:33,780 --> 00:36:33,790
main optimization is that the frangipani
 

1557
00:36:33,790 --> 00:36:36,690
main optimization is that the frangipani
has is that it has a notion of shared

1558
00:36:36,690 --> 00:36:36,700
has is that it has a notion of shared
 

1559
00:36:36,700 --> 00:36:39,210
has is that it has a notion of shared
versus shared read locks versus

1560
00:36:39,210 --> 00:36:39,220
versus shared read locks versus
 

1561
00:36:39,220 --> 00:36:41,460
versus shared read locks versus
exclusive write locks so have lots and

1562
00:36:41,460 --> 00:36:41,470
exclusive write locks so have lots and
 

1563
00:36:41,470 --> 00:36:42,870
exclusive write locks so have lots and
lots of workstations need to be

1564
00:36:42,870 --> 00:36:42,880
lots of workstations need to be
 

1565
00:36:42,880 --> 00:36:44,730
lots of workstations need to be
the same file but nobody's writing it

1566
00:36:44,730 --> 00:36:44,740
the same file but nobody's writing it
 

1567
00:36:44,740 --> 00:36:47,700
the same file but nobody's writing it
they can all have a lock a read lock on

1568
00:36:47,700 --> 00:36:47,710
they can all have a lock a read lock on
 

1569
00:36:47,710 --> 00:36:49,529
they can all have a lock a read lock on
that file and if somebody does come

1570
00:36:49,529 --> 00:36:49,539
that file and if somebody does come
 

1571
00:36:49,539 --> 00:36:51,390
that file and if somebody does come
along and try to write this file that's

1572
00:36:51,390 --> 00:36:51,400
along and try to write this file that's
 

1573
00:36:51,400 --> 00:36:54,749
along and try to write this file that's
widely cached they first need to first

1574
00:36:54,749 --> 00:36:54,759
widely cached they first need to first
 

1575
00:36:54,759 --> 00:36:57,900
widely cached they first need to first
revoke everybody's read lock so that

1576
00:36:57,900 --> 00:36:57,910
revoke everybody's read lock so that
 

1577
00:36:57,910 --> 00:36:59,700
revoke everybody's read lock so that
everybody gives up their cached copy and

1578
00:36:59,700 --> 00:36:59,710
everybody gives up their cached copy and
 

1579
00:36:59,710 --> 00:37:01,920
everybody gives up their cached copy and
only then is a right or allowed to write

1580
00:37:01,920 --> 00:37:01,930
only then is a right or allowed to write
 

1581
00:37:01,930 --> 00:37:03,450
only then is a right or allowed to write
the file but it's okay now because

1582
00:37:03,450 --> 00:37:03,460
the file but it's okay now because
 

1583
00:37:03,460 --> 00:37:05,490
the file but it's okay now because
nobody has a cache copy anymore so

1584
00:37:05,490 --> 00:37:05,500
nobody has a cache copy anymore so
 

1585
00:37:05,500 --> 00:37:08,099
nobody has a cache copy anymore so
nobody could be reading stale data while

1586
00:37:08,099 --> 00:37:08,109
nobody could be reading stale data while
 

1587
00:37:08,109 --> 00:37:13,230
nobody could be reading stale data while
it's being written all right so that's a

1588
00:37:13,230 --> 00:37:13,240
it's being written all right so that's a
 

1589
00:37:13,240 --> 00:37:21,599
it's being written all right so that's a
cache coherence story driven by driven

1590
00:37:21,599 --> 00:37:21,609
cache coherence story driven by driven
 

1591
00:37:21,609 --> 00:37:26,370
cache coherence story driven by driven
by the locking protocol next up in our

1592
00:37:26,370 --> 00:37:26,380
by the locking protocol next up in our
 

1593
00:37:26,380 --> 00:37:35,819
by the locking protocol next up in our
list of yes yes that's a good question

1594
00:37:35,819 --> 00:37:35,829
list of yes yes that's a good question
 

1595
00:37:35,829 --> 00:37:42,690
list of yes yes that's a good question
in fact there's a risk here in the

1596
00:37:42,690 --> 00:37:42,700
in fact there's a risk here in the
 

1597
00:37:42,700 --> 00:37:44,519
in fact there's a risk here in the
scheme I described that if I modify a

1598
00:37:44,519 --> 00:37:44,529
scheme I described that if I modify a
 

1599
00:37:44,529 --> 00:37:47,160
scheme I described that if I modify a
file on my workstation and nobody else

1600
00:37:47,160 --> 00:37:47,170
file on my workstation and nobody else
 

1601
00:37:47,170 --> 00:37:50,430
file on my workstation and nobody else
reads it for nobody else reads it that

1602
00:37:50,430 --> 00:37:50,440
reads it for nobody else reads it that
 

1603
00:37:50,440 --> 00:37:53,009
reads it for nobody else reads it that
the only copy of the modified file maybe

1604
00:37:53,009 --> 00:37:53,019
the only copy of the modified file maybe
 

1605
00:37:53,019 --> 00:37:55,559
the only copy of the modified file maybe
have some precious information in it is

1606
00:37:55,559 --> 00:37:55,569
have some precious information in it is
 

1607
00:37:55,569 --> 00:37:58,440
have some precious information in it is
on in in the cache in RAM on my

1608
00:37:58,440 --> 00:37:58,450
on in in the cache in RAM on my
 

1609
00:37:58,450 --> 00:38:00,839
on in in the cache in RAM on my
workstation and my works they were to

1610
00:38:00,839 --> 00:38:00,849
workstation and my works they were to
 

1611
00:38:00,849 --> 00:38:03,569
workstation and my works they were to
crash then and you know we hadn't done

1612
00:38:03,569 --> 00:38:03,579
crash then and you know we hadn't done
 

1613
00:38:03,579 --> 00:38:05,069
crash then and you know we hadn't done
anything special then it would have

1614
00:38:05,069 --> 00:38:05,079
anything special then it would have
 

1615
00:38:05,079 --> 00:38:07,049
anything special then it would have
crashed with the only copy of the data

1616
00:38:07,049 --> 00:38:07,059
crashed with the only copy of the data
 

1617
00:38:07,059 --> 00:38:09,480
crashed with the only copy of the data
and the data would be lost so in order

1618
00:38:09,480 --> 00:38:09,490
and the data would be lost so in order
 

1619
00:38:09,490 --> 00:38:12,180
and the data would be lost so in order
to forestall this no matter what all

1620
00:38:12,180 --> 00:38:12,190
to forestall this no matter what all
 

1621
00:38:12,190 --> 00:38:15,210
to forestall this no matter what all
these workstations write back anything

1622
00:38:15,210 --> 00:38:15,220
these workstations write back anything
 

1623
00:38:15,220 --> 00:38:18,539
these workstations write back anything
that's in their cache any modified stuff

1624
00:38:18,539 --> 00:38:18,549
that's in their cache any modified stuff
 

1625
00:38:18,549 --> 00:38:21,690
that's in their cache any modified stuff
in their cache every 30 seconds so that

1626
00:38:21,690 --> 00:38:21,700
in their cache every 30 seconds so that
 

1627
00:38:21,700 --> 00:38:23,789
in their cache every 30 seconds so that
if my workstation crash is unexpectedly

1628
00:38:23,789 --> 00:38:23,799
if my workstation crash is unexpectedly
 

1629
00:38:23,799 --> 00:38:25,529
if my workstation crash is unexpectedly
I may lose the last 30 seconds at work

1630
00:38:25,529 --> 00:38:25,539
I may lose the last 30 seconds at work
 

1631
00:38:25,539 --> 00:38:27,329
I may lose the last 30 seconds at work
but no more there's actually just mimics

1632
00:38:27,329 --> 00:38:27,339
but no more there's actually just mimics
 

1633
00:38:27,339 --> 00:38:33,140
but no more there's actually just mimics
the way ordinary Linux or UNIX works

1634
00:38:33,140 --> 00:38:33,150

 

1635
00:38:33,150 --> 00:38:36,230

indeed all of this a lot of the story is

1636
00:38:36,230 --> 00:38:36,240
indeed all of this a lot of the story is
 

1637
00:38:36,240 --> 00:38:40,470
indeed all of this a lot of the story is
about in the context of a distributed

1638
00:38:40,470 --> 00:38:40,480
about in the context of a distributed
 

1639
00:38:40,480 --> 00:38:43,650
about in the context of a distributed
file system trying to mimic the

1640
00:38:43,650 --> 00:38:43,660
file system trying to mimic the
 

1641
00:38:43,660 --> 00:38:46,109
file system trying to mimic the
properties that ordinary unix-style

1642
00:38:46,109 --> 00:38:46,119
properties that ordinary unix-style
 

1643
00:38:46,119 --> 00:38:49,170
properties that ordinary unix-style
workstations have so that users won't be

1644
00:38:49,170 --> 00:38:49,180
workstations have so that users won't be
 

1645
00:38:49,180 --> 00:38:51,299
workstations have so that users won't be
surprised by frangipani it just sort of

1646
00:38:51,299 --> 00:38:51,309
surprised by frangipani it just sort of
 

1647
00:38:51,309 --> 00:38:53,400
surprised by frangipani it just sort of
works much the same way that they're

1648
00:38:53,400 --> 00:38:53,410
works much the same way that they're
 

1649
00:38:53,410 --> 00:38:56,990
works much the same way that they're
already used

1650
00:38:56,990 --> 00:38:57,000

 

1651
00:38:57,000 --> 00:39:00,900

all right so our next challenge is how

1652
00:39:00,900 --> 00:39:00,910
all right so our next challenge is how
 

1653
00:39:00,910 --> 00:39:04,380
all right so our next challenge is how
do you atomicity that is how to make it

1654
00:39:04,380 --> 00:39:04,390
do you atomicity that is how to make it
 

1655
00:39:04,390 --> 00:39:05,880
do you atomicity that is how to make it
so even though when I do a complex

1656
00:39:05,880 --> 00:39:05,890
so even though when I do a complex
 

1657
00:39:05,890 --> 00:39:07,740
so even though when I do a complex
operation like creating a file which

1658
00:39:07,740 --> 00:39:07,750
operation like creating a file which
 

1659
00:39:07,750 --> 00:39:10,770
operation like creating a file which
after all involves marking a new I

1660
00:39:10,770 --> 00:39:10,780
after all involves marking a new I
 

1661
00:39:10,780 --> 00:39:14,070
after all involves marking a new I
knowed as allocated initializing the

1662
00:39:14,070 --> 00:39:14,080
knowed as allocated initializing the
 

1663
00:39:14,080 --> 00:39:15,570
knowed as allocated initializing the
inode the I knows a little piece of data

1664
00:39:15,570 --> 00:39:15,580
inode the I knows a little piece of data
 

1665
00:39:15,580 --> 00:39:16,950
inode the I knows a little piece of data
that describes each file maybe

1666
00:39:16,950 --> 00:39:16,960
that describes each file maybe
 

1667
00:39:16,960 --> 00:39:19,710
that describes each file maybe
allocating space for the file adding a

1668
00:39:19,710 --> 00:39:19,720
allocating space for the file adding a
 

1669
00:39:19,720 --> 00:39:21,390
allocating space for the file adding a
new name in the directory for my new

1670
00:39:21,390 --> 00:39:21,400
new name in the directory for my new
 

1671
00:39:21,400 --> 00:39:23,430
new name in the directory for my new
file there's many steps so many things

1672
00:39:23,430 --> 00:39:23,440
file there's many steps so many things
 

1673
00:39:23,440 --> 00:39:25,500
file there's many steps so many things
that have to be updated we don't want

1674
00:39:25,500 --> 00:39:25,510
that have to be updated we don't want
 

1675
00:39:25,510 --> 00:39:27,810
that have to be updated we don't want
anybody to see any of the intermediate

1676
00:39:27,810 --> 00:39:27,820
anybody to see any of the intermediate
 

1677
00:39:27,820 --> 00:39:30,330
anybody to see any of the intermediate
steps we want people you know other

1678
00:39:30,330 --> 00:39:30,340
steps we want people you know other
 

1679
00:39:30,340 --> 00:39:32,250
steps we want people you know other
workstations to either see the file not

1680
00:39:32,250 --> 00:39:32,260
workstations to either see the file not
 

1681
00:39:32,260 --> 00:39:34,350
workstations to either see the file not
exist or completely exist but not

1682
00:39:34,350 --> 00:39:34,360
exist or completely exist but not
 

1683
00:39:34,360 --> 00:39:41,330
exist or completely exist but not
something in between one atomic

1684
00:39:41,330 --> 00:39:41,340

 

1685
00:39:41,340 --> 00:39:56,850

multi-step operations alright so in

1686
00:39:56,850 --> 00:39:56,860
multi-step operations alright so in
 

1687
00:39:56,860 --> 00:39:58,830
multi-step operations alright so in
order to implement this in order to make

1688
00:39:58,830 --> 00:39:58,840
order to implement this in order to make
 

1689
00:39:58,840 --> 00:40:01,230
order to implement this in order to make
multi-step operations like file create

1690
00:40:01,230 --> 00:40:01,240
multi-step operations like file create
 

1691
00:40:01,240 --> 00:40:04,020
multi-step operations like file create
or rename or delete atomic as far as

1692
00:40:04,020 --> 00:40:04,030
or rename or delete atomic as far as
 

1693
00:40:04,030 --> 00:40:05,850
or rename or delete atomic as far as
other workstations are concerned

1694
00:40:05,850 --> 00:40:05,860
other workstations are concerned
 

1695
00:40:05,860 --> 00:40:08,370
other workstations are concerned
frangipani has a implement the notion of

1696
00:40:08,370 --> 00:40:08,380
frangipani has a implement the notion of
 

1697
00:40:08,380 --> 00:40:13,920
frangipani has a implement the notion of
transactions that is as a complete sort

1698
00:40:13,920 --> 00:40:13,930
transactions that is as a complete sort
 

1699
00:40:13,930 --> 00:40:15,840
transactions that is as a complete sort
of database style transaction system

1700
00:40:15,840 --> 00:40:15,850
of database style transaction system
 

1701
00:40:15,850 --> 00:40:20,240
of database style transaction system
inside it again driven by the locks

1702
00:40:20,240 --> 00:40:20,250

 

1703
00:40:20,250 --> 00:40:22,820

furthermore it it's it's this is

1704
00:40:22,820 --> 00:40:22,830
furthermore it it's it's this is
 

1705
00:40:22,830 --> 00:40:26,210
furthermore it it's it's this is
actually distributed transaction system

1706
00:40:26,210 --> 00:40:26,220
actually distributed transaction system
 

1707
00:40:26,220 --> 00:40:28,710
actually distributed transaction system
and we'll see more we'll hear more about

1708
00:40:28,710 --> 00:40:28,720
and we'll see more we'll hear more about
 

1709
00:40:28,720 --> 00:40:31,050
and we'll see more we'll hear more about
distributed transaction systems later in

1710
00:40:31,050 --> 00:40:31,060
distributed transaction systems later in
 

1711
00:40:31,060 --> 00:40:31,560
distributed transaction systems later in
the course

1712
00:40:31,560 --> 00:40:31,570
the course
 

1713
00:40:31,570 --> 00:40:34,680
the course
there are like a very common requirement

1714
00:40:34,680 --> 00:40:34,690
there are like a very common requirement
 

1715
00:40:34,690 --> 00:40:39,540
there are like a very common requirement
and distributed systems the basic story

1716
00:40:39,540 --> 00:40:39,550
and distributed systems the basic story
 

1717
00:40:39,550 --> 00:40:43,380
and distributed systems the basic story
here is that frangipani makes it so that

1718
00:40:43,380 --> 00:40:43,390
here is that frangipani makes it so that
 

1719
00:40:43,390 --> 00:40:45,780
here is that frangipani makes it so that
other workstations can't see my

1720
00:40:45,780 --> 00:40:45,790
other workstations can't see my
 

1721
00:40:45,790 --> 00:40:47,790
other workstations can't see my
modifications until completely done by

1722
00:40:47,790 --> 00:40:47,800
modifications until completely done by
 

1723
00:40:47,800 --> 00:40:50,340
modifications until completely done by
an operation by first acquiring all the

1724
00:40:50,340 --> 00:40:50,350
an operation by first acquiring all the
 

1725
00:40:50,350 --> 00:40:52,320
an operation by first acquiring all the
locks on all the data that I'm going to

1726
00:40:52,320 --> 00:40:52,330
locks on all the data that I'm going to
 

1727
00:40:52,330 --> 00:40:54,630
locks on all the data that I'm going to
need to read or write during my

1728
00:40:54,630 --> 00:40:54,640
need to read or write during my
 

1729
00:40:54,640 --> 00:40:57,270
need to read or write during my
operation and not releasing any of those

1730
00:40:57,270 --> 00:40:57,280
operation and not releasing any of those
 

1731
00:40:57,280 --> 00:41:00,960
operation and not releasing any of those
locks until it's finished with the

1732
00:41:00,960 --> 00:41:00,970
locks until it's finished with the
 

1733
00:41:00,970 --> 00:41:02,610
locks until it's finished with the
complete operation and of course

1734
00:41:02,610 --> 00:41:02,620
complete operation and of course
 

1735
00:41:02,620 --> 00:41:05,460
complete operation and of course
following the coherence rule written all

1736
00:41:05,460 --> 00:41:05,470
following the coherence rule written all
 

1737
00:41:05,470 --> 00:41:08,790
following the coherence rule written all
of the modified data back to petal

1738
00:41:08,790 --> 00:41:08,800
of the modified data back to petal
 

1739
00:41:08,800 --> 00:41:10,320
of the modified data back to petal
so before I do an operation like

1740
00:41:10,320 --> 00:41:10,330
so before I do an operation like
 

1741
00:41:10,330 --> 00:41:12,330
so before I do an operation like
renaming like moving a file from one

1742
00:41:12,330 --> 00:41:12,340
renaming like moving a file from one
 

1743
00:41:12,340 --> 00:41:13,890
renaming like moving a file from one
directory to another which after all

1744
00:41:13,890 --> 00:41:13,900
directory to another which after all
 

1745
00:41:13,900 --> 00:41:15,990
directory to another which after all
modifies both directories and I don't

1746
00:41:15,990 --> 00:41:16,000
modifies both directories and I don't
 

1747
00:41:16,000 --> 00:41:18,960
modifies both directories and I don't
want anybody to see the file being in

1748
00:41:18,960 --> 00:41:18,970
want anybody to see the file being in
 

1749
00:41:18,970 --> 00:41:20,970
want anybody to see the file being in
either directory or something in the

1750
00:41:20,970 --> 00:41:20,980
either directory or something in the
 

1751
00:41:20,980 --> 00:41:22,320
either directory or something in the
middle of the operation in order to do

1752
00:41:22,320 --> 00:41:22,330
middle of the operation in order to do
 

1753
00:41:22,330 --> 00:41:25,410
middle of the operation in order to do
in order to do this French penny first

1754
00:41:25,410 --> 00:41:25,420
in order to do this French penny first
 

1755
00:41:25,420 --> 00:41:31,950
in order to do this French penny first
acquires require all the locks for the

1756
00:41:31,950 --> 00:41:31,960
acquires require all the locks for the
 

1757
00:41:31,960 --> 00:41:39,180
acquires require all the locks for the
operation then do everything like all

1758
00:41:39,180 --> 00:41:39,190
operation then do everything like all
 

1759
00:41:39,190 --> 00:41:47,820
operation then do everything like all
the updates right the frangipani so I

1760
00:41:47,820 --> 00:41:47,830
the updates right the frangipani so I
 

1761
00:41:47,830 --> 00:41:55,890
the updates right the frangipani so I
write to pedal and then release and of

1762
00:41:55,890 --> 00:41:55,900
write to pedal and then release and of
 

1763
00:41:55,900 --> 00:41:57,420
write to pedal and then release and of
course this is easy button and you know

1764
00:41:57,420 --> 00:41:57,430
course this is easy button and you know
 

1765
00:41:57,430 --> 00:41:59,160
course this is easy button and you know
since we already had the locking server

1766
00:41:59,160 --> 00:41:59,170
since we already had the locking server
 

1767
00:41:59,170 --> 00:42:00,360
since we already had the locking server
anyway in order to drive the cache

1768
00:42:00,360 --> 00:42:00,370
anyway in order to drive the cache
 

1769
00:42:00,370 --> 00:42:04,200
anyway in order to drive the cache
coherence protocol we buy just by you

1770
00:42:04,200 --> 00:42:04,210
coherence protocol we buy just by you
 

1771
00:42:04,210 --> 00:42:05,730
coherence protocol we buy just by you
know making sure we hold all the locks

1772
00:42:05,730 --> 00:42:05,740
know making sure we hold all the locks
 

1773
00:42:05,740 --> 00:42:07,860
know making sure we hold all the locks
for the entire duration of an operation

1774
00:42:07,860 --> 00:42:07,870
for the entire duration of an operation
 

1775
00:42:07,870 --> 00:42:10,500
for the entire duration of an operation
we get these indivisible atomic

1776
00:42:10,500 --> 00:42:10,510
we get these indivisible atomic
 

1777
00:42:10,510 --> 00:42:18,180
we get these indivisible atomic
transactions almost for free so an

1778
00:42:18,180 --> 00:42:18,190
transactions almost for free so an
 

1779
00:42:18,190 --> 00:42:19,320
transactions almost for free so an
interesting thing to know and that's

1780
00:42:19,320 --> 00:42:19,330
interesting thing to know and that's
 

1781
00:42:19,330 --> 00:42:20,850
interesting thing to know and that's
basically all there is to say about

1782
00:42:20,850 --> 00:42:20,860
basically all there is to say about
 

1783
00:42:20,860 --> 00:42:23,610
basically all there is to say about
making operations atomic and transit

1784
00:42:23,610 --> 00:42:23,620
making operations atomic and transit
 

1785
00:42:23,620 --> 00:42:26,790
making operations atomic and transit
Pandu's hold all the locks an

1786
00:42:26,790 --> 00:42:26,800
Pandu's hold all the locks an
 

1787
00:42:26,800 --> 00:42:28,260
Pandu's hold all the locks an
interesting thing about this use of

1788
00:42:28,260 --> 00:42:28,270
interesting thing about this use of
 

1789
00:42:28,270 --> 00:42:29,940
interesting thing about this use of
locks is that trends of pennies using

1790
00:42:29,940 --> 00:42:29,950
locks is that trends of pennies using
 

1791
00:42:29,950 --> 00:42:33,590
locks is that trends of pennies using
locks for - almost opposite purposes for

1792
00:42:33,590 --> 00:42:33,600
locks for - almost opposite purposes for
 

1793
00:42:33,600 --> 00:42:36,420
locks for - almost opposite purposes for
cache coherence frangipani uses the

1794
00:42:36,420 --> 00:42:36,430
cache coherence frangipani uses the
 

1795
00:42:36,430 --> 00:42:38,840
cache coherence frangipani uses the
locks to make sure that writes are

1796
00:42:38,840 --> 00:42:38,850
locks to make sure that writes are
 

1797
00:42:38,850 --> 00:42:41,610
locks to make sure that writes are
visible immediately to anybody who wants

1798
00:42:41,610 --> 00:42:41,620
visible immediately to anybody who wants
 

1799
00:42:41,620 --> 00:42:43,770
visible immediately to anybody who wants
to read them so this is all about using

1800
00:42:43,770 --> 00:42:43,780
to read them so this is all about using
 

1801
00:42:43,780 --> 00:42:46,260
to read them so this is all about using
locks essentially to kind of make sure

1802
00:42:46,260 --> 00:42:46,270
locks essentially to kind of make sure
 

1803
00:42:46,270 --> 00:42:49,410
locks essentially to kind of make sure
people can see writes this use the

1804
00:42:49,410 --> 00:42:49,420
people can see writes this use the
 

1805
00:42:49,420 --> 00:42:51,420
people can see writes this use the
blocks is all about making sure people

1806
00:42:51,420 --> 00:42:51,430
blocks is all about making sure people
 

1807
00:42:51,430 --> 00:42:53,910
blocks is all about making sure people
don't see the writes until I'm finished

1808
00:42:53,910 --> 00:42:53,920
don't see the writes until I'm finished
 

1809
00:42:53,920 --> 00:42:57,810
don't see the writes until I'm finished
with an operation because I hold all the

1810
00:42:57,810 --> 00:42:57,820
with an operation because I hold all the
 

1811
00:42:57,820 --> 00:42:59,520
with an operation because I hold all the
locks until all the rights have been

1812
00:42:59,520 --> 00:42:59,530
locks until all the rights have been
 

1813
00:42:59,530 --> 00:43:01,680
locks until all the rights have been
done so they're sort of playing an

1814
00:43:01,680 --> 00:43:01,690
done so they're sort of playing an
 

1815
00:43:01,690 --> 00:43:04,620
done so they're sort of playing an
interesting trick here by reusing the

1816
00:43:04,620 --> 00:43:04,630
interesting trick here by reusing the
 

1817
00:43:04,630 --> 00:43:06,090
interesting trick here by reusing the
locks they would have had to have anyway

1818
00:43:06,090 --> 00:43:06,100
locks they would have had to have anyway
 

1819
00:43:06,100 --> 00:43:09,150
locks they would have had to have anyway
for transactions in order to drive cache

1820
00:43:09,150 --> 00:43:09,160
for transactions in order to drive cache
 

1821
00:43:09,160 --> 00:43:12,580
for transactions in order to drive cache
coherence

1822
00:43:12,580 --> 00:43:12,590

 

1823
00:43:12,590 --> 00:43:14,740

all right so the next interesting thing

1824
00:43:14,740 --> 00:43:14,750
all right so the next interesting thing
 

1825
00:43:14,750 --> 00:43:24,940
all right so the next interesting thing
is crash recovery we need to cope with

1826
00:43:24,940 --> 00:43:24,950
is crash recovery we need to cope with
 

1827
00:43:24,950 --> 00:43:27,040
is crash recovery we need to cope with
the possibility the most interesting

1828
00:43:27,040 --> 00:43:27,050
the possibility the most interesting
 

1829
00:43:27,050 --> 00:43:29,260
the possibility the most interesting
possibility is that a workstation

1830
00:43:29,260 --> 00:43:29,270
possibility is that a workstation
 

1831
00:43:29,270 --> 00:43:33,400
possibility is that a workstation
crashes while holding locks and while in

1832
00:43:33,400 --> 00:43:33,410
crashes while holding locks and while in
 

1833
00:43:33,410 --> 00:43:35,890
crashes while holding locks and while in
the middle of some sort of complex set

1834
00:43:35,890 --> 00:43:35,900
the middle of some sort of complex set
 

1835
00:43:35,900 --> 00:43:37,240
the middle of some sort of complex set
of updates that is a reforestation

1836
00:43:37,240 --> 00:43:37,250
of updates that is a reforestation
 

1837
00:43:37,250 --> 00:43:39,340
of updates that is a reforestation
acquired a bunch of locks it's writing a

1838
00:43:39,340 --> 00:43:39,350
acquired a bunch of locks it's writing a
 

1839
00:43:39,350 --> 00:43:40,810
acquired a bunch of locks it's writing a
whole lot of data to maybe create or

1840
00:43:40,810 --> 00:43:40,820
whole lot of data to maybe create or
 

1841
00:43:40,820 --> 00:43:42,730
whole lot of data to maybe create or
delete files or something has possibly

1842
00:43:42,730 --> 00:43:42,740
delete files or something has possibly
 

1843
00:43:42,740 --> 00:43:45,370
delete files or something has possibly
written some of those modifications back

1844
00:43:45,370 --> 00:43:45,380
written some of those modifications back
 

1845
00:43:45,380 --> 00:43:48,610
written some of those modifications back
to pedal because maybe it was gonna soon

1846
00:43:48,610 --> 00:43:48,620
to pedal because maybe it was gonna soon
 

1847
00:43:48,620 --> 00:43:50,470
to pedal because maybe it was gonna soon
release locks or had been asked by the

1848
00:43:50,470 --> 00:43:50,480
release locks or had been asked by the
 

1849
00:43:50,480 --> 00:43:52,090
release locks or had been asked by the
lock server to release locks so it's

1850
00:43:52,090 --> 00:43:52,100
lock server to release locks so it's
 

1851
00:43:52,100 --> 00:43:54,310
lock server to release locks so it's
maybe done some of the rights back to

1852
00:43:54,310 --> 00:43:54,320
maybe done some of the rights back to
 

1853
00:43:54,320 --> 00:43:57,580
maybe done some of the rights back to
pedal for its complex operations but not

1854
00:43:57,580 --> 00:43:57,590
pedal for its complex operations but not
 

1855
00:43:57,590 --> 00:44:00,220
pedal for its complex operations but not
all of them and then crashes before

1856
00:44:00,220 --> 00:44:00,230
all of them and then crashes before
 

1857
00:44:00,230 --> 00:44:02,370
all of them and then crashes before
giving up the locks so that's the

1858
00:44:02,370 --> 00:44:02,380
giving up the locks so that's the
 

1859
00:44:02,380 --> 00:44:07,290
giving up the locks so that's the
interesting situation for crash recovery

1860
00:44:07,290 --> 00:44:07,300
interesting situation for crash recovery
 

1861
00:44:07,300 --> 00:44:09,820
interesting situation for crash recovery
so there's a number of things that that

1862
00:44:09,820 --> 00:44:09,830
so there's a number of things that that
 

1863
00:44:09,830 --> 00:44:11,410
so there's a number of things that that
don't work very well for workstation

1864
00:44:11,410 --> 00:44:11,420
don't work very well for workstation
 

1865
00:44:11,420 --> 00:44:30,430
don't work very well for workstation
crashes crashing we hope one thing that

1866
00:44:30,430 --> 00:44:30,440
crashes crashing we hope one thing that
 

1867
00:44:30,440 --> 00:44:32,980
crashes crashing we hope one thing that
doesn't work very well is to just

1868
00:44:32,980 --> 00:44:32,990
doesn't work very well is to just
 

1869
00:44:32,990 --> 00:44:35,080
doesn't work very well is to just
observe the workstations crashed and

1870
00:44:35,080 --> 00:44:35,090
observe the workstations crashed and
 

1871
00:44:35,090 --> 00:44:37,860
observe the workstations crashed and
just release all its locks because then

1872
00:44:37,860 --> 00:44:37,870
just release all its locks because then
 

1873
00:44:37,870 --> 00:44:41,050
just release all its locks because then
if it's done something like created a

1874
00:44:41,050 --> 00:44:41,060
if it's done something like created a
 

1875
00:44:41,060 --> 00:44:43,560
if it's done something like created a
new file and it's written the files

1876
00:44:43,560 --> 00:44:43,570
new file and it's written the files
 

1877
00:44:43,570 --> 00:44:47,140
new file and it's written the files
directory entry its name back to pedal

1878
00:44:47,140 --> 00:44:47,150
directory entry its name back to pedal
 

1879
00:44:47,150 --> 00:44:48,850
directory entry its name back to pedal
but it hasn't yet written the

1880
00:44:48,850 --> 00:44:48,860
but it hasn't yet written the
 

1881
00:44:48,860 --> 00:44:51,490
but it hasn't yet written the
initialized inode that describes the

1882
00:44:51,490 --> 00:44:51,500
initialized inode that describes the
 

1883
00:44:51,500 --> 00:44:53,830
initialized inode that describes the
file the inode may still be filled with

1884
00:44:53,830 --> 00:44:53,840
file the inode may still be filled with
 

1885
00:44:53,840 --> 00:44:56,440
file the inode may still be filled with
garbage or the previous file some

1886
00:44:56,440 --> 00:44:56,450
garbage or the previous file some
 

1887
00:44:56,450 --> 00:44:58,690
garbage or the previous file some
previous files information in petal and

1888
00:44:58,690 --> 00:44:58,700
previous files information in petal and
 

1889
00:44:58,700 --> 00:45:00,220
previous files information in petal and
yet we've already written the directory

1890
00:45:00,220 --> 00:45:00,230
yet we've already written the directory
 

1891
00:45:00,230 --> 00:45:02,260
yet we've already written the directory
entry so it's not okay to just release a

1892
00:45:02,260 --> 00:45:02,270
entry so it's not okay to just release a
 

1893
00:45:02,270 --> 00:45:05,050
entry so it's not okay to just release a
crashed file servers release of crash

1894
00:45:05,050 --> 00:45:05,060
crashed file servers release of crash
 

1895
00:45:05,060 --> 00:45:11,170
crashed file servers release of crash
were stations locks another thing that's

1896
00:45:11,170 --> 00:45:11,180
were stations locks another thing that's
 

1897
00:45:11,180 --> 00:45:13,390
were stations locks another thing that's
not okay is to not release the crashed

1898
00:45:13,390 --> 00:45:13,400
not okay is to not release the crashed
 

1899
00:45:13,400 --> 00:45:15,340
not okay is to not release the crashed
workstations locks you know that would

1900
00:45:15,340 --> 00:45:15,350
workstations locks you know that would
 

1901
00:45:15,350 --> 00:45:17,680
workstations locks you know that would
be correct because you know if it

1902
00:45:17,680 --> 00:45:17,690
be correct because you know if it
 

1903
00:45:17,690 --> 00:45:20,140
be correct because you know if it
crashed while in the middle of writing

1904
00:45:20,140 --> 00:45:20,150
crashed while in the middle of writing
 

1905
00:45:20,150 --> 00:45:23,200
crashed while in the middle of writing
out some of this modifications the fact

1906
00:45:23,200 --> 00:45:23,210
out some of this modifications the fact
 

1907
00:45:23,210 --> 00:45:24,340
out some of this modifications the fact
that it hadn't written out all of them

1908
00:45:24,340 --> 00:45:24,350
that it hadn't written out all of them
 

1909
00:45:24,350 --> 00:45:26,080
that it hadn't written out all of them
means a can't of release its locks

1910
00:45:26,080 --> 00:45:26,090
means a can't of release its locks
 

1911
00:45:26,090 --> 00:45:28,630
means a can't of release its locks
so simply not releasing its locks is

1912
00:45:28,630 --> 00:45:28,640
so simply not releasing its locks is
 

1913
00:45:28,640 --> 00:45:31,090
so simply not releasing its locks is
correct because it would hide the this

1914
00:45:31,090 --> 00:45:31,100
correct because it would hide the this
 

1915
00:45:31,100 --> 00:45:33,820
correct because it would hide the this
partial update from any readers and so

1916
00:45:33,820 --> 00:45:33,830
partial update from any readers and so
 

1917
00:45:33,830 --> 00:45:35,730
partial update from any readers and so
nobody would ever be confused by seeing

1918
00:45:35,730 --> 00:45:35,740
nobody would ever be confused by seeing
 

1919
00:45:35,740 --> 00:45:38,230
nobody would ever be confused by seeing
partially updated data structures in

1920
00:45:38,230 --> 00:45:38,240
partially updated data structures in
 

1921
00:45:38,240 --> 00:45:41,200
partially updated data structures in
petal on the other hand you know then

1922
00:45:41,200 --> 00:45:41,210
petal on the other hand you know then
 

1923
00:45:41,210 --> 00:45:42,940
petal on the other hand you know then
anybody you needed to use those files

1924
00:45:42,940 --> 00:45:42,950
anybody you needed to use those files
 

1925
00:45:42,950 --> 00:45:44,470
anybody you needed to use those files
would have to wait forever for the locks

1926
00:45:44,470 --> 00:45:44,480
would have to wait forever for the locks
 

1927
00:45:44,480 --> 00:45:47,470
would have to wait forever for the locks
if we simply didn't give them up so we

1928
00:45:47,470 --> 00:45:47,480
if we simply didn't give them up so we
 

1929
00:45:47,480 --> 00:45:48,940
if we simply didn't give them up so we
absolutely have to give up the locks in

1930
00:45:48,940 --> 00:45:48,950
absolutely have to give up the locks in
 

1931
00:45:48,950 --> 00:45:51,490
absolutely have to give up the locks in
order that other workstations can use

1932
00:45:51,490 --> 00:45:51,500
order that other workstations can use
 

1933
00:45:51,500 --> 00:45:53,200
order that other workstations can use
the system can use those same files and

1934
00:45:53,200 --> 00:45:53,210
the system can use those same files and
 

1935
00:45:53,210 --> 00:45:55,690
the system can use those same files and
directories but we have to do something

1936
00:45:55,690 --> 00:45:55,700
directories but we have to do something
 

1937
00:45:55,700 --> 00:45:57,580
directories but we have to do something
about the fact that the workstation

1938
00:45:57,580 --> 00:45:57,590
about the fact that the workstation
 

1939
00:45:57,590 --> 00:45:59,890
about the fact that the workstation
might have done some of the rights but

1940
00:45:59,890 --> 00:45:59,900
might have done some of the rights but
 

1941
00:45:59,900 --> 00:46:05,350
might have done some of the rights but
not all for its operations so frangipani

1942
00:46:05,350 --> 00:46:05,360
not all for its operations so frangipani
 

1943
00:46:05,360 --> 00:46:10,120
not all for its operations so frangipani
has like almost every other system that

1944
00:46:10,120 --> 00:46:10,130
has like almost every other system that
 

1945
00:46:10,130 --> 00:46:12,040
has like almost every other system that
needs to implement crashed recoverable

1946
00:46:12,040 --> 00:46:12,050
needs to implement crashed recoverable
 

1947
00:46:12,050 --> 00:46:22,590
needs to implement crashed recoverable
transactions users right ahead logging

1948
00:46:22,590 --> 00:46:22,600

 

1949
00:46:22,600 --> 00:46:25,810

this is something we've seen at least

1950
00:46:25,810 --> 00:46:25,820
this is something we've seen at least
 

1951
00:46:25,820 --> 00:46:29,980
this is something we've seen at least
one instance of the last lecture with

1952
00:46:29,980 --> 00:46:29,990
one instance of the last lecture with
 

1953
00:46:29,990 --> 00:46:33,340
one instance of the last lecture with
with aurora i was also using right ahead

1954
00:46:33,340 --> 00:46:33,350
with aurora i was also using right ahead
 

1955
00:46:33,350 --> 00:46:39,940
with aurora i was also using right ahead
logging so the idea is that if a

1956
00:46:39,940 --> 00:46:39,950
logging so the idea is that if a
 

1957
00:46:39,950 --> 00:46:41,410
logging so the idea is that if a
workstation needs to do a complex

1958
00:46:41,410 --> 00:46:41,420
workstation needs to do a complex
 

1959
00:46:41,420 --> 00:46:43,020
workstation needs to do a complex
operation that involves touching

1960
00:46:43,020 --> 00:46:43,030
operation that involves touching
 

1961
00:46:43,030 --> 00:46:46,420
operation that involves touching
updating many pieces of data in petal in

1962
00:46:46,420 --> 00:46:46,430
updating many pieces of data in petal in
 

1963
00:46:46,430 --> 00:46:48,490
updating many pieces of data in petal in
the file system the workstation well

1964
00:46:48,490 --> 00:46:48,500
the file system the workstation well
 

1965
00:46:48,500 --> 00:46:51,010
the file system the workstation well
first before it makes any rights to

1966
00:46:51,010 --> 00:46:51,020
first before it makes any rights to
 

1967
00:46:51,020 --> 00:46:57,130
first before it makes any rights to
petal append a la log entry to his log

1968
00:46:57,130 --> 00:46:57,140
petal append a la log entry to his log
 

1969
00:46:57,140 --> 00:47:00,640
petal append a la log entry to his log
in petal describing the full set of

1970
00:47:00,640 --> 00:47:00,650
in petal describing the full set of
 

1971
00:47:00,650 --> 00:47:03,910
in petal describing the full set of
operations it's about to do and only

1972
00:47:03,910 --> 00:47:03,920
operations it's about to do and only
 

1973
00:47:03,920 --> 00:47:07,120
operations it's about to do and only
when that log entry describing the full

1974
00:47:07,120 --> 00:47:07,130
when that log entry describing the full
 

1975
00:47:07,130 --> 00:47:09,970
when that log entry describing the full
set of operations is safely in petal

1976
00:47:09,970 --> 00:47:09,980
set of operations is safely in petal
 

1977
00:47:09,980 --> 00:47:11,980
set of operations is safely in petal
where now anybody else can see it only

1978
00:47:11,980 --> 00:47:11,990
where now anybody else can see it only
 

1979
00:47:11,990 --> 00:47:15,130
where now anybody else can see it only
then will the workstation start to send

1980
00:47:15,130 --> 00:47:15,140
then will the workstation start to send
 

1981
00:47:15,140 --> 00:47:17,080
then will the workstation start to send
the rights for the operation out to

1982
00:47:17,080 --> 00:47:17,090
the rights for the operation out to
 

1983
00:47:17,090 --> 00:47:20,380
the rights for the operation out to
petal I'm so we if it were station could

1984
00:47:20,380 --> 00:47:20,390
petal I'm so we if it were station could
 

1985
00:47:20,390 --> 00:47:23,230
petal I'm so we if it were station could
ever reveal even the one of its rights

1986
00:47:23,230 --> 00:47:23,240
ever reveal even the one of its rights
 

1987
00:47:23,240 --> 00:47:26,050
ever reveal even the one of its rights
for an operation the petal it must have

1988
00:47:26,050 --> 00:47:26,060
for an operation the petal it must have
 

1989
00:47:26,060 --> 00:47:29,380
for an operation the petal it must have
already put the log entry describing the

1990
00:47:29,380 --> 00:47:29,390
already put the log entry describing the
 

1991
00:47:29,390 --> 00:47:32,290
already put the log entry describing the
whole operation all of the updates must

1992
00:47:32,290 --> 00:47:32,300
whole operation all of the updates must
 

1993
00:47:32,300 --> 00:47:35,380
whole operation all of the updates must
already exist in petal so this is very

1994
00:47:35,380 --> 00:47:35,390
already exist in petal so this is very
 

1995
00:47:35,390 --> 00:47:37,630
already exist in petal so this is very
standard this is just a description of

1996
00:47:37,630 --> 00:47:37,640
standard this is just a description of
 

1997
00:47:37,640 --> 00:47:39,620
standard this is just a description of
right ahead logging

1998
00:47:39,620 --> 00:47:39,630
right ahead logging
 

1999
00:47:39,630 --> 00:47:43,979
right ahead logging
but there's a couple of odd aspects of

2000
00:47:43,979 --> 00:47:43,989
but there's a couple of odd aspects of
 

2001
00:47:43,989 --> 00:47:47,819
but there's a couple of odd aspects of
how frangipani implements right ahead

2002
00:47:47,819 --> 00:47:47,829
how frangipani implements right ahead
 

2003
00:47:47,829 --> 00:47:48,299
how frangipani implements right ahead
logging

2004
00:47:48,299 --> 00:47:48,309
logging
 

2005
00:47:48,309 --> 00:47:51,479
logging
the first one is that in most

2006
00:47:51,479 --> 00:47:51,489
the first one is that in most
 

2007
00:47:51,489 --> 00:47:54,620
the first one is that in most
transaction systems there's just one log

2008
00:47:54,620 --> 00:47:54,630
transaction systems there's just one log
 

2009
00:47:54,630 --> 00:47:57,539
transaction systems there's just one log
and all the transactions in the system

2010
00:47:57,539 --> 00:47:57,549
and all the transactions in the system
 

2011
00:47:57,549 --> 00:47:59,160
and all the transactions in the system
you know they're all sitting there in

2012
00:47:59,160 --> 00:47:59,170
you know they're all sitting there in
 

2013
00:47:59,170 --> 00:48:02,190
you know they're all sitting there in
one log in one place so there's a crash

2014
00:48:02,190 --> 00:48:02,200
one log in one place so there's a crash
 

2015
00:48:02,200 --> 00:48:05,489
one log in one place so there's a crash
and there's opera there's more than one

2016
00:48:05,489 --> 00:48:05,499
and there's opera there's more than one
 

2017
00:48:05,499 --> 00:48:07,380
and there's opera there's more than one
operation that affects the same piece of

2018
00:48:07,380 --> 00:48:07,390
operation that affects the same piece of
 

2019
00:48:07,390 --> 00:48:10,349
operation that affects the same piece of
data we have all of those operations for

2020
00:48:10,349 --> 00:48:10,359
data we have all of those operations for
 

2021
00:48:10,359 --> 00:48:11,640
data we have all of those operations for
that piece of data and everything else

2022
00:48:11,640 --> 00:48:11,650
that piece of data and everything else
 

2023
00:48:11,650 --> 00:48:14,640
that piece of data and everything else
right there in the single log sequence

2024
00:48:14,640 --> 00:48:14,650
right there in the single log sequence
 

2025
00:48:14,650 --> 00:48:16,769
right there in the single log sequence
and so we know for example which is the

2026
00:48:16,769 --> 00:48:16,779
and so we know for example which is the
 

2027
00:48:16,779 --> 00:48:20,880
and so we know for example which is the
most recent update to a given piece of

2028
00:48:20,880 --> 00:48:20,890
most recent update to a given piece of
 

2029
00:48:20,890 --> 00:48:22,440
most recent update to a given piece of
David but frangipani doesn't do that

2030
00:48:22,440 --> 00:48:22,450
David but frangipani doesn't do that
 

2031
00:48:22,450 --> 00:48:28,140
David but frangipani doesn't do that
this it has her work station logs as one

2032
00:48:28,140 --> 00:48:28,150
this it has her work station logs as one
 

2033
00:48:28,150 --> 00:48:30,390
this it has her work station logs as one
log per work station and there's

2034
00:48:30,390 --> 00:48:30,400
log per work station and there's
 

2035
00:48:30,400 --> 00:48:34,920
log per work station and there's
separate logs the other very interesting

2036
00:48:34,920 --> 00:48:34,930
separate logs the other very interesting
 

2037
00:48:34,930 --> 00:48:36,930
separate logs the other very interesting
thing about frangipane ease logging

2038
00:48:36,930 --> 00:48:36,940
thing about frangipane ease logging
 

2039
00:48:36,940 --> 00:48:39,509
thing about frangipane ease logging
system is that the LA workstation logs

2040
00:48:39,509 --> 00:48:39,519
system is that the LA workstation logs
 

2041
00:48:39,519 --> 00:48:42,059
system is that the LA workstation logs
are stored in petal and not on local

2042
00:48:42,059 --> 00:48:42,069
are stored in petal and not on local
 

2043
00:48:42,069 --> 00:48:44,489
are stored in petal and not on local
disk in almost every system that uses

2044
00:48:44,489 --> 00:48:44,499
disk in almost every system that uses
 

2045
00:48:44,499 --> 00:48:46,829
disk in almost every system that uses
logging the log is tightly associated

2046
00:48:46,829 --> 00:48:46,839
logging the log is tightly associated
 

2047
00:48:46,839 --> 00:48:48,870
logging the log is tightly associated
with whatever computer is running the

2048
00:48:48,870 --> 00:48:48,880
with whatever computer is running the
 

2049
00:48:48,880 --> 00:48:50,640
with whatever computer is running the
transactions that it's almost always

2050
00:48:50,640 --> 00:48:50,650
transactions that it's almost always
 

2051
00:48:50,650 --> 00:48:54,329
transactions that it's almost always
kept on a local disk but for extremely

2052
00:48:54,329 --> 00:48:54,339
kept on a local disk but for extremely
 

2053
00:48:54,339 --> 00:48:56,719
kept on a local disk but for extremely
good reasons

2054
00:48:56,719 --> 00:48:56,729
good reasons
 

2055
00:48:56,729 --> 00:48:59,219
good reasons
frangipani workstations

2056
00:48:59,219 --> 00:48:59,229
frangipani workstations
 

2057
00:48:59,229 --> 00:49:01,469
frangipani workstations
store their logs in petal in the shared

2058
00:49:01,469 --> 00:49:01,479
store their logs in petal in the shared
 

2059
00:49:01,479 --> 00:49:03,450
store their logs in petal in the shared
storage each workstation had its own

2060
00:49:03,450 --> 00:49:03,460
storage each workstation had its own
 

2061
00:49:03,460 --> 00:49:05,999
storage each workstation had its own
sort of semi-private log but it's stored

2062
00:49:05,999 --> 00:49:06,009
sort of semi-private log but it's stored
 

2063
00:49:06,009 --> 00:49:09,539
sort of semi-private log but it's stored
in petal storage where if the

2064
00:49:09,539 --> 00:49:09,549
in petal storage where if the
 

2065
00:49:09,549 --> 00:49:11,609
in petal storage where if the
workstation crashes its log can be

2066
00:49:11,609 --> 00:49:11,619
workstation crashes its log can be
 

2067
00:49:11,619 --> 00:49:14,759
workstation crashes its log can be
gotten that by other workstations so the

2068
00:49:14,759 --> 00:49:14,769
gotten that by other workstations so the
 

2069
00:49:14,769 --> 00:49:25,440
gotten that by other workstations so the
logs are in petal and this is this is

2070
00:49:25,440 --> 00:49:25,450
logs are in petal and this is this is
 

2071
00:49:25,450 --> 00:49:26,930
logs are in petal and this is this is
like separate logs for workstation

2072
00:49:26,930 --> 00:49:26,940
like separate logs for workstation
 

2073
00:49:26,940 --> 00:49:30,029
like separate logs for workstation
stored somewhere else in public sort of

2074
00:49:30,029 --> 00:49:30,039
stored somewhere else in public sort of
 

2075
00:49:30,039 --> 00:49:31,529
stored somewhere else in public sort of
shared storage so like a very

2076
00:49:31,529 --> 00:49:31,539
shared storage so like a very
 

2077
00:49:31,539 --> 00:49:34,829
shared storage so like a very
interesting and unusual arrangement all

2078
00:49:34,829 --> 00:49:34,839
interesting and unusual arrangement all
 

2079
00:49:34,839 --> 00:49:37,709
interesting and unusual arrangement all
right so we kind of need to know roughly

2080
00:49:37,709 --> 00:49:37,719
right so we kind of need to know roughly
 

2081
00:49:37,719 --> 00:49:50,569
right so we kind of need to know roughly
what's in the law what's in a log entry

2082
00:49:50,569 --> 00:49:50,579

 

2083
00:49:50,579 --> 00:49:53,459

and unfortunately the papers not super

2084
00:49:53,459 --> 00:49:53,469
and unfortunately the papers not super
 

2085
00:49:53,469 --> 00:49:56,420
and unfortunately the papers not super
explicit about the format of a log entry

2086
00:49:56,420 --> 00:49:56,430
explicit about the format of a log entry
 

2087
00:49:56,430 --> 00:49:58,859
explicit about the format of a log entry
but we can imagine that the well the

2088
00:49:58,859 --> 00:49:58,869
but we can imagine that the well the
 

2089
00:49:58,869 --> 00:50:00,630
but we can imagine that the well the
paper does say that each workstations

2090
00:50:00,630 --> 00:50:00,640
paper does say that each workstations
 

2091
00:50:00,640 --> 00:50:04,229
paper does say that each workstations
log sits in a known place a known range

2092
00:50:04,229 --> 00:50:04,239
log sits in a known place a known range
 

2093
00:50:04,239 --> 00:50:06,719
log sits in a known place a known range
of block numbers in petal and

2094
00:50:06,719 --> 00:50:06,729
of block numbers in petal and
 

2095
00:50:06,729 --> 00:50:09,089
of block numbers in petal and
furthermore that each workstation uses

2096
00:50:09,089 --> 00:50:09,099
furthermore that each workstation uses
 

2097
00:50:09,099 --> 00:50:11,160
furthermore that each workstation uses
its log space and petal on a kind of in

2098
00:50:11,160 --> 00:50:11,170
its log space and petal on a kind of in
 

2099
00:50:11,170 --> 00:50:13,380
its log space and petal on a kind of in
a circular way that it is all right log

2100
00:50:13,380 --> 00:50:13,390
a circular way that it is all right log
 

2101
00:50:13,390 --> 00:50:14,999
a circular way that it is all right log
entries along from the beginning and

2102
00:50:14,999 --> 00:50:15,009
entries along from the beginning and
 

2103
00:50:15,009 --> 00:50:18,660
entries along from the beginning and
when it hits the end the workstation

2104
00:50:18,660 --> 00:50:18,670
when it hits the end the workstation
 

2105
00:50:18,670 --> 00:50:21,690
when it hits the end the workstation
will go back and reuse its log space

2106
00:50:21,690 --> 00:50:21,700
will go back and reuse its log space
 

2107
00:50:21,700 --> 00:50:23,339
will go back and reuse its log space
back at the beginning of its log area

2108
00:50:23,339 --> 00:50:23,349
back at the beginning of its log area
 

2109
00:50:23,349 --> 00:50:25,319
back at the beginning of its log area
and of course that means that were

2110
00:50:25,319 --> 00:50:25,329
and of course that means that were
 

2111
00:50:25,329 --> 00:50:26,759
and of course that means that were
stations need to be able to you know

2112
00:50:26,759 --> 00:50:26,769
stations need to be able to you know
 

2113
00:50:26,769 --> 00:50:30,930
stations need to be able to you know
clean their logs so that sort of ensure

2114
00:50:30,930 --> 00:50:30,940
clean their logs so that sort of ensure
 

2115
00:50:30,940 --> 00:50:32,969
clean their logs so that sort of ensure
that a log entry isn't needed before

2116
00:50:32,969 --> 00:50:32,979
that a log entry isn't needed before
 

2117
00:50:32,979 --> 00:50:35,579
that a log entry isn't needed before
that space is reused and I'll talk about

2118
00:50:35,579 --> 00:50:35,589
that space is reused and I'll talk about
 

2119
00:50:35,589 --> 00:50:39,390
that space is reused and I'll talk about
that in a bit but each a log consists of

2120
00:50:39,390 --> 00:50:39,400
that in a bit but each a log consists of
 

2121
00:50:39,400 --> 00:50:42,709
that in a bit but each a log consists of
a sequence of log entries each log entry

2122
00:50:42,709 --> 00:50:42,719
a sequence of log entries each log entry
 

2123
00:50:42,719 --> 00:50:47,549
a sequence of log entries each log entry
has a log sequence number it's just an

2124
00:50:47,549 --> 00:50:47,559
has a log sequence number it's just an
 

2125
00:50:47,559 --> 00:50:48,989
has a log sequence number it's just an
increasing number each workstation

2126
00:50:48,989 --> 00:50:48,999
increasing number each workstation
 

2127
00:50:48,999 --> 00:50:53,219
increasing number each workstation
numbers it's log entries 1 2 3 4 5 and

2128
00:50:53,219 --> 00:50:53,229
numbers it's log entries 1 2 3 4 5 and
 

2129
00:50:53,229 --> 00:50:56,309
numbers it's log entries 1 2 3 4 5 and
the immediate reason for this may be the

2130
00:50:56,309 --> 00:50:56,319
the immediate reason for this may be the
 

2131
00:50:56,319 --> 00:50:58,049
the immediate reason for this may be the
only reason for this that the paper

2132
00:50:58,049 --> 00:50:58,059
only reason for this that the paper
 

2133
00:50:58,059 --> 00:51:02,160
only reason for this that the paper
mentions is that the the way that French

2134
00:51:02,160 --> 00:51:02,170
mentions is that the the way that French
 

2135
00:51:02,170 --> 00:51:04,829
mentions is that the the way that French
penny just detects the end of a work

2136
00:51:04,829 --> 00:51:04,839
penny just detects the end of a work
 

2137
00:51:04,839 --> 00:51:06,930
penny just detects the end of a work
stations log if the work station crashes

2138
00:51:06,930 --> 00:51:06,940
stations log if the work station crashes
 

2139
00:51:06,940 --> 00:51:10,229
stations log if the work station crashes
is by scanning for words in its log in

2140
00:51:10,229 --> 00:51:10,239
is by scanning for words in its log in
 

2141
00:51:10,239 --> 00:51:14,039
is by scanning for words in its log in
petal until it sees the increasing

2142
00:51:14,039 --> 00:51:14,049
petal until it sees the increasing
 

2143
00:51:14,049 --> 00:51:16,620
petal until it sees the increasing
sequence stop increasing and it knows

2144
00:51:16,620 --> 00:51:16,630
sequence stop increasing and it knows
 

2145
00:51:16,630 --> 00:51:18,120
sequence stop increasing and it knows
then that the log entry with the highest

2146
00:51:18,120 --> 00:51:18,130
then that the log entry with the highest
 

2147
00:51:18,130 --> 00:51:20,759
then that the log entry with the highest
log sequence number must be the very

2148
00:51:20,759 --> 00:51:20,769
log sequence number must be the very
 

2149
00:51:20,769 --> 00:51:23,130
log sequence number must be the very
last entry as it needs to be able to

2150
00:51:23,130 --> 00:51:23,140
last entry as it needs to be able to
 

2151
00:51:23,140 --> 00:51:27,509
last entry as it needs to be able to
detect the end of the log ok so we have

2152
00:51:27,509 --> 00:51:27,519
detect the end of the log ok so we have
 

2153
00:51:27,519 --> 00:51:29,160
detect the end of the log ok so we have
this log sequence number and then I

2154
00:51:29,160 --> 00:51:29,170
this log sequence number and then I
 

2155
00:51:29,170 --> 00:51:31,529
this log sequence number and then I
believe each log actually has an an

2156
00:51:31,529 --> 00:51:31,539
believe each log actually has an an
 

2157
00:51:31,539 --> 00:51:32,049
believe each log actually has an an
array

2158
00:51:32,049 --> 00:51:32,059
array
 

2159
00:51:32,059 --> 00:51:35,380
array
of descriptions of model aughh entry has

2160
00:51:35,380 --> 00:51:35,390
of descriptions of model aughh entry has
 

2161
00:51:35,390 --> 00:51:38,049
of descriptions of model aughh entry has
an array of the descriptions of the

2162
00:51:38,049 --> 00:51:38,059
an array of the descriptions of the
 

2163
00:51:38,059 --> 00:51:39,849
an array of the descriptions of the
modifications all the different

2164
00:51:39,849 --> 00:51:39,859
modifications all the different
 

2165
00:51:39,859 --> 00:51:41,920
modifications all the different
modifications that were involved in a

2166
00:51:41,920 --> 00:51:41,930
modifications that were involved in a
 

2167
00:51:41,930 --> 00:51:44,049
modifications that were involved in a
particular operation or an operation of

2168
00:51:44,049 --> 00:51:44,059
particular operation or an operation of
 

2169
00:51:44,059 --> 00:51:48,400
particular operation or an operation of
some a file system system call so each

2170
00:51:48,400 --> 00:51:48,410
some a file system system call so each
 

2171
00:51:48,410 --> 00:51:51,160
some a file system system call so each
entry in the array is going to have a

2172
00:51:51,160 --> 00:51:51,170
entry in the array is going to have a
 

2173
00:51:51,170 --> 00:51:53,979
entry in the array is going to have a
block number it's a block number in

2174
00:51:53,979 --> 00:51:53,989
block number it's a block number in
 

2175
00:51:53,989 --> 00:52:00,910
block number it's a block number in
petal there's a version number which

2176
00:52:00,910 --> 00:52:00,920
petal there's a version number which
 

2177
00:52:00,920 --> 00:52:07,890
petal there's a version number which
we'll get to in a bit and then there's

2178
00:52:07,890 --> 00:52:07,900
we'll get to in a bit and then there's
 

2179
00:52:07,900 --> 00:52:12,370
we'll get to in a bit and then there's
the data to be written and so there's a

2180
00:52:12,370 --> 00:52:12,380
the data to be written and so there's a
 

2181
00:52:12,380 --> 00:52:18,009
the data to be written and so there's a
bunch of these required to describe

2182
00:52:18,009 --> 00:52:18,019
bunch of these required to describe
 

2183
00:52:18,019 --> 00:52:19,630
bunch of these required to describe
operations that might touch more than

2184
00:52:19,630 --> 00:52:19,640
operations that might touch more than
 

2185
00:52:19,640 --> 00:52:23,019
operations that might touch more than
one piece of data in the file system one

2186
00:52:23,019 --> 00:52:23,029
one piece of data in the file system one
 

2187
00:52:23,029 --> 00:52:25,599
one piece of data in the file system one
thing to notice is that the log only

2188
00:52:25,599 --> 00:52:25,609
thing to notice is that the log only
 

2189
00:52:25,609 --> 00:52:29,259
thing to notice is that the log only
contains information about changes to

2190
00:52:29,259 --> 00:52:29,269
contains information about changes to
 

2191
00:52:29,269 --> 00:52:32,559
contains information about changes to
metadata that is to directories and

2192
00:52:32,559 --> 00:52:32,569
metadata that is to directories and
 

2193
00:52:32,569 --> 00:52:37,059
metadata that is to directories and
inodes and allocation bitmaps in the

2194
00:52:37,059 --> 00:52:37,069
inodes and allocation bitmaps in the
 

2195
00:52:37,069 --> 00:52:38,709
inodes and allocation bitmaps in the
file system the log doesn't actually

2196
00:52:38,709 --> 00:52:38,719
file system the log doesn't actually
 

2197
00:52:38,719 --> 00:52:41,469
file system the log doesn't actually
contain the data that is written to the

2198
00:52:41,469 --> 00:52:41,479
contain the data that is written to the
 

2199
00:52:41,479 --> 00:52:43,390
contain the data that is written to the
contents of files it doesn't contain the

2200
00:52:43,390 --> 00:52:43,400
contents of files it doesn't contain the
 

2201
00:52:43,400 --> 00:52:45,339
contents of files it doesn't contain the
user's data it just contains information

2202
00:52:45,339 --> 00:52:45,349
user's data it just contains information
 

2203
00:52:45,349 --> 00:52:47,799
user's data it just contains information
enough information to make the file

2204
00:52:47,799 --> 00:52:47,809
enough information to make the file
 

2205
00:52:47,809 --> 00:52:51,009
enough information to make the file
systems structures recoverable after a

2206
00:52:51,009 --> 00:52:51,019
systems structures recoverable after a
 

2207
00:52:51,019 --> 00:52:55,299
systems structures recoverable after a
crash so for example if I create a file

2208
00:52:55,299 --> 00:52:55,309
crash so for example if I create a file
 

2209
00:52:55,309 --> 00:52:58,229
crash so for example if I create a file
called F in a directory that's gonna

2210
00:52:58,229 --> 00:52:58,239
called F in a directory that's gonna
 

2211
00:52:58,239 --> 00:53:01,809
called F in a directory that's gonna
result in a new log entry that has two

2212
00:53:01,809 --> 00:53:01,819
result in a new log entry that has two
 

2213
00:53:01,819 --> 00:53:04,329
result in a new log entry that has two
little descriptions of modifications in

2214
00:53:04,329 --> 00:53:04,339
little descriptions of modifications in
 

2215
00:53:04,339 --> 00:53:06,279
little descriptions of modifications in
it one a description of how to

2216
00:53:06,279 --> 00:53:06,289
it one a description of how to
 

2217
00:53:06,289 --> 00:53:08,799
it one a description of how to
initialize the new files inode and in

2218
00:53:08,799 --> 00:53:08,809
initialize the new files inode and in
 

2219
00:53:08,809 --> 00:53:11,919
initialize the new files inode and in
another description of a new name to be

2220
00:53:11,919 --> 00:53:11,929
another description of a new name to be
 

2221
00:53:11,929 --> 00:53:17,130
another description of a new name to be
placed in the new files directory

2222
00:53:17,130 --> 00:53:17,140

 

2223
00:53:17,140 --> 00:53:21,249

alright so one thing I didn't mention so

2224
00:53:21,249 --> 00:53:21,259
alright so one thing I didn't mention so
 

2225
00:53:21,259 --> 00:53:22,689
alright so one thing I didn't mention so
of course the log is really a sequence

2226
00:53:22,689 --> 00:53:22,699
of course the log is really a sequence
 

2227
00:53:22,699 --> 00:53:28,620
of course the log is really a sequence
of these log entries

2228
00:53:28,620 --> 00:53:28,630

 

2229
00:53:28,630 --> 00:53:32,430

initially in order to be able to do

2230
00:53:32,430 --> 00:53:32,440
initially in order to be able to do
 

2231
00:53:32,440 --> 00:53:34,830
initially in order to be able to do
modifications as fast as possible

2232
00:53:34,830 --> 00:53:34,840
modifications as fast as possible
 

2233
00:53:34,840 --> 00:53:37,510
modifications as fast as possible
initially a friend Japanese workstations

2234
00:53:37,510 --> 00:53:37,520
initially a friend Japanese workstations
 

2235
00:53:37,520 --> 00:53:40,870
initially a friend Japanese workstations
log is only stored inside the

2236
00:53:40,870 --> 00:53:40,880
log is only stored inside the
 

2237
00:53:40,880 --> 00:53:43,450
log is only stored inside the
workstations own memory and won't be

2238
00:53:43,450 --> 00:53:43,460
workstations own memory and won't be
 

2239
00:53:43,460 --> 00:53:46,420
workstations own memory and won't be
written back to peddle until it has to

2240
00:53:46,420 --> 00:53:46,430
written back to peddle until it has to
 

2241
00:53:46,430 --> 00:53:49,600
written back to peddle until it has to
be and that's so that you know writing

2242
00:53:49,600 --> 00:53:49,610
be and that's so that you know writing
 

2243
00:53:49,610 --> 00:53:51,580
be and that's so that you know writing
anything including log entries to peddle

2244
00:53:51,580 --> 00:53:51,590
anything including log entries to peddle
 

2245
00:53:51,590 --> 00:53:53,320
anything including log entries to peddle
you know it takes a long time so we want

2246
00:53:53,320 --> 00:53:53,330
you know it takes a long time so we want
 

2247
00:53:53,330 --> 00:53:55,450
you know it takes a long time so we want
to avoid even writing log entries back

2248
00:53:55,450 --> 00:53:55,460
to avoid even writing log entries back
 

2249
00:53:55,460 --> 00:53:58,180
to avoid even writing log entries back
to peddle as well as writing dirty data

2250
00:53:58,180 --> 00:53:58,190
to peddle as well as writing dirty data
 

2251
00:53:58,190 --> 00:54:00,580
to peddle as well as writing dirty data
or modified blocks back to peddle we'd

2252
00:54:00,580 --> 00:54:00,590
or modified blocks back to peddle we'd
 

2253
00:54:00,590 --> 00:54:02,320
or modified blocks back to peddle we'd
like to avoid doing that as long as

2254
00:54:02,320 --> 00:54:02,330
like to avoid doing that as long as
 

2255
00:54:02,330 --> 00:54:07,300
like to avoid doing that as long as
possible so the real full story for what

2256
00:54:07,300 --> 00:54:07,310
possible so the real full story for what
 

2257
00:54:07,310 --> 00:54:13,000
possible so the real full story for what
happens when a workstation gets a revoke

2258
00:54:13,000 --> 00:54:13,010
happens when a workstation gets a revoke
 

2259
00:54:13,010 --> 00:54:15,730
happens when a workstation gets a revoke
message from the lock server seeing that

2260
00:54:15,730 --> 00:54:15,740
message from the lock server seeing that
 

2261
00:54:15,740 --> 00:54:28,710
message from the lock server seeing that
it has to give up a certain lock so on

2262
00:54:28,710 --> 00:54:28,720

 

2263
00:54:28,720 --> 00:54:31,000

right now this is the same you know this

2264
00:54:31,000 --> 00:54:31,010
right now this is the same you know this
 

2265
00:54:31,010 --> 00:54:33,010
right now this is the same you know this
is though compared sporto's

2266
00:54:33,010 --> 00:54:33,020
is though compared sporto's
 

2267
00:54:33,020 --> 00:54:36,640
is though compared sporto's
protocols revoke message if the

2268
00:54:36,640 --> 00:54:36,650
protocols revoke message if the
 

2269
00:54:36,650 --> 00:54:39,700
protocols revoke message if the
workstation gets a revoke message the

2270
00:54:39,700 --> 00:54:39,710
workstation gets a revoke message the
 

2271
00:54:39,710 --> 00:54:41,950
workstation gets a revoke message the
series of steps it must take is first

2272
00:54:41,950 --> 00:54:41,960
series of steps it must take is first
 

2273
00:54:41,960 --> 00:54:47,290
series of steps it must take is first
it's great that's the right any parts of

2274
00:54:47,290 --> 00:54:47,300
it's great that's the right any parts of
 

2275
00:54:47,300 --> 00:54:48,910
it's great that's the right any parts of
its log that are only in memory and

2276
00:54:48,910 --> 00:54:48,920
its log that are only in memory and
 

2277
00:54:48,920 --> 00:54:50,740
its log that are only in memory and
haven't yet been written to peddle it's

2278
00:54:50,740 --> 00:54:50,750
haven't yet been written to peddle it's
 

2279
00:54:50,750 --> 00:54:52,420
haven't yet been written to peddle it's
got to make sure as log is complete and

2280
00:54:52,420 --> 00:54:52,430
got to make sure as log is complete and
 

2281
00:54:52,430 --> 00:54:54,610
got to make sure as log is complete and
pedal as the first step so it writes

2282
00:54:54,610 --> 00:54:54,620
pedal as the first step so it writes
 

2283
00:54:54,620 --> 00:55:09,010
pedal as the first step so it writes
it's long and only then does it write

2284
00:55:09,010 --> 00:55:09,020
it's long and only then does it write
 

2285
00:55:09,020 --> 00:55:16,030
it's long and only then does it write
any updated blocks that are covered by

2286
00:55:16,030 --> 00:55:16,040
any updated blocks that are covered by
 

2287
00:55:16,040 --> 00:55:21,330
any updated blocks that are covered by
the lock that's being revoked so write

2288
00:55:21,330 --> 00:55:21,340
the lock that's being revoked so write
 

2289
00:55:21,340 --> 00:55:28,059
the lock that's being revoked so write
modified blocks

2290
00:55:28,059 --> 00:55:28,069

 

2291
00:55:28,069 --> 00:55:40,410

just for that provoked to lock and then

2292
00:55:40,410 --> 00:55:40,420

 

2293
00:55:40,420 --> 00:55:48,489

send a release message and the reason

2294
00:55:48,489 --> 00:55:48,499
send a release message and the reason
 

2295
00:55:48,499 --> 00:55:50,049
send a release message and the reason
for this sequencing and for this strict

2296
00:55:50,049 --> 00:55:50,059
for this sequencing and for this strict
 

2297
00:55:50,059 --> 00:55:54,370
for this sequencing and for this strict
ban is that these modifications if we

2298
00:55:54,370 --> 00:55:54,380
ban is that these modifications if we
 

2299
00:55:54,380 --> 00:55:55,809
ban is that these modifications if we
write them to peddle you know their

2300
00:55:55,809 --> 00:55:55,819
write them to peddle you know their
 

2301
00:55:55,819 --> 00:55:58,689
write them to peddle you know their
modifications to the data structure the

2302
00:55:58,689 --> 00:55:58,699
modifications to the data structure the
 

2303
00:55:58,699 --> 00:56:00,459
modifications to the data structure the
file system data structure and if we

2304
00:56:00,459 --> 00:56:00,469
file system data structure and if we
 

2305
00:56:00,469 --> 00:56:01,900
file system data structure and if we
were to crash midway through baby news

2306
00:56:01,900 --> 00:56:01,910
were to crash midway through baby news
 

2307
00:56:01,910 --> 00:56:04,930
were to crash midway through baby news
box just as usual we want to make sure

2308
00:56:04,930 --> 00:56:04,940
box just as usual we want to make sure
 

2309
00:56:04,940 --> 00:56:07,599
box just as usual we want to make sure
that some other workstation somebody

2310
00:56:07,599 --> 00:56:07,609
that some other workstation somebody
 

2311
00:56:07,609 --> 00:56:09,189
that some other workstation somebody
else there's enough information to be

2312
00:56:09,189 --> 00:56:09,199
else there's enough information to be
 

2313
00:56:09,199 --> 00:56:12,039
else there's enough information to be
able to complete the set of

2314
00:56:12,039 --> 00:56:12,049
able to complete the set of
 

2315
00:56:12,049 --> 00:56:14,890
able to complete the set of
modifications that the were station is

2316
00:56:14,890 --> 00:56:14,900
modifications that the were station is
 

2317
00:56:14,900 --> 00:56:16,120
modifications that the were station is
made even though the workstation has

2318
00:56:16,120 --> 00:56:16,130
made even though the workstation has
 

2319
00:56:16,130 --> 00:56:17,799
made even though the workstation has
crashed and maybe didn't finish doing

2320
00:56:17,799 --> 00:56:17,809
crashed and maybe didn't finish doing
 

2321
00:56:17,809 --> 00:56:20,079
crashed and maybe didn't finish doing
these rights and writing the log first

2322
00:56:20,079 --> 00:56:20,089
these rights and writing the log first
 

2323
00:56:20,089 --> 00:56:22,390
these rights and writing the log first
it's gonna be what allows us to

2324
00:56:22,390 --> 00:56:22,400
it's gonna be what allows us to
 

2325
00:56:22,400 --> 00:56:24,670
it's gonna be what allows us to
accomplish it these these log records

2326
00:56:24,670 --> 00:56:24,680
accomplish it these these log records
 

2327
00:56:24,680 --> 00:56:26,319
accomplish it these these log records
are a complete description of what these

2328
00:56:26,319 --> 00:56:26,329
are a complete description of what these
 

2329
00:56:26,329 --> 00:56:28,089
are a complete description of what these
modifications are going to be so first

2330
00:56:28,089 --> 00:56:28,099
modifications are going to be so first
 

2331
00:56:28,099 --> 00:56:30,759
modifications are going to be so first
we you know first we write though the

2332
00:56:30,759 --> 00:56:30,769
we you know first we write though the
 

2333
00:56:30,769 --> 00:56:33,539
we you know first we write though the
complete log to petal and then we

2334
00:56:33,539 --> 00:56:33,549
complete log to petal and then we
 

2335
00:56:33,549 --> 00:56:35,709
complete log to petal and then we
workstation can start writing its

2336
00:56:35,709 --> 00:56:35,719
workstation can start writing its
 

2337
00:56:35,719 --> 00:56:37,599
workstation can start writing its
modified blocks you know maybe it

2338
00:56:37,599 --> 00:56:37,609
modified blocks you know maybe it
 

2339
00:56:37,609 --> 00:56:39,309
modified blocks you know maybe it
crashes maybe doesn't hopefully not and

2340
00:56:39,309 --> 00:56:39,319
crashes maybe doesn't hopefully not and
 

2341
00:56:39,319 --> 00:56:41,620
crashes maybe doesn't hopefully not and
if it finishes writing as modified

2342
00:56:41,620 --> 00:56:41,630
if it finishes writing as modified
 

2343
00:56:41,630 --> 00:56:43,059
if it finishes writing as modified
blocks then it could send the release

2344
00:56:43,059 --> 00:56:43,069
blocks then it could send the release
 

2345
00:56:43,069 --> 00:56:45,249
blocks then it could send the release
back to the lock server so you know if

2346
00:56:45,249 --> 00:56:45,259
back to the lock server so you know if
 

2347
00:56:45,259 --> 00:56:46,749
back to the lock server so you know if
my workstation has modified a bunch of

2348
00:56:46,749 --> 00:56:46,759
my workstation has modified a bunch of
 

2349
00:56:46,759 --> 00:56:48,489
my workstation has modified a bunch of
files and then some other workstation

2350
00:56:48,489 --> 00:56:48,499
files and then some other workstation
 

2351
00:56:48,499 --> 00:56:50,410
files and then some other workstation
wants to read one of those files this is

2352
00:56:50,410 --> 00:56:50,420
wants to read one of those files this is
 

2353
00:56:50,420 --> 00:56:52,209
wants to read one of those files this is
the sequence that happens lock so ever

2354
00:56:52,209 --> 00:56:52,219
the sequence that happens lock so ever
 

2355
00:56:52,219 --> 00:56:54,939
the sequence that happens lock so ever
asked me for my locks right back my

2356
00:56:54,939 --> 00:56:54,949
asked me for my locks right back my
 

2357
00:56:54,949 --> 00:56:56,920
asked me for my locks right back my
workstation right back said log then

2358
00:56:56,920 --> 00:56:56,930
workstation right back said log then
 

2359
00:56:56,930 --> 00:56:58,359
workstation right back said log then
right back

2360
00:56:58,359 --> 00:56:58,369
right back
 

2361
00:56:58,369 --> 00:57:01,120
right back
writes the dirty modified blocks to

2362
00:57:01,120 --> 00:57:01,130
writes the dirty modified blocks to
 

2363
00:57:01,130 --> 00:57:03,219
writes the dirty modified blocks to
peddle and only then releases and then

2364
00:57:03,219 --> 00:57:03,229
peddle and only then releases and then
 

2365
00:57:03,229 --> 00:57:04,660
peddle and only then releases and then
the other workstation can acquire the

2366
00:57:04,660 --> 00:57:04,670
the other workstation can acquire the
 

2367
00:57:04,670 --> 00:57:06,549
the other workstation can acquire the
lock and read these blocks so that's

2368
00:57:06,549 --> 00:57:06,559
lock and read these blocks so that's
 

2369
00:57:06,559 --> 00:57:09,279
lock and read these blocks so that's
sort of the non crash you know if a

2370
00:57:09,279 --> 00:57:09,289
sort of the non crash you know if a
 

2371
00:57:09,289 --> 00:57:13,420
sort of the non crash you know if a
crash doesn't happen that is the

2372
00:57:13,420 --> 00:57:13,430
crash doesn't happen that is the
 

2373
00:57:13,430 --> 00:57:17,920
crash doesn't happen that is the
sequence of course it's only interesting

2374
00:57:17,920 --> 00:57:17,930
sequence of course it's only interesting
 

2375
00:57:17,930 --> 00:57:21,970
sequence of course it's only interesting
if a crash happens yes

2376
00:57:21,970 --> 00:57:21,980

 

2377
00:57:21,980 --> 00:57:35,509

[Music]

2378
00:57:35,509 --> 00:57:35,519

 

2379
00:57:35,519 --> 00:57:38,069

okay so for the log you're absolutely

2380
00:57:38,069 --> 00:57:38,079
okay so for the log you're absolutely
 

2381
00:57:38,079 --> 00:57:42,959
okay so for the log you're absolutely
right it writes the entire log and yeah

2382
00:57:42,959 --> 00:57:42,969
right it writes the entire log and yeah
 

2383
00:57:42,969 --> 00:57:44,849
right it writes the entire log and yeah
so so if if we get a revoke for a

2384
00:57:44,849 --> 00:57:44,859
so so if if we get a revoke for a
 

2385
00:57:44,859 --> 00:57:47,670
so so if if we get a revoke for a
particular file the workstation will

2386
00:57:47,670 --> 00:57:47,680
particular file the workstation will
 

2387
00:57:47,680 --> 00:57:53,309
particular file the workstation will
write its entire log and then only it's

2388
00:57:53,309 --> 00:57:53,319
write its entire log and then only it's
 

2389
00:57:53,319 --> 00:57:54,989
write its entire log and then only it's
only because it's only giving up the

2390
00:57:54,989 --> 00:57:54,999
only because it's only giving up the
 

2391
00:57:54,999 --> 00:57:59,640
only because it's only giving up the
lock for Z it it only needs to write

2392
00:57:59,640 --> 00:57:59,650
lock for Z it it only needs to write
 

2393
00:57:59,650 --> 00:58:01,349
lock for Z it it only needs to write
back data that's covered by Z so I have

2394
00:58:01,349 --> 00:58:01,359
back data that's covered by Z so I have
 

2395
00:58:01,359 --> 00:58:03,870
back data that's covered by Z so I have
to write the whole log just the data

2396
00:58:03,870 --> 00:58:03,880
to write the whole log just the data
 

2397
00:58:03,880 --> 00:58:05,279
to write the whole log just the data
that's covered by the lock that we

2398
00:58:05,279 --> 00:58:05,289
that's covered by the lock that we
 

2399
00:58:05,289 --> 00:58:07,319
that's covered by the lock that we
needed to give up and then we can

2400
00:58:07,319 --> 00:58:07,329
needed to give up and then we can
 

2401
00:58:07,329 --> 00:58:10,049
needed to give up and then we can
release that lock so yeah you know maybe

2402
00:58:10,049 --> 00:58:10,059
release that lock so yeah you know maybe
 

2403
00:58:10,059 --> 00:58:11,459
release that lock so yeah you know maybe
this writing the whole log might be

2404
00:58:11,459 --> 00:58:11,469
this writing the whole log might be
 

2405
00:58:11,469 --> 00:58:13,920
this writing the whole log might be
overkill like you if it turned out you

2406
00:58:13,920 --> 00:58:13,930
overkill like you if it turned out you
 

2407
00:58:13,930 --> 00:58:15,900
overkill like you if it turned out you
know so here's an optimization that you

2408
00:58:15,900 --> 00:58:15,910
know so here's an optimization that you
 

2409
00:58:15,910 --> 00:58:18,839
know so here's an optimization that you
might or might not care about if the

2410
00:58:18,839 --> 00:58:18,849
might or might not care about if the
 

2411
00:58:18,849 --> 00:58:21,599
might or might not care about if the
last modification for profile Z for the

2412
00:58:21,599 --> 00:58:21,609
last modification for profile Z for the
 

2413
00:58:21,609 --> 00:58:22,979
last modification for profile Z for the
lock were giving up is this one but

2414
00:58:22,979 --> 00:58:22,989
lock were giving up is this one but
 

2415
00:58:22,989 --> 00:58:25,499
lock were giving up is this one but
subsequent entries in my log didn't

2416
00:58:25,499 --> 00:58:25,509
subsequent entries in my log didn't
 

2417
00:58:25,509 --> 00:58:27,660
subsequent entries in my log didn't
modify that file then I could just write

2418
00:58:27,660 --> 00:58:27,670
modify that file then I could just write
 

2419
00:58:27,670 --> 00:58:30,209
modify that file then I could just write
just this prefix of my in-memory log

2420
00:58:30,209 --> 00:58:30,219
just this prefix of my in-memory log
 

2421
00:58:30,219 --> 00:58:33,449
just this prefix of my in-memory log
back to petal and you know be lazy about

2422
00:58:33,449 --> 00:58:33,459
back to petal and you know be lazy about
 

2423
00:58:33,459 --> 00:58:36,479
back to petal and you know be lazy about
writing the rest and that might see me

2424
00:58:36,479 --> 00:58:36,489
writing the rest and that might see me
 

2425
00:58:36,489 --> 00:58:37,019
writing the rest and that might see me
sometime

2426
00:58:37,019 --> 00:58:37,029
sometime
 

2427
00:58:37,029 --> 00:58:41,370
sometime
I might have to write the log back it's

2428
00:58:41,370 --> 00:58:41,380
I might have to write the log back it's
 

2429
00:58:41,380 --> 00:58:42,539
I might have to write the log back it's
actually not clear I would save us a lot

2430
00:58:42,539 --> 00:58:42,549
actually not clear I would save us a lot
 

2431
00:58:42,549 --> 00:58:43,769
actually not clear I would save us a lot
of time we have to write the log back at

2432
00:58:43,769 --> 00:58:43,779
of time we have to write the log back at
 

2433
00:58:43,779 --> 00:58:47,880
of time we have to write the log back at
some point anyway and yeah I think petal

2434
00:58:47,880 --> 00:58:47,890
some point anyway and yeah I think petal
 

2435
00:58:47,890 --> 00:58:53,729
some point anyway and yeah I think petal
just writes the whole thing okay okay so

2436
00:58:53,729 --> 00:58:53,739
just writes the whole thing okay okay so
 

2437
00:58:53,739 --> 00:58:56,279
just writes the whole thing okay okay so
now we can talk about what happens when

2438
00:58:56,279 --> 00:58:56,289
now we can talk about what happens when
 

2439
00:58:56,289 --> 00:58:58,529
now we can talk about what happens when
a workstation crashes while holding

2440
00:58:58,529 --> 00:58:58,539
a workstation crashes while holding
 

2441
00:58:58,539 --> 00:59:01,400
a workstation crashes while holding
locks right it's you know needs to

2442
00:59:01,400 --> 00:59:01,410
locks right it's you know needs to
 

2443
00:59:01,410 --> 00:59:03,900
locks right it's you know needs to
modify something rename a file create a

2444
00:59:03,900 --> 00:59:03,910
modify something rename a file create a
 

2445
00:59:03,910 --> 00:59:05,370
modify something rename a file create a
file whatever it's acquired all the

2446
00:59:05,370 --> 00:59:05,380
file whatever it's acquired all the
 

2447
00:59:05,380 --> 00:59:07,559
file whatever it's acquired all the
locks it needs it's modified some stuff

2448
00:59:07,559 --> 00:59:07,569
locks it needs it's modified some stuff
 

2449
00:59:07,569 --> 00:59:13,799
locks it needs it's modified some stuff
in its own cache to reflect these

2450
00:59:13,799 --> 00:59:13,809
in its own cache to reflect these
 

2451
00:59:13,809 --> 00:59:17,370
in its own cache to reflect these
operations maybe written some stuff back

2452
00:59:17,370 --> 00:59:17,380
operations maybe written some stuff back
 

2453
00:59:17,380 --> 00:59:19,620
operations maybe written some stuff back
to petal and then crashed men possibly

2454
00:59:19,620 --> 00:59:19,630
to petal and then crashed men possibly
 

2455
00:59:19,630 --> 00:59:21,839
to petal and then crashed men possibly
midway through writing so there's a

2456
00:59:21,839 --> 00:59:21,849
midway through writing so there's a
 

2457
00:59:21,849 --> 00:59:24,140
midway through writing so there's a
number of points at which it could crash

2458
00:59:24,140 --> 00:59:24,150
number of points at which it could crash
 

2459
00:59:24,150 --> 00:59:26,699
number of points at which it could crash
right because this is always the

2460
00:59:26,699 --> 00:59:26,709
right because this is always the
 

2461
00:59:26,709 --> 00:59:31,769
right because this is always the
sequence it always just always before

2462
00:59:31,769 --> 00:59:31,779
sequence it always just always before
 

2463
00:59:31,779 --> 00:59:33,870
sequence it always just always before
writing modified blocks from the cache

2464
00:59:33,870 --> 00:59:33,880
writing modified blocks from the cache
 

2465
00:59:33,880 --> 00:59:34,320
writing modified blocks from the cache
back

2466
00:59:34,320 --> 00:59:34,330
back
 

2467
00:59:34,330 --> 00:59:36,600
back
the frangipani will always have written

2468
00:59:36,600 --> 00:59:36,610
the frangipani will always have written
 

2469
00:59:36,610 --> 00:59:39,360
the frangipani will always have written
it's logged pedal first that means that

2470
00:59:39,360 --> 00:59:39,370
it's logged pedal first that means that
 

2471
00:59:39,370 --> 00:59:41,820
it's logged pedal first that means that
if a crash happens it's either while the

2472
00:59:41,820 --> 00:59:41,830
if a crash happens it's either while the
 

2473
00:59:41,830 --> 00:59:43,680
if a crash happens it's either while the
worst station is writing us log back to

2474
00:59:43,680 --> 00:59:43,690
worst station is writing us log back to
 

2475
00:59:43,690 --> 00:59:45,600
worst station is writing us log back to
pedal but before it's written any

2476
00:59:45,600 --> 00:59:45,610
pedal but before it's written any
 

2477
00:59:45,610 --> 00:59:48,090
pedal but before it's written any
modified file or directory' blocks back

2478
00:59:48,090 --> 00:59:48,100
modified file or directory' blocks back
 

2479
00:59:48,100 --> 00:59:51,210
modified file or directory' blocks back
or it crashes while it's writing these

2480
00:59:51,210 --> 00:59:51,220
or it crashes while it's writing these
 

2481
00:59:51,220 --> 00:59:53,490
or it crashes while it's writing these
modified block back but therefore

2482
00:59:53,490 --> 00:59:53,500
modified block back but therefore
 

2483
00:59:53,500 --> 00:59:55,710
modified block back but therefore
definitely after it's written in its

2484
00:59:55,710 --> 00:59:55,720
definitely after it's written in its
 

2485
00:59:55,720 --> 00:59:57,720
definitely after it's written in its
entire log and so that's a very

2486
00:59:57,720 --> 00:59:57,730
entire log and so that's a very
 

2487
00:59:57,730 --> 01:00:00,360
entire log and so that's a very
important you know but or maybe the

2488
01:00:00,360 --> 01:00:00,370
important you know but or maybe the
 

2489
01:00:00,370 --> 01:00:01,650
important you know but or maybe the
crash happened after it's completely

2490
01:00:01,650 --> 01:00:01,660
crash happened after it's completely
 

2491
01:00:01,660 --> 01:00:05,520
crash happened after it's completely
finished all of this so you know there's

2492
01:00:05,520 --> 01:00:05,530
finished all of this so you know there's
 

2493
01:00:05,530 --> 01:00:06,960
finished all of this so you know there's
only because of the sequencing there's

2494
01:00:06,960 --> 01:00:06,970
only because of the sequencing there's
 

2495
01:00:06,970 --> 01:00:08,340
only because of the sequencing there's
only a limited number of kind of

2496
01:00:08,340 --> 01:00:08,350
only a limited number of kind of
 

2497
01:00:08,350 --> 01:00:10,950
only a limited number of kind of
scenarios we made me worried about for

2498
01:00:10,950 --> 01:00:10,960
scenarios we made me worried about for
 

2499
01:00:10,960 --> 01:00:15,960
scenarios we made me worried about for
the crash okay so the workstations

2500
01:00:15,960 --> 01:00:15,970
the crash okay so the workstations
 

2501
01:00:15,970 --> 01:00:18,360
the crash okay so the workstations
crashed its crashed you know for like to

2502
01:00:18,360 --> 01:00:18,370
crashed its crashed you know for like to
 

2503
01:00:18,370 --> 01:00:19,890
crashed its crashed you know for like to
be exciting let's crash while Holdings

2504
01:00:19,890 --> 01:00:19,900
be exciting let's crash while Holdings
 

2505
01:00:19,900 --> 01:00:21,660
be exciting let's crash while Holdings
locks the first thing that happens the

2506
01:00:21,660 --> 01:00:21,670
locks the first thing that happens the
 

2507
01:00:21,670 --> 01:00:23,940
locks the first thing that happens the
lock server sends it a revoke request

2508
01:00:23,940 --> 01:00:23,950
lock server sends it a revoke request
 

2509
01:00:23,950 --> 01:00:26,610
lock server sends it a revoke request
and the lock server gets no response all

2510
01:00:26,610 --> 01:00:26,620
and the lock server gets no response all
 

2511
01:00:26,620 --> 01:00:27,750
and the lock server gets no response all
right that's what starts to trigger

2512
01:00:27,750 --> 01:00:27,760
right that's what starts to trigger
 

2513
01:00:27,760 --> 01:00:29,550
right that's what starts to trigger
anything where did nobody ever asked for

2514
01:00:29,550 --> 01:00:29,560
anything where did nobody ever asked for
 

2515
01:00:29,560 --> 01:00:32,000
anything where did nobody ever asked for
the lock

2516
01:00:32,000 --> 01:00:32,010

 

2517
01:00:32,010 --> 01:00:33,990

basically nobody's ever going to notice

2518
01:00:33,990 --> 01:00:34,000
basically nobody's ever going to notice
 

2519
01:00:34,000 --> 01:00:35,880
basically nobody's ever going to notice
that the workstation crashed so let's

2520
01:00:35,880 --> 01:00:35,890
that the workstation crashed so let's
 

2521
01:00:35,890 --> 01:00:37,290
that the workstation crashed so let's
assume somebody else wanted one of the

2522
01:00:37,290 --> 01:00:37,300
assume somebody else wanted one of the
 

2523
01:00:37,300 --> 01:00:40,260
assume somebody else wanted one of the
locks that the workstation had while it

2524
01:00:40,260 --> 01:00:40,270
locks that the workstation had while it
 

2525
01:00:40,270 --> 01:00:42,540
locks that the workstation had while it
was crashed and the lock service ended

2526
01:00:42,540 --> 01:00:42,550
was crashed and the lock service ended
 

2527
01:00:42,550 --> 01:00:44,700
was crashed and the lock service ended
revoke and it will never get a release

2528
01:00:44,700 --> 01:00:44,710
revoke and it will never get a release
 

2529
01:00:44,710 --> 01:00:47,250
revoke and it will never get a release
back from the workstation after a

2530
01:00:47,250 --> 01:00:47,260
back from the workstation after a
 

2531
01:00:47,260 --> 01:00:48,990
back from the workstation after a
certain amount of time has passed and it

2532
01:00:48,990 --> 01:00:49,000
certain amount of time has passed and it
 

2533
01:00:49,000 --> 01:00:52,020
certain amount of time has passed and it
turns out frangipani locks use leases

2534
01:00:52,020 --> 01:00:52,030
turns out frangipani locks use leases
 

2535
01:00:52,030 --> 01:00:53,670
turns out frangipani locks use leases
for a number of reasons so you know

2536
01:00:53,670 --> 01:00:53,680
for a number of reasons so you know
 

2537
01:00:53,680 --> 01:00:56,640
for a number of reasons so you know
after the least time has expired the

2538
01:00:56,640 --> 01:00:56,650
after the least time has expired the
 

2539
01:00:56,650 --> 01:00:58,380
after the least time has expired the
lock server will decide that the

2540
01:00:58,380 --> 01:00:58,390
lock server will decide that the
 

2541
01:00:58,390 --> 01:01:00,990
lock server will decide that the
workstation must have crashed and it

2542
01:01:00,990 --> 01:01:01,000
workstation must have crashed and it
 

2543
01:01:01,000 --> 01:01:02,550
workstation must have crashed and it
will initiate recovery and what that

2544
01:01:02,550 --> 01:01:02,560
will initiate recovery and what that
 

2545
01:01:02,560 --> 01:01:03,990
will initiate recovery and what that
really means is telling a different

2546
01:01:03,990 --> 01:01:04,000
really means is telling a different
 

2547
01:01:04,000 --> 01:01:06,690
really means is telling a different
workstation the lock server will tell

2548
01:01:06,690 --> 01:01:06,700
workstation the lock server will tell
 

2549
01:01:06,700 --> 01:01:08,870
workstation the lock server will tell
some other live workstation look

2550
01:01:08,870 --> 01:01:08,880
some other live workstation look
 

2551
01:01:08,880 --> 01:01:10,710
some other live workstation look
workstation one seems to have crashed

2552
01:01:10,710 --> 01:01:10,720
workstation one seems to have crashed
 

2553
01:01:10,720 --> 01:01:16,320
workstation one seems to have crashed
please go read it's log and replay all

2554
01:01:16,320 --> 01:01:16,330
please go read it's log and replay all
 

2555
01:01:16,330 --> 01:01:18,000
please go read it's log and replay all
of its recent operations to make sure

2556
01:01:18,000 --> 01:01:18,010
of its recent operations to make sure
 

2557
01:01:18,010 --> 01:01:20,610
of its recent operations to make sure
they're complete and tell me when you're

2558
01:01:20,610 --> 01:01:20,620
they're complete and tell me when you're
 

2559
01:01:20,620 --> 01:01:22,500
they're complete and tell me when you're
done and only then the lock servers

2560
01:01:22,500 --> 01:01:22,510
done and only then the lock servers
 

2561
01:01:22,510 --> 01:01:29,540
done and only then the lock servers
going to release the locks so okay so

2562
01:01:29,540 --> 01:01:29,550
going to release the locks so okay so
 

2563
01:01:29,550 --> 01:01:32,310
going to release the locks so okay so
and and this is the point at which it

2564
01:01:32,310 --> 01:01:32,320
and and this is the point at which it
 

2565
01:01:32,320 --> 01:01:34,470
and and this is the point at which it
was critical that the logs are in pedal

2566
01:01:34,470 --> 01:01:34,480
was critical that the logs are in pedal
 

2567
01:01:34,480 --> 01:01:36,480
was critical that the logs are in pedal
because some other workstation is going

2568
01:01:36,480 --> 01:01:36,490
because some other workstation is going
 

2569
01:01:36,490 --> 01:01:39,330
because some other workstation is going
to inspect the crash workstations log in

2570
01:01:39,330 --> 01:01:39,340
to inspect the crash workstations log in
 

2571
01:01:39,340 --> 01:01:42,110
to inspect the crash workstations log in
pedal

2572
01:01:42,110 --> 01:01:42,120

 

2573
01:01:42,120 --> 01:01:45,670

all right so what are the possibilities

2574
01:01:45,670 --> 01:01:45,680
all right so what are the possibilities
 

2575
01:01:45,680 --> 01:01:47,690
all right so what are the possibilities
one is that the worst that you can crash

2576
01:01:47,690 --> 01:01:47,700
one is that the worst that you can crash
 

2577
01:01:47,700 --> 01:01:49,580
one is that the worst that you can crash
before it ever wrote anything back and

2578
01:01:49,580 --> 01:01:49,590
before it ever wrote anything back and
 

2579
01:01:49,590 --> 01:01:51,230
before it ever wrote anything back and
so that means this other work station

2580
01:01:51,230 --> 01:01:51,240
so that means this other work station
 

2581
01:01:51,240 --> 01:01:53,090
so that means this other work station
doing recovery will look at the crash

2582
01:01:53,090 --> 01:01:53,100
doing recovery will look at the crash
 

2583
01:01:53,100 --> 01:01:55,790
doing recovery will look at the crash
workstation this log see that maybe

2584
01:01:55,790 --> 01:01:55,800
workstation this log see that maybe
 

2585
01:01:55,800 --> 01:01:57,680
workstation this log see that maybe
there's nothing in it at all and do

2586
01:01:57,680 --> 01:01:57,690
there's nothing in it at all and do
 

2587
01:01:57,690 --> 01:02:00,590
there's nothing in it at all and do
nothing and then release the locks the

2588
01:02:00,590 --> 01:02:00,600
nothing and then release the locks the
 

2589
01:02:00,600 --> 01:02:02,690
nothing and then release the locks the
workstation held now the worst that you

2590
01:02:02,690 --> 01:02:02,700
workstation held now the worst that you
 

2591
01:02:02,700 --> 01:02:04,160
workstation held now the worst that you
may have modified all kinds of things in

2592
01:02:04,160 --> 01:02:04,170
may have modified all kinds of things in
 

2593
01:02:04,170 --> 01:02:06,380
may have modified all kinds of things in
its cache but if it didn't write

2594
01:02:06,380 --> 01:02:06,390
its cache but if it didn't write
 

2595
01:02:06,390 --> 01:02:09,740
its cache but if it didn't write
anything to his log area then it

2596
01:02:09,740 --> 01:02:09,750
anything to his log area then it
 

2597
01:02:09,750 --> 01:02:11,180
anything to his log area then it
couldn't possibly have written any of

2598
01:02:11,180 --> 01:02:11,190
couldn't possibly have written any of
 

2599
01:02:11,190 --> 01:02:12,890
couldn't possibly have written any of
the blocks that have modified during

2600
01:02:12,890 --> 01:02:12,900
the blocks that have modified during
 

2601
01:02:12,900 --> 01:02:16,250
the blocks that have modified during
these operations right and so well we

2602
01:02:16,250 --> 01:02:16,260
these operations right and so well we
 

2603
01:02:16,260 --> 01:02:19,220
these operations right and so well we
will have lost the last few operations

2604
01:02:19,220 --> 01:02:19,230
will have lost the last few operations
 

2605
01:02:19,230 --> 01:02:22,220
will have lost the last few operations
that the workstation did the file system

2606
01:02:22,220 --> 01:02:22,230
that the workstation did the file system
 

2607
01:02:22,230 --> 01:02:24,890
that the workstation did the file system
is going to be consistent with the point

2608
01:02:24,890 --> 01:02:24,900
is going to be consistent with the point
 

2609
01:02:24,900 --> 01:02:27,590
is going to be consistent with the point
in time before that crashed workstation

2610
01:02:27,590 --> 01:02:27,600
in time before that crashed workstation
 

2611
01:02:27,600 --> 01:02:30,020
in time before that crashed workstation
started to modify anything because

2612
01:02:30,020 --> 01:02:30,030
started to modify anything because
 

2613
01:02:30,030 --> 01:02:31,280
started to modify anything because
apparently the workstation never even

2614
01:02:31,280 --> 01:02:31,290
apparently the workstation never even
 

2615
01:02:31,290 --> 01:02:33,020
apparently the workstation never even
got to the point where it was writing

2616
01:02:33,020 --> 01:02:33,030
got to the point where it was writing
 

2617
01:02:33,030 --> 01:02:35,660
got to the point where it was writing
log entries the next possibilities of

2618
01:02:35,660 --> 01:02:35,670
log entries the next possibilities of
 

2619
01:02:35,670 --> 01:02:38,170
log entries the next possibilities of
the workstation wrote some log entries

2620
01:02:38,170 --> 01:02:38,180
the workstation wrote some log entries
 

2621
01:02:38,180 --> 01:02:40,760
the workstation wrote some log entries
the log area and in that case the

2622
01:02:40,760 --> 01:02:40,770
the log area and in that case the
 

2623
01:02:40,770 --> 01:02:43,160
the log area and in that case the
recovering workstation will scan forward

2624
01:02:43,160 --> 01:02:43,170
recovering workstation will scan forward
 

2625
01:02:43,170 --> 01:02:45,890
recovering workstation will scan forward
from the beginning of log until it's

2626
01:02:45,890 --> 01:02:45,900
from the beginning of log until it's
 

2627
01:02:45,900 --> 01:02:48,110
from the beginning of log until it's
stopped seeing the log sequence numbers

2628
01:02:48,110 --> 01:02:48,120
stopped seeing the log sequence numbers
 

2629
01:02:48,120 --> 01:02:50,990
stopped seeing the log sequence numbers
increasing that's the point of where's

2630
01:02:50,990 --> 01:02:51,000
increasing that's the point of where's
 

2631
01:02:51,000 --> 01:02:53,960
increasing that's the point of where's
the log must Anton and the recovering

2632
01:02:53,960 --> 01:02:53,970
the log must Anton and the recovering
 

2633
01:02:53,970 --> 01:02:56,390
the log must Anton and the recovering
workstation we'll look at each of these

2634
01:02:56,390 --> 01:02:56,400
workstation we'll look at each of these
 

2635
01:02:56,400 --> 01:02:58,820
workstation we'll look at each of these
descriptions of a change and basically

2636
01:02:58,820 --> 01:02:58,830
descriptions of a change and basically
 

2637
01:02:58,830 --> 01:03:02,150
descriptions of a change and basically
play that change back into petal I'll

2638
01:03:02,150 --> 01:03:02,160
play that change back into petal I'll
 

2639
01:03:02,160 --> 01:03:04,220
play that change back into petal I'll
say oh you know there's certain block

2640
01:03:04,220 --> 01:03:04,230
say oh you know there's certain block
 

2641
01:03:04,230 --> 01:03:06,620
say oh you know there's certain block
number and petal needs to have some

2642
01:03:06,620 --> 01:03:06,630
number and petal needs to have some
 

2643
01:03:06,630 --> 01:03:08,390
number and petal needs to have some
certain data written to it which is just

2644
01:03:08,390 --> 01:03:08,400
certain data written to it which is just
 

2645
01:03:08,400 --> 01:03:10,400
certain data written to it which is just
the same modification that the crashed

2646
01:03:10,400 --> 01:03:10,410
the same modification that the crashed
 

2647
01:03:10,410 --> 01:03:15,350
the same modification that the crashed
workstation did in its own local cache

2648
01:03:15,350 --> 01:03:15,360
workstation did in its own local cache
 

2649
01:03:15,360 --> 01:03:17,090
workstation did in its own local cache
so the recovering workstation we'll just

2650
01:03:17,090 --> 01:03:17,100
so the recovering workstation we'll just
 

2651
01:03:17,100 --> 01:03:19,790
so the recovering workstation we'll just
consider each of these and replay each

2652
01:03:19,790 --> 01:03:19,800
consider each of these and replay each
 

2653
01:03:19,800 --> 01:03:24,320
consider each of these and replay each
of the crashed workstations log entries

2654
01:03:24,320 --> 01:03:24,330
of the crashed workstations log entries
 

2655
01:03:24,330 --> 01:03:26,900
of the crashed workstations log entries
back into petal and when it's done that

2656
01:03:26,900 --> 01:03:26,910
back into petal and when it's done that
 

2657
01:03:26,910 --> 01:03:28,310
back into petal and when it's done that
all the way to the end of a crashed

2658
01:03:28,310 --> 01:03:28,320
all the way to the end of a crashed
 

2659
01:03:28,320 --> 01:03:32,420
all the way to the end of a crashed
workstations log as it exists in petal

2660
01:03:32,420 --> 01:03:32,430
workstations log as it exists in petal
 

2661
01:03:32,430 --> 01:03:36,410
workstations log as it exists in petal
it'll tell the lock server and the lock

2662
01:03:36,410 --> 01:03:36,420
it'll tell the lock server and the lock
 

2663
01:03:36,420 --> 01:03:37,790
it'll tell the lock server and the lock
server will release the crashed

2664
01:03:37,790 --> 01:03:37,800
server will release the crashed
 

2665
01:03:37,800 --> 01:03:42,170
server will release the crashed
workstations locks and that will bring

2666
01:03:42,170 --> 01:03:42,180
workstations locks and that will bring
 

2667
01:03:42,180 --> 01:03:46,550
workstations locks and that will bring
the pedal up to date with some prefix of

2668
01:03:46,550 --> 01:03:46,560
the pedal up to date with some prefix of
 

2669
01:03:46,560 --> 01:03:50,090
the pedal up to date with some prefix of
the operations the crash workstation had

2670
01:03:50,090 --> 01:03:50,100
the operations the crash workstation had
 

2671
01:03:50,100 --> 01:03:51,770
the operations the crash workstation had
done before crashing maybe not all of

2672
01:03:51,770 --> 01:03:51,780
done before crashing maybe not all of
 

2673
01:03:51,780 --> 01:03:53,060
done before crashing maybe not all of
them because maybe it didn't write out

2674
01:03:53,060 --> 01:03:53,070
them because maybe it didn't write out
 

2675
01:03:53,070 --> 01:03:55,550
them because maybe it didn't write out
all of its log but the recovery were

2676
01:03:55,550 --> 01:03:55,560
all of its log but the recovery were
 

2677
01:03:55,560 --> 01:03:56,300
all of its log but the recovery were
season

2678
01:03:56,300 --> 01:03:56,310
season
 

2679
01:03:56,310 --> 01:03:58,430
season
won't replay anything in a log entry

2680
01:03:58,430 --> 01:03:58,440
won't replay anything in a log entry
 

2681
01:03:58,440 --> 01:04:01,790
won't replay anything in a log entry
unless it has the complete log entry in

2682
01:04:01,790 --> 01:04:01,800
unless it has the complete log entry in
 

2683
01:04:01,800 --> 01:04:05,210
unless it has the complete log entry in
petal and so you know implicitly that

2684
01:04:05,210 --> 01:04:05,220
petal and so you know implicitly that
 

2685
01:04:05,220 --> 01:04:06,260
petal and so you know implicitly that
means there's gonna be some sort of

2686
01:04:06,260 --> 01:04:06,270
means there's gonna be some sort of
 

2687
01:04:06,270 --> 01:04:08,300
means there's gonna be some sort of
checksum arrangement or something so the

2688
01:04:08,300 --> 01:04:08,310
checksum arrangement or something so the
 

2689
01:04:08,310 --> 01:04:11,210
checksum arrangement or something so the
recovery work station will know aha this

2690
01:04:11,210 --> 01:04:11,220
recovery work station will know aha this
 

2691
01:04:11,220 --> 01:04:13,100
recovery work station will know aha this
log entry is complete and not like

2692
01:04:13,100 --> 01:04:13,110
log entry is complete and not like
 

2693
01:04:13,110 --> 01:04:14,960
log entry is complete and not like
partially written that's quite important

2694
01:04:14,960 --> 01:04:14,970
partially written that's quite important
 

2695
01:04:14,970 --> 01:04:17,690
partially written that's quite important
because the whole point of this is to

2696
01:04:17,690 --> 01:04:17,700
because the whole point of this is to
 

2697
01:04:17,700 --> 01:04:21,020
because the whole point of this is to
make sure that only complete operations

2698
01:04:21,020 --> 01:04:21,030
make sure that only complete operations
 

2699
01:04:21,030 --> 01:04:24,200
make sure that only complete operations
are visible and petal and never never

2700
01:04:24,200 --> 01:04:24,210
are visible and petal and never never
 

2701
01:04:24,210 --> 01:04:26,840
are visible and petal and never never
never a partial operation so it's also

2702
01:04:26,840 --> 01:04:26,850
never a partial operation so it's also
 

2703
01:04:26,850 --> 01:04:30,560
never a partial operation so it's also
important that all the rights for a

2704
01:04:30,560 --> 01:04:30,570
important that all the rights for a
 

2705
01:04:30,570 --> 01:04:32,150
important that all the rights for a
given operation or a group together in

2706
01:04:32,150 --> 01:04:32,160
given operation or a group together in
 

2707
01:04:32,160 --> 01:04:34,870
given operation or a group together in
the log so that on recovery the recovery

2708
01:04:34,870 --> 01:04:34,880
the log so that on recovery the recovery
 

2709
01:04:34,880 --> 01:04:38,900
the log so that on recovery the recovery
workstation can do all of the rights for

2710
01:04:38,900 --> 01:04:38,910
workstation can do all of the rights for
 

2711
01:04:38,910 --> 01:04:42,710
workstation can do all of the rights for
an operation or none of them never half

2712
01:04:42,710 --> 01:04:42,720
an operation or none of them never half
 

2713
01:04:42,720 --> 01:04:47,990
an operation or none of them never half
of them ok so that's what happens if the

2714
01:04:47,990 --> 01:04:48,000
of them ok so that's what happens if the
 

2715
01:04:48,000 --> 01:04:50,540
of them ok so that's what happens if the
crash happens while the log is being

2716
01:04:50,540 --> 01:04:50,550
crash happens while the log is being
 

2717
01:04:50,550 --> 01:04:55,490
crash happens while the log is being
written back to petal a another

2718
01:04:55,490 --> 01:04:55,500
written back to petal a another
 

2719
01:04:55,500 --> 01:04:57,980
written back to petal a another
interesting possibility is that the

2720
01:04:57,980 --> 01:04:57,990
interesting possibility is that the
 

2721
01:04:57,990 --> 01:04:59,810
interesting possibility is that the
crash workstation crashed after writing

2722
01:04:59,810 --> 01:04:59,820
crash workstation crashed after writing
 

2723
01:04:59,820 --> 01:05:02,150
crash workstation crashed after writing
its log and also after writing some of

2724
01:05:02,150 --> 01:05:02,160
its log and also after writing some of
 

2725
01:05:02,160 --> 01:05:04,760
its log and also after writing some of
the blocks back itself and then crashed

2726
01:05:04,760 --> 01:05:04,770
the blocks back itself and then crashed
 

2727
01:05:04,770 --> 01:05:08,210
the blocks back itself and then crashed
and then skimming over some extremely

2728
01:05:08,210 --> 01:05:08,220
and then skimming over some extremely
 

2729
01:05:08,220 --> 01:05:09,830
and then skimming over some extremely
important details which I'll get to in a

2730
01:05:09,830 --> 01:05:09,840
important details which I'll get to in a
 

2731
01:05:09,840 --> 01:05:11,270
important details which I'll get to in a
moment then what will happen is again

2732
01:05:11,270 --> 01:05:11,280
moment then what will happen is again
 

2733
01:05:11,280 --> 01:05:12,320
moment then what will happen is again
the recovery workstation of course the

2734
01:05:12,320 --> 01:05:12,330
the recovery workstation of course the
 

2735
01:05:12,330 --> 01:05:13,640
the recovery workstation of course the
recovery where station doesn't know

2736
01:05:13,640 --> 01:05:13,650
recovery where station doesn't know
 

2737
01:05:13,650 --> 01:05:14,900
recovery where station doesn't know
really the point at which the

2738
01:05:14,900 --> 01:05:14,910
really the point at which the
 

2739
01:05:14,910 --> 01:05:19,520
really the point at which the
workstation crashed all it sees is oh

2740
01:05:19,520 --> 01:05:19,530
workstation crashed all it sees is oh
 

2741
01:05:19,530 --> 01:05:21,680
workstation crashed all it sees is oh
here's some log entries and again the

2742
01:05:21,680 --> 01:05:21,690
here's some log entries and again the
 

2743
01:05:21,690 --> 01:05:23,210
here's some log entries and again the
recovery workstation will replay the log

2744
01:05:23,210 --> 01:05:23,220
recovery workstation will replay the log
 

2745
01:05:23,220 --> 01:05:29,420
recovery workstation will replay the log
in the same way and more or less what's

2746
01:05:29,420 --> 01:05:29,430
in the same way and more or less what's
 

2747
01:05:29,430 --> 01:05:30,680
in the same way and more or less what's
going on is that yeah even if the

2748
01:05:30,680 --> 01:05:30,690
going on is that yeah even if the
 

2749
01:05:30,690 --> 01:05:32,860
going on is that yeah even if the
modifications were already done in petal

2750
01:05:32,860 --> 01:05:32,870
modifications were already done in petal
 

2751
01:05:32,870 --> 01:05:35,390
modifications were already done in petal
we're replaying the same modifications

2752
01:05:35,390 --> 01:05:35,400
we're replaying the same modifications
 

2753
01:05:35,400 --> 01:05:36,680
we're replaying the same modifications
here the recovery where students were

2754
01:05:36,680 --> 01:05:36,690
here the recovery where students were
 

2755
01:05:36,690 --> 01:05:38,270
here the recovery where students were
playing the same modifications it just

2756
01:05:38,270 --> 01:05:38,280
playing the same modifications it just
 

2757
01:05:38,280 --> 01:05:40,640
playing the same modifications it just
writes the same data the same place

2758
01:05:40,640 --> 01:05:40,650
writes the same data the same place
 

2759
01:05:40,650 --> 01:05:43,850
writes the same data the same place
again and presumably not really changing

2760
01:05:43,850 --> 01:05:43,860
again and presumably not really changing
 

2761
01:05:43,860 --> 01:05:46,160
again and presumably not really changing
the value for the writes that had

2762
01:05:46,160 --> 01:05:46,170
the value for the writes that had
 

2763
01:05:46,170 --> 01:05:48,050
the value for the writes that had
already been completed but if the crash

2764
01:05:48,050 --> 01:05:48,060
already been completed but if the crash
 

2765
01:05:48,060 --> 01:05:49,400
already been completed but if the crash
workstation hadn't done some of its

2766
01:05:49,400 --> 01:05:49,410
workstation hadn't done some of its
 

2767
01:05:49,410 --> 01:05:50,930
workstation hadn't done some of its
rights then some of these rights were

2768
01:05:50,930 --> 01:05:50,940
rights then some of these rights were
 

2769
01:05:50,940 --> 01:05:53,390
rights then some of these rights were
not sure which will actually change the

2770
01:05:53,390 --> 01:05:53,400
not sure which will actually change the
 

2771
01:05:53,400 --> 01:06:00,590
not sure which will actually change the
data to complete the operations all

2772
01:06:00,590 --> 01:06:00,600
data to complete the operations all
 

2773
01:06:00,600 --> 01:06:03,730
data to complete the operations all
right

2774
01:06:03,730 --> 01:06:03,740

 

2775
01:06:03,740 --> 01:06:06,550

that's not actually as it turns out the

2776
01:06:06,550 --> 01:06:06,560
that's not actually as it turns out the
 

2777
01:06:06,560 --> 01:06:12,220
that's not actually as it turns out the
full story and today's question sets up

2778
01:06:12,220 --> 01:06:12,230
full story and today's question sets up
 

2779
01:06:12,230 --> 01:06:14,470
full story and today's question sets up
a particular scenario for which a little

2780
01:06:14,470 --> 01:06:14,480
a particular scenario for which a little
 

2781
01:06:14,480 --> 01:06:22,150
a particular scenario for which a little
bit of added complexity is necessary in

2782
01:06:22,150 --> 01:06:22,160
bit of added complexity is necessary in
 

2783
01:06:22,160 --> 01:06:24,339
bit of added complexity is necessary in
particular the possibility that the

2784
01:06:24,339 --> 01:06:24,349
particular the possibility that the
 

2785
01:06:24,349 --> 01:06:27,910
particular the possibility that the
crashed workstation had actually gotten

2786
01:06:27,910 --> 01:06:27,920
crashed workstation had actually gotten
 

2787
01:06:27,920 --> 01:06:29,559
crashed workstation had actually gotten
through this entire sequence before

2788
01:06:29,559 --> 01:06:29,569
through this entire sequence before
 

2789
01:06:29,569 --> 01:06:31,690
through this entire sequence before
crashing and in fact released some of

2790
01:06:31,690 --> 01:06:31,700
crashing and in fact released some of
 

2791
01:06:31,700 --> 01:06:37,630
crashing and in fact released some of
its locks or so that it wasn't the last

2792
01:06:37,630 --> 01:06:37,640
its locks or so that it wasn't the last
 

2793
01:06:37,640 --> 01:06:40,599
its locks or so that it wasn't the last
person the last workstation to modify a

2794
01:06:40,599 --> 01:06:40,609
person the last workstation to modify a
 

2795
01:06:40,609 --> 01:06:42,520
person the last workstation to modify a
particular piece of data so an example

2796
01:06:42,520 --> 01:06:42,530
particular piece of data so an example
 

2797
01:06:42,530 --> 01:06:44,710
particular piece of data so an example
of this is what happens if we have some

2798
01:06:44,710 --> 01:06:44,720
of this is what happens if we have some
 

2799
01:06:44,720 --> 01:06:50,470
of this is what happens if we have some
workstation and it executes say a delete

2800
01:06:50,470 --> 01:06:50,480
workstation and it executes say a delete
 

2801
01:06:50,480 --> 01:06:57,190
workstation and it executes say a delete
file it deletes a file say a file F and

2802
01:06:57,190 --> 01:06:57,200
file it deletes a file say a file F and
 

2803
01:06:57,200 --> 01:07:03,579
file it deletes a file say a file F and
directory D and then there's some other

2804
01:07:03,579 --> 01:07:03,589
directory D and then there's some other
 

2805
01:07:03,589 --> 01:07:07,390
directory D and then there's some other
workstation which after this delete

2806
01:07:07,390 --> 01:07:07,400
workstation which after this delete
 

2807
01:07:07,400 --> 01:07:09,910
workstation which after this delete
creates a new file with the same name

2808
01:07:09,910 --> 01:07:09,920
creates a new file with the same name
 

2809
01:07:09,920 --> 01:07:12,480
creates a new file with the same name
but of course it's a different file now

2810
01:07:12,480 --> 01:07:12,490
but of course it's a different file now
 

2811
01:07:12,490 --> 01:07:15,790
but of course it's a different file now
so workstation 1 I'm sorry

2812
01:07:15,790 --> 01:07:15,800
so workstation 1 I'm sorry
 

2813
01:07:15,800 --> 01:07:22,480
so workstation 1 I'm sorry
workstation two later create create same

2814
01:07:22,480 --> 01:07:22,490
workstation two later create create same
 

2815
01:07:22,490 --> 01:07:27,130
workstation two later create create same
file same file name and then after that

2816
01:07:27,130 --> 01:07:27,140
file same file name and then after that
 

2817
01:07:27,140 --> 01:07:32,740
file same file name and then after that
workstation 1 crashes so we're going to

2818
01:07:32,740 --> 01:07:32,750
workstation 1 crashes so we're going to
 

2819
01:07:32,750 --> 01:07:34,180
workstation 1 crashes so we're going to
need you to do recovery on workstation

2820
01:07:34,180 --> 01:07:34,190
need you to do recovery on workstation
 

2821
01:07:34,190 --> 01:07:38,980
need you to do recovery on workstation
ones log and so at this point in time

2822
01:07:38,980 --> 01:07:38,990
ones log and so at this point in time
 

2823
01:07:38,990 --> 01:07:39,700
ones log and so at this point in time
you know maybe there's a third

2824
01:07:39,700 --> 01:07:39,710
you know maybe there's a third
 

2825
01:07:39,710 --> 01:07:45,240
you know maybe there's a third
workstation doing the recovery

2826
01:07:45,240 --> 01:07:45,250

 

2827
01:07:45,250 --> 01:07:52,170

so now workstation 3 is doing a recover

2828
01:07:52,170 --> 01:07:52,180

 

2829
01:07:52,180 --> 01:07:56,650

on workstation ones log so the sequence

2830
01:07:56,650 --> 01:07:56,660
on workstation ones log so the sequence
 

2831
01:07:56,660 --> 01:07:58,240
on workstation ones log so the sequence
says workstation 1 deleted a file or

2832
01:07:58,240 --> 01:07:58,250
says workstation 1 deleted a file or
 

2833
01:07:58,250 --> 01:08:00,819
says workstation 1 deleted a file or
station 2 created a file or station 3

2834
01:08:00,819 --> 01:08:00,829
station 2 created a file or station 3
 

2835
01:08:00,829 --> 01:08:04,180
station 2 created a file or station 3
does recovery well you know could be

2836
01:08:04,180 --> 01:08:04,190
does recovery well you know could be
 

2837
01:08:04,190 --> 01:08:06,819
does recovery well you know could be
that this delete is still in workstation

2838
01:08:06,819 --> 01:08:06,829
that this delete is still in workstation
 

2839
01:08:06,829 --> 01:08:09,880
that this delete is still in workstation
ones log so workstation two may you know

2840
01:08:09,880 --> 01:08:09,890
ones log so workstation two may you know
 

2841
01:08:09,890 --> 01:08:11,859
ones log so workstation two may you know
or station 1 crash just going to go or

2842
01:08:11,859 --> 01:08:11,869
or station 1 crash just going to go or
 

2843
01:08:11,869 --> 01:08:13,059
or station 1 crash just going to go or
station 3 is going to look at its log

2844
01:08:13,059 --> 01:08:13,069
station 3 is going to look at its log
 

2845
01:08:13,069 --> 01:08:14,660
station 3 is going to look at its log
that's going to replay all

2846
01:08:14,660 --> 01:08:14,670
that's going to replay all
 

2847
01:08:14,670 --> 01:08:19,149
that's going to replay all
all the updates in workstation ones log

2848
01:08:19,149 --> 01:08:19,159
all the updates in workstation ones log
 

2849
01:08:19,159 --> 01:08:21,769
all the updates in workstation ones log
this delete may the updates for this

2850
01:08:21,769 --> 01:08:21,779
this delete may the updates for this
 

2851
01:08:21,779 --> 01:08:23,479
this delete may the updates for this
delete the entry for this delete may

2852
01:08:23,479 --> 01:08:23,489
delete the entry for this delete may
 

2853
01:08:23,489 --> 01:08:25,669
delete the entry for this delete may
still be in workstation ones log so

2854
01:08:25,669 --> 01:08:25,679
still be in workstation ones log so
 

2855
01:08:25,679 --> 01:08:27,370
still be in workstation ones log so
unless we do something clever

2856
01:08:27,370 --> 01:08:27,380
unless we do something clever
 

2857
01:08:27,380 --> 01:08:29,809
unless we do something clever
workstation 3 is going to delete this

2858
01:08:29,809 --> 01:08:29,819
workstation 3 is going to delete this
 

2859
01:08:29,819 --> 01:08:32,720
workstation 3 is going to delete this
file you know because this this

2860
01:08:32,720 --> 01:08:32,730
file you know because this this
 

2861
01:08:32,730 --> 01:08:34,879
file you know because this this
operation erased the relevant entry from

2862
01:08:34,879 --> 01:08:34,889
operation erased the relevant entry from
 

2863
01:08:34,889 --> 01:08:35,780
operation erased the relevant entry from
the directory

2864
01:08:35,780 --> 01:08:35,790
the directory
 

2865
01:08:35,790 --> 01:08:40,099
the directory
thus actually erasing deleting this file

2866
01:08:40,099 --> 01:08:40,109
thus actually erasing deleting this file
 

2867
01:08:40,109 --> 01:08:41,899
thus actually erasing deleting this file
that's it's a different file that

2868
01:08:41,899 --> 01:08:41,909
that's it's a different file that
 

2869
01:08:41,909 --> 01:08:44,269
that's it's a different file that
workstation 2 created afterwards so

2870
01:08:44,269 --> 01:08:44,279
workstation 2 created afterwards so
 

2871
01:08:44,279 --> 01:08:46,910
workstation 2 created afterwards so
that's completely wrong alright what we

2872
01:08:46,910 --> 01:08:46,920
that's completely wrong alright what we
 

2873
01:08:46,920 --> 01:08:48,740
that's completely wrong alright what we
want you know the how come we want is

2874
01:08:48,740 --> 01:08:48,750
want you know the how come we want is
 

2875
01:08:48,750 --> 01:08:50,450
want you know the how come we want is
you know horse station one deleted a

2876
01:08:50,450 --> 01:08:50,460
you know horse station one deleted a
 

2877
01:08:50,460 --> 01:08:52,849
you know horse station one deleted a
file that file should be deleted but a

2878
01:08:52,849 --> 01:08:52,859
file that file should be deleted but a
 

2879
01:08:52,859 --> 01:08:55,160
file that file should be deleted but a
new file that if her name should not be

2880
01:08:55,160 --> 01:08:55,170
new file that if her name should not be
 

2881
01:08:55,170 --> 01:08:56,780
new file that if her name should not be
deleted just because it was a crash in a

2882
01:08:56,780 --> 01:08:56,790
deleted just because it was a crash in a
 

2883
01:08:56,790 --> 01:08:58,849
deleted just because it was a crash in a
restart cuz this create happen after

2884
01:08:58,849 --> 01:08:58,859
restart cuz this create happen after
 

2885
01:08:58,859 --> 01:09:01,959
restart cuz this create happen after
delete all right so we cannot just

2886
01:09:01,959 --> 01:09:01,969
delete all right so we cannot just
 

2887
01:09:01,969 --> 01:09:05,450
delete all right so we cannot just
replay workstation ones log without

2888
01:09:05,450 --> 01:09:05,460
replay workstation ones log without
 

2889
01:09:05,460 --> 01:09:09,379
replay workstation ones log without
further thought because it may it may

2890
01:09:09,379 --> 01:09:09,389
further thought because it may it may
 

2891
01:09:09,389 --> 01:09:11,120
further thought because it may it may
essentially a log entry in workstations

2892
01:09:11,120 --> 01:09:11,130
essentially a log entry in workstations
 

2893
01:09:11,130 --> 01:09:13,490
essentially a log entry in workstations
one log may be out of date by the time

2894
01:09:13,490 --> 01:09:13,500
one log may be out of date by the time
 

2895
01:09:13,500 --> 01:09:16,099
one log may be out of date by the time
it's we played during recovery some

2896
01:09:16,099 --> 01:09:16,109
it's we played during recovery some
 

2897
01:09:16,109 --> 01:09:17,450
it's we played during recovery some
other workstation may have modified the

2898
01:09:17,450 --> 01:09:17,460
other workstation may have modified the
 

2899
01:09:17,460 --> 01:09:19,099
other workstation may have modified the
same data and some other way

2900
01:09:19,099 --> 01:09:19,109
same data and some other way
 

2901
01:09:19,109 --> 01:09:22,189
same data and some other way
subsequently so we can't blindly replay

2902
01:09:22,189 --> 01:09:22,199
subsequently so we can't blindly replay
 

2903
01:09:22,199 --> 01:09:26,870
subsequently so we can't blindly replay
the log entries and so this is this is

2904
01:09:26,870 --> 01:09:26,880
the log entries and so this is this is
 

2905
01:09:26,880 --> 01:09:29,930
the log entries and so this is this is
this is today's question and the way

2906
01:09:29,930 --> 01:09:29,940
this is today's question and the way
 

2907
01:09:29,940 --> 01:09:32,930
this is today's question and the way
frangipani solves this is by associating

2908
01:09:32,930 --> 01:09:32,940
frangipani solves this is by associating
 

2909
01:09:32,940 --> 01:09:36,249
frangipani solves this is by associating
version numbers with every piece of data

2910
01:09:36,249 --> 01:09:36,259
version numbers with every piece of data
 

2911
01:09:36,259 --> 01:09:39,349
version numbers with every piece of data
in the file system as stored in pedal

2912
01:09:39,349 --> 01:09:39,359
in the file system as stored in pedal
 

2913
01:09:39,359 --> 01:09:42,410
in the file system as stored in pedal
and also associating the same version

2914
01:09:42,410 --> 01:09:42,420
and also associating the same version
 

2915
01:09:42,420 --> 01:09:45,859
and also associating the same version
number with every update that's

2916
01:09:45,859 --> 01:09:45,869
number with every update that's
 

2917
01:09:45,869 --> 01:09:49,090
number with every update that's
described in the log so every log entry

2918
01:09:49,090 --> 01:09:49,100
described in the log so every log entry
 

2919
01:09:49,100 --> 01:09:53,660
described in the log so every log entry
when well first I don't have any that's

2920
01:09:53,660 --> 01:09:53,670
when well first I don't have any that's
 

2921
01:09:53,670 --> 01:09:59,419
when well first I don't have any that's
you know say in pedal I'll just say in

2922
01:09:59,419 --> 01:09:59,429
you know say in pedal I'll just say in
 

2923
01:09:59,429 --> 01:10:02,419
you know say in pedal I'll just say in
pedal every piece of metadata every

2924
01:10:02,419 --> 01:10:02,429
pedal every piece of metadata every
 

2925
01:10:02,429 --> 01:10:06,649
pedal every piece of metadata every
inode every every piece of data that's

2926
01:10:06,649 --> 01:10:06,659
inode every every piece of data that's
 

2927
01:10:06,659 --> 01:10:08,390
inode every every piece of data that's
like the contents of a directory for

2928
01:10:08,390 --> 01:10:08,400
like the contents of a directory for
 

2929
01:10:08,400 --> 01:10:12,310
like the contents of a directory for
example every block of data metadata in

2930
01:10:12,310 --> 01:10:12,320
example every block of data metadata in
 

2931
01:10:12,320 --> 01:10:14,570
example every block of data metadata in
stored and pedal has a version number

2932
01:10:14,570 --> 01:10:14,580
stored and pedal has a version number
 

2933
01:10:14,580 --> 01:10:19,280
stored and pedal has a version number
when a workstation needs to modify a

2934
01:10:19,280 --> 01:10:19,290
when a workstation needs to modify a
 

2935
01:10:19,290 --> 01:10:21,830
when a workstation needs to modify a
piece of metadata in pedal it first

2936
01:10:21,830 --> 01:10:21,840
piece of metadata in pedal it first
 

2937
01:10:21,840 --> 01:10:23,660
piece of metadata in pedal it first
reads that metadata from pedal into its

2938
01:10:23,660 --> 01:10:23,670
reads that metadata from pedal into its
 

2939
01:10:23,670 --> 01:10:27,439
reads that metadata from pedal into its
memory and then looks at the existing

2940
01:10:27,439 --> 01:10:27,449
memory and then looks at the existing
 

2941
01:10:27,449 --> 01:10:28,209
memory and then looks at the existing
version of

2942
01:10:28,209 --> 01:10:28,219
version of
 

2943
01:10:28,219 --> 01:10:30,310
version of
and then when it's creating the log file

2944
01:10:30,310 --> 01:10:30,320
and then when it's creating the log file
 

2945
01:10:30,320 --> 01:10:32,410
and then when it's creating the log file
describing its modification it puts the

2946
01:10:32,410 --> 01:10:32,420
describing its modification it puts the
 

2947
01:10:32,420 --> 01:10:36,279
describing its modification it puts the
existing version number plus one into

2948
01:10:36,279 --> 01:10:36,289
existing version number plus one into
 

2949
01:10:36,289 --> 01:10:41,589
existing version number plus one into
the log entry and then when it in if it

2950
01:10:41,589 --> 01:10:41,599
the log entry and then when it in if it
 

2951
01:10:41,599 --> 01:10:43,089
the log entry and then when it in if it
does get a chance to write the data back

2952
01:10:43,089 --> 01:10:43,099
does get a chance to write the data back
 

2953
01:10:43,099 --> 01:10:45,160
does get a chance to write the data back
it'll write the data back with the new

2954
01:10:45,160 --> 01:10:45,170
it'll write the data back with the new
 

2955
01:10:45,170 --> 01:10:48,609
it'll write the data back with the new
increased version number so if over

2956
01:10:48,609 --> 01:10:48,619
increased version number so if over
 

2957
01:10:48,619 --> 01:10:51,489
increased version number so if over
station hasn't crashed and it did or if

2958
01:10:51,489 --> 01:10:51,499
station hasn't crashed and it did or if
 

2959
01:10:51,499 --> 01:10:52,959
station hasn't crashed and it did or if
it did manage to write some data back

2960
01:10:52,959 --> 01:10:52,969
it did manage to write some data back
 

2961
01:10:52,969 --> 01:10:55,029
it did manage to write some data back
before it crashed then the version

2962
01:10:55,029 --> 01:10:55,039
before it crashed then the version
 

2963
01:10:55,039 --> 01:10:56,950
before it crashed then the version
number has stored in petal for the

2964
01:10:56,950 --> 01:10:56,960
number has stored in petal for the
 

2965
01:10:56,960 --> 01:10:59,919
number has stored in petal for the
effected metadata it will be at least as

2966
01:10:59,919 --> 01:10:59,929
effected metadata it will be at least as
 

2967
01:10:59,929 --> 01:11:02,620
effected metadata it will be at least as
high or higher than the version numbers

2968
01:11:02,620 --> 01:11:02,630
high or higher than the version numbers
 

2969
01:11:02,630 --> 01:11:04,270
high or higher than the version numbers
stored in the log entry there will be

2970
01:11:04,270 --> 01:11:04,280
stored in the log entry there will be
 

2971
01:11:04,280 --> 01:11:05,589
stored in the log entry there will be
higher some other workstations

2972
01:11:05,589 --> 01:11:05,599
higher some other workstations
 

2973
01:11:05,599 --> 01:11:09,819
higher some other workstations
subsequently modified so what will

2974
01:11:09,819 --> 01:11:09,829
subsequently modified so what will
 

2975
01:11:09,829 --> 01:11:13,689
subsequently modified so what will
actually happen here is that the what

2976
01:11:13,689 --> 01:11:13,699
actually happen here is that the what
 

2977
01:11:13,699 --> 01:11:17,290
actually happen here is that the what
workstation 3 we'll see is that the log

2978
01:11:17,290 --> 01:11:17,300
workstation 3 we'll see is that the log
 

2979
01:11:17,300 --> 01:11:20,680
workstation 3 we'll see is that the log
entry for workstations one delete

2980
01:11:20,680 --> 01:11:20,690
entry for workstations one delete
 

2981
01:11:20,690 --> 01:11:23,080
entry for workstations one delete
operation will have a particular version

2982
01:11:23,080 --> 01:11:23,090
operation will have a particular version
 

2983
01:11:23,090 --> 01:11:26,020
operation will have a particular version
number stored in the log entry that

2984
01:11:26,020 --> 01:11:26,030
number stored in the log entry that
 

2985
01:11:26,030 --> 01:11:28,839
number stored in the log entry that
associated with the modification to the

2986
01:11:28,839 --> 01:11:28,849
associated with the modification to the
 

2987
01:11:28,849 --> 01:11:31,930
associated with the modification to the
directory let's say and the log entry

2988
01:11:31,930 --> 01:11:31,940
directory let's say and the log entry
 

2989
01:11:31,940 --> 01:11:33,189
directory let's say and the log entry
will say well the version number for the

2990
01:11:33,189 --> 01:11:33,199
will say well the version number for the
 

2991
01:11:33,199 --> 01:11:35,140
will say well the version number for the
directory and the new version number

2992
01:11:35,140 --> 01:11:35,150
directory and the new version number
 

2993
01:11:35,150 --> 01:11:37,450
directory and the new version number
created by this log entry is version

2994
01:11:37,450 --> 01:11:37,460
created by this log entry is version
 

2995
01:11:37,460 --> 01:11:40,120
created by this log entry is version
number three in order for workstation

2996
01:11:40,120 --> 01:11:40,130
number three in order for workstation
 

2997
01:11:40,130 --> 01:11:42,160
number three in order for workstation
two to subsequently change the directory

2998
01:11:42,160 --> 01:11:42,170
two to subsequently change the directory
 

2999
01:11:42,170 --> 01:11:45,609
two to subsequently change the directory
that is to add a file app in fact before

3000
01:11:45,609 --> 01:11:45,619
that is to add a file app in fact before
 

3001
01:11:45,619 --> 01:11:47,529
that is to add a file app in fact before
it crashed the workstation one must have

3002
01:11:47,529 --> 01:11:47,539
it crashed the workstation one must have
 

3003
01:11:47,539 --> 01:11:49,589
it crashed the workstation one must have
given up the lock in the directory and

3004
01:11:49,589 --> 01:11:49,599
given up the lock in the directory and
 

3005
01:11:49,599 --> 01:11:52,209
given up the lock in the directory and
that's probably why the log entry even

3006
01:11:52,209 --> 01:11:52,219
that's probably why the log entry even
 

3007
01:11:52,219 --> 01:11:55,419
that's probably why the log entry even
exists in pedal so workstation 1 must

3008
01:11:55,419 --> 01:11:55,429
exists in pedal so workstation 1 must
 

3009
01:11:55,429 --> 01:11:56,620
exists in pedal so workstation 1 must
have given up the lock apparently

3010
01:11:56,620 --> 01:11:56,630
have given up the lock apparently
 

3011
01:11:56,630 --> 01:11:58,930
have given up the lock apparently
workstation two got the lock and read

3012
01:11:58,930 --> 01:11:58,940
workstation two got the lock and read
 

3013
01:11:58,940 --> 01:12:02,169
workstation two got the lock and read
the current metadata for the directory

3014
01:12:02,169 --> 01:12:02,179
the current metadata for the directory
 

3015
01:12:02,179 --> 01:12:04,479
the current metadata for the directory
saw that the version number was three

3016
01:12:04,479 --> 01:12:04,489
saw that the version number was three
 

3017
01:12:04,489 --> 01:12:08,259
saw that the version number was three
now and when workstation two writes this

3018
01:12:08,259 --> 01:12:08,269
now and when workstation two writes this
 

3019
01:12:08,269 --> 01:12:14,350
now and when workstation two writes this
data it will set the version number or

3020
01:12:14,350 --> 01:12:14,360
data it will set the version number or
 

3021
01:12:14,360 --> 01:12:19,930
data it will set the version number or
the directory in peddle to be 4 ok so

3022
01:12:19,930 --> 01:12:19,940
the directory in peddle to be 4 ok so
 

3023
01:12:19,940 --> 01:12:22,739
the directory in peddle to be 4 ok so
the that means the log entry for this

3024
01:12:22,739 --> 01:12:22,749
the that means the log entry for this
 

3025
01:12:22,749 --> 01:12:24,729
the that means the log entry for this
delete operation is going to have

3026
01:12:24,729 --> 01:12:24,739
delete operation is going to have
 

3027
01:12:24,739 --> 01:12:28,779
delete operation is going to have
version number 3 in it now when the

3028
01:12:28,779 --> 01:12:28,789
version number 3 in it now when the
 

3029
01:12:28,789 --> 01:12:31,180
version number 3 in it now when the
recovery software on worst agent 3

3030
01:12:31,180 --> 01:12:31,190
recovery software on worst agent 3
 

3031
01:12:31,190 --> 01:12:34,839
recovery software on worst agent 3
replays workstation ones log it looks at

3032
01:12:34,839 --> 01:12:34,849
replays workstation ones log it looks at
 

3033
01:12:34,849 --> 01:12:36,459
replays workstation ones log it looks at
the version numbers first so it'll look

3034
01:12:36,459 --> 01:12:36,469
the version numbers first so it'll look
 

3035
01:12:36,469 --> 01:12:37,899
the version numbers first so it'll look
at the version number the log entry

3036
01:12:37,899 --> 01:12:37,909
at the version number the log entry
 

3037
01:12:37,909 --> 01:12:40,919
at the version number the log entry
it'll read the block from

3038
01:12:40,919 --> 01:12:40,929
it'll read the block from
 

3039
01:12:40,929 --> 01:12:42,359
it'll read the block from
look at the version number in the block

3040
01:12:42,359 --> 01:12:42,369
look at the version number in the block
 

3041
01:12:42,369 --> 01:12:44,569
look at the version number in the block
and if the version number in the block

3042
01:12:44,569 --> 01:12:44,579
and if the version number in the block
 

3043
01:12:44,579 --> 01:12:47,429
and if the version number in the block
in pedal is greater than or equal to the

3044
01:12:47,429 --> 01:12:47,439
in pedal is greater than or equal to the
 

3045
01:12:47,439 --> 01:12:50,100
in pedal is greater than or equal to the
version number in the log entry the

3046
01:12:50,100 --> 01:12:50,110
version number in the log entry the
 

3047
01:12:50,110 --> 01:12:51,600
version number in the log entry the
recovery software will simply ignore

3048
01:12:51,600 --> 01:12:51,610
recovery software will simply ignore
 

3049
01:12:51,610 --> 01:12:54,330
recovery software will simply ignore
that update in the log entry and not do

3050
01:12:54,330 --> 01:12:54,340
that update in the log entry and not do
 

3051
01:12:54,340 --> 01:12:57,719
that update in the log entry and not do
it because clearly the block had already

3052
01:12:57,719 --> 01:12:57,729
it because clearly the block had already
 

3053
01:12:57,729 --> 01:12:59,129
it because clearly the block had already
been written back by the crash

3054
01:12:59,129 --> 01:12:59,139
been written back by the crash
 

3055
01:12:59,139 --> 01:13:01,439
been written back by the crash
workstation and then maybe subsequently

3056
01:13:01,439 --> 01:13:01,449
workstation and then maybe subsequently
 

3057
01:13:01,449 --> 01:13:05,399
workstation and then maybe subsequently
modified by other workstations so the

3058
01:13:05,399 --> 01:13:05,409
modified by other workstations so the
 

3059
01:13:05,409 --> 01:13:06,989
modified by other workstations so the
replay is actually selectively based on

3060
01:13:06,989 --> 01:13:06,999
replay is actually selectively based on
 

3061
01:13:06,999 --> 01:13:08,819
replay is actually selectively based on
this version number that replay it's a

3062
01:13:08,819 --> 01:13:08,829
this version number that replay it's a
 

3063
01:13:08,829 --> 01:13:14,359
this version number that replay it's a
recovery only writes only

3064
01:13:14,359 --> 01:13:14,369
recovery only writes only
 

3065
01:13:14,369 --> 01:13:17,160
recovery only writes only
replays are right in the log if that

3066
01:13:17,160 --> 01:13:17,170
replays are right in the log if that
 

3067
01:13:17,170 --> 01:13:20,489
replays are right in the log if that
right is actually newer right in the log

3068
01:13:20,489 --> 01:13:20,499
right is actually newer right in the log
 

3069
01:13:20,499 --> 01:13:22,589
right is actually newer right in the log
entry is newer than the data that's

3070
01:13:22,589 --> 01:13:22,599
entry is newer than the data that's
 

3071
01:13:22,599 --> 01:13:31,529
entry is newer than the data that's
already stored in peddle so one sort of

3072
01:13:31,529 --> 01:13:31,539
already stored in peddle so one sort of
 

3073
01:13:31,539 --> 01:13:34,640
already stored in peddle so one sort of
irritating question here maybe is that

3074
01:13:34,640 --> 01:13:34,650
irritating question here maybe is that
 

3075
01:13:34,650 --> 01:13:37,140
irritating question here maybe is that
workstation three is running this

3076
01:13:37,140 --> 01:13:37,150
workstation three is running this
 

3077
01:13:37,150 --> 01:13:39,270
workstation three is running this
recovery software while other

3078
01:13:39,270 --> 01:13:39,280
recovery software while other
 

3079
01:13:39,280 --> 01:13:41,040
recovery software while other
workstations are still reading and

3080
01:13:41,040 --> 01:13:41,050
workstations are still reading and
 

3081
01:13:41,050 --> 01:13:42,719
workstations are still reading and
writing in the file system actively and

3082
01:13:42,719 --> 01:13:42,729
writing in the file system actively and
 

3083
01:13:42,729 --> 01:13:46,219
writing in the file system actively and
have locks and knows what to peddle so

3084
01:13:46,219 --> 01:13:46,229
have locks and knows what to peddle so
 

3085
01:13:46,229 --> 01:13:50,790
have locks and knows what to peddle so
the replay it's gonna go on while we're

3086
01:13:50,790 --> 01:13:50,800
the replay it's gonna go on while we're
 

3087
01:13:50,800 --> 01:13:52,020
the replay it's gonna go on while we're
station to which that doesn't know

3088
01:13:52,020 --> 01:13:52,030
station to which that doesn't know
 

3089
01:13:52,030 --> 01:13:54,660
station to which that doesn't know
anything about the recovery still active

3090
01:13:54,660 --> 01:13:54,670
anything about the recovery still active
 

3091
01:13:54,670 --> 01:13:57,419
anything about the recovery still active
and indeed workstation two may have the

3092
01:13:57,419 --> 01:13:57,429
and indeed workstation two may have the
 

3093
01:13:57,429 --> 01:14:00,839
and indeed workstation two may have the
lock for this directory

3094
01:14:00,839 --> 01:14:00,849
lock for this directory
 

3095
01:14:00,849 --> 01:14:03,750
lock for this directory
while recoveries going on so recovery

3096
01:14:03,750 --> 01:14:03,760
while recoveries going on so recovery
 

3097
01:14:03,760 --> 01:14:05,759
while recoveries going on so recovery
may be scanning the log and you no need

3098
01:14:05,759 --> 01:14:05,769
may be scanning the log and you no need
 

3099
01:14:05,769 --> 01:14:08,399
may be scanning the log and you no need
to read or write this directories data

3100
01:14:08,399 --> 01:14:08,409
to read or write this directories data
 

3101
01:14:08,409 --> 01:14:11,640
to read or write this directories data
in pedal while workstation two still has

3102
01:14:11,640 --> 01:14:11,650
in pedal while workstation two still has
 

3103
01:14:11,650 --> 01:14:14,489
in pedal while workstation two still has
the lock on this data the question is

3104
01:14:14,489 --> 01:14:14,499
the lock on this data the question is
 

3105
01:14:14,499 --> 01:14:16,169
the lock on this data the question is
how you know how do we sort this out

3106
01:14:16,169 --> 01:14:16,179
how you know how do we sort this out
 

3107
01:14:16,179 --> 01:14:19,500
how you know how do we sort this out
like one possibility which actually

3108
01:14:19,500 --> 01:14:19,510
like one possibility which actually
 

3109
01:14:19,510 --> 01:14:22,140
like one possibility which actually
turns out not to work is for the

3110
01:14:22,140 --> 01:14:22,150
turns out not to work is for the
 

3111
01:14:22,150 --> 01:14:24,750
turns out not to work is for the
recovery software to first acquire the

3112
01:14:24,750 --> 01:14:24,760
recovery software to first acquire the
 

3113
01:14:24,760 --> 01:14:28,739
recovery software to first acquire the
lock on anything that it needs to look

3114
01:14:28,739 --> 01:14:28,749
lock on anything that it needs to look
 

3115
01:14:28,749 --> 01:14:30,959
lock on anything that it needs to look
at in petal before while it's replaying

3116
01:14:30,959 --> 01:14:30,969
at in petal before while it's replaying
 

3117
01:14:30,969 --> 01:14:36,179
at in petal before while it's replaying
the log and the the you know one good

3118
01:14:36,179 --> 01:14:36,189
the log and the the you know one good
 

3119
01:14:36,189 --> 01:14:38,219
the log and the the you know one good
reason why that doesn't work is that it

3120
01:14:38,219 --> 01:14:38,229
reason why that doesn't work is that it
 

3121
01:14:38,229 --> 01:14:39,629
reason why that doesn't work is that it
could be that we're running recovery

3122
01:14:39,629 --> 01:14:39,639
could be that we're running recovery
 

3123
01:14:39,639 --> 01:14:41,790
could be that we're running recovery
after a system-wide power failure for

3124
01:14:41,790 --> 01:14:41,800
after a system-wide power failure for
 

3125
01:14:41,800 --> 01:14:43,560
after a system-wide power failure for
example in which all knowledge of who

3126
01:14:43,560 --> 01:14:43,570
example in which all knowledge of who
 

3127
01:14:43,570 --> 01:14:46,679
example in which all knowledge of who
had what locks is lost and therefore we

3128
01:14:46,679 --> 01:14:46,689
had what locks is lost and therefore we
 

3129
01:14:46,689 --> 01:14:49,459
had what locks is lost and therefore we
cannot write the recovery software to

3130
01:14:49,459 --> 01:14:49,469
cannot write the recovery software to
 

3131
01:14:49,469 --> 01:14:52,830
cannot write the recovery software to
sort of participate in the locking

3132
01:14:52,830 --> 01:14:52,840
sort of participate in the locking
 

3133
01:14:52,840 --> 01:14:54,189
sort of participate in the locking
protocol because

3134
01:14:54,189 --> 01:14:54,199
protocol because
 

3135
01:14:54,199 --> 01:14:56,020
protocol because
you know all knowledge of what's locked

3136
01:14:56,020 --> 01:14:56,030
you know all knowledge of what's locked
 

3137
01:14:56,030 --> 01:14:57,759
you know all knowledge of what's locked
my slot not locked may have been lost in

3138
01:14:57,759 --> 01:14:57,769
my slot not locked may have been lost in
 

3139
01:14:57,769 --> 01:14:58,449
my slot not locked may have been lost in
the power failure

3140
01:14:58,449 --> 01:14:58,459
the power failure
 

3141
01:14:58,459 --> 01:15:01,930
the power failure
um but luckily it turns out that the

3142
01:15:01,930 --> 01:15:01,940
um but luckily it turns out that the
 

3143
01:15:01,940 --> 01:15:03,609
um but luckily it turns out that the
recovery software can just go ahead and

3144
01:15:03,609 --> 01:15:03,619
recovery software can just go ahead and
 

3145
01:15:03,619 --> 01:15:07,270
recovery software can just go ahead and
read or write blocks in pedal without

3146
01:15:07,270 --> 01:15:07,280
read or write blocks in pedal without
 

3147
01:15:07,280 --> 01:15:09,549
read or write blocks in pedal without
worrying about sorry read or write data

3148
01:15:09,549 --> 01:15:09,559
worrying about sorry read or write data
 

3149
01:15:09,559 --> 01:15:11,350
worrying about sorry read or write data
in pedal without worrying at all about

3150
01:15:11,350 --> 01:15:11,360
in pedal without worrying at all about
 

3151
01:15:11,360 --> 01:15:15,250
in pedal without worrying at all about
locks and the reason is that if the

3152
01:15:15,250 --> 01:15:15,260
locks and the reason is that if the
 

3153
01:15:15,260 --> 01:15:16,629
locks and the reason is that if the
recovery software you know the recovery

3154
01:15:16,629 --> 01:15:16,639
recovery software you know the recovery
 

3155
01:15:16,639 --> 01:15:18,100
recovery software you know the recovery
software wants to replay this log entry

3156
01:15:18,100 --> 01:15:18,110
software wants to replay this log entry
 

3157
01:15:18,110 --> 01:15:20,500
software wants to replay this log entry
and possibly modify the data associated

3158
01:15:20,500 --> 01:15:20,510
and possibly modify the data associated
 

3159
01:15:20,510 --> 01:15:22,029
and possibly modify the data associated
with this directory it just goes ahead

3160
01:15:22,029 --> 01:15:22,039
with this directory it just goes ahead
 

3161
01:15:22,039 --> 01:15:23,529
with this directory it just goes ahead
and reads whatever's there for the

3162
01:15:23,529 --> 01:15:23,539
and reads whatever's there for the
 

3163
01:15:23,539 --> 01:15:26,620
and reads whatever's there for the
directory out of pedal right now and

3164
01:15:26,620 --> 01:15:26,630
directory out of pedal right now and
 

3165
01:15:26,630 --> 01:15:28,959
directory out of pedal right now and
there's really only two cases either the

3166
01:15:28,959 --> 01:15:28,969
there's really only two cases either the
 

3167
01:15:28,969 --> 01:15:30,640
there's really only two cases either the
crash workstation one had given up its

3168
01:15:30,640 --> 01:15:30,650
crash workstation one had given up its
 

3169
01:15:30,650 --> 01:15:33,850
crash workstation one had given up its
lock or it hadn't if it hadn't given up

3170
01:15:33,850 --> 01:15:33,860
lock or it hadn't if it hadn't given up
 

3171
01:15:33,860 --> 01:15:35,140
lock or it hadn't if it hadn't given up
this lock then nobody else can have a

3172
01:15:35,140 --> 01:15:35,150
this lock then nobody else can have a
 

3173
01:15:35,150 --> 01:15:36,580
this lock then nobody else can have a
directory locked and so there's no

3174
01:15:36,580 --> 01:15:36,590
directory locked and so there's no
 

3175
01:15:36,590 --> 01:15:39,899
directory locked and so there's no
problem if it had given up its lock then

3176
01:15:39,899 --> 01:15:39,909
problem if it had given up its lock then
 

3177
01:15:39,909 --> 01:15:42,549
problem if it had given up its lock then
before I gave it up its lock it must

3178
01:15:42,549 --> 01:15:42,559
before I gave it up its lock it must
 

3179
01:15:42,559 --> 01:15:46,689
before I gave it up its lock it must
have written that it's data for the

3180
01:15:46,689 --> 01:15:46,699
have written that it's data for the
 

3181
01:15:46,699 --> 01:15:50,020
have written that it's data for the
directory back to pedal and that means

3182
01:15:50,020 --> 01:15:50,030
directory back to pedal and that means
 

3183
01:15:50,030 --> 01:15:52,209
directory back to pedal and that means
that the version number stored in pedal

3184
01:15:52,209 --> 01:15:52,219
that the version number stored in pedal
 

3185
01:15:52,219 --> 01:15:53,919
that the version number stored in pedal
must be at least as high as the version

3186
01:15:53,919 --> 01:15:53,929
must be at least as high as the version
 

3187
01:15:53,929 --> 01:15:56,140
must be at least as high as the version
number in the crashed workstations log

3188
01:15:56,140 --> 01:15:56,150
number in the crashed workstations log
 

3189
01:15:56,150 --> 01:15:58,449
number in the crashed workstations log
entry and therefore when recovery

3190
01:15:58,449 --> 01:15:58,459
entry and therefore when recovery
 

3191
01:15:58,459 --> 01:16:00,759
entry and therefore when recovery
software compares the log entry version

3192
01:16:00,759 --> 01:16:00,769
software compares the log entry version
 

3193
01:16:00,769 --> 01:16:02,589
software compares the log entry version
number with the version number of the

3194
01:16:02,589 --> 01:16:02,599
number with the version number of the
 

3195
01:16:02,599 --> 01:16:04,810
number with the version number of the
data and pedal it'll see that the log

3196
01:16:04,810 --> 01:16:04,820
data and pedal it'll see that the log
 

3197
01:16:04,820 --> 01:16:07,500
data and pedal it'll see that the log
entry version number is not higher and

3198
01:16:07,500 --> 01:16:07,510
entry version number is not higher and
 

3199
01:16:07,510 --> 01:16:11,469
entry version number is not higher and
therefore won't we play the log entry so

3200
01:16:11,469 --> 01:16:11,479
therefore won't we play the log entry so
 

3201
01:16:11,479 --> 01:16:13,390
therefore won't we play the log entry so
yeah the recovery software will have

3202
01:16:13,390 --> 01:16:13,400
yeah the recovery software will have
 

3203
01:16:13,400 --> 01:16:15,129
yeah the recovery software will have
read the block without holding the lock

3204
01:16:15,129 --> 01:16:15,139
read the block without holding the lock
 

3205
01:16:15,139 --> 01:16:18,069
read the block without holding the lock
but it's not going to modify it because

3206
01:16:18,069 --> 01:16:18,079
but it's not going to modify it because
 

3207
01:16:18,079 --> 01:16:19,479
but it's not going to modify it because
if the locked was released the version

3208
01:16:19,479 --> 01:16:19,489
if the locked was released the version
 

3209
01:16:19,489 --> 01:16:21,640
if the locked was released the version
number will be high enough to show that

3210
01:16:21,640 --> 01:16:21,650
number will be high enough to show that
 

3211
01:16:21,650 --> 01:16:26,500
number will be high enough to show that
the log entry had already been sort of

3212
01:16:26,500 --> 01:16:26,510
the log entry had already been sort of
 

3213
01:16:26,510 --> 01:16:28,509
the log entry had already been sort of
processing to pedal before the crashed

3214
01:16:28,509 --> 01:16:28,519
processing to pedal before the crashed
 

3215
01:16:28,519 --> 01:16:31,449
processing to pedal before the crashed
workstation crashed no so there's no

3216
01:16:31,449 --> 01:16:31,459
workstation crashed no so there's no
 

3217
01:16:31,459 --> 01:16:41,799
workstation crashed no so there's no
locking issue alright this is the I've

3218
01:16:41,799 --> 01:16:41,809
locking issue alright this is the I've
 

3219
01:16:41,809 --> 01:16:43,839
locking issue alright this is the I've
gone over that kind of main guts of what

3220
01:16:43,839 --> 01:16:43,849
gone over that kind of main guts of what
 

3221
01:16:43,849 --> 01:16:46,390
gone over that kind of main guts of what
pedal is up to Nam it's cache coherence

3222
01:16:46,390 --> 01:16:46,400
pedal is up to Nam it's cache coherence
 

3223
01:16:46,400 --> 01:16:49,060
pedal is up to Nam it's cache coherence
it's distributed transactions and it's

3224
01:16:49,060 --> 01:16:49,070
it's distributed transactions and it's
 

3225
01:16:49,070 --> 01:16:53,830
it's distributed transactions and it's
distributed crash recovery the other

3226
01:16:53,830 --> 01:16:53,840
distributed crash recovery the other
 

3227
01:16:53,840 --> 01:16:55,540
distributed crash recovery the other
things to think about are the the paper

3228
01:16:55,540 --> 01:16:55,550
things to think about are the the paper
 

3229
01:16:55,550 --> 01:16:57,129
things to think about are the the paper
talks a bit about performance it's

3230
01:16:57,129 --> 01:16:57,139
talks a bit about performance it's
 

3231
01:16:57,139 --> 01:17:00,939
talks a bit about performance it's
actually very hard after over 20 years

3232
01:17:00,939 --> 01:17:00,949
actually very hard after over 20 years
 

3233
01:17:00,949 --> 01:17:02,890
actually very hard after over 20 years
to interpret performance numbers because

3234
01:17:02,890 --> 01:17:02,900
to interpret performance numbers because
 

3235
01:17:02,900 --> 01:17:04,899
to interpret performance numbers because
they brand their performance numbers on

3236
01:17:04,899 --> 01:17:04,909
they brand their performance numbers on
 

3237
01:17:04,909 --> 01:17:06,879
they brand their performance numbers on
very different Hardware in a very

3238
01:17:06,879 --> 01:17:06,889
very different Hardware in a very
 

3239
01:17:06,889 --> 01:17:08,140
very different Hardware in a very
different environment from

3240
01:17:08,140 --> 01:17:08,150
different environment from
 

3241
01:17:08,150 --> 01:17:11,169
different environment from
you see today roughly speaking the

3242
01:17:11,169 --> 01:17:11,179
you see today roughly speaking the
 

3243
01:17:11,179 --> 01:17:12,939
you see today roughly speaking the
performance numbers they show or that as

3244
01:17:12,939 --> 01:17:12,949
performance numbers they show or that as
 

3245
01:17:12,949 --> 01:17:15,130
performance numbers they show or that as
you add more and more friendship and

3246
01:17:15,130 --> 01:17:15,140
you add more and more friendship and
 

3247
01:17:15,140 --> 01:17:19,300
you add more and more friendship and
work stations the system basically

3248
01:17:19,300 --> 01:17:19,310
work stations the system basically
 

3249
01:17:19,310 --> 01:17:22,209
work stations the system basically
doesn't get slower that is each new

3250
01:17:22,209 --> 01:17:22,219
doesn't get slower that is each new
 

3251
01:17:22,219 --> 01:17:24,490
doesn't get slower that is each new
workstation even if it's actively doing

3252
01:17:24,490 --> 01:17:24,500
workstation even if it's actively doing
 

3253
01:17:24,500 --> 01:17:26,439
workstation even if it's actively doing
file system operations doesn't slow down

3254
01:17:26,439 --> 01:17:26,449
file system operations doesn't slow down
 

3255
01:17:26,449 --> 01:17:28,419
file system operations doesn't slow down
the existing workstation so in that

3256
01:17:28,419 --> 01:17:28,429
the existing workstation so in that
 

3257
01:17:28,429 --> 01:17:30,310
the existing workstation so in that
sense the system you know at least for

3258
01:17:30,310 --> 01:17:30,320
sense the system you know at least for
 

3259
01:17:30,320 --> 01:17:32,590
sense the system you know at least for
the application state look at the system

3260
01:17:32,590 --> 01:17:32,600
the application state look at the system
 

3261
01:17:32,600 --> 01:17:34,720
the application state look at the system
was giving them reasonable scalability

3262
01:17:34,720 --> 01:17:34,730
was giving them reasonable scalability
 

3263
01:17:34,730 --> 01:17:36,850
was giving them reasonable scalability
they could add more workstations without

3264
01:17:36,850 --> 01:17:36,860
they could add more workstations without
 

3265
01:17:36,860 --> 01:17:42,669
they could add more workstations without
slowing existing users down looking

3266
01:17:42,669 --> 01:17:42,679
slowing existing users down looking
 

3267
01:17:42,679 --> 01:17:44,880
slowing existing users down looking
backwards

3268
01:17:44,880 --> 01:17:44,890
backwards
 

3269
01:17:44,890 --> 01:17:47,590
backwards
although frangipani is full of like very

3270
01:17:47,590 --> 01:17:47,600
although frangipani is full of like very
 

3271
01:17:47,600 --> 01:17:49,120
although frangipani is full of like very
interesting techniques that are worth

3272
01:17:49,120 --> 01:17:49,130
interesting techniques that are worth
 

3273
01:17:49,130 --> 01:17:51,640
interesting techniques that are worth
remembering it didn't have too much

3274
01:17:51,640 --> 01:17:51,650
remembering it didn't have too much
 

3275
01:17:51,650 --> 01:17:55,899
remembering it didn't have too much
influence in on how on the evolution of

3276
01:17:55,899 --> 01:17:55,909
influence in on how on the evolution of
 

3277
01:17:55,909 --> 01:17:58,540
influence in on how on the evolution of
storage systems part of the reason is

3278
01:17:58,540 --> 01:17:58,550
storage systems part of the reason is
 

3279
01:17:58,550 --> 01:18:00,550
storage systems part of the reason is
that the environment for which is aimed

3280
01:18:00,550 --> 01:18:00,560
that the environment for which is aimed
 

3281
01:18:00,560 --> 01:18:01,990
that the environment for which is aimed
that is small workgroups

3282
01:18:01,990 --> 01:18:02,000
that is small workgroups
 

3283
01:18:02,000 --> 01:18:04,030
that is small workgroups
people sitting in front of workstations

3284
01:18:04,030 --> 01:18:04,040
people sitting in front of workstations
 

3285
01:18:04,040 --> 01:18:06,850
people sitting in front of workstations
on their desks and sharing files that

3286
01:18:06,850 --> 01:18:06,860
on their desks and sharing files that
 

3287
01:18:06,860 --> 01:18:09,610
on their desks and sharing files that
environment well it still exists in some

3288
01:18:09,610 --> 01:18:09,620
environment well it still exists in some
 

3289
01:18:09,620 --> 01:18:12,130
environment well it still exists in some
places isn't really where the action is

3290
01:18:12,130 --> 01:18:12,140
places isn't really where the action is
 

3291
01:18:12,140 --> 01:18:13,720
places isn't really where the action is
in distributed storage the action the

3292
01:18:13,720 --> 01:18:13,730
in distributed storage the action the
 

3293
01:18:13,730 --> 01:18:15,220
in distributed storage the action the
real action is moved into sort of big

3294
01:18:15,220 --> 01:18:15,230
real action is moved into sort of big
 

3295
01:18:15,230 --> 01:18:19,390
real action is moved into sort of big
data center or big websites big data

3296
01:18:19,390 --> 01:18:19,400
data center or big websites big data
 

3297
01:18:19,400 --> 01:18:22,240
data center or big websites big data
computations and there you know in that

3298
01:18:22,240 --> 01:18:22,250
computations and there you know in that
 

3299
01:18:22,250 --> 01:18:24,370
computations and there you know in that
world first of all the file system

3300
01:18:24,370 --> 01:18:24,380
world first of all the file system
 

3301
01:18:24,380 --> 01:18:25,899
world first of all the file system
interface just isn't very useful

3302
01:18:25,899 --> 01:18:25,909
interface just isn't very useful
 

3303
01:18:25,909 --> 01:18:28,840
interface just isn't very useful
compared to databases like people really

3304
01:18:28,840 --> 01:18:28,850
compared to databases like people really
 

3305
01:18:28,850 --> 01:18:31,180
compared to databases like people really
like transactions in the big website

3306
01:18:31,180 --> 01:18:31,190
like transactions in the big website
 

3307
01:18:31,190 --> 01:18:33,610
like transactions in the big website
world but they need them for very small

3308
01:18:33,610 --> 01:18:33,620
world but they need them for very small
 

3309
01:18:33,620 --> 01:18:35,350
world but they need them for very small
items of data the kind of data that you

3310
01:18:35,350 --> 01:18:35,360
items of data the kind of data that you
 

3311
01:18:35,360 --> 01:18:39,070
items of data the kind of data that you
would store in a database rather than

3312
01:18:39,070 --> 01:18:39,080
would store in a database rather than
 

3313
01:18:39,080 --> 01:18:40,330
would store in a database rather than
the kind of data that would you would

3314
01:18:40,330 --> 01:18:40,340
the kind of data that would you would
 

3315
01:18:40,340 --> 01:18:44,919
the kind of data that would you would
naturally store in a file system so you

3316
01:18:44,919 --> 01:18:44,929
naturally store in a file system so you
 

3317
01:18:44,929 --> 01:18:47,260
naturally store in a file system so you
know some of this technology might sort

3318
01:18:47,260 --> 01:18:47,270
know some of this technology might sort
 

3319
01:18:47,270 --> 01:18:49,360
know some of this technology might sort
of you can see echoes of it in modern

3320
01:18:49,360 --> 01:18:49,370
of you can see echoes of it in modern
 

3321
01:18:49,370 --> 01:18:50,919
of you can see echoes of it in modern
systems but it usually takes the form of

3322
01:18:50,919 --> 01:18:50,929
systems but it usually takes the form of
 

3323
01:18:50,929 --> 01:18:53,020
systems but it usually takes the form of
some database the other big kind of

3324
01:18:53,020 --> 01:18:53,030
some database the other big kind of
 

3325
01:18:53,030 --> 01:18:56,020
some database the other big kind of
storage this out there is storing big

3326
01:18:56,020 --> 01:18:56,030
storage this out there is storing big
 

3327
01:18:56,030 --> 01:18:59,020
storage this out there is storing big
files as needed for big data

3328
01:18:59,020 --> 01:18:59,030
files as needed for big data
 

3329
01:18:59,030 --> 01:19:01,720
files as needed for big data
computations like MapReduce and indeed

3330
01:19:01,720 --> 01:19:01,730
computations like MapReduce and indeed
 

3331
01:19:01,730 --> 01:19:04,959
computations like MapReduce and indeed
GFS is a you know to some extent looks

3332
01:19:04,959 --> 01:19:04,969
GFS is a you know to some extent looks
 

3333
01:19:04,969 --> 01:19:06,640
GFS is a you know to some extent looks
like a file system and is the kind of

3334
01:19:06,640 --> 01:19:06,650
like a file system and is the kind of
 

3335
01:19:06,650 --> 01:19:08,790
like a file system and is the kind of
storage system you want for MapReduce

3336
01:19:08,790 --> 01:19:08,800
storage system you want for MapReduce
 

3337
01:19:08,800 --> 01:19:12,520
storage system you want for MapReduce
but for GFS and for big data

3338
01:19:12,520 --> 01:19:12,530
but for GFS and for big data
 

3339
01:19:12,530 --> 01:19:15,700
but for GFS and for big data
computations frangipane ease you know

3340
01:19:15,700 --> 01:19:15,710
computations frangipane ease you know
 

3341
01:19:15,710 --> 01:19:19,030
computations frangipane ease you know
focus on local caching and workstations

3342
01:19:19,030 --> 01:19:19,040
focus on local caching and workstations
 

3343
01:19:19,040 --> 01:19:22,000
focus on local caching and workstations
and very close attention to

3344
01:19:22,000 --> 01:19:22,010
and very close attention to
 

3345
01:19:22,010 --> 01:19:24,400
and very close attention to
cache coherence and locking it's just

3346
01:19:24,400 --> 01:19:24,410
cache coherence and locking it's just
 

3347
01:19:24,410 --> 01:19:27,160
cache coherence and locking it's just
not very useful you know for both the

3348
01:19:27,160 --> 01:19:27,170
not very useful you know for both the
 

3349
01:19:27,170 --> 01:19:29,880
not very useful you know for both the
data read and write

3350
01:19:29,880 --> 01:19:29,890
data read and write
 

3351
01:19:29,890 --> 01:19:33,520
data read and write
typically caching is not useful at all

3352
01:19:33,520 --> 01:19:33,530
typically caching is not useful at all
 

3353
01:19:33,530 --> 01:19:35,980
typically caching is not useful at all
right if you're reading through ten

3354
01:19:35,980 --> 01:19:35,990
right if you're reading through ten
 

3355
01:19:35,990 --> 01:19:38,440
right if you're reading through ten
terabytes of data it's really

3356
01:19:38,440 --> 01:19:38,450
terabytes of data it's really
 

3357
01:19:38,450 --> 01:19:41,080
terabytes of data it's really
counterproductive almost to cache it so

3358
01:19:41,080 --> 01:19:41,090
counterproductive almost to cache it so
 

3359
01:19:41,090 --> 01:19:45,460
counterproductive almost to cache it so
a lot of the focus in frangipani is sort

3360
01:19:45,460 --> 01:19:45,470
a lot of the focus in frangipani is sort
 

3361
01:19:45,470 --> 01:19:47,050
a lot of the focus in frangipani is sort
of time is pass it by a little bit it's

3362
01:19:47,050 --> 01:19:47,060
of time is pass it by a little bit it's
 

3363
01:19:47,060 --> 01:19:50,220
of time is pass it by a little bit it's
still useful in some situations but it's

3364
01:19:50,220 --> 01:19:50,230
still useful in some situations but it's
 

3365
01:19:50,230 --> 01:19:52,360
still useful in some situations but it's
not what people are really thinking

3366
01:19:52,360 --> 01:19:52,370
not what people are really thinking
 

3367
01:19:52,370 --> 01:19:56,380
not what people are really thinking
about in designing new systems for all

3368
01:19:56,380 --> 01:19:56,390
about in designing new systems for all
 

3369
01:19:56,390 --> 01:19:59,500
about in designing new systems for all
right that is it

