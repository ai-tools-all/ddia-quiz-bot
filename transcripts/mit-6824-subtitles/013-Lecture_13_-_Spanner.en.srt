1
00:00:01,120 --> 00:00:04,309

Um

2
00:00:04,309 --> 00:00:04,319

 

3
00:00:04,319 --> 00:00:08,470

maybe maybe we should get started.

4
00:00:08,470 --> 00:00:08,480
maybe maybe we should get started.
 

5
00:00:08,480 --> 00:00:10,150
maybe maybe we should get started.
Um it's been a long time since we've all

6
00:00:10,150 --> 00:00:10,160
Um it's been a long time since we've all
 

7
00:00:10,160 --> 00:00:11,589
Um it's been a long time since we've all
been in the same place and I hope

8
00:00:11,589 --> 00:00:11,599
been in the same place and I hope
 

9
00:00:11,599 --> 00:00:13,990
been in the same place and I hope
everybody's doing well.

10
00:00:13,990 --> 00:00:14,000
everybody's doing well.
 

11
00:00:14,000 --> 00:00:15,509
everybody's doing well.
Um

12
00:00:15,509 --> 00:00:15,519
Um
 

13
00:00:15,519 --> 00:00:18,950
Um
today I'd like to talk about Spanner.

14
00:00:18,950 --> 00:00:18,960
today I'd like to talk about Spanner.
 

15
00:00:18,960 --> 00:00:20,630
today I'd like to talk about Spanner.
The reason to talk about this paper is

16
00:00:20,630 --> 00:00:20,640
The reason to talk about this paper is
 

17
00:00:20,640 --> 00:00:23,269
The reason to talk about this paper is
that it's a rare example of a um system

18
00:00:23,269 --> 00:00:23,279
that it's a rare example of a um system
 

19
00:00:23,279 --> 00:00:26,070
that it's a rare example of a um system
that provides distributed transactions

20
00:00:26,070 --> 00:00:26,080
that provides distributed transactions
 

21
00:00:26,080 --> 00:00:28,230
that provides distributed transactions
over data that's widely separated. That

22
00:00:28,230 --> 00:00:28,240
over data that's widely separated. That
 

23
00:00:28,240 --> 00:00:30,070
over data that's widely separated. That
is data that might be scattered all over

24
00:00:30,070 --> 00:00:30,080
is data that might be scattered all over
 

25
00:00:30,080 --> 00:00:32,310
is data that might be scattered all over
the internet in different data centers.

26
00:00:32,310 --> 00:00:32,320
the internet in different data centers.
 

27
00:00:32,320 --> 00:00:35,270
the internet in different data centers.
It's almost never done in um production

28
00:00:35,270 --> 00:00:35,280
It's almost never done in um production
 

29
00:00:35,280 --> 00:00:36,950
It's almost never done in um production
systems. Of course, it's extremely

30
00:00:36,950 --> 00:00:36,960
systems. Of course, it's extremely
 

31
00:00:36,960 --> 00:00:38,549
systems. Of course, it's extremely
desirable to be able to have

32
00:00:38,549 --> 00:00:38,559
desirable to be able to have
 

33
00:00:38,559 --> 00:00:40,310
desirable to be able to have
transactions. The programmers really

34
00:00:40,310 --> 00:00:40,320
transactions. The programmers really
 

35
00:00:40,320 --> 00:00:43,350
transactions. The programmers really
like it. Um and also extremely desirable

36
00:00:43,350 --> 00:00:43,360
like it. Um and also extremely desirable
 

37
00:00:43,360 --> 00:00:46,229
like it. Um and also extremely desirable
to have data spread all over the um

38
00:00:46,229 --> 00:00:46,239
to have data spread all over the um
 

39
00:00:46,239 --> 00:00:49,270
to have data spread all over the um
network for both for fault tolerance and

40
00:00:49,270 --> 00:00:49,280
network for both for fault tolerance and
 

41
00:00:49,280 --> 00:00:52,229
network for both for fault tolerance and
to ensure that data is near um that

42
00:00:52,229 --> 00:00:52,239
to ensure that data is near um that
 

43
00:00:52,239 --> 00:00:54,310
to ensure that data is near um that
there's a copy of the data near

44
00:00:54,310 --> 00:00:54,320
there's a copy of the data near
 

45
00:00:54,320 --> 00:01:01,029
there's a copy of the data near
everybody who wants to use it. Um

46
00:01:01,029 --> 00:01:01,039

 

47
00:01:01,039 --> 00:01:03,430

and um on the way to achieving this,

48
00:01:03,430 --> 00:01:03,440
and um on the way to achieving this,
 

49
00:01:03,440 --> 00:01:07,350
and um on the way to achieving this,
Spanner um used at least two neat ideas.

50
00:01:07,350 --> 00:01:07,360
Spanner um used at least two neat ideas.
 

51
00:01:07,360 --> 00:01:09,190
Spanner um used at least two neat ideas.
One is that they run two-phase commit,

52
00:01:09,190 --> 00:01:09,200
One is that they run two-phase commit,
 

53
00:01:09,200 --> 00:01:11,429
One is that they run two-phase commit,
but they actually run it over Paxos

54
00:01:11,429 --> 00:01:11,439
but they actually run it over Paxos
 

55
00:01:11,439 --> 00:01:14,070
but they actually run it over Paxos
replicated participants

56
00:01:14,070 --> 00:01:14,080
replicated participants
 

57
00:01:14,080 --> 00:01:16,630
replicated participants
um in order to avoid the problem with

58
00:01:16,630 --> 00:01:16,640
um in order to avoid the problem with
 

59
00:01:16,640 --> 00:01:19,030
um in order to avoid the problem with
two-phase commit that a crashed

60
00:01:19,030 --> 00:01:19,040
two-phase commit that a crashed
 

61
00:01:19,040 --> 00:01:21,270
two-phase commit that a crashed
coordinator can block everyone. Um and

62
00:01:21,270 --> 00:01:21,280
coordinator can block everyone. Um and
 

63
00:01:21,280 --> 00:01:22,950
coordinator can block everyone. Um and
the other interesting idea is that they

64
00:01:22,950 --> 00:01:22,960
the other interesting idea is that they
 

65
00:01:22,960 --> 00:01:25,830
the other interesting idea is that they
use synchronized time in order to have

66
00:01:25,830 --> 00:01:25,840
use synchronized time in order to have
 

67
00:01:25,840 --> 00:01:29,670
use synchronized time in order to have
very efficient readonly transactions. Um

68
00:01:29,670 --> 00:01:29,680
very efficient readonly transactions. Um
 

69
00:01:29,680 --> 00:01:31,749
very efficient readonly transactions. Um
and the system is is actually been very

70
00:01:31,749 --> 00:01:31,759
and the system is is actually been very
 

71
00:01:31,759 --> 00:01:34,149
and the system is is actually been very
successful. It's used a lot by many many

72
00:01:34,149 --> 00:01:34,159
successful. It's used a lot by many many
 

73
00:01:34,159 --> 00:01:36,789
successful. It's used a lot by many many
different services inside of Google.

74
00:01:36,789 --> 00:01:36,799
different services inside of Google.
 

75
00:01:36,799 --> 00:01:39,429
different services inside of Google.
It's uh been turned by Google into a a

76
00:01:39,429 --> 00:01:39,439
It's uh been turned by Google into a a
 

77
00:01:39,439 --> 00:01:41,429
It's uh been turned by Google into a a
product a service for their cloud-based

78
00:01:41,429 --> 00:01:41,439
product a service for their cloud-based
 

79
00:01:41,439 --> 00:01:45,190
product a service for their cloud-based
customers. Um and it's inspired um a

80
00:01:45,190 --> 00:01:45,200
customers. Um and it's inspired um a
 

81
00:01:45,200 --> 00:01:46,710
customers. Um and it's inspired um a
bunch of other research and other

82
00:01:46,710 --> 00:01:46,720
bunch of other research and other
 

83
00:01:46,720 --> 00:01:50,069
bunch of other research and other
systems both sort of by the example that

84
00:01:50,069 --> 00:01:50,079
systems both sort of by the example that
 

85
00:01:50,079 --> 00:01:52,069
systems both sort of by the example that
um these kind of wide area transactions

86
00:01:52,069 --> 00:01:52,079
um these kind of wide area transactions
 

87
00:01:52,079 --> 00:01:54,149
um these kind of wide area transactions
are possible and also specifically

88
00:01:54,149 --> 00:01:54,159
are possible and also specifically
 

89
00:01:54,159 --> 00:01:55,749
are possible and also specifically
there's um at least one open source

90
00:01:55,749 --> 00:01:55,759
there's um at least one open source
 

91
00:01:55,759 --> 00:01:58,550
there's um at least one open source
system cockroach DB that uses a lot of

92
00:01:58,550 --> 00:01:58,560
system cockroach DB that uses a lot of
 

93
00:01:58,560 --> 00:02:02,469
system cockroach DB that uses a lot of
explicitly uses a lot of the design um

94
00:02:02,469 --> 00:02:02,479
explicitly uses a lot of the design um
 

95
00:02:02,479 --> 00:02:05,030
explicitly uses a lot of the design um
the motivating use case the um reason

96
00:02:05,030 --> 00:02:05,040
the motivating use case the um reason
 

97
00:02:05,040 --> 00:02:07,270
the motivating use case the um reason
that the paper says they first kind of

98
00:02:07,270 --> 00:02:07,280
that the paper says they first kind of
 

99
00:02:07,280 --> 00:02:08,790
that the paper says they first kind of
uh started the design spanninner was

100
00:02:08,790 --> 00:02:08,800
uh started the design spanninner was
 

101
00:02:08,800 --> 00:02:11,270
uh started the design spanninner was
that they were already had a um well

102
00:02:11,270 --> 00:02:11,280
that they were already had a um well
 

103
00:02:11,280 --> 00:02:13,430
that they were already had a um well
actually they many big database systems

104
00:02:13,430 --> 00:02:13,440
actually they many big database systems
 

105
00:02:13,440 --> 00:02:15,110
actually they many big database systems
inside Google but their advertising

106
00:02:15,110 --> 00:02:15,120
inside Google but their advertising
 

107
00:02:15,120 --> 00:02:18,869
inside Google but their advertising
system in particular um the it data was

108
00:02:18,869 --> 00:02:18,879
system in particular um the it data was
 

109
00:02:18,879 --> 00:02:22,630
system in particular um the it data was
sharted over many many uh distinct MySQL

110
00:02:22,630 --> 00:02:22,640
sharted over many many uh distinct MySQL
 

111
00:02:22,640 --> 00:02:25,670
sharted over many many uh distinct MySQL
and big table databases and maintaining

112
00:02:25,670 --> 00:02:25,680
and big table databases and maintaining
 

113
00:02:25,680 --> 00:02:28,070
and big table databases and maintaining
that sharding uh was a just an awkward

114
00:02:28,070 --> 00:02:28,080
that sharding uh was a just an awkward
 

115
00:02:28,080 --> 00:02:30,869
that sharding uh was a just an awkward
and manual and timeconuming process in

116
00:02:30,869 --> 00:02:30,879
and manual and timeconuming process in
 

117
00:02:30,879 --> 00:02:33,670
and manual and timeconuming process in
addition their previous advertising

118
00:02:33,670 --> 00:02:33,680
addition their previous advertising
 

119
00:02:33,680 --> 00:02:36,390
addition their previous advertising
database system um didn't allow

120
00:02:36,390 --> 00:02:36,400
database system um didn't allow
 

121
00:02:36,400 --> 00:02:38,229
database system um didn't allow
transactions that spanned more than a

122
00:02:38,229 --> 00:02:38,239
transactions that spanned more than a
 

123
00:02:38,239 --> 00:02:40,150
transactions that spanned more than a
single uh basically more than a single

124
00:02:40,150 --> 00:02:40,160
single uh basically more than a single
 

125
00:02:40,160 --> 00:02:42,390
single uh basically more than a single
server um But they really wanted to be

126
00:02:42,390 --> 00:02:42,400
server um But they really wanted to be
 

127
00:02:42,400 --> 00:02:44,710
server um But they really wanted to be
able to have um to spread their data out

128
00:02:44,710 --> 00:02:44,720
able to have um to spread their data out
 

129
00:02:44,720 --> 00:02:47,670
able to have um to spread their data out
more widely for better performance and

130
00:02:47,670 --> 00:02:47,680
more widely for better performance and
 

131
00:02:47,680 --> 00:02:50,630
more widely for better performance and
to have transactions over the um

132
00:02:50,630 --> 00:02:50,640
to have transactions over the um
 

133
00:02:50,640 --> 00:02:53,990
to have transactions over the um
multiple shards of the data

134
00:02:53,990 --> 00:02:54,000
multiple shards of the data
 

135
00:02:54,000 --> 00:02:56,070
multiple shards of the data
um for their advertising database.

136
00:02:56,070 --> 00:02:56,080
um for their advertising database.
 

137
00:02:56,080 --> 00:02:57,670
um for their advertising database.
Apparently the workload was dominated by

138
00:02:57,670 --> 00:02:57,680
Apparently the workload was dominated by
 

139
00:02:57,680 --> 00:02:59,589
Apparently the workload was dominated by
readonly transactions. Um and you can

140
00:02:59,589 --> 00:02:59,599
readonly transactions. Um and you can
 

141
00:02:59,599 --> 00:03:01,910
readonly transactions. Um and you can
see this in table six where the um

142
00:03:01,910 --> 00:03:01,920
see this in table six where the um
 

143
00:03:01,920 --> 00:03:03,589
see this in table six where the um
there's billions of readonly

144
00:03:03,589 --> 00:03:03,599
there's billions of readonly
 

145
00:03:03,599 --> 00:03:07,509
there's billions of readonly
transactions and only millions of um of

146
00:03:07,509 --> 00:03:07,519
transactions and only millions of um of
 

147
00:03:07,519 --> 00:03:09,670
transactions and only millions of um of
read write transactions. So they're very

148
00:03:09,670 --> 00:03:09,680
read write transactions. So they're very
 

149
00:03:09,680 --> 00:03:12,390
read write transactions. So they're very
interested in um the performance of read

150
00:03:12,390 --> 00:03:12,400
interested in um the performance of read
 

151
00:03:12,400 --> 00:03:15,030
interested in um the performance of read
only of transactions that only do reads

152
00:03:15,030 --> 00:03:15,040
only of transactions that only do reads
 

153
00:03:15,040 --> 00:03:16,949
only of transactions that only do reads
and apparently they also required strong

154
00:03:16,949 --> 00:03:16,959
and apparently they also required strong
 

155
00:03:16,959 --> 00:03:18,949
and apparently they also required strong
consistency um that you know what

156
00:03:18,949 --> 00:03:18,959
consistency um that you know what
 

157
00:03:18,959 --> 00:03:21,270
consistency um that you know what
transactions in particular um so they

158
00:03:21,270 --> 00:03:21,280
transactions in particular um so they
 

159
00:03:21,280 --> 00:03:23,589
transactions in particular um so they
wanted serializable transactions and

160
00:03:23,589 --> 00:03:23,599
wanted serializable transactions and
 

161
00:03:23,599 --> 00:03:27,190
wanted serializable transactions and
they also wanted um external consistency

162
00:03:27,190 --> 00:03:27,200
they also wanted um external consistency
 

163
00:03:27,200 --> 00:03:29,190
they also wanted um external consistency
which means that if one transaction

164
00:03:29,190 --> 00:03:29,200
which means that if one transaction
 

165
00:03:29,200 --> 00:03:31,270
which means that if one transaction
commits

166
00:03:31,270 --> 00:03:31,280
commits
 

167
00:03:31,280 --> 00:03:33,910
commits
um and then after it finishes committing

168
00:03:33,910 --> 00:03:33,920
um and then after it finishes committing
 

169
00:03:33,920 --> 00:03:35,509
um and then after it finishes committing
another transaction starts the second

170
00:03:35,509 --> 00:03:35,519
another transaction starts the second
 

171
00:03:35,519 --> 00:03:38,390
another transaction starts the second
transaction needs to see any modific

172
00:03:38,390 --> 00:03:38,400
transaction needs to see any modific
 

173
00:03:38,400 --> 00:03:41,350
transaction needs to see any modific
ifications done by the first

174
00:03:41,350 --> 00:03:41,360
ifications done by the first
 

175
00:03:41,360 --> 00:03:43,430
ifications done by the first
um and this external consistency turns

176
00:03:43,430 --> 00:03:43,440
um and this external consistency turns
 

177
00:03:43,440 --> 00:03:48,710
um and this external consistency turns
out to be um uh interesting uh with with

178
00:03:48,710 --> 00:03:48,720
out to be um uh interesting uh with with
 

179
00:03:48,720 --> 00:03:52,949
out to be um uh interesting uh with with
replicated data. All right. So um I want

180
00:03:52,949 --> 00:03:52,959
replicated data. All right. So um I want
 

181
00:03:52,959 --> 00:03:55,190
replicated data. All right. So um I want
to draw out just the basic uh

182
00:03:55,190 --> 00:03:55,200
to draw out just the basic uh
 

183
00:03:55,200 --> 00:03:56,949
to draw out just the basic uh
arrangement sort of physical arrangement

184
00:03:56,949 --> 00:03:56,959
arrangement sort of physical arrangement
 

185
00:03:56,959 --> 00:03:59,670
arrangement sort of physical arrangement
of their servers that that Spanner uses.

186
00:03:59,670 --> 00:03:59,680
of their servers that that Spanner uses.
 

187
00:03:59,680 --> 00:04:02,630
of their servers that that Spanner uses.
Um it has the its servers are spread

188
00:04:02,630 --> 00:04:02,640
Um it has the its servers are spread
 

189
00:04:02,640 --> 00:04:05,110
Um it has the its servers are spread
over data centers um presumably all over

190
00:04:05,110 --> 00:04:05,120
over data centers um presumably all over
 

191
00:04:05,120 --> 00:04:06,869
over data centers um presumably all over
the world certainly all over the United

192
00:04:06,869 --> 00:04:06,879
the world certainly all over the United
 

193
00:04:06,879 --> 00:04:09,750
the world certainly all over the United
States. Um, and each piece of data is

194
00:04:09,750 --> 00:04:09,760
States. Um, and each piece of data is
 

195
00:04:09,760 --> 00:04:12,309
States. Um, and each piece of data is
replicated at multiple data centers. So,

196
00:04:12,309 --> 00:04:12,319
replicated at multiple data centers. So,
 

197
00:04:12,319 --> 00:04:14,630
replicated at multiple data centers. So,
um, the diagrams got to have, um,

198
00:04:14,630 --> 00:04:14,640
um, the diagrams got to have, um,
 

199
00:04:14,640 --> 00:04:16,069
um, the diagrams got to have, um,
multiple data centers. Let's say

200
00:04:16,069 --> 00:04:16,079
multiple data centers. Let's say
 

201
00:04:16,079 --> 00:04:19,509
multiple data centers. Let's say
there's, um, there's three data centers.

202
00:04:19,509 --> 00:04:19,519
there's, um, there's three data centers.
 

203
00:04:19,519 --> 00:04:23,830
there's, um, there's three data centers.
Really, there'd be many more. Oops.

204
00:04:23,830 --> 00:04:23,840
Really, there'd be many more. Oops.
 

205
00:04:23,840 --> 00:04:26,790
Really, there'd be many more. Oops.
Um,

206
00:04:26,790 --> 00:04:26,800
Um,
 

207
00:04:26,800 --> 00:04:28,950
Um,
so we have multiple data centers. Then

208
00:04:28,950 --> 00:04:28,960
so we have multiple data centers. Then
 

209
00:04:28,960 --> 00:04:30,870
so we have multiple data centers. Then
the data is sharded that it's broken up.

210
00:04:30,870 --> 00:04:30,880
the data is sharded that it's broken up.
 

211
00:04:30,880 --> 00:04:32,870
the data is sharded that it's broken up.
You can think of it as been being broken

212
00:04:32,870 --> 00:04:32,880
You can think of it as been being broken
 

213
00:04:32,880 --> 00:04:36,150
You can think of it as been being broken
up by key into um, and split over many

214
00:04:36,150 --> 00:04:36,160
up by key into um, and split over many
 

215
00:04:36,160 --> 00:04:37,990
up by key into um, and split over many
servers. So maybe there's one server

216
00:04:37,990 --> 00:04:38,000
servers. So maybe there's one server
 

217
00:04:38,000 --> 00:04:41,430
servers. So maybe there's one server
that um serves keys starting with A in

218
00:04:41,430 --> 00:04:41,440
that um serves keys starting with A in
 

219
00:04:41,440 --> 00:04:43,430
that um serves keys starting with A in
in this data center, another starting

220
00:04:43,430 --> 00:04:43,440
in this data center, another starting
 

221
00:04:43,440 --> 00:04:47,590
in this data center, another starting
with B um and so forth. Lots of lots of

222
00:04:47,590 --> 00:04:47,600
with B um and so forth. Lots of lots of
 

223
00:04:47,600 --> 00:04:49,990
with B um and so forth. Lots of lots of
starting over lots of servers. In fact,

224
00:04:49,990 --> 00:04:50,000
starting over lots of servers. In fact,
 

225
00:04:50,000 --> 00:04:52,790
starting over lots of servers. In fact,
every data center has or um any piece of

226
00:04:52,790 --> 00:04:52,800
every data center has or um any piece of
 

227
00:04:52,800 --> 00:04:55,670
every data center has or um any piece of
data is any shard is replicated at at

228
00:04:55,670 --> 00:04:55,680
data is any shard is replicated at at
 

229
00:04:55,680 --> 00:04:57,430
data is any shard is replicated at at
more than one data center. So there's

230
00:04:57,430 --> 00:04:57,440
more than one data center. So there's
 

231
00:04:57,440 --> 00:04:59,510
more than one data center. So there's
going to be another copy another replica

232
00:04:59,510 --> 00:04:59,520
going to be another copy another replica
 

233
00:04:59,520 --> 00:05:02,230
going to be another copy another replica
of the A keys and the B keys and so on.

234
00:05:02,230 --> 00:05:02,240
of the A keys and the B keys and so on.
 

235
00:05:02,240 --> 00:05:04,710
of the A keys and the B keys and so on.
the second data center and yet another

236
00:05:04,710 --> 00:05:04,720
the second data center and yet another
 

237
00:05:04,720 --> 00:05:08,390
the second data center and yet another
hopefully identical copy um of all this

238
00:05:08,390 --> 00:05:08,400
hopefully identical copy um of all this
 

239
00:05:08,400 --> 00:05:11,029
hopefully identical copy um of all this
data at the third data center. In

240
00:05:11,029 --> 00:05:11,039
data at the third data center. In
 

241
00:05:11,039 --> 00:05:13,990
data at the third data center. In
addition, each data center has m

242
00:05:13,990 --> 00:05:14,000
addition, each data center has m
 

243
00:05:14,000 --> 00:05:16,390
addition, each data center has m
multiple clients or they're clients of

244
00:05:16,390 --> 00:05:16,400
multiple clients or they're clients of
 

245
00:05:16,400 --> 00:05:19,350
multiple clients or they're clients of
Spanner. Um and what these clients

246
00:05:19,350 --> 00:05:19,360
Spanner. Um and what these clients
 

247
00:05:19,360 --> 00:05:21,830
Spanner. Um and what these clients
really are is web servers. So if an

248
00:05:21,830 --> 00:05:21,840
really are is web servers. So if an
 

249
00:05:21,840 --> 00:05:23,350
really are is web servers. So if an
ordinary human being sitting in front of

250
00:05:23,350 --> 00:05:23,360
ordinary human being sitting in front of
 

251
00:05:23,360 --> 00:05:27,350
ordinary human being sitting in front of
a web browser uh connects to some Google

252
00:05:27,350 --> 00:05:27,360
a web browser uh connects to some Google
 

253
00:05:27,360 --> 00:05:28,950
a web browser uh connects to some Google
service that uses Spanner, they'll

254
00:05:28,950 --> 00:05:28,960
service that uses Spanner, they'll
 

255
00:05:28,960 --> 00:05:30,550
service that uses Spanner, they'll
connect to some web server in one of the

256
00:05:30,550 --> 00:05:30,560
connect to some web server in one of the
 

257
00:05:30,560 --> 00:05:32,070
connect to some web server in one of the
data centers and that's going to be one

258
00:05:32,070 --> 00:05:32,080
data centers and that's going to be one
 

259
00:05:32,080 --> 00:05:34,790
data centers and that's going to be one
of these um

260
00:05:34,790 --> 00:05:34,800
of these um
 

261
00:05:34,800 --> 00:05:37,350
of these um
one of these Spanner clients.

262
00:05:37,350 --> 00:05:37,360
one of these Spanner clients.
 

263
00:05:37,360 --> 00:05:41,590
one of these Spanner clients.
All right. Um so that is replicated. The

264
00:05:41,590 --> 00:05:41,600
All right. Um so that is replicated. The
 

265
00:05:41,600 --> 00:05:43,909
All right. Um so that is replicated. The
replication is managed by Paxos. um in

266
00:05:43,909 --> 00:05:43,919
replication is managed by Paxos. um in
 

267
00:05:43,919 --> 00:05:45,990
replication is managed by Paxos. um in
fact really a variant of Paxos that has

268
00:05:45,990 --> 00:05:46,000
fact really a variant of Paxos that has
 

269
00:05:46,000 --> 00:05:48,550
fact really a variant of Paxos that has
leaders and is really very much like the

270
00:05:48,550 --> 00:05:48,560
leaders and is really very much like the
 

271
00:05:48,560 --> 00:05:51,029
leaders and is really very much like the
raft that we're all familiar with. Um

272
00:05:51,029 --> 00:05:51,039
raft that we're all familiar with. Um
 

273
00:05:51,039 --> 00:05:54,230
raft that we're all familiar with. Um
and each Paxos instance manages all the

274
00:05:54,230 --> 00:05:54,240
and each Paxos instance manages all the
 

275
00:05:54,240 --> 00:05:56,790
and each Paxos instance manages all the
replicas of a given shard of the data.

276
00:05:56,790 --> 00:05:56,800
replicas of a given shard of the data.
 

277
00:05:56,800 --> 00:05:59,590
replicas of a given shard of the data.
So this shard,

278
00:05:59,590 --> 00:05:59,600
So this shard,
 

279
00:05:59,600 --> 00:06:02,310
So this shard,
all the copies of this shard um form one

280
00:06:02,310 --> 00:06:02,320
all the copies of this shard um form one
 

281
00:06:02,320 --> 00:06:04,150
all the copies of this shard um form one
Paxos

282
00:06:04,150 --> 00:06:04,160
Paxos
 

283
00:06:04,160 --> 00:06:05,909
Paxos
uh group

284
00:06:05,909 --> 00:06:05,919
uh group
 

285
00:06:05,919 --> 00:06:07,749
uh group
and all the replicas of this shard form

286
00:06:07,749 --> 00:06:07,759
and all the replicas of this shard form
 

287
00:06:07,759 --> 00:06:09,670
and all the replicas of this shard form
another Paxos group and within each each

288
00:06:09,670 --> 00:06:09,680
another Paxos group and within each each
 

289
00:06:09,680 --> 00:06:12,309
another Paxos group and within each each
of these Paxos instances is um

290
00:06:12,309 --> 00:06:12,319
of these Paxos instances is um
 

291
00:06:12,319 --> 00:06:14,390
of these Paxos instances is um
independent has its own leader runs its

292
00:06:14,390 --> 00:06:14,400
independent has its own leader runs its
 

293
00:06:14,400 --> 00:06:17,749
independent has its own leader runs its
own version of the own uh of the own

294
00:06:17,749 --> 00:06:17,759
own version of the own uh of the own
 

295
00:06:17,759 --> 00:06:21,189
own version of the own uh of the own
instance of the Paxos protocol. Um and

296
00:06:21,189 --> 00:06:21,199
instance of the Paxos protocol. Um and
 

297
00:06:21,199 --> 00:06:22,790
instance of the Paxos protocol. Um and
the reason for the sharding and for the

298
00:06:22,790 --> 00:06:22,800
the reason for the sharding and for the
 

299
00:06:22,800 --> 00:06:24,390
the reason for the sharding and for the
independent

300
00:06:24,390 --> 00:06:24,400
independent
 

301
00:06:24,400 --> 00:06:29,029
independent
uh Paxos instances per shard is to allow

302
00:06:29,029 --> 00:06:29,039
uh Paxos instances per shard is to allow
 

303
00:06:29,039 --> 00:06:31,270
uh Paxos instances per shard is to allow
um parallel speed up and sort of a lot

304
00:06:31,270 --> 00:06:31,280
um parallel speed up and sort of a lot
 

305
00:06:31,280 --> 00:06:33,670
um parallel speed up and sort of a lot
of parallel throughput because there's a

306
00:06:33,670 --> 00:06:33,680
of parallel throughput because there's a
 

307
00:06:33,680 --> 00:06:35,749
of parallel throughput because there's a
vast number of clients you know which

308
00:06:35,749 --> 00:06:35,759
vast number of clients you know which
 

309
00:06:35,759 --> 00:06:37,430
vast number of clients you know which
are representing working on behalf of

310
00:06:37,430 --> 00:06:37,440
are representing working on behalf of
 

311
00:06:37,440 --> 00:06:39,590
are representing working on behalf of
web browsers. So this huge number

312
00:06:39,590 --> 00:06:39,600
web browsers. So this huge number
 

313
00:06:39,600 --> 00:06:43,110
web browsers. So this huge number
typically of concurrent requests um and

314
00:06:43,110 --> 00:06:43,120
typically of concurrent requests um and
 

315
00:06:43,120 --> 00:06:45,110
typically of concurrent requests um and
so it pays more immensely to split them

316
00:06:45,110 --> 00:06:45,120
so it pays more immensely to split them
 

317
00:06:45,120 --> 00:06:48,950
so it pays more immensely to split them
up over multiple shards and multiple

318
00:06:48,950 --> 00:06:48,960
up over multiple shards and multiple
 

319
00:06:48,960 --> 00:06:51,350
up over multiple shards and multiple
sort of Paxos

320
00:06:51,350 --> 00:06:51,360
sort of Paxos
 

321
00:06:51,360 --> 00:06:56,150
sort of Paxos
uh groups that are running in parallel.

322
00:06:56,150 --> 00:06:56,160

 

323
00:06:56,160 --> 00:06:58,710

Okay. And you can think of or each of

324
00:06:58,710 --> 00:06:58,720
Okay. And you can think of or each of
 

325
00:06:58,720 --> 00:07:01,350
Okay. And you can think of or each of
these Paxos groups has a leader um a lot

326
00:07:01,350 --> 00:07:01,360
these Paxos groups has a leader um a lot
 

327
00:07:01,360 --> 00:07:03,909
these Paxos groups has a leader um a lot
like raft. So maybe the leader for this

328
00:07:03,909 --> 00:07:03,919
like raft. So maybe the leader for this
 

329
00:07:03,919 --> 00:07:06,150
like raft. So maybe the leader for this
shard is in data is the replica in data

330
00:07:06,150 --> 00:07:06,160
shard is in data is the replica in data
 

331
00:07:06,160 --> 00:07:07,830
shard is in data is the replica in data
center one and the leader for this shard

332
00:07:07,830 --> 00:07:07,840
center one and the leader for this shard
 

333
00:07:07,840 --> 00:07:12,230
center one and the leader for this shard
might be the uh replica in data center 2

334
00:07:12,230 --> 00:07:12,240
might be the uh replica in data center 2
 

335
00:07:12,240 --> 00:07:15,589
might be the uh replica in data center 2
and um and so forth.

336
00:07:15,589 --> 00:07:15,599
and um and so forth.
 

337
00:07:15,599 --> 00:07:18,550
and um and so forth.
Um and uh you know so that means that if

338
00:07:18,550 --> 00:07:18,560
Um and uh you know so that means that if
 

339
00:07:18,560 --> 00:07:21,430
Um and uh you know so that means that if
you need to um if a client needs to do a

340
00:07:21,430 --> 00:07:21,440
you need to um if a client needs to do a
 

341
00:07:21,440 --> 00:07:23,510
you need to um if a client needs to do a
write it has to send that right to the

342
00:07:23,510 --> 00:07:23,520
write it has to send that right to the
 

343
00:07:23,520 --> 00:07:28,309
write it has to send that right to the
leader of the um of the shard whose data

344
00:07:28,309 --> 00:07:28,319
leader of the um of the shard whose data
 

345
00:07:28,319 --> 00:07:32,150
leader of the um of the shard whose data
it needs to write. Um just as with raft

346
00:07:32,150 --> 00:07:32,160
it needs to write. Um just as with raft
 

347
00:07:32,160 --> 00:07:34,710
it needs to write. Um just as with raft
these Paxos instances are what they're

348
00:07:34,710 --> 00:07:34,720
these Paxos instances are what they're
 

349
00:07:34,720 --> 00:07:36,469
these Paxos instances are what they're
really doing is sending out a log. The

350
00:07:36,469 --> 00:07:36,479
really doing is sending out a log. The
 

351
00:07:36,479 --> 00:07:38,070
really doing is sending out a log. The
leader is sort of replicating a log of

352
00:07:38,070 --> 00:07:38,080
leader is sort of replicating a log of
 

353
00:07:38,080 --> 00:07:40,550
leader is sort of replicating a log of
operations to all the followers and the

354
00:07:40,550 --> 00:07:40,560
operations to all the followers and the
 

355
00:07:40,560 --> 00:07:42,390
operations to all the followers and the
followers execute that log which is for

356
00:07:42,390 --> 00:07:42,400
followers execute that log which is for
 

357
00:07:42,400 --> 00:07:44,469
followers execute that log which is for
data is going to be reads and writes

358
00:07:44,469 --> 00:07:44,479
data is going to be reads and writes
 

359
00:07:44,479 --> 00:07:48,550
data is going to be reads and writes
sort of executes those logs. Um

360
00:07:48,550 --> 00:07:48,560
sort of executes those logs. Um
 

361
00:07:48,560 --> 00:07:53,110
sort of executes those logs. Um
all in the same order. Um

362
00:07:53,110 --> 00:07:53,120
all in the same order. Um
 

363
00:07:53,120 --> 00:07:55,510
all in the same order. Um
all right so uh the reason for these for

364
00:07:55,510 --> 00:07:55,520
all right so uh the reason for these for
 

365
00:07:55,520 --> 00:07:57,990
all right so uh the reason for these for
this setup um the sharding as I

366
00:07:57,990 --> 00:07:58,000
this setup um the sharding as I
 

367
00:07:58,000 --> 00:08:00,230
this setup um the sharding as I
mentioned is for throughput the multiple

368
00:08:00,230 --> 00:08:00,240
mentioned is for throughput the multiple
 

369
00:08:00,240 --> 00:08:03,670
mentioned is for throughput the multiple
copies in different data centers is for

370
00:08:03,670 --> 00:08:03,680
copies in different data centers is for
 

371
00:08:03,680 --> 00:08:06,230
copies in different data centers is for
two reasons one is um you want copies in

372
00:08:06,230 --> 00:08:06,240
two reasons one is um you want copies in
 

373
00:08:06,240 --> 00:08:07,909
two reasons one is um you want copies in
different data centers in case one data

374
00:08:07,909 --> 00:08:07,919
different data centers in case one data
 

375
00:08:07,919 --> 00:08:11,110
different data centers in case one data
center fails if you know maybe a power

376
00:08:11,110 --> 00:08:11,120
center fails if you know maybe a power
 

377
00:08:11,120 --> 00:08:12,950
center fails if you know maybe a power
fails to the entire city the data

378
00:08:12,950 --> 00:08:12,960
fails to the entire city the data
 

379
00:08:12,960 --> 00:08:14,390
fails to the entire city the data
center's in or there's an earthquake or

380
00:08:14,390 --> 00:08:14,400
center's in or there's an earthquake or
 

381
00:08:14,400 --> 00:08:17,110
center's in or there's an earthquake or
a fire or something you'd like um other

382
00:08:17,110 --> 00:08:17,120
a fire or something you'd like um other
 

383
00:08:17,120 --> 00:08:19,189
a fire or something you'd like um other
copies at other data centers that are

384
00:08:19,189 --> 00:08:19,199
copies at other data centers that are
 

385
00:08:19,199 --> 00:08:20,550
copies at other data centers that are
maybe not going to fail at the same

386
00:08:20,550 --> 00:08:20,560
maybe not going to fail at the same
 

387
00:08:20,560 --> 00:08:22,469
maybe not going to fail at the same
time. Um, and you know, there's a price

388
00:08:22,469 --> 00:08:22,479
time. Um, and you know, there's a price
 

389
00:08:22,479 --> 00:08:24,230
time. Um, and you know, there's a price
to pay for that because now the Paxos

390
00:08:24,230 --> 00:08:24,240
to pay for that because now the Paxos
 

391
00:08:24,240 --> 00:08:27,189
to pay for that because now the Paxos
protocol now has to talk maybe over long

392
00:08:27,189 --> 00:08:27,199
protocol now has to talk maybe over long
 

393
00:08:27,199 --> 00:08:29,830
protocol now has to talk maybe over long
distances to um talk to followers and in

394
00:08:29,830 --> 00:08:29,840
distances to um talk to followers and in
 

395
00:08:29,840 --> 00:08:31,510
distances to um talk to followers and in
different data centers. The other reason

396
00:08:31,510 --> 00:08:31,520
different data centers. The other reason
 

397
00:08:31,520 --> 00:08:33,430
different data centers. The other reason
to have data in multiple data centers is

398
00:08:33,430 --> 00:08:33,440
to have data in multiple data centers is
 

399
00:08:33,440 --> 00:08:35,509
to have data in multiple data centers is
that it may allow you to have copies of

400
00:08:35,509 --> 00:08:35,519
that it may allow you to have copies of
 

401
00:08:35,519 --> 00:08:38,630
that it may allow you to have copies of
the data near um all the different

402
00:08:38,630 --> 00:08:38,640
the data near um all the different
 

403
00:08:38,640 --> 00:08:40,070
the data near um all the different
clients that use it. So, if you have a

404
00:08:40,070 --> 00:08:40,080
clients that use it. So, if you have a
 

405
00:08:40,080 --> 00:08:42,230
clients that use it. So, if you have a
piece of data that may be read in both

406
00:08:42,230 --> 00:08:42,240
piece of data that may be read in both
 

407
00:08:42,240 --> 00:08:45,430
piece of data that may be read in both
California and New York, um maybe it's

408
00:08:45,430 --> 00:08:45,440
California and New York, um maybe it's
 

409
00:08:45,440 --> 00:08:47,430
California and New York, um maybe it's
nice to have a copy of that data, one

410
00:08:47,430 --> 00:08:47,440
nice to have a copy of that data, one
 

411
00:08:47,440 --> 00:08:49,110
nice to have a copy of that data, one
copy in California, one copy in New

412
00:08:49,110 --> 00:08:49,120
copy in California, one copy in New
 

413
00:08:49,120 --> 00:08:52,310
copy in California, one copy in New
York. um so that reads can be very fast

414
00:08:52,310 --> 00:08:52,320
York. um so that reads can be very fast
 

415
00:08:52,320 --> 00:08:53,829
York. um so that reads can be very fast
and indeed a lot of the focus of the

416
00:08:53,829 --> 00:08:53,839
and indeed a lot of the focus of the
 

417
00:08:53,839 --> 00:08:57,590
and indeed a lot of the focus of the
design is to make reads from the local

418
00:08:57,590 --> 00:08:57,600
design is to make reads from the local
 

419
00:08:57,600 --> 00:08:59,990
design is to make reads from the local
the nearest replica both fast and

420
00:08:59,990 --> 00:09:00,000
the nearest replica both fast and
 

421
00:09:00,000 --> 00:09:04,310
the nearest replica both fast and
correct. Um finally another interesting

422
00:09:04,310 --> 00:09:04,320
correct. Um finally another interesting
 

423
00:09:04,320 --> 00:09:06,230
correct. Um finally another interesting
interaction between Paxos and multiple

424
00:09:06,230 --> 00:09:06,240
interaction between Paxos and multiple
 

425
00:09:06,240 --> 00:09:08,389
interaction between Paxos and multiple
data centers is that Paxos like raft

426
00:09:08,389 --> 00:09:08,399
data centers is that Paxos like raft
 

427
00:09:08,399 --> 00:09:10,870
data centers is that Paxos like raft
only requires a majority

428
00:09:10,870 --> 00:09:10,880
only requires a majority
 

429
00:09:10,880 --> 00:09:13,509
only requires a majority
um in order to replicate a log entry and

430
00:09:13,509 --> 00:09:13,519
um in order to replicate a log entry and
 

431
00:09:13,519 --> 00:09:15,190
um in order to replicate a log entry and
proceed. And that means if there's one

432
00:09:15,190 --> 00:09:15,200
proceed. And that means if there's one
 

433
00:09:15,200 --> 00:09:17,829
proceed. And that means if there's one
slow or distant or flaky data center,

434
00:09:17,829 --> 00:09:17,839
slow or distant or flaky data center,
 

435
00:09:17,839 --> 00:09:20,710
slow or distant or flaky data center,
the Paxo system can keep chugging along

436
00:09:20,710 --> 00:09:20,720
the Paxo system can keep chugging along
 

437
00:09:20,720 --> 00:09:22,389
the Paxo system can keep chugging along
um and accepting new requests even if

438
00:09:22,389 --> 00:09:22,399
um and accepting new requests even if
 

439
00:09:22,399 --> 00:09:27,990
um and accepting new requests even if
one data center is um is being slow.

440
00:09:27,990 --> 00:09:28,000
one data center is um is being slow.
 

441
00:09:28,000 --> 00:09:30,949
one data center is um is being slow.
All right, so with this arrangement um

442
00:09:30,949 --> 00:09:30,959
All right, so with this arrangement um
 

443
00:09:30,959 --> 00:09:32,790
All right, so with this arrangement um
there's a couple of big challenges that

444
00:09:32,790 --> 00:09:32,800
there's a couple of big challenges that
 

445
00:09:32,800 --> 00:09:35,110
there's a couple of big challenges that
paper has to bite off. One is they

446
00:09:35,110 --> 00:09:35,120
paper has to bite off. One is they
 

447
00:09:35,120 --> 00:09:36,790
paper has to bite off. One is they
really want to do reads from local data

448
00:09:36,790 --> 00:09:36,800
really want to do reads from local data
 

449
00:09:36,800 --> 00:09:40,310
really want to do reads from local data
centers. Um but because they're using

450
00:09:40,310 --> 00:09:40,320
centers. Um but because they're using
 

451
00:09:40,320 --> 00:09:44,630
centers. Um but because they're using
Paxos and because Paxos only requires um

452
00:09:44,630 --> 00:09:44,640
Paxos and because Paxos only requires um
 

453
00:09:44,640 --> 00:09:46,550
Paxos and because Paxos only requires um
each log entry to be replicated on a

454
00:09:46,550 --> 00:09:46,560
each log entry to be replicated on a
 

455
00:09:46,560 --> 00:09:48,710
each log entry to be replicated on a
majority that means a minority of the

456
00:09:48,710 --> 00:09:48,720
majority that means a minority of the
 

457
00:09:48,720 --> 00:09:51,190
majority that means a minority of the
replicas may be lagging and may not have

458
00:09:51,190 --> 00:09:51,200
replicas may be lagging and may not have
 

459
00:09:51,200 --> 00:09:53,670
replicas may be lagging and may not have
seen the latest data that's been

460
00:09:53,670 --> 00:09:53,680
seen the latest data that's been
 

461
00:09:53,680 --> 00:09:56,790
seen the latest data that's been
committed by Paxos. Um, and that means

462
00:09:56,790 --> 00:09:56,800
committed by Paxos. Um, and that means
 

463
00:09:56,800 --> 00:09:59,509
committed by Paxos. Um, and that means
that if we allow clients to read from

464
00:09:59,509 --> 00:09:59,519
that if we allow clients to read from
 

465
00:09:59,519 --> 00:10:02,470
that if we allow clients to read from
the local replica for speed, they may be

466
00:10:02,470 --> 00:10:02,480
the local replica for speed, they may be
 

467
00:10:02,480 --> 00:10:05,190
the local replica for speed, they may be
reading outofdate data if their replica

468
00:10:05,190 --> 00:10:05,200
reading outofdate data if their replica
 

469
00:10:05,200 --> 00:10:06,630
reading outofdate data if their replica
happens to be in the minority that

470
00:10:06,630 --> 00:10:06,640
happens to be in the minority that
 

471
00:10:06,640 --> 00:10:08,389
happens to be in the minority that
didn't see the latest updates. So, they

472
00:10:08,389 --> 00:10:08,399
didn't see the latest updates. So, they
 

473
00:10:08,399 --> 00:10:09,990
didn't see the latest updates. So, they
have to since they're requiring

474
00:10:09,990 --> 00:10:10,000
have to since they're requiring
 

475
00:10:10,000 --> 00:10:11,829
have to since they're requiring
correctness, they're requiring this

476
00:10:11,829 --> 00:10:11,839
correctness, they're requiring this
 

477
00:10:11,839 --> 00:10:16,150
correctness, they're requiring this
external consistency idea um that every

478
00:10:16,150 --> 00:10:16,160
external consistency idea um that every
 

479
00:10:16,160 --> 00:10:18,630
external consistency idea um that every
read see the most up-to-date data, they

480
00:10:18,630 --> 00:10:18,640
read see the most up-to-date data, they
 

481
00:10:18,640 --> 00:10:20,710
read see the most up-to-date data, they
have to have some way of dealing with

482
00:10:20,710 --> 00:10:20,720
have to have some way of dealing with
 

483
00:10:20,720 --> 00:10:22,949
have to have some way of dealing with
the possibility that the local replica

484
00:10:22,949 --> 00:10:22,959
the possibility that the local replica
 

485
00:10:22,959 --> 00:10:24,949
the possibility that the local replica
may be lagging.

486
00:10:24,949 --> 00:10:24,959
may be lagging.
 

487
00:10:24,959 --> 00:10:27,269
may be lagging.
Um, another issue they have to deal with

488
00:10:27,269 --> 00:10:27,279
Um, another issue they have to deal with
 

489
00:10:27,279 --> 00:10:29,030
Um, another issue they have to deal with
is that a transaction may involve

490
00:10:29,030 --> 00:10:29,040
is that a transaction may involve
 

491
00:10:29,040 --> 00:10:31,030
is that a transaction may involve
multiple shards and therefore multiple

492
00:10:31,030 --> 00:10:31,040
multiple shards and therefore multiple
 

493
00:10:31,040 --> 00:10:32,949
multiple shards and therefore multiple
paxos groups. So you may be reading or

494
00:10:32,949 --> 00:10:32,959
paxos groups. So you may be reading or
 

495
00:10:32,959 --> 00:10:34,790
paxos groups. So you may be reading or
writing a single transaction may be

496
00:10:34,790 --> 00:10:34,800
writing a single transaction may be
 

497
00:10:34,800 --> 00:10:36,310
writing a single transaction may be
reading or writing multiple records in

498
00:10:36,310 --> 00:10:36,320
reading or writing multiple records in
 

499
00:10:36,320 --> 00:10:38,710
reading or writing multiple records in
the database that are stored in multiple

500
00:10:38,710 --> 00:10:38,720
the database that are stored in multiple
 

501
00:10:38,720 --> 00:10:40,790
the database that are stored in multiple
shards and multiple paxos groups. So

502
00:10:40,790 --> 00:10:40,800
shards and multiple paxos groups. So
 

503
00:10:40,800 --> 00:10:43,509
shards and multiple paxos groups. So
those have to be um we need distributed

504
00:10:43,509 --> 00:10:43,519
those have to be um we need distributed
 

505
00:10:43,519 --> 00:10:45,509
those have to be um we need distributed
transactions.

506
00:10:45,509 --> 00:10:45,519
transactions.
 

507
00:10:45,519 --> 00:10:48,069
transactions.
Um

508
00:10:48,069 --> 00:10:48,079
Um
 

509
00:10:48,079 --> 00:10:50,630
Um
okay so um I'm going to explain how the

510
00:10:50,630 --> 00:10:50,640
okay so um I'm going to explain how the
 

511
00:10:50,640 --> 00:10:52,230
okay so um I'm going to explain how the
transactions work. That's going to be

512
00:10:52,230 --> 00:10:52,240
transactions work. That's going to be
 

513
00:10:52,240 --> 00:10:55,030
transactions work. That's going to be
the kind of focus of the lecture.

514
00:10:55,030 --> 00:10:55,040
the kind of focus of the lecture.
 

515
00:10:55,040 --> 00:10:57,670
the kind of focus of the lecture.
Um, Spanner actually treats implements

516
00:10:57,670 --> 00:10:57,680
Um, Spanner actually treats implements
 

517
00:10:57,680 --> 00:10:59,829
Um, Spanner actually treats implements
readwrite transactions um quite

518
00:10:59,829 --> 00:10:59,839
readwrite transactions um quite
 

519
00:10:59,839 --> 00:11:01,590
readwrite transactions um quite
differently from readonly transactions.

520
00:11:01,590 --> 00:11:01,600
differently from readonly transactions.
 

521
00:11:01,600 --> 00:11:03,269
differently from readonly transactions.
So let me start with the read read

522
00:11:03,269 --> 00:11:03,279
So let me start with the read read
 

523
00:11:03,279 --> 00:11:06,310
So let me start with the read read
transactions which are um sort of a lot

524
00:11:06,310 --> 00:11:06,320
transactions which are um sort of a lot
 

525
00:11:06,320 --> 00:11:09,670
transactions which are um sort of a lot
more conventional in their design.

526
00:11:09,670 --> 00:11:09,680
more conventional in their design.
 

527
00:11:09,680 --> 00:11:19,829
more conventional in their design.
All right. Um

528
00:11:19,829 --> 00:11:19,839

 

529
00:11:19,839 --> 00:11:26,069

Right. So first read write transactions.

530
00:11:26,069 --> 00:11:26,079

 

531
00:11:26,079 --> 00:11:27,670

Uh let me just remind you what a

532
00:11:27,670 --> 00:11:27,680
Uh let me just remind you what a
 

533
00:11:27,680 --> 00:11:30,710
Uh let me just remind you what a
transaction looks like. Um so let's just

534
00:11:30,710 --> 00:11:30,720
transaction looks like. Um so let's just
 

535
00:11:30,720 --> 00:11:32,150
transaction looks like. Um so let's just
choose a simple one that's like

536
00:11:32,150 --> 00:11:32,160
choose a simple one that's like
 

537
00:11:32,160 --> 00:11:37,190
choose a simple one that's like
mimicking u bank transfer. So on one of

538
00:11:37,190 --> 00:11:37,200
mimicking u bank transfer. So on one of
 

539
00:11:37,200 --> 00:11:39,110
mimicking u bank transfer. So on one of
those client machines, a client of

540
00:11:39,110 --> 00:11:39,120
those client machines, a client of
 

541
00:11:39,120 --> 00:11:41,110
those client machines, a client of
Spanner, you'd run some code. You run

542
00:11:41,110 --> 00:11:41,120
Spanner, you'd run some code. You run
 

543
00:11:41,120 --> 00:11:42,389
Spanner, you'd run some code. You run
this transaction code. The code would

544
00:11:42,389 --> 00:11:42,399
this transaction code. The code would
 

545
00:11:42,399 --> 00:11:45,030
this transaction code. The code would
say I'm beginning a transaction. Um and

546
00:11:45,030 --> 00:11:45,040
say I'm beginning a transaction. Um and
 

547
00:11:45,040 --> 00:11:46,310
say I'm beginning a transaction. Um and
then it would say I want to read and

548
00:11:46,310 --> 00:11:46,320
then it would say I want to read and
 

549
00:11:46,320 --> 00:11:48,150
then it would say I want to read and
write these records. So maybe we have a

550
00:11:48,150 --> 00:11:48,160
write these records. So maybe we have a
 

551
00:11:48,160 --> 00:11:50,389
write these records. So maybe we have a
bank balance in database record X and we

552
00:11:50,389 --> 00:11:50,399
bank balance in database record X and we
 

553
00:11:50,399 --> 00:11:52,630
bank balance in database record X and we
want to you know increment we want to

554
00:11:52,630 --> 00:11:52,640
want to you know increment we want to
 

555
00:11:52,640 --> 00:11:56,150
want to you know increment we want to
increase this bank balance and decrease

556
00:11:56,150 --> 00:11:56,160
increase this bank balance and decrease
 

557
00:11:56,160 --> 00:11:58,150
increase this bank balance and decrease
Y's bank balance and oh that's the end

558
00:11:58,150 --> 00:11:58,160
Y's bank balance and oh that's the end
 

559
00:11:58,160 --> 00:12:00,710
Y's bank balance and oh that's the end
of the transaction and now the client

560
00:12:00,710 --> 00:12:00,720
of the transaction and now the client
 

561
00:12:00,720 --> 00:12:02,069
of the transaction and now the client
hopes the database will go off and

562
00:12:02,069 --> 00:12:02,079
hopes the database will go off and
 

563
00:12:02,079 --> 00:12:05,910
hopes the database will go off and
commit that. Um,

564
00:12:05,910 --> 00:12:05,920
commit that. Um,
 

565
00:12:05,920 --> 00:12:08,470
commit that. Um,
all right. So, I want to trace through

566
00:12:08,470 --> 00:12:08,480
all right. So, I want to trace through
 

567
00:12:08,480 --> 00:12:10,710
all right. So, I want to trace through
all the steps that uh that have to

568
00:12:10,710 --> 00:12:10,720
all the steps that uh that have to
 

569
00:12:10,720 --> 00:12:14,150
all the steps that uh that have to
happen in order to um in order for

570
00:12:14,150 --> 00:12:14,160
happen in order to um in order for
 

571
00:12:14,160 --> 00:12:16,230
happen in order to um in order for
Spanner to execute this readwrite

572
00:12:16,230 --> 00:12:16,240
Spanner to execute this readwrite
 

573
00:12:16,240 --> 00:12:18,069
Spanner to execute this readwrite
transaction. So, first of all, there's a

574
00:12:18,069 --> 00:12:18,079
transaction. So, first of all, there's a
 

575
00:12:18,079 --> 00:12:19,829
transaction. So, first of all, there's a
client in one of the data centers that's

576
00:12:19,829 --> 00:12:19,839
client in one of the data centers that's
 

577
00:12:19,839 --> 00:12:22,710
client in one of the data centers that's
driving this transaction. Um, so I'll

578
00:12:22,710 --> 00:12:22,720
driving this transaction. Um, so I'll
 

579
00:12:22,720 --> 00:12:24,710
driving this transaction. Um, so I'll
draw this client here. Let's imagine

580
00:12:24,710 --> 00:12:24,720
draw this client here. Let's imagine
 

581
00:12:24,720 --> 00:12:26,629
draw this client here. Let's imagine
that X and Y are on different shards.

582
00:12:26,629 --> 00:12:26,639
that X and Y are on different shards.
 

583
00:12:26,639 --> 00:12:28,389
that X and Y are on different shards.
Um, since that's the that's the

584
00:12:28,389 --> 00:12:28,399
Um, since that's the that's the
 

585
00:12:28,399 --> 00:12:30,389
Um, since that's the that's the
interesting case.

586
00:12:30,389 --> 00:12:30,399
interesting case.
 

587
00:12:30,399 --> 00:12:33,430
interesting case.
um and that those shards each of the two

588
00:12:33,430 --> 00:12:33,440
um and that those shards each of the two
 

589
00:12:33,440 --> 00:12:36,710
um and that those shards each of the two
shards is is replicated in uh uh three

590
00:12:36,710 --> 00:12:36,720
shards is is replicated in uh uh three
 

591
00:12:36,720 --> 00:12:39,269
shards is is replicated in uh uh three
different data centers. So, uh, we got

592
00:12:39,269 --> 00:12:39,279
different data centers. So, uh, we got
 

593
00:12:39,279 --> 00:12:43,750
different data centers. So, uh, we got
our three data centers here.

594
00:12:43,750 --> 00:12:43,760

 

595
00:12:43,760 --> 00:12:46,629

And at each data center, there's a, um,

596
00:12:46,629 --> 00:12:46,639
And at each data center, there's a, um,
 

597
00:12:46,639 --> 00:12:49,509
And at each data center, there's a, um,
a server that, uh, I'm just going to

598
00:12:49,509 --> 00:12:49,519
a server that, uh, I'm just going to
 

599
00:12:49,519 --> 00:12:53,990
a server that, uh, I'm just going to
write X for the replicas of the

600
00:12:53,990 --> 00:12:54,000
write X for the replicas of the
 

601
00:12:54,000 --> 00:12:56,949
write X for the replicas of the
shard that's holding X, the bank balance

602
00:12:56,949 --> 00:12:56,959
shard that's holding X, the bank balance
 

603
00:12:56,959 --> 00:13:00,790
shard that's holding X, the bank balance
for X, and Y for the these three

604
00:13:00,790 --> 00:13:00,800
for X, and Y for the these three
 

605
00:13:00,800 --> 00:13:02,710
for X, and Y for the these three
servers.

606
00:13:02,710 --> 00:13:02,720
servers.
 

607
00:13:02,720 --> 00:13:06,069
servers.
Spinner runs two-phase commit, just

608
00:13:06,069 --> 00:13:06,079
Spinner runs two-phase commit, just
 

609
00:13:06,079 --> 00:13:08,069
Spinner runs two-phase commit, just
totally standard two-phase commit and

610
00:13:08,069 --> 00:13:08,079
totally standard two-phase commit and
 

611
00:13:08,079 --> 00:13:11,670
totally standard two-phase commit and
two-phase locking almost exactly

612
00:13:11,670 --> 00:13:11,680
two-phase locking almost exactly
 

613
00:13:11,680 --> 00:13:14,949
two-phase locking almost exactly
um as described in the reading from last

614
00:13:14,949 --> 00:13:14,959
um as described in the reading from last
 

615
00:13:14,959 --> 00:13:17,750
um as described in the reading from last
week from the 6033 textbook. And the

616
00:13:17,750 --> 00:13:17,760
week from the 6033 textbook. And the
 

617
00:13:17,760 --> 00:13:21,509
week from the 6033 textbook. And the
huge difference um is that instead of

618
00:13:21,509 --> 00:13:21,519
huge difference um is that instead of
 

619
00:13:21,519 --> 00:13:23,350
huge difference um is that instead of
the participants and the transaction

620
00:13:23,350 --> 00:13:23,360
the participants and the transaction
 

621
00:13:23,360 --> 00:13:25,910
the participants and the transaction
manager being individual computers, the

622
00:13:25,910 --> 00:13:25,920
manager being individual computers, the
 

623
00:13:25,920 --> 00:13:27,590
manager being individual computers, the
participants in the track transaction

624
00:13:27,590 --> 00:13:27,600
participants in the track transaction
 

625
00:13:27,600 --> 00:13:33,110
participants in the track transaction
manager are um Paxos replicated

626
00:13:33,110 --> 00:13:33,120
manager are um Paxos replicated
 

627
00:13:33,120 --> 00:13:35,509
manager are um Paxos replicated
uh groups of servers for increased fault

628
00:13:35,509 --> 00:13:35,519
uh groups of servers for increased fault
 

629
00:13:35,519 --> 00:13:37,750
uh groups of servers for increased fault
tolerance. So that means just to remind

630
00:13:37,750 --> 00:13:37,760
tolerance. So that means just to remind
 

631
00:13:37,760 --> 00:13:42,069
tolerance. So that means just to remind
you that um the shard the three replicas

632
00:13:42,069 --> 00:13:42,079
you that um the shard the three replicas
 

633
00:13:42,079 --> 00:13:44,230
you that um the shard the three replicas
of the shard that stores X is really a

634
00:13:44,230 --> 00:13:44,240
of the shard that stores X is really a
 

635
00:13:44,240 --> 00:13:46,230
of the shard that stores X is really a
packless group. Same with these three

636
00:13:46,230 --> 00:13:46,240
packless group. Same with these three
 

637
00:13:46,240 --> 00:13:49,350
packless group. Same with these three
replicas storing Y. Um and we'll just

638
00:13:49,350 --> 00:13:49,360
replicas storing Y. Um and we'll just
 

639
00:13:49,360 --> 00:13:51,509
replicas storing Y. Um and we'll just
imagine that for each of these one of

640
00:13:51,509 --> 00:13:51,519
imagine that for each of these one of
 

641
00:13:51,519 --> 00:13:53,590
imagine that for each of these one of
the three servers is a leader. So let's

642
00:13:53,590 --> 00:13:53,600
the three servers is a leader. So let's
 

643
00:13:53,600 --> 00:13:56,069
the three servers is a leader. So let's
say the servant data center 2 is the

644
00:13:56,069 --> 00:13:56,079
say the servant data center 2 is the
 

645
00:13:56,079 --> 00:14:00,790
say the servant data center 2 is the
Paxo's leader for the X's shard and the

646
00:14:00,790 --> 00:14:00,800
Paxo's leader for the X's shard and the
 

647
00:14:00,800 --> 00:14:03,030
Paxo's leader for the X's shard and the
servant data center one is the Paxos

648
00:14:03,030 --> 00:14:03,040
servant data center one is the Paxos
 

649
00:14:03,040 --> 00:14:08,069
servant data center one is the Paxos
leader for uh Y's shard. Okay. So the

650
00:14:08,069 --> 00:14:08,079
leader for uh Y's shard. Okay. So the
 

651
00:14:08,079 --> 00:14:09,750
leader for uh Y's shard. Okay. So the
first thing that happens is that uh the

652
00:14:09,750 --> 00:14:09,760
first thing that happens is that uh the
 

653
00:14:09,760 --> 00:14:11,590
first thing that happens is that uh the
client picks a unique transaction ID

654
00:14:11,590 --> 00:14:11,600
client picks a unique transaction ID
 

655
00:14:11,600 --> 00:14:13,030
client picks a unique transaction ID
which is going to be carried on all

656
00:14:13,030 --> 00:14:13,040
which is going to be carried on all
 

657
00:14:13,040 --> 00:14:15,990
which is going to be carried on all
these uh messages so that the system

658
00:14:15,990 --> 00:14:16,000
these uh messages so that the system
 

659
00:14:16,000 --> 00:14:18,150
these uh messages so that the system
knows that um all the different

660
00:14:18,150 --> 00:14:18,160
knows that um all the different
 

661
00:14:18,160 --> 00:14:19,990
knows that um all the different
operations are associated with a single

662
00:14:19,990 --> 00:14:20,000
operations are associated with a single
 

663
00:14:20,000 --> 00:14:22,069
operations are associated with a single
transaction. First thing that is the

664
00:14:22,069 --> 00:14:22,079
transaction. First thing that is the
 

665
00:14:22,079 --> 00:14:24,629
transaction. First thing that is the
client has to read. So um despite the

666
00:14:24,629 --> 00:14:24,639
client has to read. So um despite the
 

667
00:14:24,639 --> 00:14:26,710
client has to read. So um despite the
way the code looks where it reads and

668
00:14:26,710 --> 00:14:26,720
way the code looks where it reads and
 

669
00:14:26,720 --> 00:14:29,910
way the code looks where it reads and
writes X and reads and write Y. In fact

670
00:14:29,910 --> 00:14:29,920
writes X and reads and write Y. In fact
 

671
00:14:29,920 --> 00:14:31,670
writes X and reads and write Y. In fact
um the way the code has transaction code

672
00:14:31,670 --> 00:14:31,680
um the way the code has transaction code
 

673
00:14:31,680 --> 00:14:33,030
um the way the code has transaction code
has to be organized. It has to do all

674
00:14:33,030 --> 00:14:33,040
has to be organized. It has to do all
 

675
00:14:33,040 --> 00:14:36,150
has to be organized. It has to do all
its reads first and then at the very end

676
00:14:36,150 --> 00:14:36,160
its reads first and then at the very end
 

677
00:14:36,160 --> 00:14:38,069
its reads first and then at the very end
do all the writes at the same time

678
00:14:38,069 --> 00:14:38,079
do all the writes at the same time
 

679
00:14:38,079 --> 00:14:42,150
do all the writes at the same time
essentially as part of the commit. Um so

680
00:14:42,150 --> 00:14:42,160
essentially as part of the commit. Um so
 

681
00:14:42,160 --> 00:14:44,230
essentially as part of the commit. Um so
the uh

682
00:14:44,230 --> 00:14:44,240
the uh
 

683
00:14:44,240 --> 00:14:46,310
the uh
the client has to do the reads. Um it

684
00:14:46,310 --> 00:14:46,320
the client has to do the reads. Um it
 

685
00:14:46,320 --> 00:14:49,910
the client has to do the reads. Um it
turns out that it um in order to

686
00:14:49,910 --> 00:14:49,920
turns out that it um in order to
 

687
00:14:49,920 --> 00:14:53,910
turns out that it um in order to
maintain locks since just as um as in

688
00:14:53,910 --> 00:14:53,920
maintain locks since just as um as in
 

689
00:14:53,920 --> 00:14:57,189
maintain locks since just as um as in
last week's 603 reading um every time

690
00:14:57,189 --> 00:14:57,199
last week's 603 reading um every time
 

691
00:14:57,199 --> 00:15:00,389
last week's 603 reading um every time
you read or write a data item the um

692
00:15:00,389 --> 00:15:00,399
you read or write a data item the um
 

693
00:15:00,399 --> 00:15:03,269
you read or write a data item the um
server responsible for it has to

694
00:15:03,269 --> 00:15:03,279
server responsible for it has to
 

695
00:15:03,279 --> 00:15:05,829
server responsible for it has to
associate a lock with that data item. Um

696
00:15:05,829 --> 00:15:05,839
associate a lock with that data item. Um
 

697
00:15:05,839 --> 00:15:08,790
associate a lock with that data item. Um
the locks are maintained the read locks

698
00:15:08,790 --> 00:15:08,800
the locks are maintained the read locks
 

699
00:15:08,800 --> 00:15:10,949
the locks are maintained the read locks
in spanner are maintained only in the

700
00:15:10,949 --> 00:15:10,959
in spanner are maintained only in the
 

701
00:15:10,959 --> 00:15:13,829
in spanner are maintained only in the
paxos leader. So uh when the client

702
00:15:13,829 --> 00:15:13,839
paxos leader. So uh when the client
 

703
00:15:13,839 --> 00:15:15,430
paxos leader. So uh when the client
transaction wants to readex, it sends a

704
00:15:15,430 --> 00:15:15,440
transaction wants to readex, it sends a
 

705
00:15:15,440 --> 00:15:21,269
transaction wants to readex, it sends a
redex request to um the leader of X's

706
00:15:21,269 --> 00:15:21,279
redex request to um the leader of X's
 

707
00:15:21,279 --> 00:15:24,150
redex request to um the leader of X's
shard and uh that leader of X's shard

708
00:15:24,150 --> 00:15:24,160
shard and uh that leader of X's shard
 

709
00:15:24,160 --> 00:15:26,710
shard and uh that leader of X's shard
returns the current value of X plus sets

710
00:15:26,710 --> 00:15:26,720
returns the current value of X plus sets
 

711
00:15:26,720 --> 00:15:28,790
returns the current value of X plus sets
a lock on X. Um and of course if the

712
00:15:28,790 --> 00:15:28,800
a lock on X. Um and of course if the
 

713
00:15:28,800 --> 00:15:30,629
a lock on X. Um and of course if the
lock's already set, then it won't

714
00:15:30,629 --> 00:15:30,639
lock's already set, then it won't
 

715
00:15:30,639 --> 00:15:32,710
lock's already set, then it won't
respond to the client until whatever

716
00:15:32,710 --> 00:15:32,720
respond to the client until whatever
 

717
00:15:32,720 --> 00:15:34,389
respond to the client until whatever
transaction currently has the data

718
00:15:34,389 --> 00:15:34,399
transaction currently has the data
 

719
00:15:34,399 --> 00:15:36,949
transaction currently has the data
locked releases the lock by committing.

720
00:15:36,949 --> 00:15:36,959
locked releases the lock by committing.
 

721
00:15:36,959 --> 00:15:40,230
locked releases the lock by committing.
Um, and then the leader for that shard

722
00:15:40,230 --> 00:15:40,240
Um, and then the leader for that shard
 

723
00:15:40,240 --> 00:15:42,069
Um, and then the leader for that shard
uh sends back the value of x to the

724
00:15:42,069 --> 00:15:42,079
uh sends back the value of x to the
 

725
00:15:42,079 --> 00:15:44,230
uh sends back the value of x to the
client. The client needs to read y. Got

726
00:15:44,230 --> 00:15:44,240
client. The client needs to read y. Got
 

727
00:15:44,240 --> 00:15:47,030
client. The client needs to read y. Got
lucky this time because the um assuming

728
00:15:47,030 --> 00:15:47,040
lucky this time because the um assuming
 

729
00:15:47,040 --> 00:15:49,269
lucky this time because the um assuming
the client's in data center one. The

730
00:15:49,269 --> 00:15:49,279
the client's in data center one. The
 

731
00:15:49,279 --> 00:15:51,509
the client's in data center one. The
leaders in the local

732
00:15:51,509 --> 00:15:51,519
leaders in the local
 

733
00:15:51,519 --> 00:15:52,870
leaders in the local
data center. So this read's going to be

734
00:15:52,870 --> 00:15:52,880
data center. So this read's going to be
 

735
00:15:52,880 --> 00:15:56,550
data center. So this read's going to be
a lot faster. Um the read sets the lock

736
00:15:56,550 --> 00:15:56,560
a lot faster. Um the read sets the lock
 

737
00:15:56,560 --> 00:15:59,430
a lot faster. Um the read sets the lock
on y in the paxos leader and then

738
00:15:59,430 --> 00:15:59,440
on y in the paxos leader and then
 

739
00:15:59,440 --> 00:16:01,110
on y in the paxos leader and then
returns. Okay. So now the client's done

740
00:16:01,110 --> 00:16:01,120
returns. Okay. So now the client's done
 

741
00:16:01,120 --> 00:16:02,790
returns. Okay. So now the client's done
all the reads. it does internal

742
00:16:02,790 --> 00:16:02,800
all the reads. it does internal
 

743
00:16:02,800 --> 00:16:04,389
all the reads. it does internal
computations and figures out the writes

744
00:16:04,389 --> 00:16:04,399
computations and figures out the writes
 

745
00:16:04,399 --> 00:16:06,550
computations and figures out the writes
it wants to do, what values it wants to

746
00:16:06,550 --> 00:16:06,560
it wants to do, what values it wants to
 

747
00:16:06,560 --> 00:16:09,910
it wants to do, what values it wants to
write to X and Y. Um, and so now the

748
00:16:09,910 --> 00:16:09,920
write to X and Y. Um, and so now the
 

749
00:16:09,920 --> 00:16:12,310
write to X and Y. Um, and so now the
client's going to send out the updated

750
00:16:12,310 --> 00:16:12,320
client's going to send out the updated
 

751
00:16:12,320 --> 00:16:16,069
client's going to send out the updated
values for the records um that it wants

752
00:16:16,069 --> 00:16:16,079
values for the records um that it wants
 

753
00:16:16,079 --> 00:16:18,949
values for the records um that it wants
to write and it does this all at once at

754
00:16:18,949 --> 00:16:18,959
to write and it does this all at once at
 

755
00:16:18,959 --> 00:16:20,310
to write and it does this all at once at
the end towards the end of the

756
00:16:20,310 --> 00:16:20,320
the end towards the end of the
 

757
00:16:20,320 --> 00:16:21,910
the end towards the end of the
transaction.

758
00:16:21,910 --> 00:16:21,920
transaction.
 

759
00:16:21,920 --> 00:16:23,990
transaction.
Um, so the first thing it does is it

760
00:16:23,990 --> 00:16:24,000
Um, so the first thing it does is it
 

761
00:16:24,000 --> 00:16:27,110
Um, so the first thing it does is it
chooses one of the Paxos groups to act

762
00:16:27,110 --> 00:16:27,120
chooses one of the Paxos groups to act
 

763
00:16:27,120 --> 00:16:29,670
chooses one of the Paxos groups to act
as the transaction coordinator.

764
00:16:29,670 --> 00:16:29,680
as the transaction coordinator.
 

765
00:16:29,680 --> 00:16:31,670
as the transaction coordinator.
um and it has to it chooses this in

766
00:16:31,670 --> 00:16:31,680
um and it has to it chooses this in
 

767
00:16:31,680 --> 00:16:33,350
um and it has to it chooses this in
advance and it's going to send out the

768
00:16:33,350 --> 00:16:33,360
advance and it's going to send out the
 

769
00:16:33,360 --> 00:16:36,069
advance and it's going to send out the
identity of the which Paxos group is

770
00:16:36,069 --> 00:16:36,079
identity of the which Paxos group is
 

771
00:16:36,079 --> 00:16:37,590
identity of the which Paxos group is
going to act as the transaction

772
00:16:37,590 --> 00:16:37,600
going to act as the transaction
 

773
00:16:37,600 --> 00:16:40,230
going to act as the transaction
coordinator. So let's assume it chooses

774
00:16:40,230 --> 00:16:40,240
coordinator. So let's assume it chooses
 

775
00:16:40,240 --> 00:16:42,710
coordinator. So let's assume it chooses
this Paxos group. I'll just put a double

776
00:16:42,710 --> 00:16:42,720
this Paxos group. I'll just put a double
 

777
00:16:42,720 --> 00:16:45,189
this Paxos group. I'll just put a double
box here to say that not only is this

778
00:16:45,189 --> 00:16:45,199
box here to say that not only is this
 

779
00:16:45,199 --> 00:16:47,269
box here to say that not only is this
server the leader of its Paxos group,

780
00:16:47,269 --> 00:16:47,279
server the leader of its Paxos group,
 

781
00:16:47,279 --> 00:16:48,629
server the leader of its Paxos group,
it's also acting as transaction

782
00:16:48,629 --> 00:16:48,639
it's also acting as transaction
 

783
00:16:48,639 --> 00:16:51,590
it's also acting as transaction
coordinator for this transaction. Then

784
00:16:51,590 --> 00:16:51,600
coordinator for this transaction. Then
 

785
00:16:51,600 --> 00:16:54,870
coordinator for this transaction. Then
the client sends out the um updated

786
00:16:54,870 --> 00:16:54,880
the client sends out the um updated
 

787
00:16:54,880 --> 00:16:56,629
the client sends out the um updated
values

788
00:16:56,629 --> 00:16:56,639
values
 

789
00:16:56,639 --> 00:16:58,310
values
that it wants to write. So it's going to

790
00:16:58,310 --> 00:16:58,320
that it wants to write. So it's going to
 

791
00:16:58,320 --> 00:17:01,670
that it wants to write. So it's going to
send a right x a right x request here

792
00:17:01,670 --> 00:17:01,680
send a right x a right x request here
 

793
00:17:01,680 --> 00:17:03,430
send a right x a right x request here
with a new value and the identity of the

794
00:17:03,430 --> 00:17:03,440
with a new value and the identity of the
 

795
00:17:03,440 --> 00:17:07,029
with a new value and the identity of the
transaction coordinator. Um

796
00:17:07,029 --> 00:17:07,039
transaction coordinator. Um
 

797
00:17:07,039 --> 00:17:10,549
transaction coordinator. Um
when each um the Paxos leader for each

798
00:17:10,549 --> 00:17:10,559
when each um the Paxos leader for each
 

799
00:17:10,559 --> 00:17:12,309
when each um the Paxos leader for each
written value receives the right

800
00:17:12,309 --> 00:17:12,319
written value receives the right
 

801
00:17:12,319 --> 00:17:16,309
written value receives the right
request, it um

802
00:17:16,309 --> 00:17:16,319
request, it um
 

803
00:17:16,319 --> 00:17:18,069
request, it um
uh

804
00:17:18,069 --> 00:17:18,079
uh
 

805
00:17:18,079 --> 00:17:22,069
uh
sends out a prepare message to its

806
00:17:22,069 --> 00:17:22,079
sends out a prepare message to its
 

807
00:17:22,079 --> 00:17:24,069
sends out a prepare message to its
followers and gets that into the Paxos

808
00:17:24,069 --> 00:17:24,079
followers and gets that into the Paxos
 

809
00:17:24,079 --> 00:17:27,189
followers and gets that into the Paxos
log. So that um I'll represent that by P

810
00:17:27,189 --> 00:17:27,199
log. So that um I'll represent that by P
 

811
00:17:27,199 --> 00:17:30,150
log. So that um I'll represent that by P
into the Paxus log because it's going to

812
00:17:30,150 --> 00:17:30,160
into the Paxus log because it's going to
 

813
00:17:30,160 --> 00:17:32,549
into the Paxus log because it's going to
commit to being able to or commit the

814
00:17:32,549 --> 00:17:32,559
commit to being able to or commit the
 

815
00:17:32,559 --> 00:17:34,470
commit to being able to or commit the
wrong word. it's promising to be able to

816
00:17:34,470 --> 00:17:34,480
wrong word. it's promising to be able to
 

817
00:17:34,480 --> 00:17:35,990
wrong word. it's promising to be able to
carry out this transaction that it

818
00:17:35,990 --> 00:17:36,000
carry out this transaction that it
 

819
00:17:36,000 --> 00:17:38,630
carry out this transaction that it
hasn't crashed for example and lost its

820
00:17:38,630 --> 00:17:38,640
hasn't crashed for example and lost its
 

821
00:17:38,640 --> 00:17:41,990
hasn't crashed for example and lost its
locks. Um so it sends out this prepare

822
00:17:41,990 --> 00:17:42,000
locks. Um so it sends out this prepare
 

823
00:17:42,000 --> 00:17:43,990
locks. Um so it sends out this prepare
message. It logs the prepare message

824
00:17:43,990 --> 00:17:44,000
message. It logs the prepare message
 

825
00:17:44,000 --> 00:17:46,390
message. It logs the prepare message
through Paxos when it gets a majority of

826
00:17:46,390 --> 00:17:46,400
through Paxos when it gets a majority of
 

827
00:17:46,400 --> 00:17:49,990
through Paxos when it gets a majority of
responses from the followers. Um

828
00:17:49,990 --> 00:17:50,000
responses from the followers. Um
 

829
00:17:50,000 --> 00:17:53,909
responses from the followers. Um
then this Paxos leader sends a yes to

830
00:17:53,909 --> 00:17:53,919
then this Paxos leader sends a yes to
 

831
00:17:53,919 --> 00:17:56,870
then this Paxos leader sends a yes to
the transaction coordinator saying yes

832
00:17:56,870 --> 00:17:56,880
the transaction coordinator saying yes
 

833
00:17:56,880 --> 00:17:58,789
the transaction coordinator saying yes
um I am promising to be able to carry

834
00:17:58,789 --> 00:17:58,799
um I am promising to be able to carry
 

835
00:17:58,799 --> 00:18:00,630
um I am promising to be able to carry
out my part of the transaction the right

836
00:18:00,630 --> 00:18:00,640
out my part of the transaction the right
 

837
00:18:00,640 --> 00:18:04,549
out my part of the transaction the right
to Y. Um

838
00:18:04,549 --> 00:18:04,559
to Y. Um
 

839
00:18:04,559 --> 00:18:07,830
to Y. Um
the and um notionally the transaction

840
00:18:07,830 --> 00:18:07,840
the and um notionally the transaction
 

841
00:18:07,840 --> 00:18:10,789
the and um notionally the transaction
the let's see the client also sends the

842
00:18:10,789 --> 00:18:10,799
the let's see the client also sends the
 

843
00:18:10,799 --> 00:18:13,909
the let's see the client also sends the
value to be written to Y

844
00:18:13,909 --> 00:18:13,919
value to be written to Y
 

845
00:18:13,919 --> 00:18:16,230
value to be written to Y
to um

846
00:18:16,230 --> 00:18:16,240
to um
 

847
00:18:16,240 --> 00:18:18,470
to um
uh Y's

848
00:18:18,470 --> 00:18:18,480
uh Y's
 

849
00:18:18,480 --> 00:18:21,830
uh Y's
Paxos leader and this server acting as

850
00:18:21,830 --> 00:18:21,840
Paxos leader and this server acting as
 

851
00:18:21,840 --> 00:18:26,230
Paxos leader and this server acting as
Paxos leader sends out prepare messages

852
00:18:26,230 --> 00:18:26,240
Paxos leader sends out prepare messages
 

853
00:18:26,240 --> 00:18:28,230
Paxos leader sends out prepare messages
um to his followers and logs it and

854
00:18:28,230 --> 00:18:28,240
um to his followers and logs it and
 

855
00:18:28,240 --> 00:18:30,710
um to his followers and logs it and
Paxos and waits for the acknowledgements

856
00:18:30,710 --> 00:18:30,720
Paxos and waits for the acknowledgements
 

857
00:18:30,720 --> 00:18:33,750
Paxos and waits for the acknowledgements
from majority already. Um and then you

858
00:18:33,750 --> 00:18:33,760
from majority already. Um and then you
 

859
00:18:33,760 --> 00:18:37,590
from majority already. Um and then you
can think of it as as the Paxos leaders

860
00:18:37,590 --> 00:18:37,600
can think of it as as the Paxos leaders
 

861
00:18:37,600 --> 00:18:39,590
can think of it as as the Paxos leaders
sending the

862
00:18:39,590 --> 00:18:39,600
sending the
 

863
00:18:39,600 --> 00:18:42,630
sending the
um transaction coordinator which is on

864
00:18:42,630 --> 00:18:42,640
um transaction coordinator which is on
 

865
00:18:42,640 --> 00:18:44,710
um transaction coordinator which is on
the same machine maybe the same program

866
00:18:44,710 --> 00:18:44,720
the same machine maybe the same program
 

867
00:18:44,720 --> 00:18:47,029
the same machine maybe the same program
a yes vote saying yes I can I can

868
00:18:47,029 --> 00:18:47,039
a yes vote saying yes I can I can
 

869
00:18:47,039 --> 00:18:49,029
a yes vote saying yes I can I can
commit. Okay. So when the transaction

870
00:18:49,029 --> 00:18:49,039
commit. Okay. So when the transaction
 

871
00:18:49,039 --> 00:18:50,870
commit. Okay. So when the transaction
coordinator

872
00:18:50,870 --> 00:18:50,880
coordinator
 

873
00:18:50,880 --> 00:18:53,350
coordinator
um gets responses from all the different

874
00:18:53,350 --> 00:18:53,360
um gets responses from all the different
 

875
00:18:53,360 --> 00:18:54,950
um gets responses from all the different
from the leaders of all the different

876
00:18:54,950 --> 00:18:54,960
from the leaders of all the different
 

877
00:18:54,960 --> 00:18:58,630
from the leaders of all the different
shards whose data um is involved in this

878
00:18:58,630 --> 00:18:58,640
shards whose data um is involved in this
 

879
00:18:58,640 --> 00:19:01,110
shards whose data um is involved in this
transaction. If they all said yes, then

880
00:19:01,110 --> 00:19:01,120
transaction. If they all said yes, then
 

881
00:19:01,120 --> 00:19:03,190
transaction. If they all said yes, then
the transaction coordinator can commit,

882
00:19:03,190 --> 00:19:03,200
the transaction coordinator can commit,
 

883
00:19:03,200 --> 00:19:07,430
the transaction coordinator can commit,
otherwise it can't. Um,

884
00:19:07,430 --> 00:19:07,440
otherwise it can't. Um,
 

885
00:19:07,440 --> 00:19:10,310
otherwise it can't. Um,
let's assume it decides to commit. Um,

886
00:19:10,310 --> 00:19:10,320
let's assume it decides to commit. Um,
 

887
00:19:10,320 --> 00:19:11,669
let's assume it decides to commit. Um,
at that point, the transaction

888
00:19:11,669 --> 00:19:11,679
at that point, the transaction
 

889
00:19:11,679 --> 00:19:15,750
at that point, the transaction
coordinator sends out um to the Paxos

890
00:19:15,750 --> 00:19:15,760
coordinator sends out um to the Paxos
 

891
00:19:15,760 --> 00:19:17,909
coordinator sends out um to the Paxos
followers a commit message saying,

892
00:19:17,909 --> 00:19:17,919
followers a commit message saying,
 

893
00:19:17,919 --> 00:19:20,070
followers a commit message saying,
"Look,

894
00:19:20,070 --> 00:19:20,080
"Look,
 

895
00:19:20,080 --> 00:19:22,630
"Look,
um, please remember that permanently in

896
00:19:22,630 --> 00:19:22,640
um, please remember that permanently in
 

897
00:19:22,640 --> 00:19:25,750
um, please remember that permanently in
the transaction log that um, we're

898
00:19:25,750 --> 00:19:25,760
the transaction log that um, we're
 

899
00:19:25,760 --> 00:19:29,270
the transaction log that um, we're
committing this transaction.

900
00:19:29,270 --> 00:19:29,280
committing this transaction.
 

901
00:19:29,280 --> 00:19:31,909
committing this transaction.
Um

902
00:19:31,909 --> 00:19:31,919
Um
 

903
00:19:31,919 --> 00:19:35,510
Um
and it also tells the um

904
00:19:35,510 --> 00:19:35,520
and it also tells the um
 

905
00:19:35,520 --> 00:19:37,350
and it also tells the um
leaders of the other Paxos groups

906
00:19:37,350 --> 00:19:37,360
leaders of the other Paxos groups
 

907
00:19:37,360 --> 00:19:40,070
leaders of the other Paxos groups
involved in the transaction then they

908
00:19:40,070 --> 00:19:40,080
involved in the transaction then they
 

909
00:19:40,080 --> 00:19:43,029
involved in the transaction then they
can commit as well. And so now um this

910
00:19:43,029 --> 00:19:43,039
can commit as well. And so now um this
 

911
00:19:43,039 --> 00:19:45,909
can commit as well. And so now um this
leader sends out commit messages to his

912
00:19:45,909 --> 00:19:45,919
leader sends out commit messages to his
 

913
00:19:45,919 --> 00:19:48,870
leader sends out commit messages to his
followers as well. as soon as the

914
00:19:48,870 --> 00:19:48,880
followers as well. as soon as the
 

915
00:19:48,880 --> 00:19:53,990
followers as well. as soon as the
commits are um

916
00:19:53,990 --> 00:19:54,000

 

917
00:19:54,000 --> 00:19:55,510

actually I think the leader the

918
00:19:55,510 --> 00:19:55,520
actually I think the leader the
 

919
00:19:55,520 --> 00:19:56,870
actually I think the leader the
transaction coordinator probably doesn't

920
00:19:56,870 --> 00:19:56,880
transaction coordinator probably doesn't
 

921
00:19:56,880 --> 00:19:58,549
transaction coordinator probably doesn't
send out the commit message to the other

922
00:19:58,549 --> 00:19:58,559
send out the commit message to the other
 

923
00:19:58,559 --> 00:20:01,190
send out the commit message to the other
shards until its commit is safe in the

924
00:20:01,190 --> 00:20:01,200
shards until its commit is safe in the
 

925
00:20:01,200 --> 00:20:02,870
shards until its commit is safe in the
log so that the transaction coordinator

926
00:20:02,870 --> 00:20:02,880
log so that the transaction coordinator
 

927
00:20:02,880 --> 00:20:04,630
log so that the transaction coordinator
is not guaranteed not to forget its

928
00:20:04,630 --> 00:20:04,640
is not guaranteed not to forget its
 

929
00:20:04,640 --> 00:20:08,390
is not guaranteed not to forget its
decision. Um once commits these commit

930
00:20:08,390 --> 00:20:08,400
decision. Um once commits these commit
 

931
00:20:08,400 --> 00:20:10,549
decision. Um once commits these commit
messages are committed into the Paxos

932
00:20:10,549 --> 00:20:10,559
messages are committed into the Paxos
 

933
00:20:10,559 --> 00:20:12,710
messages are committed into the Paxos
logs of the different shards, each of

934
00:20:12,710 --> 00:20:12,720
logs of the different shards, each of
 

935
00:20:12,720 --> 00:20:14,230
logs of the different shards, each of
those shards can actually execute the

936
00:20:14,230 --> 00:20:14,240
those shards can actually execute the
 

937
00:20:14,240 --> 00:20:17,750
those shards can actually execute the
rights that is place the written data um

938
00:20:17,750 --> 00:20:17,760
rights that is place the written data um
 

939
00:20:17,760 --> 00:20:20,950
rights that is place the written data um
and release the locks on

940
00:20:20,950 --> 00:20:20,960
and release the locks on
 

941
00:20:20,960 --> 00:20:23,190
and release the locks on
um the data items so that other

942
00:20:23,190 --> 00:20:23,200
um the data items so that other
 

943
00:20:23,200 --> 00:20:27,590
um the data items so that other
transactions can use them. Um

944
00:20:27,590 --> 00:20:27,600
transactions can use them. Um
 

945
00:20:27,600 --> 00:20:32,870
transactions can use them. Um
and then the transactions over.

946
00:20:32,870 --> 00:20:32,880

 

947
00:20:32,880 --> 00:20:36,310

So um first of all please feel free to

948
00:20:36,310 --> 00:20:36,320
So um first of all please feel free to
 

949
00:20:36,320 --> 00:20:39,750
So um first of all please feel free to
ask questions if uh um by raising your

950
00:20:39,750 --> 00:20:39,760
ask questions if uh um by raising your
 

951
00:20:39,760 --> 00:20:43,990
ask questions if uh um by raising your
hand if you if you have questions.

952
00:20:43,990 --> 00:20:44,000
hand if you if you have questions.
 

953
00:20:44,000 --> 00:20:46,789
hand if you if you have questions.
Okay. So there's some points um to

954
00:20:46,789 --> 00:20:46,799
Okay. So there's some points um to
 

955
00:20:46,799 --> 00:20:49,029
Okay. So there's some points um to
observe about the design so far which is

956
00:20:49,029 --> 00:20:49,039
observe about the design so far which is
 

957
00:20:49,039 --> 00:20:50,789
observe about the design so far which is
you know only covered the readr aspect

958
00:20:50,789 --> 00:20:50,799
you know only covered the readr aspect
 

959
00:20:50,799 --> 00:20:53,430
you know only covered the readr aspect
of transactions. One is that it's the

960
00:20:53,430 --> 00:20:53,440
of transactions. One is that it's the
 

961
00:20:53,440 --> 00:20:56,070
of transactions. One is that it's the
the locking that is ensuring

962
00:20:56,070 --> 00:20:56,080
the locking that is ensuring
 

963
00:20:56,080 --> 00:20:57,590
the locking that is ensuring
serializability.

964
00:20:57,590 --> 00:20:57,600
serializability.
 

965
00:20:57,600 --> 00:20:59,270
serializability.
that is if two transactions conflict

966
00:20:59,270 --> 00:20:59,280
that is if two transactions conflict
 

967
00:20:59,280 --> 00:21:01,669
that is if two transactions conflict
because they use the same data, one has

968
00:21:01,669 --> 00:21:01,679
because they use the same data, one has
 

969
00:21:01,679 --> 00:21:03,029
because they use the same data, one has
to completely wait for the other to

970
00:21:03,029 --> 00:21:03,039
to completely wait for the other to
 

971
00:21:03,039 --> 00:21:05,110
to completely wait for the other to
release it locks before it can proceed.

972
00:21:05,110 --> 00:21:05,120
release it locks before it can proceed.
 

973
00:21:05,120 --> 00:21:07,270
release it locks before it can proceed.
So it's using so Spanner is using

974
00:21:07,270 --> 00:21:07,280
So it's using so Spanner is using
 

975
00:21:07,280 --> 00:21:10,630
So it's using so Spanner is using
completely standard two-phase locking um

976
00:21:10,630 --> 00:21:10,640
completely standard two-phase locking um
 

977
00:21:10,640 --> 00:21:13,270
completely standard two-phase locking um
in order to get serializability

978
00:21:13,270 --> 00:21:13,280
in order to get serializability
 

979
00:21:13,280 --> 00:21:15,430
in order to get serializability
and completely standard two-phase commit

980
00:21:15,430 --> 00:21:15,440
and completely standard two-phase commit
 

981
00:21:15,440 --> 00:21:18,870
and completely standard two-phase commit
to get distributed transactions.

982
00:21:18,870 --> 00:21:18,880
to get distributed transactions.
 

983
00:21:18,880 --> 00:21:21,350
to get distributed transactions.
The two-face commits widely hated um

984
00:21:21,350 --> 00:21:21,360
The two-face commits widely hated um
 

985
00:21:21,360 --> 00:21:24,070
The two-face commits widely hated um
because if the transaction coordinator

986
00:21:24,070 --> 00:21:24,080
because if the transaction coordinator
 

987
00:21:24,080 --> 00:21:26,470
because if the transaction coordinator
should fail or become unreachable then

988
00:21:26,470 --> 00:21:26,480
should fail or become unreachable then
 

989
00:21:26,480 --> 00:21:29,430
should fail or become unreachable then
any transactions it was um managing

990
00:21:29,430 --> 00:21:29,440
any transactions it was um managing
 

991
00:21:29,440 --> 00:21:32,149
any transactions it was um managing
block indefinitely until the transaction

992
00:21:32,149 --> 00:21:32,159
block indefinitely until the transaction
 

993
00:21:32,159 --> 00:21:33,830
block indefinitely until the transaction
coordinator comes back up and they block

994
00:21:33,830 --> 00:21:33,840
coordinator comes back up and they block
 

995
00:21:33,840 --> 00:21:36,789
coordinator comes back up and they block
with locks held. So people have been in

996
00:21:36,789 --> 00:21:36,799
with locks held. So people have been in
 

997
00:21:36,799 --> 00:21:39,909
with locks held. So people have been in
general very reluctant to use two-phase

998
00:21:39,909 --> 00:21:39,919
general very reluctant to use two-phase
 

999
00:21:39,919 --> 00:21:41,750
general very reluctant to use two-phase
commit in the real world because it's

1000
00:21:41,750 --> 00:21:41,760
commit in the real world because it's
 

1001
00:21:41,760 --> 00:21:43,430
commit in the real world because it's
blocking.

1002
00:21:43,430 --> 00:21:43,440
blocking.
 

1003
00:21:43,440 --> 00:21:46,710
blocking.
Spanner solves this by replicating the

1004
00:21:46,710 --> 00:21:46,720
Spanner solves this by replicating the
 

1005
00:21:46,720 --> 00:21:48,310
Spanner solves this by replicating the
transaction manager. The transaction

1006
00:21:48,310 --> 00:21:48,320
transaction manager. The transaction
 

1007
00:21:48,320 --> 00:21:50,630
transaction manager. The transaction
manager itself is a Paxos replicated

1008
00:21:50,630 --> 00:21:50,640
manager itself is a Paxos replicated
 

1009
00:21:50,640 --> 00:21:53,110
manager itself is a Paxos replicated
state machine. So everything it does

1010
00:21:53,110 --> 00:21:53,120
state machine. So everything it does
 

1011
00:21:53,120 --> 00:21:55,590
state machine. So everything it does
like for example remember whether it's

1012
00:21:55,590 --> 00:21:55,600
like for example remember whether it's
 

1013
00:21:55,600 --> 00:21:57,830
like for example remember whether it's
committed or not is replicated into the

1014
00:21:57,830 --> 00:21:57,840
committed or not is replicated into the
 

1015
00:21:57,840 --> 00:22:01,510
committed or not is replicated into the
Paxos log. So if the uh leader here

1016
00:22:01,510 --> 00:22:01,520
Paxos log. So if the uh leader here
 

1017
00:22:01,520 --> 00:22:03,350
Paxos log. So if the uh leader here
fails

1018
00:22:03,350 --> 00:22:03,360
fails
 

1019
00:22:03,360 --> 00:22:04,950
fails
um even though it was managing the

1020
00:22:04,950 --> 00:22:04,960
um even though it was managing the
 

1021
00:22:04,960 --> 00:22:07,510
um even though it was managing the
transaction because it's raft replicated

1022
00:22:07,510 --> 00:22:07,520
transaction because it's raft replicated
 

1023
00:22:07,520 --> 00:22:10,390
transaction because it's raft replicated
either of these two replicas can spring

1024
00:22:10,390 --> 00:22:10,400
either of these two replicas can spring
 

1025
00:22:10,400 --> 00:22:12,630
either of these two replicas can spring
to life take over leadership and also

1026
00:22:12,630 --> 00:22:12,640
to life take over leadership and also
 

1027
00:22:12,640 --> 00:22:14,870
to life take over leadership and also
take over um being the transaction

1028
00:22:14,870 --> 00:22:14,880
take over um being the transaction
 

1029
00:22:14,880 --> 00:22:16,950
take over um being the transaction
manager and they'll have in their log if

1030
00:22:16,950 --> 00:22:16,960
manager and they'll have in their log if
 

1031
00:22:16,960 --> 00:22:18,710
manager and they'll have in their log if
the transaction manager decided to

1032
00:22:18,710 --> 00:22:18,720
the transaction manager decided to
 

1033
00:22:18,720 --> 00:22:20,950
the transaction manager decided to
commit. any leader that takes over will

1034
00:22:20,950 --> 00:22:20,960
commit. any leader that takes over will
 

1035
00:22:20,960 --> 00:22:23,510
commit. any leader that takes over will
see a commit in its log and be able to

1036
00:22:23,510 --> 00:22:23,520
see a commit in its log and be able to
 

1037
00:22:23,520 --> 00:22:26,310
see a commit in its log and be able to
then tell the other right away tell the

1038
00:22:26,310 --> 00:22:26,320
then tell the other right away tell the
 

1039
00:22:26,320 --> 00:22:28,230
then tell the other right away tell the
other um participants in the two-face

1040
00:22:28,230 --> 00:22:28,240
other um participants in the two-face
 

1041
00:22:28,240 --> 00:22:29,750
other um participants in the two-face
commit that look oh this transaction was

1042
00:22:29,750 --> 00:22:29,760
commit that look oh this transaction was
 

1043
00:22:29,760 --> 00:22:31,190
commit that look oh this transaction was
committed. So this effectively

1044
00:22:31,190 --> 00:22:31,200
committed. So this effectively
 

1045
00:22:31,200 --> 00:22:33,990
committed. So this effectively
eliminates the um

1046
00:22:33,990 --> 00:22:34,000
eliminates the um
 

1047
00:22:34,000 --> 00:22:35,669
eliminates the um
problem with two-face commit that it can

1048
00:22:35,669 --> 00:22:35,679
problem with two-face commit that it can
 

1049
00:22:35,679 --> 00:22:37,110
problem with two-face commit that it can
block with locks held if there's a

1050
00:22:37,110 --> 00:22:37,120
block with locks held if there's a
 

1051
00:22:37,120 --> 00:22:39,430
block with locks held if there's a
failure. Um and this is a really big

1052
00:22:39,430 --> 00:22:39,440
failure. Um and this is a really big
 

1053
00:22:39,440 --> 00:22:42,470
failure. Um and this is a really big
deal because this problem basically

1054
00:22:42,470 --> 00:22:42,480
deal because this problem basically
 

1055
00:22:42,480 --> 00:22:43,909
deal because this problem basically
makes two-face commit otherwise

1056
00:22:43,909 --> 00:22:43,919
makes two-face commit otherwise
 

1057
00:22:43,919 --> 00:22:45,830
makes two-face commit otherwise
completely unacceptable for any sort of

1058
00:22:45,830 --> 00:22:45,840
completely unacceptable for any sort of
 

1059
00:22:45,840 --> 00:22:47,750
completely unacceptable for any sort of
large scale system that has a lot of

1060
00:22:47,750 --> 00:22:47,760
large scale system that has a lot of
 

1061
00:22:47,760 --> 00:22:49,590
large scale system that has a lot of
parts that might fail.

1062
00:22:49,590 --> 00:22:49,600
parts that might fail.
 

1063
00:22:49,600 --> 00:22:51,430
parts that might fail.
The other another thing to note is that

1064
00:22:51,430 --> 00:22:51,440
The other another thing to note is that
 

1065
00:22:51,440 --> 00:22:55,590
The other another thing to note is that
there's a huge amount of messages on um

1066
00:22:55,590 --> 00:22:55,600
there's a huge amount of messages on um
 

1067
00:22:55,600 --> 00:22:59,510
there's a huge amount of messages on um
in this diagram here. Um and that means

1068
00:22:59,510 --> 00:22:59,520
in this diagram here. Um and that means
 

1069
00:22:59,520 --> 00:23:01,830
in this diagram here. Um and that means
and many of them are across data

1070
00:23:01,830 --> 00:23:01,840
and many of them are across data
 

1071
00:23:01,840 --> 00:23:03,750
and many of them are across data
centers. And so some of these messages

1072
00:23:03,750 --> 00:23:03,760
centers. And so some of these messages
 

1073
00:23:03,760 --> 00:23:05,830
centers. And so some of these messages
that go between the shards or between a

1074
00:23:05,830 --> 00:23:05,840
that go between the shards or between a
 

1075
00:23:05,840 --> 00:23:07,590
that go between the shards or between a
client and the shard whose leader is

1076
00:23:07,590 --> 00:23:07,600
client and the shard whose leader is
 

1077
00:23:07,600 --> 00:23:09,350
client and the shard whose leader is
another data center may take many

1078
00:23:09,350 --> 00:23:09,360
another data center may take many
 

1079
00:23:09,360 --> 00:23:12,470
another data center may take many
milliseconds. Um and in a world in which

1080
00:23:12,470 --> 00:23:12,480
milliseconds. Um and in a world in which
 

1081
00:23:12,480 --> 00:23:16,149
milliseconds. Um and in a world in which
you know computations take nanconds this

1082
00:23:16,149 --> 00:23:16,159
you know computations take nanconds this
 

1083
00:23:16,159 --> 00:23:19,990
you know computations take nanconds this
is uh a potentially pretty grim expense.

1084
00:23:19,990 --> 00:23:20,000
is uh a potentially pretty grim expense.
 

1085
00:23:20,000 --> 00:23:22,549
is uh a potentially pretty grim expense.
Um

1086
00:23:22,549 --> 00:23:22,559
Um
 

1087
00:23:22,559 --> 00:23:25,029
Um
and indeed you can see that in from in

1088
00:23:25,029 --> 00:23:25,039
and indeed you can see that in from in
 

1089
00:23:25,039 --> 00:23:27,750
and indeed you can see that in from in
table six and table six if you look at

1090
00:23:27,750 --> 00:23:27,760
table six and table six if you look at
 

1091
00:23:27,760 --> 00:23:30,549
table six and table six if you look at
it it's describing the performance of a

1092
00:23:30,549 --> 00:23:30,559
it it's describing the performance of a
 

1093
00:23:30,559 --> 00:23:32,070
it it's describing the performance of a
um

1094
00:23:32,070 --> 00:23:32,080
um
 

1095
00:23:32,080 --> 00:23:33,510
um
Spanner deployment where the different

1096
00:23:33,510 --> 00:23:33,520
Spanner deployment where the different
 

1097
00:23:33,520 --> 00:23:35,190
Spanner deployment where the different
replicas are on different sides of the

1098
00:23:35,190 --> 00:23:35,200
replicas are on different sides of the
 

1099
00:23:35,200 --> 00:23:37,990
replicas are on different sides of the
United States east and west coast and um

1100
00:23:37,990 --> 00:23:38,000
United States east and west coast and um
 

1101
00:23:38,000 --> 00:23:40,549
United States east and west coast and um
it takes about a 100 milliseconds to do

1102
00:23:40,549 --> 00:23:40,559
it takes about a 100 milliseconds to do
 

1103
00:23:40,559 --> 00:23:44,070
it takes about a 100 milliseconds to do
a um complete a transaction where the

1104
00:23:44,070 --> 00:23:44,080
a um complete a transaction where the
 

1105
00:23:44,080 --> 00:23:45,990
a um complete a transaction where the
different replicas involved are on

1106
00:23:45,990 --> 00:23:46,000
different replicas involved are on
 

1107
00:23:46,000 --> 00:23:47,590
different replicas involved are on
different coasts. That's a huge amount

1108
00:23:47,590 --> 00:23:47,600
different coasts. That's a huge amount
 

1109
00:23:47,600 --> 00:23:50,070
different coasts. That's a huge amount
of time. That's a tenth of a second. Um

1110
00:23:50,070 --> 00:23:50,080
of time. That's a tenth of a second. Um
 

1111
00:23:50,080 --> 00:23:51,669
of time. That's a tenth of a second. Um
it's maybe not quite as bad as it may

1112
00:23:51,669 --> 00:23:51,679
it's maybe not quite as bad as it may
 

1113
00:23:51,679 --> 00:23:53,029
it's maybe not quite as bad as it may
seem because the throughput of the

1114
00:23:53,029 --> 00:23:53,039
seem because the throughput of the
 

1115
00:23:53,039 --> 00:23:55,510
seem because the throughput of the
system since it's sharded and it can run

1116
00:23:55,510 --> 00:23:55,520
system since it's sharded and it can run
 

1117
00:23:55,520 --> 00:23:57,430
system since it's sharded and it can run
a lot of non-conlicting transactions in

1118
00:23:57,430 --> 00:23:57,440
a lot of non-conlicting transactions in
 

1119
00:23:57,440 --> 00:23:59,270
a lot of non-conlicting transactions in
parallel the throughput may be very hard

1120
00:23:59,270 --> 00:23:59,280
parallel the throughput may be very hard
 

1121
00:23:59,280 --> 00:24:02,310
parallel the throughput may be very hard
high um but the delay for individual

1122
00:24:02,310 --> 00:24:02,320
high um but the delay for individual
 

1123
00:24:02,320 --> 00:24:03,990
high um but the delay for individual
transactions very significant I mean 100

1124
00:24:03,990 --> 00:24:04,000
transactions very significant I mean 100
 

1125
00:24:04,000 --> 00:24:06,070
transactions very significant I mean 100
milliseconds is maybe somewhat less than

1126
00:24:06,070 --> 00:24:06,080
milliseconds is maybe somewhat less than
 

1127
00:24:06,080 --> 00:24:07,430
milliseconds is maybe somewhat less than
a human is going to notice but if you

1128
00:24:07,430 --> 00:24:07,440
a human is going to notice but if you
 

1129
00:24:07,440 --> 00:24:10,149
a human is going to notice but if you
have to do a couple of them um to say

1130
00:24:10,149 --> 00:24:10,159
have to do a couple of them um to say
 

1131
00:24:10,159 --> 00:24:12,070
have to do a couple of them um to say
generate a web page or carry out a human

1132
00:24:12,070 --> 00:24:12,080
generate a web page or carry out a human
 

1133
00:24:12,080 --> 00:24:13,590
generate a web page or carry out a human
instruction it's starting to be an

1134
00:24:13,590 --> 00:24:13,600
instruction it's starting to be an
 

1135
00:24:13,600 --> 00:24:15,830
instruction it's starting to be an
amount of time that will be noticeable

1136
00:24:15,830 --> 00:24:15,840
amount of time that will be noticeable
 

1137
00:24:15,840 --> 00:24:19,350
amount of time that will be noticeable
and start to be bothering bothersome Um

1138
00:24:19,350 --> 00:24:19,360
and start to be bothering bothersome Um
 

1139
00:24:19,360 --> 00:24:21,350
and start to be bothering bothersome Um
on the other hand for I think I suspect

1140
00:24:21,350 --> 00:24:21,360
on the other hand for I think I suspect
 

1141
00:24:21,360 --> 00:24:23,990
on the other hand for I think I suspect
for many uses of Spanner all the

1142
00:24:23,990 --> 00:24:24,000
for many uses of Spanner all the
 

1143
00:24:24,000 --> 00:24:27,110
for many uses of Spanner all the
replicas might be in um in the same city

1144
00:24:27,110 --> 00:24:27,120
replicas might be in um in the same city
 

1145
00:24:27,120 --> 00:24:29,590
replicas might be in um in the same city
or sort of across town and there the

1146
00:24:29,590 --> 00:24:29,600
or sort of across town and there the
 

1147
00:24:29,600 --> 00:24:31,110
or sort of across town and there the
much faster times that you can see in

1148
00:24:31,110 --> 00:24:31,120
much faster times that you can see in
 

1149
00:24:31,120 --> 00:24:33,669
much faster times that you can see in
table three um are relevant and there

1150
00:24:33,669 --> 00:24:33,679
table three um are relevant and there
 

1151
00:24:33,679 --> 00:24:36,230
table three um are relevant and there
it's table three shows that it can um

1152
00:24:36,230 --> 00:24:36,240
it's table three shows that it can um
 

1153
00:24:36,240 --> 00:24:37,909
it's table three shows that it can um
complete transactions where the data

1154
00:24:37,909 --> 00:24:37,919
complete transactions where the data
 

1155
00:24:37,919 --> 00:24:40,390
complete transactions where the data
centers are nearby in you know I think

1156
00:24:40,390 --> 00:24:40,400
centers are nearby in you know I think
 

1157
00:24:40,400 --> 00:24:42,630
centers are nearby in you know I think
it's 14 milliseconds instead of 100

1158
00:24:42,630 --> 00:24:42,640
it's 14 milliseconds instead of 100
 

1159
00:24:42,640 --> 00:24:45,110
it's 14 milliseconds instead of 100
milliseconds so that's not quite so bad.

1160
00:24:45,110 --> 00:24:45,120
milliseconds so that's not quite so bad.
 

1161
00:24:45,120 --> 00:24:47,750
milliseconds so that's not quite so bad.
Um, nevertheless, these read write

1162
00:24:47,750 --> 00:24:47,760
Um, nevertheless, these read write
 

1163
00:24:47,760 --> 00:24:50,710
Um, nevertheless, these read write
transactions are slow enough that we

1164
00:24:50,710 --> 00:24:50,720
transactions are slow enough that we
 

1165
00:24:50,720 --> 00:24:54,310
transactions are slow enough that we
like to avoid um the expense if we

1166
00:24:54,310 --> 00:24:54,320
like to avoid um the expense if we
 

1167
00:24:54,320 --> 00:24:56,470
like to avoid um the expense if we
possibly can.

1168
00:24:56,470 --> 00:24:56,480
possibly can.
 

1169
00:24:56,480 --> 00:24:58,149
possibly can.
Um, and so that's going to take us to

1170
00:24:58,149 --> 00:24:58,159
Um, and so that's going to take us to
 

1171
00:24:58,159 --> 00:24:59,669
Um, and so that's going to take us to
read only transactions. It turns out

1172
00:24:59,669 --> 00:24:59,679
read only transactions. It turns out
 

1173
00:24:59,679 --> 00:25:01,430
read only transactions. It turns out
that if you're not writing, that is if

1174
00:25:01,430 --> 00:25:01,440
that if you're not writing, that is if
 

1175
00:25:01,440 --> 00:25:03,750
that if you're not writing, that is if
you know in advance that all of the

1176
00:25:03,750 --> 00:25:03,760
you know in advance that all of the
 

1177
00:25:03,760 --> 00:25:05,430
you know in advance that all of the
operations in a transaction are

1178
00:25:05,430 --> 00:25:05,440
operations in a transaction are
 

1179
00:25:05,440 --> 00:25:08,149
operations in a transaction are
guaranteed to be reads, then Spanner has

1180
00:25:08,149 --> 00:25:08,159
guaranteed to be reads, then Spanner has
 

1181
00:25:08,159 --> 00:25:10,149
guaranteed to be reads, then Spanner has
a much faster, much more streamlined,

1182
00:25:10,149 --> 00:25:10,159
a much faster, much more streamlined,
 

1183
00:25:10,159 --> 00:25:13,510
a much faster, much more streamlined,
much less meth message intensive scheme

1184
00:25:13,510 --> 00:25:13,520
much less meth message intensive scheme
 

1185
00:25:13,520 --> 00:25:20,470
much less meth message intensive scheme
um for executing readonly transactions.

1186
00:25:20,470 --> 00:25:20,480

 

1187
00:25:20,480 --> 00:25:28,149

Okay. So, so readonly transactions um

1188
00:25:28,149 --> 00:25:28,159

 

1189
00:25:28,159 --> 00:25:29,590

start a new topic here. The read only

1190
00:25:29,590 --> 00:25:29,600
start a new topic here. The read only
 

1191
00:25:29,600 --> 00:25:32,070
start a new topic here. The read only
transactions work although they rely on

1192
00:25:32,070 --> 00:25:32,080
transactions work although they rely on
 

1193
00:25:32,080 --> 00:25:33,269
transactions work although they rely on
some information from readwrite

1194
00:25:33,269 --> 00:25:33,279
some information from readwrite
 

1195
00:25:33,279 --> 00:25:35,269
some information from readwrite
transactions. The design is quite

1196
00:25:35,269 --> 00:25:35,279
transactions. The design is quite
 

1197
00:25:35,279 --> 00:25:37,909
transactions. The design is quite
different from

1198
00:25:37,909 --> 00:25:37,919
different from
 

1199
00:25:37,919 --> 00:25:43,750
different from
um the read the readwrite transactions.

1200
00:25:43,750 --> 00:25:43,760

 

1201
00:25:43,760 --> 00:25:47,830

Um and Spanner eliminates two big costs

1202
00:25:47,830 --> 00:25:47,840
Um and Spanner eliminates two big costs
 

1203
00:25:47,840 --> 00:25:50,789
Um and Spanner eliminates two big costs
um in its readonly transaction design.

1204
00:25:50,789 --> 00:25:50,799
um in its readonly transaction design.
 

1205
00:25:50,799 --> 00:25:52,710
um in its readonly transaction design.
Eliminates two of the costs that were

1206
00:25:52,710 --> 00:25:52,720
Eliminates two of the costs that were
 

1207
00:25:52,720 --> 00:25:54,149
Eliminates two of the costs that were
present in readwrite transactions. First

1208
00:25:54,149 --> 00:25:54,159
present in readwrite transactions. First
 

1209
00:25:54,159 --> 00:25:56,230
present in readwrite transactions. First
of all, as I mentioned, it reads from

1210
00:25:56,230 --> 00:25:56,240
of all, as I mentioned, it reads from
 

1211
00:25:56,240 --> 00:26:00,070
of all, as I mentioned, it reads from
local replicas. Um and so if you have a

1212
00:26:00,070 --> 00:26:00,080
local replicas. Um and so if you have a
 

1213
00:26:00,080 --> 00:26:01,669
local replicas. Um and so if you have a
replica as long as there's a replica the

1214
00:26:01,669 --> 00:26:01,679
replica as long as there's a replica the
 

1215
00:26:01,679 --> 00:26:03,669
replica as long as there's a replica the
data the client needs the transaction

1216
00:26:03,669 --> 00:26:03,679
data the client needs the transaction
 

1217
00:26:03,679 --> 00:26:05,430
data the client needs the transaction
needs in the local data center you can

1218
00:26:05,430 --> 00:26:05,440
needs in the local data center you can
 

1219
00:26:05,440 --> 00:26:07,190
needs in the local data center you can
do the read and uh from that local

1220
00:26:07,190 --> 00:26:07,200
do the read and uh from that local
 

1221
00:26:07,200 --> 00:26:09,029
do the read and uh from that local
replica which may take a small fraction

1222
00:26:09,029 --> 00:26:09,039
replica which may take a small fraction
 

1223
00:26:09,039 --> 00:26:11,590
replica which may take a small fraction
of a m millisecond to talk to instead of

1224
00:26:11,590 --> 00:26:11,600
of a m millisecond to talk to instead of
 

1225
00:26:11,600 --> 00:26:13,830
of a m millisecond to talk to instead of
maybe dozens of of milliseconds if you

1226
00:26:13,830 --> 00:26:13,840
maybe dozens of of milliseconds if you
 

1227
00:26:13,840 --> 00:26:15,510
maybe dozens of of milliseconds if you
have to go cross country. So it can read

1228
00:26:15,510 --> 00:26:15,520
have to go cross country. So it can read
 

1229
00:26:15,520 --> 00:26:17,990
have to go cross country. So it can read
from local replicas. Um but note you

1230
00:26:17,990 --> 00:26:18,000
from local replicas. Um but note you
 

1231
00:26:18,000 --> 00:26:20,310
from local replicas. Um but note you
know again the danger here is that any

1232
00:26:20,310 --> 00:26:20,320
know again the danger here is that any
 

1233
00:26:20,320 --> 00:26:22,630
know again the danger here is that any
given replica may not be up to date. Um

1234
00:26:22,630 --> 00:26:22,640
given replica may not be up to date. Um
 

1235
00:26:22,640 --> 00:26:25,350
given replica may not be up to date. Um
so there has to be a story for that.

1236
00:26:25,350 --> 00:26:25,360
so there has to be a story for that.
 

1237
00:26:25,360 --> 00:26:27,750
so there has to be a story for that.
And the other big um savings in the

1238
00:26:27,750 --> 00:26:27,760
And the other big um savings in the
 

1239
00:26:27,760 --> 00:26:29,990
And the other big um savings in the
readonly design is that it doesn't use

1240
00:26:29,990 --> 00:26:30,000
readonly design is that it doesn't use
 

1241
00:26:30,000 --> 00:26:32,390
readonly design is that it doesn't use
locks. It doesn't use two-face commit.

1242
00:26:32,390 --> 00:26:32,400
locks. It doesn't use two-face commit.
 

1243
00:26:32,400 --> 00:26:34,070
locks. It doesn't use two-face commit.
Um and it doesn't need a transaction

1244
00:26:34,070 --> 00:26:34,080
Um and it doesn't need a transaction
 

1245
00:26:34,080 --> 00:26:35,750
Um and it doesn't need a transaction
manager.

1246
00:26:35,750 --> 00:26:35,760
manager.
 

1247
00:26:35,760 --> 00:26:37,830
manager.
Um and this avoids things like cross

1248
00:26:37,830 --> 00:26:37,840
Um and this avoids things like cross
 

1249
00:26:37,840 --> 00:26:39,750
Um and this avoids things like cross
data center or inter data center

1250
00:26:39,750 --> 00:26:39,760
data center or inter data center
 

1251
00:26:39,760 --> 00:26:43,110
data center or inter data center
messages uh to Paxos leaders. Um and

1252
00:26:43,110 --> 00:26:43,120
messages uh to Paxos leaders. Um and
 

1253
00:26:43,120 --> 00:26:44,630
messages uh to Paxos leaders. Um and
because no locks are taken out, not only

1254
00:26:44,630 --> 00:26:44,640
because no locks are taken out, not only
 

1255
00:26:44,640 --> 00:26:46,230
because no locks are taken out, not only
does that make the readonly transactions

1256
00:26:46,230 --> 00:26:46,240
does that make the readonly transactions
 

1257
00:26:46,240 --> 00:26:48,549
does that make the readonly transactions
faster, but it avoids slowing down read

1258
00:26:48,549 --> 00:26:48,559
faster, but it avoids slowing down read
 

1259
00:26:48,559 --> 00:26:50,310
faster, but it avoids slowing down read
only read write transactions because

1260
00:26:50,310 --> 00:26:50,320
only read write transactions because
 

1261
00:26:50,320 --> 00:26:52,310
only read write transactions because
they don't have to rate for locks held

1262
00:26:52,310 --> 00:26:52,320
they don't have to rate for locks held
 

1263
00:26:52,320 --> 00:26:54,710
they don't have to rate for locks held
by readonly transactions. Um and just to

1264
00:26:54,710 --> 00:26:54,720
by readonly transactions. Um and just to
 

1265
00:26:54,720 --> 00:26:57,110
by readonly transactions. Um and just to
kind of preview why this is important to

1266
00:26:57,110 --> 00:26:57,120
kind of preview why this is important to
 

1267
00:26:57,120 --> 00:27:00,470
kind of preview why this is important to
them, uh tables three and six show a 10

1268
00:27:00,470 --> 00:27:00,480
them, uh tables three and six show a 10
 

1269
00:27:00,480 --> 00:27:03,430
them, uh tables three and six show a 10
times latency improvement for readonly

1270
00:27:03,430 --> 00:27:03,440
times latency improvement for readonly
 

1271
00:27:03,440 --> 00:27:05,190
times latency improvement for readonly
transactions compared to readwrite

1272
00:27:05,190 --> 00:27:05,200
transactions compared to readwrite
 

1273
00:27:05,200 --> 00:27:08,950
transactions compared to readwrite
transactions. Um so the readonly design

1274
00:27:08,950 --> 00:27:08,960
transactions. Um so the readonly design
 

1275
00:27:08,960 --> 00:27:11,430
transactions. Um so the readonly design
gets them a factor of 10 boost in

1276
00:27:11,430 --> 00:27:11,440
gets them a factor of 10 boost in
 

1277
00:27:11,440 --> 00:27:13,029
gets them a factor of 10 boost in
latency.

1278
00:27:13,029 --> 00:27:13,039
latency.
 

1279
00:27:13,039 --> 00:27:14,710
latency.
Um and then much less complexity. So

1280
00:27:14,710 --> 00:27:14,720
Um and then much less complexity. So
 

1281
00:27:14,720 --> 00:27:16,390
Um and then much less complexity. So
almost certainly far more throughput as

1282
00:27:16,390 --> 00:27:16,400
almost certainly far more throughput as
 

1283
00:27:16,400 --> 00:27:18,149
almost certainly far more throughput as
well. And the big challenge is going to

1284
00:27:18,149 --> 00:27:18,159
well. And the big challenge is going to
 

1285
00:27:18,159 --> 00:27:20,630
well. And the big challenge is going to
be how to square the uh you know realign

1286
00:27:20,630 --> 00:27:20,640
be how to square the uh you know realign
 

1287
00:27:20,640 --> 00:27:21,990
be how to square the uh you know realign
transactions don't do a lot of things

1288
00:27:21,990 --> 00:27:22,000
transactions don't do a lot of things
 

1289
00:27:22,000 --> 00:27:24,230
transactions don't do a lot of things
that were require required on read read

1290
00:27:24,230 --> 00:27:24,240
that were require required on read read
 

1291
00:27:24,240 --> 00:27:27,110
that were require required on read read
transactions to get serializability. Um

1292
00:27:27,110 --> 00:27:27,120
transactions to get serializability. Um
 

1293
00:27:27,120 --> 00:27:29,269
transactions to get serializability. Um
so we need to f uh they needed to find a

1294
00:27:29,269 --> 00:27:29,279
so we need to f uh they needed to find a
 

1295
00:27:29,279 --> 00:27:31,669
so we need to f uh they needed to find a
way to kind of square this increased

1296
00:27:31,669 --> 00:27:31,679
way to kind of square this increased
 

1297
00:27:31,679 --> 00:27:35,590
way to kind of square this increased
efficiency with correctness. Um and so

1298
00:27:35,590 --> 00:27:35,600
efficiency with correctness. Um and so
 

1299
00:27:35,600 --> 00:27:38,310
efficiency with correctness. Um and so
there's really two uh main correctness

1300
00:27:38,310 --> 00:27:38,320
there's really two uh main correctness
 

1301
00:27:38,320 --> 00:27:41,430
there's really two uh main correctness
constraints that they wanted to um have

1302
00:27:41,430 --> 00:27:41,440
constraints that they wanted to um have
 

1303
00:27:41,440 --> 00:27:43,350
constraints that they wanted to um have
read only transactions imposed. The

1304
00:27:43,350 --> 00:27:43,360
read only transactions imposed. The
 

1305
00:27:43,360 --> 00:27:46,070
read only transactions imposed. The
first is that they like all transactions

1306
00:27:46,070 --> 00:27:46,080
first is that they like all transactions
 

1307
00:27:46,080 --> 00:27:48,390
first is that they like all transactions
they still need to be serializable.

1308
00:27:48,390 --> 00:27:48,400
they still need to be serializable.
 

1309
00:27:48,400 --> 00:27:53,430
they still need to be serializable.
Um and what that means is that um even

1310
00:27:53,430 --> 00:27:53,440
Um and what that means is that um even
 

1311
00:27:53,440 --> 00:27:56,310
Um and what that means is that um even
though just to review even though uh the

1312
00:27:56,310 --> 00:27:56,320
though just to review even though uh the
 

1313
00:27:56,320 --> 00:27:58,789
though just to review even though uh the
system may execute transactions

1314
00:27:58,789 --> 00:27:58,799
system may execute transactions
 

1315
00:27:58,799 --> 00:28:01,909
system may execute transactions
concurrently in parallel um the results

1316
00:28:01,909 --> 00:28:01,919
concurrently in parallel um the results
 

1317
00:28:01,919 --> 00:28:04,470
concurrently in parallel um the results
that a bunch of concurrent transactions

1318
00:28:04,470 --> 00:28:04,480
that a bunch of concurrent transactions
 

1319
00:28:04,480 --> 00:28:06,870
that a bunch of concurrent transactions
must yield both in terms of sort of

1320
00:28:06,870 --> 00:28:06,880
must yield both in terms of sort of
 

1321
00:28:06,880 --> 00:28:08,389
must yield both in terms of sort of
values that they return to the client

1322
00:28:08,389 --> 00:28:08,399
values that they return to the client
 

1323
00:28:08,399 --> 00:28:10,789
values that they return to the client
and modifications to the database. the

1324
00:28:10,789 --> 00:28:10,799
and modifications to the database. the
 

1325
00:28:10,799 --> 00:28:12,310
and modifications to the database. the
results of a bunch of concurrence

1326
00:28:12,310 --> 00:28:12,320
results of a bunch of concurrence
 

1327
00:28:12,320 --> 00:28:15,110
results of a bunch of concurrence
transactions must be the same as some

1328
00:28:15,110 --> 00:28:15,120
transactions must be the same as some
 

1329
00:28:15,120 --> 00:28:19,669
transactions must be the same as some
one at a time or serial u execution of

1330
00:28:19,669 --> 00:28:19,679
one at a time or serial u execution of
 

1331
00:28:19,679 --> 00:28:21,830
one at a time or serial u execution of
those transactions.

1332
00:28:21,830 --> 00:28:21,840
those transactions.
 

1333
00:28:21,840 --> 00:28:24,549
those transactions.
Um, and for readonly transactions, what

1334
00:28:24,549 --> 00:28:24,559
Um, and for readonly transactions, what
 

1335
00:28:24,559 --> 00:28:27,029
Um, and for readonly transactions, what
that essentially means is that the an

1336
00:28:27,029 --> 00:28:27,039
that essentially means is that the an
 

1337
00:28:27,039 --> 00:28:29,190
that essentially means is that the an
entire all the reads of a readonly

1338
00:28:29,190 --> 00:28:29,200
entire all the reads of a readonly
 

1339
00:28:29,200 --> 00:28:31,669
entire all the reads of a readonly
transaction must effectively fit neatly

1340
00:28:31,669 --> 00:28:31,679
transaction must effectively fit neatly
 

1341
00:28:31,679 --> 00:28:34,950
transaction must effectively fit neatly
between um all the rights of a bunch of

1342
00:28:34,950 --> 00:28:34,960
between um all the rights of a bunch of
 

1343
00:28:34,960 --> 00:28:37,830
between um all the rights of a bunch of
transactions that um can be viewed as

1344
00:28:37,830 --> 00:28:37,840
transactions that um can be viewed as
 

1345
00:28:37,840 --> 00:28:40,710
transactions that um can be viewed as
going before it and and it must not see

1346
00:28:40,710 --> 00:28:40,720
going before it and and it must not see
 

1347
00:28:40,720 --> 00:28:42,470
going before it and and it must not see
any of the rights of the transactions

1348
00:28:42,470 --> 00:28:42,480
any of the rights of the transactions
 

1349
00:28:42,480 --> 00:28:44,389
any of the rights of the transactions
that we're going to view as as going

1350
00:28:44,389 --> 00:28:44,399
that we're going to view as as going
 

1351
00:28:44,399 --> 00:28:46,070
that we're going to view as as going
after it. So we need a way to sort of

1352
00:28:46,070 --> 00:28:46,080
after it. So we need a way to sort of
 

1353
00:28:46,080 --> 00:28:47,830
after it. So we need a way to sort of
fit the read all the reads of a

1354
00:28:47,830 --> 00:28:47,840
fit the read all the reads of a
 

1355
00:28:47,840 --> 00:28:49,669
fit the read all the reads of a
transaction read only transaction kind

1356
00:28:49,669 --> 00:28:49,679
transaction read only transaction kind
 

1357
00:28:49,679 --> 00:28:53,909
transaction read only transaction kind
of neatly between readrs.

1358
00:28:53,909 --> 00:28:53,919
of neatly between readrs.
 

1359
00:28:53,919 --> 00:28:55,990
of neatly between readrs.
Um

1360
00:28:55,990 --> 00:28:56,000
Um
 

1361
00:28:56,000 --> 00:28:59,590
Um
the other big uh constraint that the

1362
00:28:59,590 --> 00:28:59,600
the other big uh constraint that the
 

1363
00:28:59,600 --> 00:29:01,029
the other big uh constraint that the
paper talks about is that they want

1364
00:29:01,029 --> 00:29:01,039
paper talks about is that they want
 

1365
00:29:01,039 --> 00:29:03,510
paper talks about is that they want
external consistency.

1366
00:29:03,510 --> 00:29:03,520
external consistency.
 

1367
00:29:03,520 --> 00:29:06,710
external consistency.
Um and what this means

1368
00:29:06,710 --> 00:29:06,720
Um and what this means
 

1369
00:29:06,720 --> 00:29:08,630
Um and what this means
um

1370
00:29:08,630 --> 00:29:08,640
um
 

1371
00:29:08,640 --> 00:29:10,630
um
it's actually

1372
00:29:10,630 --> 00:29:10,640
it's actually
 

1373
00:29:10,640 --> 00:29:13,510
it's actually
uh equivalent to

1374
00:29:13,510 --> 00:29:13,520
uh equivalent to
 

1375
00:29:13,520 --> 00:29:15,990
uh equivalent to
um linearizability that we've seen

1376
00:29:15,990 --> 00:29:16,000
um linearizability that we've seen
 

1377
00:29:16,000 --> 00:29:17,430
um linearizability that we've seen
before. What this really means is that

1378
00:29:17,430 --> 00:29:17,440
before. What this really means is that
 

1379
00:29:17,440 --> 00:29:19,990
before. What this really means is that
if one transaction commits, finishes

1380
00:29:19,990 --> 00:29:20,000
if one transaction commits, finishes
 

1381
00:29:20,000 --> 00:29:23,430
if one transaction commits, finishes
committing and another transaction

1382
00:29:23,430 --> 00:29:23,440
committing and another transaction
 

1383
00:29:23,440 --> 00:29:25,590
committing and another transaction
starts after the first transaction

1384
00:29:25,590 --> 00:29:25,600
starts after the first transaction
 

1385
00:29:25,600 --> 00:29:28,710
starts after the first transaction
completed in real time um then the

1386
00:29:28,710 --> 00:29:28,720
completed in real time um then the
 

1387
00:29:28,720 --> 00:29:31,430
completed in real time um then the
second transactions required to see the

1388
00:29:31,430 --> 00:29:31,440
second transactions required to see the
 

1389
00:29:31,440 --> 00:29:33,510
second transactions required to see the
rights done by the first transaction.

1390
00:29:33,510 --> 00:29:33,520
rights done by the first transaction.
 

1391
00:29:33,520 --> 00:29:35,350
rights done by the first transaction.
Another way of putting that is that

1392
00:29:35,350 --> 00:29:35,360
Another way of putting that is that
 

1393
00:29:35,360 --> 00:29:37,750
Another way of putting that is that
transactions even readonly transactions

1394
00:29:37,750 --> 00:29:37,760
transactions even readonly transactions
 

1395
00:29:37,760 --> 00:29:40,389
transactions even readonly transactions
should not see stale data. You know, if

1396
00:29:40,389 --> 00:29:40,399
should not see stale data. You know, if
 

1397
00:29:40,399 --> 00:29:43,110
should not see stale data. You know, if
there's a committed write from a

1398
00:29:43,110 --> 00:29:43,120
there's a committed write from a
 

1399
00:29:43,120 --> 00:29:45,269
there's a committed write from a
completed transaction that's prior to

1400
00:29:45,269 --> 00:29:45,279
completed transaction that's prior to
 

1401
00:29:45,279 --> 00:29:47,669
completed transaction that's prior to
the read only transaction, prior to the

1402
00:29:47,669 --> 00:29:47,679
the read only transaction, prior to the
 

1403
00:29:47,679 --> 00:29:49,269
the read only transaction, prior to the
start of the read only transaction, the

1404
00:29:49,269 --> 00:29:49,279
start of the read only transaction, the
 

1405
00:29:49,279 --> 00:29:51,350
start of the read only transaction, the
readine transaction is required to see

1406
00:29:51,350 --> 00:29:51,360
readine transaction is required to see
 

1407
00:29:51,360 --> 00:29:55,110
readine transaction is required to see
that right. Um

1408
00:29:55,110 --> 00:29:55,120
that right. Um
 

1409
00:29:55,120 --> 00:29:57,750
that right. Um
okay, so um this is actually none of

1410
00:29:57,750 --> 00:29:57,760
okay, so um this is actually none of
 

1411
00:29:57,760 --> 00:29:58,870
okay, so um this is actually none of
neither of these is particularly

1412
00:29:58,870 --> 00:29:58,880
neither of these is particularly
 

1413
00:29:58,880 --> 00:30:01,990
neither of these is particularly
surprising. the standard databases some

1414
00:30:01,990 --> 00:30:02,000
surprising. the standard databases some
 

1415
00:30:02,000 --> 00:30:06,470
surprising. the standard databases some
like my SQL or something for example um

1416
00:30:06,470 --> 00:30:06,480
like my SQL or something for example um
 

1417
00:30:06,480 --> 00:30:09,510
like my SQL or something for example um
um can be configured to provide this

1418
00:30:09,510 --> 00:30:09,520
um can be configured to provide this
 

1419
00:30:09,520 --> 00:30:11,110
um can be configured to provide this
kind of consistency. So in a way it's

1420
00:30:11,110 --> 00:30:11,120
kind of consistency. So in a way it's
 

1421
00:30:11,120 --> 00:30:13,830
kind of consistency. So in a way it's
sort of the consistency that if you

1422
00:30:13,830 --> 00:30:13,840
sort of the consistency that if you
 

1423
00:30:13,840 --> 00:30:15,750
sort of the consistency that if you
didn't know better this is exactly the

1424
00:30:15,750 --> 00:30:15,760
didn't know better this is exactly the
 

1425
00:30:15,760 --> 00:30:18,230
didn't know better this is exactly the
consistency that you would expect of a

1426
00:30:18,230 --> 00:30:18,240
consistency that you would expect of a
 

1427
00:30:18,240 --> 00:30:21,830
consistency that you would expect of a
of a straightforward system. Um and the

1428
00:30:21,830 --> 00:30:21,840
of a straightforward system. Um and the
 

1429
00:30:21,840 --> 00:30:24,070
of a straightforward system. Um and the
you know you don't have to have it but

1430
00:30:24,070 --> 00:30:24,080
you know you don't have to have it but
 

1431
00:30:24,080 --> 00:30:25,909
you know you don't have to have it but
it makes programmers lives it makes it

1432
00:30:25,909 --> 00:30:25,919
it makes programmers lives it makes it
 

1433
00:30:25,919 --> 00:30:28,389
it makes programmers lives it makes it
much easier to uh produce correct

1434
00:30:28,389 --> 00:30:28,399
much easier to uh produce correct
 

1435
00:30:28,399 --> 00:30:30,149
much easier to uh produce correct
answers you know otherwise the if you

1436
00:30:30,149 --> 00:30:30,159
answers you know otherwise the if you
 

1437
00:30:30,159 --> 00:30:32,310
answers you know otherwise the if you
don't have this kind of consistency then

1438
00:30:32,310 --> 00:30:32,320
don't have this kind of consistency then
 

1439
00:30:32,320 --> 00:30:34,710
don't have this kind of consistency then
the programmers are responsible for kind

1440
00:30:34,710 --> 00:30:34,720
the programmers are responsible for kind
 

1441
00:30:34,720 --> 00:30:36,470
the programmers are responsible for kind
of programming around whatever anomalies

1442
00:30:36,470 --> 00:30:36,480
of programming around whatever anomalies
 

1443
00:30:36,480 --> 00:30:38,310
of programming around whatever anomalies
the database may provide. So this is

1444
00:30:38,310 --> 00:30:38,320
the database may provide. So this is
 

1445
00:30:38,320 --> 00:30:40,070
the database may provide. So this is
like a this is sort of the gold standard

1446
00:30:40,070 --> 00:30:40,080
like a this is sort of the gold standard
 

1447
00:30:40,080 --> 00:30:43,110
like a this is sort of the gold standard
of of correctness.

1448
00:30:43,110 --> 00:30:43,120
of of correctness.
 

1449
00:30:43,120 --> 00:30:45,110
of of correctness.
Okay. So

1450
00:30:45,110 --> 00:30:45,120
Okay. So
 

1451
00:30:45,120 --> 00:30:47,190
Okay. So
um

1452
00:30:47,190 --> 00:30:47,200
um
 

1453
00:30:47,200 --> 00:30:48,789
um
let's I want to going to talk about how

1454
00:30:48,789 --> 00:30:48,799
let's I want to going to talk about how
 

1455
00:30:48,799 --> 00:30:50,470
let's I want to going to talk about how
read only transactions work. It's a bit

1456
00:30:50,470 --> 00:30:50,480
read only transactions work. It's a bit
 

1457
00:30:50,480 --> 00:30:52,630
read only transactions work. It's a bit
of a complex story. So, um I think what

1458
00:30:52,630 --> 00:30:52,640
of a complex story. So, um I think what
 

1459
00:30:52,640 --> 00:30:55,430
of a complex story. So, um I think what
I'd like to talk about first is to just

1460
00:30:55,430 --> 00:30:55,440
I'd like to talk about first is to just
 

1461
00:30:55,440 --> 00:30:57,590
I'd like to talk about first is to just
um consider what would happen if we did

1462
00:30:57,590 --> 00:30:57,600
um consider what would happen if we did
 

1463
00:30:57,600 --> 00:30:59,750
um consider what would happen if we did
just absolutely the stupidest thing and

1464
00:30:59,750 --> 00:30:59,760
just absolutely the stupidest thing and
 

1465
00:30:59,760 --> 00:31:02,230
just absolutely the stupidest thing and
had the readonly transactions

1466
00:31:02,230 --> 00:31:02,240
had the readonly transactions
 

1467
00:31:02,240 --> 00:31:04,950
had the readonly transactions
um not do anything special to achieve

1468
00:31:04,950 --> 00:31:04,960
um not do anything special to achieve
 

1469
00:31:04,960 --> 00:31:06,789
um not do anything special to achieve
consistency, but just read the very

1470
00:31:06,789 --> 00:31:06,799
consistency, but just read the very
 

1471
00:31:06,799 --> 00:31:08,789
consistency, but just read the very
latest copy of the data. So every time a

1472
00:31:08,789 --> 00:31:08,799
latest copy of the data. So every time a
 

1473
00:31:08,799 --> 00:31:12,789
latest copy of the data. So every time a
readonly transaction does a read um we

1474
00:31:12,789 --> 00:31:12,799
readonly transaction does a read um we
 

1475
00:31:12,799 --> 00:31:15,269
readonly transaction does a read um we
could just have it look at the local

1476
00:31:15,269 --> 00:31:15,279
could just have it look at the local
 

1477
00:31:15,279 --> 00:31:17,269
could just have it look at the local
replica and find the current most

1478
00:31:17,269 --> 00:31:17,279
replica and find the current most
 

1479
00:31:17,279 --> 00:31:20,870
replica and find the current most
up-to-date um copy of the data right

1480
00:31:20,870 --> 00:31:20,880
up-to-date um copy of the data right
 

1481
00:31:20,880 --> 00:31:23,029
up-to-date um copy of the data right
that would be very straightforward um

1482
00:31:23,029 --> 00:31:23,039
that would be very straightforward um
 

1483
00:31:23,039 --> 00:31:24,870
that would be very straightforward um
very low overhead. So we need to

1484
00:31:24,870 --> 00:31:24,880
very low overhead. So we need to
 

1485
00:31:24,880 --> 00:31:28,549
very low overhead. So we need to
understand why that doesn't work um

1486
00:31:28,549 --> 00:31:28,559
understand why that doesn't work um
 

1487
00:31:28,559 --> 00:31:32,389
understand why that doesn't work um
in order. So this is uh

1488
00:31:32,389 --> 00:31:32,399
in order. So this is uh
 

1489
00:31:32,399 --> 00:31:34,549
in order. So this is uh
so why not

1490
00:31:34,549 --> 00:31:34,559
so why not
 

1491
00:31:34,559 --> 00:31:42,710
so why not
read the just the the latest value.

1492
00:31:42,710 --> 00:31:42,720

 

1493
00:31:42,720 --> 00:31:44,710

And so maybe we'll imagine that the

1494
00:31:44,710 --> 00:31:44,720
And so maybe we'll imagine that the
 

1495
00:31:44,720 --> 00:31:47,029
And so maybe we'll imagine that the
transaction is a transaction that simply

1496
00:31:47,029 --> 00:31:47,039
transaction is a transaction that simply
 

1497
00:31:47,039 --> 00:31:50,950
transaction is a transaction that simply
reads um

1498
00:31:50,950 --> 00:31:50,960
reads um
 

1499
00:31:50,960 --> 00:31:53,830
reads um
X and Y and prints them.

1500
00:31:53,830 --> 00:31:53,840
X and Y and prints them.
 

1501
00:31:53,840 --> 00:31:55,590
X and Y and prints them.
It's read only. We're going to print y

1502
00:31:55,590 --> 00:31:55,600
It's read only. We're going to print y
 

1503
00:31:55,600 --> 00:32:01,750
It's read only. We're going to print y
and we'll just print x comma y.

1504
00:32:01,750 --> 00:32:01,760

 

1505
00:32:01,760 --> 00:32:04,070

Okay. So um I want to show you an

1506
00:32:04,070 --> 00:32:04,080
Okay. So um I want to show you an
 

1507
00:32:04,080 --> 00:32:07,110
Okay. So um I want to show you an
example of a situation in which um read

1508
00:32:07,110 --> 00:32:07,120
example of a situation in which um read
 

1509
00:32:07,120 --> 00:32:08,549
example of a situation in which um read
having this transaction just simply read

1510
00:32:08,549 --> 00:32:08,559
having this transaction just simply read
 

1511
00:32:08,559 --> 00:32:12,389
having this transaction just simply read
the latest value yields um incorrect not

1512
00:32:12,389 --> 00:32:12,399
the latest value yields um incorrect not
 

1513
00:32:12,399 --> 00:32:15,029
the latest value yields um incorrect not
uh not serializable results. So so we

1514
00:32:15,029 --> 00:32:15,039
uh not serializable results. So so we
 

1515
00:32:15,039 --> 00:32:18,710
uh not serializable results. So so we
have three transactions running t1,

1516
00:32:18,710 --> 00:32:18,720
have three transactions running t1,
 

1517
00:32:18,720 --> 00:32:20,389
have three transactions running t1,
t2,

1518
00:32:20,389 --> 00:32:20,399
t2,
 

1519
00:32:20,399 --> 00:32:23,350
t2,
t3. Um T3 is going to be our

1520
00:32:23,350 --> 00:32:23,360
t3. Um T3 is going to be our
 

1521
00:32:23,360 --> 00:32:25,750
t3. Um T3 is going to be our
transaction. T1 and T2 are uh

1522
00:32:25,750 --> 00:32:25,760
transaction. T1 and T2 are uh
 

1523
00:32:25,760 --> 00:32:27,590
transaction. T1 and T2 are uh
transactions that are are rewrite

1524
00:32:27,590 --> 00:32:27,600
transactions that are are rewrite
 

1525
00:32:27,600 --> 00:32:31,190
transactions that are are rewrite
transactions. Um so let's say that uh T1

1526
00:32:31,190 --> 00:32:31,200
transactions. Um so let's say that uh T1
 

1527
00:32:31,200 --> 00:32:33,029
transactions. Um so let's say that uh T1
writes X

1528
00:32:33,029 --> 00:32:33,039
writes X
 

1529
00:32:33,039 --> 00:32:36,470
writes X
and writes Y and then commits. And you

1530
00:32:36,470 --> 00:32:36,480
and writes Y and then commits. And you
 

1531
00:32:36,480 --> 00:32:37,909
and writes Y and then commits. And you
know maybe it's a bank transfer

1532
00:32:37,909 --> 00:32:37,919
know maybe it's a bank transfer
 

1533
00:32:37,919 --> 00:32:39,269
know maybe it's a bank transfer
operation. So it's transferring money

1534
00:32:39,269 --> 00:32:39,279
operation. So it's transferring money
 

1535
00:32:39,279 --> 00:32:41,590
operation. So it's transferring money
from X to Y. And we're printing X and Y

1536
00:32:41,590 --> 00:32:41,600
from X to Y. And we're printing X and Y
 

1537
00:32:41,600 --> 00:32:42,950
from X to Y. And we're printing X and Y
because we're doing an audit of the bank

1538
00:32:42,950 --> 00:32:42,960
because we're doing an audit of the bank
 

1539
00:32:42,960 --> 00:32:44,149
because we're doing an audit of the bank
to try to make sure it hasn't lost

1540
00:32:44,149 --> 00:32:44,159
to try to make sure it hasn't lost
 

1541
00:32:44,159 --> 00:32:46,149
to try to make sure it hasn't lost
money. Let's imagine that transaction

1542
00:32:46,149 --> 00:32:46,159
money. Let's imagine that transaction
 

1543
00:32:46,159 --> 00:32:50,710
money. Let's imagine that transaction
two um also does another transfer

1544
00:32:50,710 --> 00:32:50,720
two um also does another transfer
 

1545
00:32:50,720 --> 00:32:52,389
two um also does another transfer
between

1546
00:32:52,389 --> 00:32:52,399
between
 

1547
00:32:52,399 --> 00:32:54,389
between
uh balances X and Y and then commits.

1548
00:32:54,389 --> 00:32:54,399
uh balances X and Y and then commits.
 

1549
00:32:54,399 --> 00:32:55,830
uh balances X and Y and then commits.
And now we have our transaction

1550
00:32:55,830 --> 00:32:55,840
And now we have our transaction
 

1551
00:32:55,840 --> 00:32:58,389
And now we have our transaction
transaction T3. It's it needs to read X

1552
00:32:58,389 --> 00:32:58,399
transaction T3. It's it needs to read X
 

1553
00:32:58,399 --> 00:33:00,230
transaction T3. It's it needs to read X
and Y. Um so it's going to have a read

1554
00:33:00,230 --> 00:33:00,240
and Y. Um so it's going to have a read
 

1555
00:33:00,240 --> 00:33:02,710
and Y. Um so it's going to have a read
of X. Let's say the read of X um happens

1556
00:33:02,710 --> 00:33:02,720
of X. Let's say the read of X um happens
 

1557
00:33:02,720 --> 00:33:06,549
of X. Let's say the read of X um happens
at this point in time. And so I'm uh the

1558
00:33:06,549 --> 00:33:06,559
at this point in time. And so I'm uh the
 

1559
00:33:06,559 --> 00:33:08,549
at this point in time. And so I'm uh the
way I'm drawing these diagrams is that

1560
00:33:08,549 --> 00:33:08,559
way I'm drawing these diagrams is that
 

1561
00:33:08,559 --> 00:33:10,950
way I'm drawing these diagrams is that
real time moves to the right. wall clock

1562
00:33:10,950 --> 00:33:10,960
real time moves to the right. wall clock
 

1563
00:33:10,960 --> 00:33:12,630
real time moves to the right. wall clock
time, the kind of time you'd see on your

1564
00:33:12,630 --> 00:33:12,640
time, the kind of time you'd see on your
 

1565
00:33:12,640 --> 00:33:14,870
time, the kind of time you'd see on your
watch moves to the right. So the read of

1566
00:33:14,870 --> 00:33:14,880
watch moves to the right. So the read of
 

1567
00:33:14,880 --> 00:33:17,350
watch moves to the right. So the read of
X happens here after transaction one

1568
00:33:17,350 --> 00:33:17,360
X happens here after transaction one
 

1569
00:33:17,360 --> 00:33:20,389
X happens here after transaction one
completes before transaction two starts.

1570
00:33:20,389 --> 00:33:20,399
completes before transaction two starts.
 

1571
00:33:20,399 --> 00:33:23,110
completes before transaction two starts.
Um and let's say T3 is running on a slow

1572
00:33:23,110 --> 00:33:23,120
Um and let's say T3 is running on a slow
 

1573
00:33:23,120 --> 00:33:24,710
Um and let's say T3 is running on a slow
computer. So it only manages to issue

1574
00:33:24,710 --> 00:33:24,720
computer. So it only manages to issue
 

1575
00:33:24,720 --> 00:33:28,549
computer. So it only manages to issue
the read of Y uh much later.

1576
00:33:28,549 --> 00:33:28,559
the read of Y uh much later.
 

1577
00:33:28,559 --> 00:33:30,230
the read of Y uh much later.
So the way this is going to play out is

1578
00:33:30,230 --> 00:33:30,240
So the way this is going to play out is
 

1579
00:33:30,240 --> 00:33:33,750
So the way this is going to play out is
that transaction 3 will see the y value

1580
00:33:33,750 --> 00:33:33,760
that transaction 3 will see the y value
 

1581
00:33:33,760 --> 00:33:39,509
that transaction 3 will see the y value
that t1 wrote but the x value that t2

1582
00:33:39,509 --> 00:33:39,519
that t1 wrote but the x value that t2
 

1583
00:33:39,519 --> 00:33:41,029
that t1 wrote but the x value that t2
wrote.

1584
00:33:41,029 --> 00:33:41,039
wrote.
 

1585
00:33:41,039 --> 00:33:45,029
wrote.
Um assuming it uses this uh dubious

1586
00:33:45,029 --> 00:33:45,039
Um assuming it uses this uh dubious
 

1587
00:33:45,039 --> 00:33:47,110
Um assuming it uses this uh dubious
procedure of simply reading the latest

1588
00:33:47,110 --> 00:33:47,120
procedure of simply reading the latest
 

1589
00:33:47,120 --> 00:33:51,029
procedure of simply reading the latest
value that's in the database. Um, and so

1590
00:33:51,029 --> 00:33:51,039
value that's in the database. Um, and so
 

1591
00:33:51,039 --> 00:33:55,909
value that's in the database. Um, and so
this is not serializable because um,

1592
00:33:55,909 --> 00:33:55,919
this is not serializable because um,
 

1593
00:33:55,919 --> 00:33:57,990
this is not serializable because um,
well, we know that any serial order that

1594
00:33:57,990 --> 00:33:58,000
well, we know that any serial order that
 

1595
00:33:58,000 --> 00:34:04,149
well, we know that any serial order that
could exist must have um, T1

1596
00:34:04,149 --> 00:34:04,159
could exist must have um, T1
 

1597
00:34:04,159 --> 00:34:06,630
could exist must have um, T1
uh, followed by T2. There's only two

1598
00:34:06,630 --> 00:34:06,640
uh, followed by T2. There's only two
 

1599
00:34:06,640 --> 00:34:11,430
uh, followed by T2. There's only two
places T3 could go. So T3 could go here.

1600
00:34:11,430 --> 00:34:11,440
places T3 could go. So T3 could go here.
 

1601
00:34:11,440 --> 00:34:15,270
places T3 could go. So T3 could go here.
Um but T3 can't fit here because if T3

1602
00:34:15,270 --> 00:34:15,280
Um but T3 can't fit here because if T3
 

1603
00:34:15,280 --> 00:34:16,869
Um but T3 can't fit here because if T3
was second in the equivalent serial

1604
00:34:16,869 --> 00:34:16,879
was second in the equivalent serial
 

1605
00:34:16,879 --> 00:34:19,750
was second in the equivalent serial
order then it shouldn't see rights by T2

1606
00:34:19,750 --> 00:34:19,760
order then it shouldn't see rights by T2
 

1607
00:34:19,760 --> 00:34:21,829
order then it shouldn't see rights by T2
which comes after it. It should see um

1608
00:34:21,829 --> 00:34:21,839
which comes after it. It should see um
 

1609
00:34:21,839 --> 00:34:24,710
which comes after it. It should see um
the value of Y produced by T1 but it

1610
00:34:24,710 --> 00:34:24,720
the value of Y produced by T1 but it
 

1611
00:34:24,720 --> 00:34:26,629
the value of Y produced by T1 but it
doesn't right it sees the value produced

1612
00:34:26,629 --> 00:34:26,639
doesn't right it sees the value produced
 

1613
00:34:26,639 --> 00:34:30,230
doesn't right it sees the value produced
by T3 by T2. So this is not an

1614
00:34:30,230 --> 00:34:30,240
by T3 by T2. So this is not an
 

1615
00:34:30,240 --> 00:34:32,149
by T3 by T2. So this is not an
equivalent. This serial order wouldn't

1616
00:34:32,149 --> 00:34:32,159
equivalent. This serial order wouldn't
 

1617
00:34:32,159 --> 00:34:34,069
equivalent. This serial order wouldn't
produce the same results. The only other

1618
00:34:34,069 --> 00:34:34,079
produce the same results. The only other
 

1619
00:34:34,079 --> 00:34:37,589
produce the same results. The only other
one available to us is this one. um this

1620
00:34:37,589 --> 00:34:37,599
one available to us is this one. um this
 

1621
00:34:37,599 --> 00:34:39,589
one available to us is this one. um this
serial order would get the same value

1622
00:34:39,589 --> 00:34:39,599
serial order would get the same value
 

1623
00:34:39,599 --> 00:34:44,389
serial order would get the same value
for y that t3 actually produced but um

1624
00:34:44,389 --> 00:34:44,399
for y that t3 actually produced but um
 

1625
00:34:44,399 --> 00:34:46,389
for y that t3 actually produced but um
if this was the serial order then t3

1626
00:34:46,389 --> 00:34:46,399
if this was the serial order then t3
 

1627
00:34:46,399 --> 00:34:48,629
if this was the serial order then t3
should have seen the value written by t2

1628
00:34:48,629 --> 00:34:48,639
should have seen the value written by t2
 

1629
00:34:48,639 --> 00:34:50,710
should have seen the value written by t2
but it actually saw the value written by

1630
00:34:50,710 --> 00:34:50,720
but it actually saw the value written by
 

1631
00:34:50,720 --> 00:34:53,510
but it actually saw the value written by
t1. So this execution is not equivalent

1632
00:34:53,510 --> 00:34:53,520
t1. So this execution is not equivalent
 

1633
00:34:53,520 --> 00:34:57,990
t1. So this execution is not equivalent
to any one at a time serial order. So um

1634
00:34:57,990 --> 00:34:58,000
to any one at a time serial order. So um
 

1635
00:34:58,000 --> 00:35:01,910
to any one at a time serial order. So um
this is like there's something broken

1636
00:35:01,910 --> 00:35:01,920
this is like there's something broken
 

1637
00:35:01,920 --> 00:35:04,630
this is like there's something broken
um about read simply reading the latest

1638
00:35:04,630 --> 00:35:04,640
um about read simply reading the latest
 

1639
00:35:04,640 --> 00:35:07,910
um about read simply reading the latest
value. So we know that doesn't work. You

1640
00:35:07,910 --> 00:35:07,920
value. So we know that doesn't work. You
 

1641
00:35:07,920 --> 00:35:09,430
value. So we know that doesn't work. You
know what we're really looking for of

1642
00:35:09,430 --> 00:35:09,440
know what we're really looking for of
 

1643
00:35:09,440 --> 00:35:12,630
know what we're really looking for of
course is that either the our our

1644
00:35:12,630 --> 00:35:12,640
course is that either the our our
 

1645
00:35:12,640 --> 00:35:15,510
course is that either the our our
transaction either reads the uh both

1646
00:35:15,510 --> 00:35:15,520
transaction either reads the uh both
 

1647
00:35:15,520 --> 00:35:19,270
transaction either reads the uh both
values at this point in time or it reads

1648
00:35:19,270 --> 00:35:19,280
values at this point in time or it reads
 

1649
00:35:19,280 --> 00:35:22,630
values at this point in time or it reads
both values at this point in time.

1650
00:35:22,630 --> 00:35:22,640
both values at this point in time.
 

1651
00:35:22,640 --> 00:35:27,990
both values at this point in time.
Um okay. So um

1652
00:35:27,990 --> 00:35:28,000
Um okay. So um
 

1653
00:35:28,000 --> 00:35:29,589
Um okay. So um
the

1654
00:35:29,589 --> 00:35:29,599
the
 

1655
00:35:29,599 --> 00:35:34,150
the
uh approach that um

1656
00:35:34,150 --> 00:35:34,160
uh approach that um
 

1657
00:35:34,160 --> 00:35:36,710
uh approach that um
expand our taste of this it's it's a

1658
00:35:36,710 --> 00:35:36,720
expand our taste of this it's it's a
 

1659
00:35:36,720 --> 00:35:40,550
expand our taste of this it's it's a
somewhat complex. Um the first big idea

1660
00:35:40,550 --> 00:35:40,560
somewhat complex. Um the first big idea
 

1661
00:35:40,560 --> 00:35:43,349
somewhat complex. Um the first big idea
is an existing idea. Um it's called

1662
00:35:43,349 --> 00:35:43,359
is an existing idea. Um it's called
 

1663
00:35:43,359 --> 00:35:53,750
is an existing idea. Um it's called
snapshot isolation.

1664
00:35:53,750 --> 00:35:53,760

 

1665
00:35:53,760 --> 00:35:55,750

And

1666
00:35:55,750 --> 00:35:55,760
And
 

1667
00:35:55,760 --> 00:35:57,430
And
um

1668
00:35:57,430 --> 00:35:57,440
um
 

1669
00:35:57,440 --> 00:35:59,510
um
the way I'm going to describe this is

1670
00:35:59,510 --> 00:35:59,520
the way I'm going to describe this is
 

1671
00:35:59,520 --> 00:36:02,550
the way I'm going to describe this is
that um let's imagine that all the

1672
00:36:02,550 --> 00:36:02,560
that um let's imagine that all the
 

1673
00:36:02,560 --> 00:36:04,470
that um let's imagine that all the
computers involved had synchronized

1674
00:36:04,470 --> 00:36:04,480
computers involved had synchronized
 

1675
00:36:04,480 --> 00:36:06,550
computers involved had synchronized
clocks. That is the you know they all

1676
00:36:06,550 --> 00:36:06,560
clocks. That is the you know they all
 

1677
00:36:06,560 --> 00:36:09,030
clocks. That is the you know they all
have a clock the clock yields uh yields

1678
00:36:09,030 --> 00:36:09,040
have a clock the clock yields uh yields
 

1679
00:36:09,040 --> 00:36:11,510
have a clock the clock yields uh yields
a sort of wall clock time like oh it's

1680
00:36:11,510 --> 00:36:11,520
a sort of wall clock time like oh it's
 

1681
00:36:11,520 --> 00:36:16,790
a sort of wall clock time like oh it's
um 1:43 in the afternoon on uh April 7th

1682
00:36:16,790 --> 00:36:16,800
um 1:43 in the afternoon on uh April 7th
 

1683
00:36:16,800 --> 00:36:19,030
um 1:43 in the afternoon on uh April 7th
2020. So that's what we mean by it a

1684
00:36:19,030 --> 00:36:19,040
2020. So that's what we mean by it a
 

1685
00:36:19,040 --> 00:36:21,109
2020. So that's what we mean by it a
wall clock time a time. So let's assume

1686
00:36:21,109 --> 00:36:21,119
wall clock time a time. So let's assume
 

1687
00:36:21,119 --> 00:36:23,510
wall clock time a time. So let's assume
that all the computers assume even

1688
00:36:23,510 --> 00:36:23,520
that all the computers assume even
 

1689
00:36:23,520 --> 00:36:25,430
that all the computers assume even
though this isn't true that all the

1690
00:36:25,430 --> 00:36:25,440
though this isn't true that all the
 

1691
00:36:25,440 --> 00:36:27,190
though this isn't true that all the
computers involved have uh synchronized

1692
00:36:27,190 --> 00:36:27,200
computers involved have uh synchronized
 

1693
00:36:27,200 --> 00:36:30,950
computers involved have uh synchronized
times. Furthermore, let's imagine that

1694
00:36:30,950 --> 00:36:30,960
times. Furthermore, let's imagine that
 

1695
00:36:30,960 --> 00:36:33,510
times. Furthermore, let's imagine that
every transaction is assigned a

1696
00:36:33,510 --> 00:36:33,520
every transaction is assigned a
 

1697
00:36:33,520 --> 00:36:38,470
every transaction is assigned a
particular time, a time stamp. Um,

1698
00:36:38,470 --> 00:36:38,480
particular time, a time stamp. Um,
 

1699
00:36:38,480 --> 00:36:39,990
particular time, a time stamp. Um,
and

1700
00:36:39,990 --> 00:36:40,000
and
 

1701
00:36:40,000 --> 00:36:41,670
and
um,

1702
00:36:41,670 --> 00:36:41,680
um,
 

1703
00:36:41,680 --> 00:36:45,190
um,
okay. So, we have these timestamps

1704
00:36:45,190 --> 00:36:45,200
okay. So, we have these timestamps
 

1705
00:36:45,200 --> 00:36:47,030
okay. So, we have these timestamps
there. There are wall clocks times taken

1706
00:36:47,030 --> 00:36:47,040
there. There are wall clocks times taken
 

1707
00:36:47,040 --> 00:36:48,870
there. There are wall clocks times taken
from these synchronized clocks for read

1708
00:36:48,870 --> 00:36:48,880
from these synchronized clocks for read
 

1709
00:36:48,880 --> 00:36:53,030
from these synchronized clocks for read
write transaction. its time stamp is um

1710
00:36:53,030 --> 00:36:53,040
write transaction. its time stamp is um
 

1711
00:36:53,040 --> 00:36:54,950
write transaction. its time stamp is um
I'm going to say just for this uh for

1712
00:36:54,950 --> 00:36:54,960
I'm going to say just for this uh for
 

1713
00:36:54,960 --> 00:36:57,589
I'm going to say just for this uh for
this simplified design is the real time

1714
00:36:57,589 --> 00:36:57,599
this simplified design is the real time
 

1715
00:36:57,599 --> 00:37:02,630
this simplified design is the real time
at um at the commit

1716
00:37:02,630 --> 00:37:02,640

 

1717
00:37:02,640 --> 00:37:06,710

and for read for a um or at the time at

1718
00:37:06,710 --> 00:37:06,720
and for read for a um or at the time at
 

1719
00:37:06,720 --> 00:37:08,630
and for read for a um or at the time at
uh which the transaction manager starts

1720
00:37:08,630 --> 00:37:08,640
uh which the transaction manager starts
 

1721
00:37:08,640 --> 00:37:10,150
uh which the transaction manager starts
the commit and for a readonly

1722
00:37:10,150 --> 00:37:10,160
the commit and for a readonly
 

1723
00:37:10,160 --> 00:37:13,190
the commit and for a readonly
transaction um that time stamp is equal

1724
00:37:13,190 --> 00:37:13,200
transaction um that time stamp is equal
 

1725
00:37:13,200 --> 00:37:15,589
transaction um that time stamp is equal
to the start time.

1726
00:37:15,589 --> 00:37:15,599
to the start time.
 

1727
00:37:15,599 --> 00:37:17,430
to the start time.
Um

1728
00:37:17,430 --> 00:37:17,440
Um
 

1729
00:37:17,440 --> 00:37:18,870
Um
all right so every transaction has a

1730
00:37:18,870 --> 00:37:18,880
all right so every transaction has a
 

1731
00:37:18,880 --> 00:37:22,230
all right so every transaction has a
time and we're going to design our

1732
00:37:22,230 --> 00:37:22,240
time and we're going to design our
 

1733
00:37:22,240 --> 00:37:25,030
time and we're going to design our
system our snapshot isolation system

1734
00:37:25,030 --> 00:37:25,040
system our snapshot isolation system
 

1735
00:37:25,040 --> 00:37:28,710
system our snapshot isolation system
gets is designed to execute as if to get

1736
00:37:28,710 --> 00:37:28,720
gets is designed to execute as if to get
 

1737
00:37:28,720 --> 00:37:30,470
gets is designed to execute as if to get
the same results as if all the

1738
00:37:30,470 --> 00:37:30,480
the same results as if all the
 

1739
00:37:30,480 --> 00:37:32,950
the same results as if all the
transactions had executed in timestamp

1740
00:37:32,950 --> 00:37:32,960
transactions had executed in timestamp
 

1741
00:37:32,960 --> 00:37:34,790
transactions had executed in timestamp
order. So we're going to assign the

1742
00:37:34,790 --> 00:37:34,800
order. So we're going to assign the
 

1743
00:37:34,800 --> 00:37:36,790
order. So we're going to assign the
transactions each transaction a time

1744
00:37:36,790 --> 00:37:36,800
transactions each transaction a time
 

1745
00:37:36,800 --> 00:37:38,310
transactions each transaction a time
stamp and then we're going to arrange

1746
00:37:38,310 --> 00:37:38,320
stamp and then we're going to arrange
 

1747
00:37:38,320 --> 00:37:41,190
stamp and then we're going to arrange
the executions so that um the

1748
00:37:41,190 --> 00:37:41,200
the executions so that um the
 

1749
00:37:41,200 --> 00:37:43,030
the executions so that um the
transactions get the results as if they

1750
00:37:43,030 --> 00:37:43,040
transactions get the results as if they
 

1751
00:37:43,040 --> 00:37:45,430
transactions get the results as if they
had executed in that order. So given the

1752
00:37:45,430 --> 00:37:45,440
had executed in that order. So given the
 

1753
00:37:45,440 --> 00:37:47,430
had executed in that order. So given the
time stamps, we sort of need to um have

1754
00:37:47,430 --> 00:37:47,440
time stamps, we sort of need to um have
 

1755
00:37:47,440 --> 00:37:49,109
time stamps, we sort of need to um have
an implementation that will kind of

1756
00:37:49,109 --> 00:37:49,119
an implementation that will kind of
 

1757
00:37:49,119 --> 00:37:52,069
an implementation that will kind of
basically honor the timestamps um and

1758
00:37:52,069 --> 00:37:52,079
basically honor the timestamps um and
 

1759
00:37:52,079 --> 00:37:53,829
basically honor the timestamps um and
basically you know show each transaction

1760
00:37:53,829 --> 00:37:53,839
basically you know show each transaction
 

1761
00:37:53,839 --> 00:37:58,069
basically you know show each transaction
the data sort of as it existed at at its

1762
00:37:58,069 --> 00:37:58,079
the data sort of as it existed at at its
 

1763
00:37:58,079 --> 00:38:01,030
the data sort of as it existed at at its
um time stamp. Okay. So the way that

1764
00:38:01,030 --> 00:38:01,040
um time stamp. Okay. So the way that
 

1765
00:38:01,040 --> 00:38:03,910
um time stamp. Okay. So the way that
this works um

1766
00:38:03,910 --> 00:38:03,920
this works um
 

1767
00:38:03,920 --> 00:38:07,589
this works um
uh for readonly transactions

1768
00:38:07,589 --> 00:38:07,599
uh for readonly transactions
 

1769
00:38:07,599 --> 00:38:11,670
uh for readonly transactions
um is that each replica when it stores

1770
00:38:11,670 --> 00:38:11,680
um is that each replica when it stores
 

1771
00:38:11,680 --> 00:38:13,349
um is that each replica when it stores
data it actually has multiple versions

1772
00:38:13,349 --> 00:38:13,359
data it actually has multiple versions
 

1773
00:38:13,359 --> 00:38:17,190
data it actually has multiple versions
of the data. Um so we have a multiple

1774
00:38:17,190 --> 00:38:17,200
of the data. Um so we have a multiple
 

1775
00:38:17,200 --> 00:38:19,670
of the data. Um so we have a multiple
version

1776
00:38:19,670 --> 00:38:19,680
version
 

1777
00:38:19,680 --> 00:38:22,069
version
um database

1778
00:38:22,069 --> 00:38:22,079
um database
 

1779
00:38:22,079 --> 00:38:25,109
um database
every database record has um you know

1780
00:38:25,109 --> 00:38:25,119
every database record has um you know
 

1781
00:38:25,119 --> 00:38:26,470
every database record has um you know
maybe if it's been written a couple

1782
00:38:26,470 --> 00:38:26,480
maybe if it's been written a couple
 

1783
00:38:26,480 --> 00:38:28,150
maybe if it's been written a couple
times it has a separate copy of that

1784
00:38:28,150 --> 00:38:28,160
times it has a separate copy of that
 

1785
00:38:28,160 --> 00:38:29,990
times it has a separate copy of that
record for each of the times it's been

1786
00:38:29,990 --> 00:38:30,000
record for each of the times it's been
 

1787
00:38:30,000 --> 00:38:32,069
record for each of the times it's been
written each one of them associated with

1788
00:38:32,069 --> 00:38:32,079
written each one of them associated with
 

1789
00:38:32,079 --> 00:38:35,190
written each one of them associated with
the um timestamp of the transaction that

1790
00:38:35,190 --> 00:38:35,200
the um timestamp of the transaction that
 

1791
00:38:35,200 --> 00:38:37,190
the um timestamp of the transaction that
wrote it.

1792
00:38:37,190 --> 00:38:37,200
wrote it.
 

1793
00:38:37,200 --> 00:38:40,470
wrote it.
Um

1794
00:38:40,470 --> 00:38:40,480

 

1795
00:38:40,480 --> 00:38:42,950

and um then the basic strategy is that

1796
00:38:42,950 --> 00:38:42,960
and um then the basic strategy is that
 

1797
00:38:42,960 --> 00:38:45,190
and um then the basic strategy is that
readonly transactions when they when a

1798
00:38:45,190 --> 00:38:45,200
readonly transactions when they when a
 

1799
00:38:45,200 --> 00:38:47,430
readonly transactions when they when a
readonly transaction does a read it's

1800
00:38:47,430 --> 00:38:47,440
readonly transaction does a read it's
 

1801
00:38:47,440 --> 00:38:50,310
readonly transaction does a read it's
already allocated itself a time stamp um

1802
00:38:50,310 --> 00:38:50,320
already allocated itself a time stamp um
 

1803
00:38:50,320 --> 00:38:52,630
already allocated itself a time stamp um
when it started and so it accompanies

1804
00:38:52,630 --> 00:38:52,640
when it started and so it accompanies
 

1805
00:38:52,640 --> 00:38:56,390
when it started and so it accompanies
its read request with its time stamp and

1806
00:38:56,390 --> 00:38:56,400
its read request with its time stamp and
 

1807
00:38:56,400 --> 00:39:00,710
its read request with its time stamp and
the whatever uh server um you know that

1808
00:39:00,710 --> 00:39:00,720
the whatever uh server um you know that
 

1809
00:39:00,720 --> 00:39:03,030
the whatever uh server um you know that
stores the replica of the data that the

1810
00:39:03,030 --> 00:39:03,040
stores the replica of the data that the
 

1811
00:39:03,040 --> 00:39:04,470
stores the replica of the data that the
transaction needs. It's going to look

1812
00:39:04,470 --> 00:39:04,480
transaction needs. It's going to look
 

1813
00:39:04,480 --> 00:39:06,390
transaction needs. It's going to look
into its multi-version database and find

1814
00:39:06,390 --> 00:39:06,400
into its multi-version database and find
 

1815
00:39:06,400 --> 00:39:10,630
into its multi-version database and find
the um record that's being asked for

1816
00:39:10,630 --> 00:39:10,640
the um record that's being asked for
 

1817
00:39:10,640 --> 00:39:12,390
the um record that's being asked for
that has the highest time that's still

1818
00:39:12,390 --> 00:39:12,400
that has the highest time that's still
 

1819
00:39:12,400 --> 00:39:16,390
that has the highest time that's still
less than the time stamp um specified by

1820
00:39:16,390 --> 00:39:16,400
less than the time stamp um specified by
 

1821
00:39:16,400 --> 00:39:17,829
less than the time stamp um specified by
the readonly transaction. So that means

1822
00:39:17,829 --> 00:39:17,839
the readonly transaction. So that means
 

1823
00:39:17,839 --> 00:39:20,230
the readonly transaction. So that means
it be only transaction sort of sees data

1824
00:39:20,230 --> 00:39:20,240
it be only transaction sort of sees data
 

1825
00:39:20,240 --> 00:39:23,430
it be only transaction sort of sees data
the latest data as of the time as of its

1826
00:39:23,430 --> 00:39:23,440
the latest data as of the time as of its
 

1827
00:39:23,440 --> 00:39:27,829
the latest data as of the time as of its
time chosen time stamp. Um

1828
00:39:27,829 --> 00:39:27,839
time chosen time stamp. Um
 

1829
00:39:27,839 --> 00:39:31,750
time chosen time stamp. Um
okay so this is for um this snapshot

1830
00:39:31,750 --> 00:39:31,760
okay so this is for um this snapshot
 

1831
00:39:31,760 --> 00:39:33,430
okay so this is for um this snapshot
isolation idea works for readonly

1832
00:39:33,430 --> 00:39:33,440
isolation idea works for readonly
 

1833
00:39:33,440 --> 00:39:36,069
isolation idea works for readonly
transactions or Spanner uses it for

1834
00:39:36,069 --> 00:39:36,079
transactions or Spanner uses it for
 

1835
00:39:36,079 --> 00:39:38,310
transactions or Spanner uses it for
readonly transactions. Spanner uses

1836
00:39:38,310 --> 00:39:38,320
readonly transactions. Spanner uses
 

1837
00:39:38,320 --> 00:39:41,990
readonly transactions. Spanner uses
still uses um two-phase locking and

1838
00:39:41,990 --> 00:39:42,000
still uses um two-phase locking and
 

1839
00:39:42,000 --> 00:39:44,470
still uses um two-phase locking and
two-phase commit for read write

1840
00:39:44,470 --> 00:39:44,480
two-phase commit for read write
 

1841
00:39:44,480 --> 00:39:46,230
two-phase commit for read write
transactions. And so the readr

1842
00:39:46,230 --> 00:39:46,240
transactions. And so the readr
 

1843
00:39:46,240 --> 00:39:47,990
transactions. And so the readr
transactions allocate timestamps for

1844
00:39:47,990 --> 00:39:48,000
transactions allocate timestamps for
 

1845
00:39:48,000 --> 00:39:49,430
transactions allocate timestamps for
themselves at commit time but other than

1846
00:39:49,430 --> 00:39:49,440
themselves at commit time but other than
 

1847
00:39:49,440 --> 00:39:51,510
themselves at commit time but other than
that they work in the usual way with

1848
00:39:51,510 --> 00:39:51,520
that they work in the usual way with
 

1849
00:39:51,520 --> 00:39:53,829
that they work in the usual way with
locks and two-phase commit. Whereas the

1850
00:39:53,829 --> 00:39:53,839
locks and two-phase commit. Whereas the
 

1851
00:39:53,839 --> 00:39:57,349
locks and two-phase commit. Whereas the
readonly transactions um access the

1852
00:39:57,349 --> 00:39:57,359
readonly transactions um access the
 

1853
00:39:57,359 --> 00:39:58,950
readonly transactions um access the
multiple versions in the database and

1854
00:39:58,950 --> 00:39:58,960
multiple versions in the database and
 

1855
00:39:58,960 --> 00:40:00,870
multiple versions in the database and
get the version that's you know written

1856
00:40:00,870 --> 00:40:00,880
get the version that's you know written
 

1857
00:40:00,880 --> 00:40:04,790
get the version that's you know written
by the um has the time stamp that's

1858
00:40:04,790 --> 00:40:04,800
by the um has the time stamp that's
 

1859
00:40:04,800 --> 00:40:06,710
by the um has the time stamp that's
highest but still less than the readonly

1860
00:40:06,710 --> 00:40:06,720
highest but still less than the readonly
 

1861
00:40:06,720 --> 00:40:09,030
highest but still less than the readonly
transactions time stamp. And where this

1862
00:40:09,030 --> 00:40:09,040
transactions time stamp. And where this
 

1863
00:40:09,040 --> 00:40:10,710
transactions time stamp. And where this
is going to get us is that you know

1864
00:40:10,710 --> 00:40:10,720
is going to get us is that you know
 

1865
00:40:10,720 --> 00:40:12,310
is going to get us is that you know
readon transactions will see all the

1866
00:40:12,310 --> 00:40:12,320
readon transactions will see all the
 

1867
00:40:12,320 --> 00:40:15,109
readon transactions will see all the
rights of of readwrite transactions with

1868
00:40:15,109 --> 00:40:15,119
rights of of readwrite transactions with
 

1869
00:40:15,119 --> 00:40:17,750
rights of of readwrite transactions with
lower time stamps and none of the writes

1870
00:40:17,750 --> 00:40:17,760
lower time stamps and none of the writes
 

1871
00:40:17,760 --> 00:40:20,390
lower time stamps and none of the writes
of rewrite transactions with higher time

1872
00:40:20,390 --> 00:40:20,400
of rewrite transactions with higher time
 

1873
00:40:20,400 --> 00:40:24,710
of rewrite transactions with higher time
time stamps. Um okay. So, uh how would

1874
00:40:24,710 --> 00:40:24,720
time stamps. Um okay. So, uh how would
 

1875
00:40:24,720 --> 00:40:29,349
time stamps. Um okay. So, uh how would
snapshot isolation um work out for our

1876
00:40:29,349 --> 00:40:29,359
snapshot isolation um work out for our
 

1877
00:40:29,359 --> 00:40:33,750
snapshot isolation um work out for our
example? Um

1878
00:40:33,750 --> 00:40:33,760

 

1879
00:40:33,760 --> 00:40:36,870

um the example that I had here before

1880
00:40:36,870 --> 00:40:36,880
um the example that I had here before
 

1881
00:40:36,880 --> 00:40:40,310
um the example that I had here before
in which um we had a failure of serial

1882
00:40:40,310 --> 00:40:40,320
in which um we had a failure of serial
 

1883
00:40:40,320 --> 00:40:44,310
in which um we had a failure of serial
serializability because um

1884
00:40:44,310 --> 00:40:44,320
serializability because um
 

1885
00:40:44,320 --> 00:40:47,670
serializability because um
the reading transaction

1886
00:40:47,670 --> 00:40:47,680
the reading transaction
 

1887
00:40:47,680 --> 00:40:52,470
the reading transaction
um read before read values that were not

1888
00:40:52,470 --> 00:40:52,480
um read before read values that were not
 

1889
00:40:52,480 --> 00:40:53,990
um read before read values that were not
between any two of the readrite

1890
00:40:53,990 --> 00:40:54,000
between any two of the readrite
 

1891
00:40:54,000 --> 00:40:56,390
between any two of the readrite
transactions. Okay. So this is now our

1892
00:40:56,390 --> 00:40:56,400
transactions. Okay. So this is now our
 

1893
00:40:56,400 --> 00:41:02,069
transactions. Okay. So this is now our
example but with um snapshot isolation.

1894
00:41:02,069 --> 00:41:02,079
example but with um snapshot isolation.
 

1895
00:41:02,079 --> 00:41:05,190
example but with um snapshot isolation.
I'm showing you this to show that the

1896
00:41:05,190 --> 00:41:05,200
I'm showing you this to show that the
 

1897
00:41:05,200 --> 00:41:08,630
I'm showing you this to show that the
snapshot isolation technique um solves

1898
00:41:08,630 --> 00:41:08,640
snapshot isolation technique um solves
 

1899
00:41:08,640 --> 00:41:10,470
snapshot isolation technique um solves
our problem

1900
00:41:10,470 --> 00:41:10,480
our problem
 

1901
00:41:10,480 --> 00:41:13,910
our problem
causes the readonly transaction to uh be

1902
00:41:13,910 --> 00:41:13,920
causes the readonly transaction to uh be
 

1903
00:41:13,920 --> 00:41:16,069
causes the readonly transaction to uh be
serializable. So again we have these two

1904
00:41:16,069 --> 00:41:16,079
serializable. So again we have these two
 

1905
00:41:16,079 --> 00:41:19,109
serializable. So again we have these two
read write transactions T1 and T2 and we

1906
00:41:19,109 --> 00:41:19,119
read write transactions T1 and T2 and we
 

1907
00:41:19,119 --> 00:41:21,190
read write transactions T1 and T2 and we
have our transaction that's a readonly

1908
00:41:21,190 --> 00:41:21,200
have our transaction that's a readonly
 

1909
00:41:21,200 --> 00:41:22,710
have our transaction that's a readonly
transaction

1910
00:41:22,710 --> 00:41:22,720
transaction
 

1911
00:41:22,720 --> 00:41:27,910
transaction
T1 and T2 um

1912
00:41:27,910 --> 00:41:27,920

 

1913
00:41:27,920 --> 00:41:31,190

uh write as before they write and they

1914
00:41:31,190 --> 00:41:31,200
uh write as before they write and they
 

1915
00:41:31,200 --> 00:41:36,390
uh write as before they write and they
commit um

1916
00:41:36,390 --> 00:41:36,400

 

1917
00:41:36,400 --> 00:41:38,550

but now they're allocating themselves

1918
00:41:38,550 --> 00:41:38,560
but now they're allocating themselves
 

1919
00:41:38,560 --> 00:41:41,430
but now they're allocating themselves
timestamps as of the commit time. So um

1920
00:41:41,430 --> 00:41:41,440
timestamps as of the commit time. So um
 

1921
00:41:41,440 --> 00:41:43,030
timestamps as of the commit time. So um
in addition to using two-phase commit

1922
00:41:43,030 --> 00:41:43,040
in addition to using two-phase commit
 

1923
00:41:43,040 --> 00:41:44,470
in addition to using two-phase commit
and two-face locking, these rewrite

1924
00:41:44,470 --> 00:41:44,480
and two-face locking, these rewrite
 

1925
00:41:44,480 --> 00:41:46,470
and two-face locking, these rewrite
transactions allocate a time stamp. So

1926
00:41:46,470 --> 00:41:46,480
transactions allocate a time stamp. So
 

1927
00:41:46,480 --> 00:41:48,710
transactions allocate a time stamp. So
let's imagine that at uh the time of the

1928
00:41:48,710 --> 00:41:48,720
let's imagine that at uh the time of the
 

1929
00:41:48,720 --> 00:41:51,030
let's imagine that at uh the time of the
commit, T1 looked at the clock and saw

1930
00:41:51,030 --> 00:41:51,040
commit, T1 looked at the clock and saw
 

1931
00:41:51,040 --> 00:41:53,430
commit, T1 looked at the clock and saw
that it um the time was 10. And I'm

1932
00:41:53,430 --> 00:41:53,440
that it um the time was 10. And I'm
 

1933
00:41:53,440 --> 00:41:55,750
that it um the time was 10. And I'm
going to use times of 10 and 20 and

1934
00:41:55,750 --> 00:41:55,760
going to use times of 10 and 20 and
 

1935
00:41:55,760 --> 00:41:57,750
going to use times of 10 and 20 and
whatnot. Um but you know, you should

1936
00:41:57,750 --> 00:41:57,760
whatnot. Um but you know, you should
 

1937
00:41:57,760 --> 00:41:59,990
whatnot. Um but you know, you should
imagine times as being real times like

1938
00:41:59,990 --> 00:42:00,000
imagine times as being real times like
 

1939
00:42:00,000 --> 00:42:02,630
imagine times as being real times like
4:00 in the morning on a given day. So

1940
00:42:02,630 --> 00:42:02,640
4:00 in the morning on a given day. So
 

1941
00:42:02,640 --> 00:42:05,829
4:00 in the morning on a given day. So
um let's say that T1 sees the time as 10

1942
00:42:05,829 --> 00:42:05,839
um let's say that T1 sees the time as 10
 

1943
00:42:05,839 --> 00:42:09,109
um let's say that T1 sees the time as 10
when it committed. Um and T2

1944
00:42:09,109 --> 00:42:09,119
when it committed. Um and T2
 

1945
00:42:09,119 --> 00:42:11,589
when it committed. Um and T2
um sees that at the commit time the time

1946
00:42:11,589 --> 00:42:11,599
um sees that at the commit time the time
 

1947
00:42:11,599 --> 00:42:13,510
um sees that at the commit time the time
was 20. So I'm going to write these

1948
00:42:13,510 --> 00:42:13,520
was 20. So I'm going to write these
 

1949
00:42:13,520 --> 00:42:15,990
was 20. So I'm going to write these
transactions chosen time stamp after the

1950
00:42:15,990 --> 00:42:16,000
transactions chosen time stamp after the
 

1951
00:42:16,000 --> 00:42:21,829
transactions chosen time stamp after the
at sign. Um then the uh database uh

1952
00:42:21,829 --> 00:42:21,839
at sign. Um then the uh database uh
 

1953
00:42:21,839 --> 00:42:23,510
at sign. Um then the uh database uh
storage systems the spanner storage

1954
00:42:23,510 --> 00:42:23,520
storage systems the spanner storage
 

1955
00:42:23,520 --> 00:42:26,390
storage systems the spanner storage
systems are going to store um when

1956
00:42:26,390 --> 00:42:26,400
systems are going to store um when
 

1957
00:42:26,400 --> 00:42:28,150
systems are going to store um when
transaction one does its writes they're

1958
00:42:28,150 --> 00:42:28,160
transaction one does its writes they're
 

1959
00:42:28,160 --> 00:42:30,309
transaction one does its writes they're
going to store a new sort of not instead

1960
00:42:30,309 --> 00:42:30,319
going to store a new sort of not instead
 

1961
00:42:30,319 --> 00:42:31,670
going to store a new sort of not instead
of overwriting the current value they're

1962
00:42:31,670 --> 00:42:31,680
of overwriting the current value they're
 

1963
00:42:31,680 --> 00:42:33,829
of overwriting the current value they're
just going to add a new copy of this

1964
00:42:33,829 --> 00:42:33,839
just going to add a new copy of this
 

1965
00:42:33,839 --> 00:42:35,829
just going to add a new copy of this
record u with the time stamp. So it's

1966
00:42:35,829 --> 00:42:35,839
record u with the time stamp. So it's
 

1967
00:42:35,839 --> 00:42:37,430
record u with the time stamp. So it's
going to the database is going to store

1968
00:42:37,430 --> 00:42:37,440
going to the database is going to store
 

1969
00:42:37,440 --> 00:42:39,990
going to the database is going to store
away a new record that says the value of

1970
00:42:39,990 --> 00:42:40,000
away a new record that says the value of
 

1971
00:42:40,000 --> 00:42:43,349
away a new record that says the value of
x at time 10 is whatever it happens to

1972
00:42:43,349 --> 00:42:43,359
x at time 10 is whatever it happens to
 

1973
00:42:43,359 --> 00:42:47,190
x at time 10 is whatever it happens to
be let's say nine. The value of uh

1974
00:42:47,190 --> 00:42:47,200
be let's say nine. The value of uh
 

1975
00:42:47,200 --> 00:42:51,670
be let's say nine. The value of uh
record y at time 10 is say 11. Maybe

1976
00:42:51,670 --> 00:42:51,680
record y at time 10 is say 11. Maybe
 

1977
00:42:51,680 --> 00:42:55,510
record y at time 10 is say 11. Maybe
we're doing a transfer from x to y.

1978
00:42:55,510 --> 00:42:55,520
we're doing a transfer from x to y.
 

1979
00:42:55,520 --> 00:42:58,150
we're doing a transfer from x to y.
Similarly t2 chose time stamp of 20

1980
00:42:58,150 --> 00:42:58,160
Similarly t2 chose time stamp of 20
 

1981
00:42:58,160 --> 00:42:59,510
Similarly t2 chose time stamp of 20
because that was the real time at commit

1982
00:42:59,510 --> 00:42:59,520
because that was the real time at commit
 

1983
00:42:59,520 --> 00:43:01,190
because that was the real time at commit
time and the database is going to

1984
00:43:01,190 --> 00:43:01,200
time and the database is going to
 

1985
00:43:01,200 --> 00:43:02,790
time and the database is going to
remember a new set of records in

1986
00:43:02,790 --> 00:43:02,800
remember a new set of records in
 

1987
00:43:02,800 --> 00:43:05,109
remember a new set of records in
addition um to these old ones. just

1988
00:43:05,109 --> 00:43:05,119
addition um to these old ones. just
 

1989
00:43:05,119 --> 00:43:09,190
addition um to these old ones. just
going to say x at time 20

1990
00:43:09,190 --> 00:43:09,200
going to say x at time 20
 

1991
00:43:09,200 --> 00:43:12,550
going to say x at time 20
um if we did a another transfer from x

1992
00:43:12,550 --> 00:43:12,560
um if we did a another transfer from x
 

1993
00:43:12,560 --> 00:43:16,150
um if we did a another transfer from x
to y and y at time 20

1994
00:43:16,150 --> 00:43:16,160
to y and y at time 20
 

1995
00:43:16,160 --> 00:43:18,710
to y and y at time 20
equals 12. So now I have two copies of

1996
00:43:18,710 --> 00:43:18,720
equals 12. So now I have two copies of
 

1997
00:43:18,720 --> 00:43:20,630
equals 12. So now I have two copies of
each record at different times. Now t

1998
00:43:20,630 --> 00:43:20,640
each record at different times. Now t
 

1999
00:43:20,640 --> 00:43:22,630
each record at different times. Now t
transaction 3 is going to come along and

2000
00:43:22,630 --> 00:43:22,640
transaction 3 is going to come along and
 

2001
00:43:22,640 --> 00:43:24,870
transaction 3 is going to come along and
again it starts

2002
00:43:24,870 --> 00:43:24,880
again it starts
 

2003
00:43:24,880 --> 00:43:27,270
again it starts
um at about this time and does a read of

2004
00:43:27,270 --> 00:43:27,280
um at about this time and does a read of
 

2005
00:43:27,280 --> 00:43:29,829
um at about this time and does a read of
x and again it's going to be slow so you

2006
00:43:29,829 --> 00:43:29,839
x and again it's going to be slow so you
 

2007
00:43:29,839 --> 00:43:31,190
x and again it's going to be slow so you
know it's not going to get around to

2008
00:43:31,190 --> 00:43:31,200
know it's not going to get around to
 

2009
00:43:31,200 --> 00:43:34,230
know it's not going to get around to
reading y until much later much later in

2010
00:43:34,230 --> 00:43:34,240
reading y until much later much later in
 

2011
00:43:34,240 --> 00:43:37,510
reading y until much later much later in
real time however when transaction 3

2012
00:43:37,510 --> 00:43:37,520
real time however when transaction 3
 

2013
00:43:37,520 --> 00:43:40,470
real time however when transaction 3
started it chose a timestamp by looking

2014
00:43:40,470 --> 00:43:40,480
started it chose a timestamp by looking
 

2015
00:43:40,480 --> 00:43:43,030
started it chose a timestamp by looking
at the uh looking at the current time

2016
00:43:43,030 --> 00:43:43,040
at the uh looking at the current time
 

2017
00:43:43,040 --> 00:43:45,349
at the uh looking at the current time
and and so let's say so we know in real

2018
00:43:45,349 --> 00:43:45,359
and and so let's say so we know in real
 

2019
00:43:45,359 --> 00:43:48,069
and and so let's say so we know in real
time that transaction 3 started after

2020
00:43:48,069 --> 00:43:48,079
time that transaction 3 started after
 

2021
00:43:48,079 --> 00:43:49,829
time that transaction 3 started after
transaction one and before transaction

2022
00:43:49,829 --> 00:43:49,839
transaction one and before transaction
 

2023
00:43:49,839 --> 00:43:51,750
transaction one and before transaction
two, we know it's got to have chosen a

2024
00:43:51,750 --> 00:43:51,760
two, we know it's got to have chosen a
 

2025
00:43:51,760 --> 00:43:53,750
two, we know it's got to have chosen a
transaction time somewhere between 10

2026
00:43:53,750 --> 00:43:53,760
transaction time somewhere between 10
 

2027
00:43:53,760 --> 00:43:58,309
transaction time somewhere between 10
and 20. Um, and let's suppose it started

2028
00:43:58,309 --> 00:43:58,319
and 20. Um, and let's suppose it started
 

2029
00:43:58,319 --> 00:44:01,190
and 20. Um, and let's suppose it started
at time 15 and chose time stamp 15 for

2030
00:44:01,190 --> 00:44:01,200
at time 15 and chose time stamp 15 for
 

2031
00:44:01,200 --> 00:44:03,910
at time 15 and chose time stamp 15 for
itself. So that mean when it does the

2032
00:44:03,910 --> 00:44:03,920
itself. So that mean when it does the
 

2033
00:44:03,920 --> 00:44:07,030
itself. So that mean when it does the
read of X, it's going to send a a

2034
00:44:07,030 --> 00:44:07,040
read of X, it's going to send a a
 

2035
00:44:07,040 --> 00:44:10,390
read of X, it's going to send a a
request to the local replica that holds

2036
00:44:10,390 --> 00:44:10,400
request to the local replica that holds
 

2037
00:44:10,400 --> 00:44:12,230
request to the local replica that holds
X and it's going to accompany it with it

2038
00:44:12,230 --> 00:44:12,240
X and it's going to accompany it with it
 

2039
00:44:12,240 --> 00:44:13,750
X and it's going to accompany it with it
time stamp of 15. It's going to say,

2040
00:44:13,750 --> 00:44:13,760
time stamp of 15. It's going to say,
 

2041
00:44:13,760 --> 00:44:15,829
time stamp of 15. It's going to say,
please give me the latest data as of

2042
00:44:15,829 --> 00:44:15,839
please give me the latest data as of
 

2043
00:44:15,839 --> 00:44:19,589
please give me the latest data as of
time 15. Um but of course transaction

2044
00:44:19,589 --> 00:44:19,599
time 15. Um but of course transaction
 

2045
00:44:19,599 --> 00:44:21,190
time 15. Um but of course transaction
two hasn't executed yet and but

2046
00:44:21,190 --> 00:44:21,200
two hasn't executed yet and but
 

2047
00:44:21,200 --> 00:44:24,710
two hasn't executed yet and but
nevertheless the highest time stamp copy

2048
00:44:24,710 --> 00:44:24,720
nevertheless the highest time stamp copy
 

2049
00:44:24,720 --> 00:44:27,910
nevertheless the highest time stamp copy
of X um is the one from time 10 written

2050
00:44:27,910 --> 00:44:27,920
of X um is the one from time 10 written
 

2051
00:44:27,920 --> 00:44:29,670
of X um is the one from time 10 written
by transaction one. So we're going to

2052
00:44:29,670 --> 00:44:29,680
by transaction one. So we're going to
 

2053
00:44:29,680 --> 00:44:34,069
by transaction one. So we're going to
get um nine for this one. Time passes.

2054
00:44:34,069 --> 00:44:34,079
get um nine for this one. Time passes.
 

2055
00:44:34,079 --> 00:44:36,230
get um nine for this one. Time passes.
Transaction two commits. Now transaction

2056
00:44:36,230 --> 00:44:36,240
Transaction two commits. Now transaction
 

2057
00:44:36,240 --> 00:44:37,589
Transaction two commits. Now transaction
three does it second read. Again it

2058
00:44:37,589 --> 00:44:37,599
three does it second read. Again it
 

2059
00:44:37,599 --> 00:44:39,910
three does it second read. Again it
accompanies it the read request with its

2060
00:44:39,910 --> 00:44:39,920
accompanies it the read request with its
 

2061
00:44:39,920 --> 00:44:42,390
accompanies it the read request with its
own time stamp of 15. Sends it to the

2062
00:44:42,390 --> 00:44:42,400
own time stamp of 15. Sends it to the
 

2063
00:44:42,400 --> 00:44:43,750
own time stamp of 15. Sends it to the
servers. Now the servers have two

2064
00:44:43,750 --> 00:44:43,760
servers. Now the servers have two
 

2065
00:44:43,760 --> 00:44:46,550
servers. Now the servers have two
records. But again, because the server

2066
00:44:46,550 --> 00:44:46,560
records. But again, because the server
 

2067
00:44:46,560 --> 00:44:49,109
records. But again, because the server
gets transaction 3's time stamp of 15,

2068
00:44:49,109 --> 00:44:49,119
gets transaction 3's time stamp of 15,
 

2069
00:44:49,119 --> 00:44:51,589
gets transaction 3's time stamp of 15,
it looks at its records and say, "Ha, 15

2070
00:44:51,589 --> 00:44:51,599
it looks at its records and say, "Ha, 15
 

2071
00:44:51,599 --> 00:44:53,190
it looks at its records and say, "Ha, 15
sits between these two, I'm going to

2072
00:44:53,190 --> 00:44:53,200
sits between these two, I'm going to
 

2073
00:44:53,200 --> 00:44:55,349
sits between these two, I'm going to
return the highest time stamp record for

2074
00:44:55,349 --> 00:44:55,359
return the highest time stamp record for
 

2075
00:44:55,359 --> 00:44:58,630
return the highest time stamp record for
X for Y." Um, that's less than the

2076
00:44:58,630 --> 00:44:58,640
X for Y." Um, that's less than the
 

2077
00:44:58,640 --> 00:45:01,510
X for Y." Um, that's less than the
requested time stamp, and that's still

2078
00:45:01,510 --> 00:45:01,520
requested time stamp, and that's still
 

2079
00:45:01,520 --> 00:45:03,910
requested time stamp, and that's still
uh the version of Y from time 10. So,

2080
00:45:03,910 --> 00:45:03,920
uh the version of Y from time 10. So,
 

2081
00:45:03,920 --> 00:45:07,349
uh the version of Y from time 10. So,
the read of Y will return 11.

2082
00:45:07,349 --> 00:45:07,359
the read of Y will return 11.
 

2083
00:45:07,359 --> 00:45:09,670
the read of Y will return 11.
That is the read of X essentially

2084
00:45:09,670 --> 00:45:09,680
That is the read of X essentially
 

2085
00:45:09,680 --> 00:45:11,510
That is the read of X essentially
happens at this time. But because we

2086
00:45:11,510 --> 00:45:11,520
happens at this time. But because we
 

2087
00:45:11,520 --> 00:45:13,589
happens at this time. But because we
remembered a time stamp and we have the

2088
00:45:13,589 --> 00:45:13,599
remembered a time stamp and we have the
 

2089
00:45:13,599 --> 00:45:17,030
remembered a time stamp and we have the
database keep data as of um different

2090
00:45:17,030 --> 00:45:17,040
database keep data as of um different
 

2091
00:45:17,040 --> 00:45:19,190
database keep data as of um different
times it was written, it's as if both

2092
00:45:19,190 --> 00:45:19,200
times it was written, it's as if both
 

2093
00:45:19,200 --> 00:45:24,550
times it was written, it's as if both
reads happened um at time 15 instead of

2094
00:45:24,550 --> 00:45:24,560
reads happened um at time 15 instead of
 

2095
00:45:24,560 --> 00:45:28,630
reads happened um at time 15 instead of
one at time 15 and one later. Um and now

2096
00:45:28,630 --> 00:45:28,640
one at time 15 and one later. Um and now
 

2097
00:45:28,640 --> 00:45:31,349
one at time 15 and one later. Um and now
you'll see that in fact this just

2098
00:45:31,349 --> 00:45:31,359
you'll see that in fact this just
 

2099
00:45:31,359 --> 00:45:34,230
you'll see that in fact this just
essentially emulates a serial one at a

2100
00:45:34,230 --> 00:45:34,240
essentially emulates a serial one at a
 

2101
00:45:34,240 --> 00:45:36,230
essentially emulates a serial one at a
time execution in which the order is

2102
00:45:36,230 --> 00:45:36,240
time execution in which the order is
 

2103
00:45:36,240 --> 00:45:39,030
time execution in which the order is
timestamp order. transaction one, then

2104
00:45:39,030 --> 00:45:39,040
timestamp order. transaction one, then
 

2105
00:45:39,040 --> 00:45:41,990
timestamp order. transaction one, then
transaction two, sorry, then transaction

2106
00:45:41,990 --> 00:45:42,000
transaction two, sorry, then transaction
 

2107
00:45:42,000 --> 00:45:43,589
transaction two, sorry, then transaction
three,

2108
00:45:43,589 --> 00:45:43,599
three,
 

2109
00:45:43,599 --> 00:45:46,630
three,
then transaction two. That is the serial

2110
00:45:46,630 --> 00:45:46,640
then transaction two. That is the serial
 

2111
00:45:46,640 --> 00:45:48,630
then transaction two. That is the serial
order that is equivalent to the results

2112
00:45:48,630 --> 00:45:48,640
order that is equivalent to the results
 

2113
00:45:48,640 --> 00:45:50,390
order that is equivalent to the results
that were actually produced is the time

2114
00:45:50,390 --> 00:45:50,400
that were actually produced is the time
 

2115
00:45:50,400 --> 00:45:56,550
that were actually produced is the time
stamp order of 10, 15, 20.

2116
00:45:56,550 --> 00:45:56,560

 

2117
00:45:56,560 --> 00:46:00,950

All right. Um, okay. So, that's a kind

2118
00:46:00,950 --> 00:46:00,960
All right. Um, okay. So, that's a kind
 

2119
00:46:00,960 --> 00:46:04,069
All right. Um, okay. So, that's a kind
of simplified version of what Spanner

2120
00:46:04,069 --> 00:46:04,079
of simplified version of what Spanner
 

2121
00:46:04,079 --> 00:46:07,510
of simplified version of what Spanner
does for readonly transactions.

2122
00:46:07,510 --> 00:46:07,520
does for readonly transactions.
 

2123
00:46:07,520 --> 00:46:09,030
does for readonly transactions.
Um

2124
00:46:09,030 --> 00:46:09,040
Um
 

2125
00:46:09,040 --> 00:46:10,390
Um
there's more complexity which I'll get

2126
00:46:10,390 --> 00:46:10,400
there's more complexity which I'll get
 

2127
00:46:10,400 --> 00:46:13,190
there's more complexity which I'll get
to in a minute. Um one question you

2128
00:46:13,190 --> 00:46:13,200
to in a minute. Um one question you
 

2129
00:46:13,200 --> 00:46:16,309
to in a minute. Um one question you
might have is why it was okay for

2130
00:46:16,309 --> 00:46:16,319
might have is why it was okay for
 

2131
00:46:16,319 --> 00:46:19,349
might have is why it was okay for
transaction 3 to read an old value of Y.

2132
00:46:19,349 --> 00:46:19,359
transaction 3 to read an old value of Y.
 

2133
00:46:19,359 --> 00:46:22,710
transaction 3 to read an old value of Y.
That is it issued this read of Y at this

2134
00:46:22,710 --> 00:46:22,720
That is it issued this read of Y at this
 

2135
00:46:22,720 --> 00:46:25,990
That is it issued this read of Y at this
point in time. The freshest data for Y

2136
00:46:25,990 --> 00:46:26,000
point in time. The freshest data for Y
 

2137
00:46:26,000 --> 00:46:28,630
point in time. The freshest data for Y
was this value 12. But the value it

2138
00:46:28,630 --> 00:46:28,640
was this value 12. But the value it
 

2139
00:46:28,640 --> 00:46:30,950
was this value 12. But the value it
actually got was intentionally a stale

2140
00:46:30,950 --> 00:46:30,960
actually got was intentionally a stale
 

2141
00:46:30,960 --> 00:46:33,829
actually got was intentionally a stale
value. Not the freshest value but the

2142
00:46:33,829 --> 00:46:33,839
value. Not the freshest value but the
 

2143
00:46:33,839 --> 00:46:36,790
value. Not the freshest value but the
value from a while ago. this value 11.

2144
00:46:36,790 --> 00:46:36,800
value from a while ago. this value 11.
 

2145
00:46:36,800 --> 00:46:38,870
value from a while ago. this value 11.
So why is that okay? Why is it okay not

2146
00:46:38,870 --> 00:46:38,880
So why is that okay? Why is it okay not
 

2147
00:46:38,880 --> 00:46:42,230
So why is that okay? Why is it okay not
to be using the freshest um version of

2148
00:46:42,230 --> 00:46:42,240
to be using the freshest um version of
 

2149
00:46:42,240 --> 00:46:46,550
to be using the freshest um version of
the data and um the kind of technical

2150
00:46:46,550 --> 00:46:46,560
the data and um the kind of technical
 

2151
00:46:46,560 --> 00:46:49,030
the data and um the kind of technical
justification for that is that

2152
00:46:49,030 --> 00:46:49,040
justification for that is that
 

2153
00:46:49,040 --> 00:46:51,349
justification for that is that
transaction two and transaction 3 are

2154
00:46:51,349 --> 00:46:51,359
transaction two and transaction 3 are
 

2155
00:46:51,359 --> 00:46:53,670
transaction two and transaction 3 are
concurrent that is they overlap in time.

2156
00:46:53,670 --> 00:46:53,680
concurrent that is they overlap in time.
 

2157
00:46:53,680 --> 00:46:56,069
concurrent that is they overlap in time.
So the sort of time extent of

2158
00:46:56,069 --> 00:46:56,079
So the sort of time extent of
 

2159
00:46:56,079 --> 00:46:58,550
So the sort of time extent of
transaction two is here and the time

2160
00:46:58,550 --> 00:46:58,560
transaction two is here and the time
 

2161
00:46:58,560 --> 00:47:00,309
transaction two is here and the time
extent of transaction three is here.

2162
00:47:00,309 --> 00:47:00,319
extent of transaction three is here.
 

2163
00:47:00,319 --> 00:47:02,870
extent of transaction three is here.
they're concurrent and the rules for

2164
00:47:02,870 --> 00:47:02,880
they're concurrent and the rules for
 

2165
00:47:02,880 --> 00:47:05,349
they're concurrent and the rules for
linearizability and external consistency

2166
00:47:05,349 --> 00:47:05,359
linearizability and external consistency
 

2167
00:47:05,359 --> 00:47:07,190
linearizability and external consistency
are that if two transactions are

2168
00:47:07,190 --> 00:47:07,200
are that if two transactions are
 

2169
00:47:07,200 --> 00:47:08,870
are that if two transactions are
concurrent

2170
00:47:08,870 --> 00:47:08,880
concurrent
 

2171
00:47:08,880 --> 00:47:12,309
concurrent
um then the serial order that the

2172
00:47:12,309 --> 00:47:12,319
um then the serial order that the
 

2173
00:47:12,319 --> 00:47:14,950
um then the serial order that the
database is allowed to use can be can

2174
00:47:14,950 --> 00:47:14,960
database is allowed to use can be can
 

2175
00:47:14,960 --> 00:47:17,109
database is allowed to use can be can
put the two transactions in either order

2176
00:47:17,109 --> 00:47:17,119
put the two transactions in either order
 

2177
00:47:17,119 --> 00:47:19,910
put the two transactions in either order
and here the database spanner has chosen

2178
00:47:19,910 --> 00:47:19,920
and here the database spanner has chosen
 

2179
00:47:19,920 --> 00:47:21,750
and here the database spanner has chosen
to put transaction three before

2180
00:47:21,750 --> 00:47:21,760
to put transaction three before
 

2181
00:47:21,760 --> 00:47:25,990
to put transaction three before
transaction two in the serial order.

2182
00:47:25,990 --> 00:47:26,000
transaction two in the serial order.
 

2183
00:47:26,000 --> 00:47:28,230
transaction two in the serial order.
Okay, I think we Robert, we Yeah, we

2184
00:47:28,230 --> 00:47:28,240
Okay, I think we Robert, we Yeah, we
 

2185
00:47:28,240 --> 00:47:30,550
Okay, I think we Robert, we Yeah, we
have a student question. Does external

2186
00:47:30,550 --> 00:47:30,560
have a student question. Does external
 

2187
00:47:30,560 --> 00:47:32,470
have a student question. Does external
consistency like with time stamps always

2188
00:47:32,470 --> 00:47:32,480
consistency like with time stamps always
 

2189
00:47:32,480 --> 00:47:36,069
consistency like with time stamps always
imply strong consistency?

2190
00:47:36,069 --> 00:47:36,079
imply strong consistency?
 

2191
00:47:36,079 --> 00:47:39,190
imply strong consistency?
Um,

2192
00:47:39,190 --> 00:47:39,200

 

2193
00:47:39,200 --> 00:47:41,910

uh, I'm going to guess.

2194
00:47:41,910 --> 00:47:41,920
uh, I'm going to guess.
 

2195
00:47:41,920 --> 00:47:45,829
uh, I'm going to guess.
Um, I think so. if strong consistency

2196
00:47:45,829 --> 00:47:45,839
Um, I think so. if strong consistency
 

2197
00:47:45,839 --> 00:47:47,430
Um, I think so. if strong consistency
um strong consistency usually what

2198
00:47:47,430 --> 00:47:47,440
um strong consistency usually what
 

2199
00:47:47,440 --> 00:47:50,309
um strong consistency usually what
people mean by that is a linearizability

2200
00:47:50,309 --> 00:47:50,319
people mean by that is a linearizability
 

2201
00:47:50,319 --> 00:47:51,829
people mean by that is a linearizability
and I believe the definition of

2202
00:47:51,829 --> 00:47:51,839
and I believe the definition of
 

2203
00:47:51,839 --> 00:47:54,710
and I believe the definition of
linearizability and uh external

2204
00:47:54,710 --> 00:47:54,720
linearizability and uh external
 

2205
00:47:54,720 --> 00:47:58,069
linearizability and uh external
consistency are the same. So I would say

2206
00:47:58,069 --> 00:47:58,079
consistency are the same. So I would say
 

2207
00:47:58,079 --> 00:48:00,230
consistency are the same. So I would say
yes

2208
00:48:00,230 --> 00:48:00,240
yes
 

2209
00:48:00,240 --> 00:48:01,829
yes
and another question how does this not

2210
00:48:01,829 --> 00:48:01,839
and another question how does this not
 

2211
00:48:01,839 --> 00:48:04,950
and another question how does this not
absolutely blow up storage? That is a

2212
00:48:04,950 --> 00:48:04,960
absolutely blow up storage? That is a
 

2213
00:48:04,960 --> 00:48:07,430
absolutely blow up storage? That is a
great question and the answer is it

2214
00:48:07,430 --> 00:48:07,440
great question and the answer is it
 

2215
00:48:07,440 --> 00:48:09,750
great question and the answer is it
definitely blows up storage and the

2216
00:48:09,750 --> 00:48:09,760
definitely blows up storage and the
 

2217
00:48:09,760 --> 00:48:12,470
definitely blows up storage and the
reason is that um now the storage system

2218
00:48:12,470 --> 00:48:12,480
reason is that um now the storage system
 

2219
00:48:12,480 --> 00:48:16,230
reason is that um now the storage system
has to keep multiple copies um of data

2220
00:48:16,230 --> 00:48:16,240
has to keep multiple copies um of data
 

2221
00:48:16,240 --> 00:48:18,230
has to keep multiple copies um of data
records that have been recently modified

2222
00:48:18,230 --> 00:48:18,240
records that have been recently modified
 

2223
00:48:18,240 --> 00:48:20,710
records that have been recently modified
multiple times. Um and that's definitely

2224
00:48:20,710 --> 00:48:20,720
multiple times. Um and that's definitely
 

2225
00:48:20,720 --> 00:48:23,670
multiple times. Um and that's definitely
expense both um both this cost in

2226
00:48:23,670 --> 00:48:23,680
expense both um both this cost in
 

2227
00:48:23,680 --> 00:48:25,510
expense both um both this cost in
storage and space on the disk and in

2228
00:48:25,510 --> 00:48:25,520
storage and space on the disk and in
 

2229
00:48:25,520 --> 00:48:28,230
storage and space on the disk and in
memory and also it's just like an added

2230
00:48:28,230 --> 00:48:28,240
memory and also it's just like an added
 

2231
00:48:28,240 --> 00:48:30,309
memory and also it's just like an added
layer of bookkeeping um you know now

2232
00:48:30,309 --> 00:48:30,319
layer of bookkeeping um you know now
 

2233
00:48:30,319 --> 00:48:31,910
layer of bookkeeping um you know now
lookups have to consider the time stamps

2234
00:48:31,910 --> 00:48:31,920
lookups have to consider the time stamps
 

2235
00:48:31,920 --> 00:48:35,510
lookups have to consider the time stamps
as well as keys. Um

2236
00:48:35,510 --> 00:48:35,520
as well as keys. Um
 

2237
00:48:35,520 --> 00:48:39,670
as well as keys. Um
the storage expense I think is um not as

2238
00:48:39,670 --> 00:48:39,680
the storage expense I think is um not as
 

2239
00:48:39,680 --> 00:48:42,069
the storage expense I think is um not as
great as it could be because the system

2240
00:48:42,069 --> 00:48:42,079
great as it could be because the system
 

2241
00:48:42,079 --> 00:48:44,549
great as it could be because the system
discards old records. The paper does not

2242
00:48:44,549 --> 00:48:44,559
discards old records. The paper does not
 

2243
00:48:44,559 --> 00:48:47,589
discards old records. The paper does not
say what the policy is. Um but

2244
00:48:47,589 --> 00:48:47,599
say what the policy is. Um but
 

2245
00:48:47,599 --> 00:48:49,829
say what the policy is. Um but
presumably

2246
00:48:49,829 --> 00:48:49,839
presumably
 

2247
00:48:49,839 --> 00:48:51,990
presumably
well it must be discarding old records.

2248
00:48:51,990 --> 00:48:52,000
well it must be discarding old records.
 

2249
00:48:52,000 --> 00:48:53,510
well it must be discarding old records.
Um certainly if the only reason for the

2250
00:48:53,510 --> 00:48:53,520
Um certainly if the only reason for the
 

2251
00:48:53,520 --> 00:48:55,030
Um certainly if the only reason for the
multiple records is to implement

2252
00:48:55,030 --> 00:48:55,040
multiple records is to implement
 

2253
00:48:55,040 --> 00:48:57,829
multiple records is to implement
snapshot isolation of these kinds of

2254
00:48:57,829 --> 00:48:57,839
snapshot isolation of these kinds of
 

2255
00:48:57,839 --> 00:48:59,670
snapshot isolation of these kinds of
transactions then you don't really need

2256
00:48:59,670 --> 00:48:59,680
transactions then you don't really need
 

2257
00:48:59,680 --> 00:49:02,790
transactions then you don't really need
to remember values too far in the past.

2258
00:49:02,790 --> 00:49:02,800
to remember values too far in the past.
 

2259
00:49:02,800 --> 00:49:05,430
to remember values too far in the past.
um because

2260
00:49:05,430 --> 00:49:05,440
um because
 

2261
00:49:05,440 --> 00:49:07,190
um because
um you only need to remember values back

2262
00:49:07,190 --> 00:49:07,200
um you only need to remember values back
 

2263
00:49:07,200 --> 00:49:09,990
um you only need to remember values back
to the sort of earliest time that a that

2264
00:49:09,990 --> 00:49:10,000
to the sort of earliest time that a that
 

2265
00:49:10,000 --> 00:49:11,990
to the sort of earliest time that a that
a transaction could have started at

2266
00:49:11,990 --> 00:49:12,000
a transaction could have started at
 

2267
00:49:12,000 --> 00:49:13,910
a transaction could have started at
that's still running now. And if your

2268
00:49:13,910 --> 00:49:13,920
that's still running now. And if your
 

2269
00:49:13,920 --> 00:49:16,309
that's still running now. And if your
transactions mostly are always finish or

2270
00:49:16,309 --> 00:49:16,319
transactions mostly are always finish or
 

2271
00:49:16,319 --> 00:49:18,230
transactions mostly are always finish or
force to finish by killing them or

2272
00:49:18,230 --> 00:49:18,240
force to finish by killing them or
 

2273
00:49:18,240 --> 00:49:21,030
force to finish by killing them or
something um within say one minute. If

2274
00:49:21,030 --> 00:49:21,040
something um within say one minute. If
 

2275
00:49:21,040 --> 00:49:22,549
something um within say one minute. If
no transaction can take longer than a

2276
00:49:22,549 --> 00:49:22,559
no transaction can take longer than a
 

2277
00:49:22,559 --> 00:49:23,910
no transaction can take longer than a
minute, then you only have to remember

2278
00:49:23,910 --> 00:49:23,920
minute, then you only have to remember
 

2279
00:49:23,920 --> 00:49:27,030
minute, then you only have to remember
the last minute of of versions in the

2280
00:49:27,030 --> 00:49:27,040
the last minute of of versions in the
 

2281
00:49:27,040 --> 00:49:28,870
the last minute of of versions in the
database. Now, in fact, the paper

2282
00:49:28,870 --> 00:49:28,880
database. Now, in fact, the paper
 

2283
00:49:28,880 --> 00:49:31,670
database. Now, in fact, the paper
implies that they remember data farther

2284
00:49:31,670 --> 00:49:31,680
implies that they remember data farther
 

2285
00:49:31,680 --> 00:49:34,150
implies that they remember data farther
back than that because it um appears

2286
00:49:34,150 --> 00:49:34,160
back than that because it um appears
 

2287
00:49:34,160 --> 00:49:35,990
back than that because it um appears
they support

2288
00:49:35,990 --> 00:49:36,000
they support
 

2289
00:49:36,000 --> 00:49:38,790
they support
intentionally support um these snapshot

2290
00:49:38,790 --> 00:49:38,800
intentionally support um these snapshot
 

2291
00:49:38,800 --> 00:49:41,990
intentionally support um these snapshot
reads which allow them to support the

2292
00:49:41,990 --> 00:49:42,000
reads which allow them to support the
 

2293
00:49:42,000 --> 00:49:43,750
reads which allow them to support the
notion of seeing, you know, data from a

2294
00:49:43,750 --> 00:49:43,760
notion of seeing, you know, data from a
 

2295
00:49:43,760 --> 00:49:45,430
notion of seeing, you know, data from a
while ago, you know, yesterday or

2296
00:49:45,430 --> 00:49:45,440
while ago, you know, yesterday or
 

2297
00:49:45,440 --> 00:49:47,190
while ago, you know, yesterday or
something. Um but they don't say what

2298
00:49:47,190 --> 00:49:47,200
something. Um but they don't say what
 

2299
00:49:47,200 --> 00:49:48,870
something. Um but they don't say what
the

2300
00:49:48,870 --> 00:49:48,880
the
 

2301
00:49:48,880 --> 00:49:50,470
the
what the garbage collection policy is

2302
00:49:50,470 --> 00:49:50,480
what the garbage collection policy is
 

2303
00:49:50,480 --> 00:49:52,630
what the garbage collection policy is
for old values. So I don't know how

2304
00:49:52,630 --> 00:49:52,640
for old values. So I don't know how
 

2305
00:49:52,640 --> 00:49:57,589
for old values. So I don't know how
expensive it would be for them.

2306
00:49:57,589 --> 00:49:57,599

 

2307
00:49:57,599 --> 00:49:59,510

Okay.

2308
00:49:59,510 --> 00:49:59,520
Okay.
 

2309
00:49:59,520 --> 00:50:02,069
Okay.
Okay. So the uh the the justification

2310
00:50:02,069 --> 00:50:02,079
Okay. So the uh the the justification
 

2311
00:50:02,079 --> 00:50:03,670
Okay. So the uh the the justification
for why it's legal is that in external

2312
00:50:03,670 --> 00:50:03,680
for why it's legal is that in external
 

2313
00:50:03,680 --> 00:50:06,549
for why it's legal is that in external
consistency the the only rule that

2314
00:50:06,549 --> 00:50:06,559
consistency the the only rule that
 

2315
00:50:06,559 --> 00:50:08,870
consistency the the only rule that
external consistency imposes is that if

2316
00:50:08,870 --> 00:50:08,880
external consistency imposes is that if
 

2317
00:50:08,880 --> 00:50:11,349
external consistency imposes is that if
one transaction has completed then a

2318
00:50:11,349 --> 00:50:11,359
one transaction has completed then a
 

2319
00:50:11,359 --> 00:50:13,510
one transaction has completed then a
transaction that starts after it must

2320
00:50:13,510 --> 00:50:13,520
transaction that starts after it must
 

2321
00:50:13,520 --> 00:50:16,390
transaction that starts after it must
see its rights. So T1 maybe T1

2322
00:50:16,390 --> 00:50:16,400
see its rights. So T1 maybe T1
 

2323
00:50:16,400 --> 00:50:18,390
see its rights. So T1 maybe T1
completed. Let's say that T1 completed

2324
00:50:18,390 --> 00:50:18,400
completed. Let's say that T1 completed
 

2325
00:50:18,400 --> 00:50:22,390
completed. Let's say that T1 completed
at this time and T3 started just after

2326
00:50:22,390 --> 00:50:22,400
at this time and T3 started just after
 

2327
00:50:22,400 --> 00:50:24,309
at this time and T3 started just after
it. Maybe external consistency would

2328
00:50:24,309 --> 00:50:24,319
it. Maybe external consistency would
 

2329
00:50:24,319 --> 00:50:27,349
it. Maybe external consistency would
demand that T3 sees T1's rights. But

2330
00:50:27,349 --> 00:50:27,359
demand that T3 sees T1's rights. But
 

2331
00:50:27,359 --> 00:50:29,910
demand that T3 sees T1's rights. But
since T2 definitely didn't finish before

2332
00:50:29,910 --> 00:50:29,920
since T2 definitely didn't finish before
 

2333
00:50:29,920 --> 00:50:32,549
since T2 definitely didn't finish before
T3 started, we have no obligation under

2334
00:50:32,549 --> 00:50:32,559
T3 started, we have no obligation under
 

2335
00:50:32,559 --> 00:50:35,589
T3 started, we have no obligation under
external consistency for T3 to see T2's

2336
00:50:35,589 --> 00:50:35,599
external consistency for T3 to see T2's
 

2337
00:50:35,599 --> 00:50:39,109
external consistency for T3 to see T2's
rights. And indeed the in this example,

2338
00:50:39,109 --> 00:50:39,119
rights. And indeed the in this example,
 

2339
00:50:39,119 --> 00:50:42,790
rights. And indeed the in this example,
it does not. So it's actually legal.

2340
00:50:42,790 --> 00:50:42,800
it does not. So it's actually legal.
 

2341
00:50:42,800 --> 00:50:44,630
it does not. So it's actually legal.
Um

2342
00:50:44,630 --> 00:50:44,640
Um
 

2343
00:50:44,640 --> 00:50:48,069
Um
okay another problem that comes up um is

2344
00:50:48,069 --> 00:50:48,079
okay another problem that comes up um is
 

2345
00:50:48,079 --> 00:50:49,910
okay another problem that comes up um is
that

2346
00:50:49,910 --> 00:50:49,920
that
 

2347
00:50:49,920 --> 00:50:51,990
that
uh the transaction T3 is needs to read

2348
00:50:51,990 --> 00:50:52,000
uh the transaction T3 is needs to read
 

2349
00:50:52,000 --> 00:50:54,790
uh the transaction T3 is needs to read
data as of a particular time stamp but

2350
00:50:54,790 --> 00:50:54,800
data as of a particular time stamp but
 

2351
00:50:54,800 --> 00:50:56,790
data as of a particular time stamp but
um you know the reason why this is

2352
00:50:56,790 --> 00:50:56,800
um you know the reason why this is
 

2353
00:50:56,800 --> 00:50:58,630
um you know the reason why this is
desirable is that we're it allows us to

2354
00:50:58,630 --> 00:50:58,640
desirable is that we're it allows us to
 

2355
00:50:58,640 --> 00:51:01,349
desirable is that we're it allows us to
read from the local replica in the same

2356
00:51:01,349 --> 00:51:01,359
read from the local replica in the same
 

2357
00:51:01,359 --> 00:51:04,069
read from the local replica in the same
data center but maybe that local replica

2358
00:51:04,069 --> 00:51:04,079
data center but maybe that local replica
 

2359
00:51:04,079 --> 00:51:08,069
data center but maybe that local replica
is in a minority of Paxos followers that

2360
00:51:08,069 --> 00:51:08,079
is in a minority of Paxos followers that
 

2361
00:51:08,079 --> 00:51:10,549
is in a minority of Paxos followers that
didn't see the latest log records the

2362
00:51:10,549 --> 00:51:10,559
didn't see the latest log records the
 

2363
00:51:10,559 --> 00:51:12,950
didn't see the latest log records the
leader so maybe our local replica uh

2364
00:51:12,950 --> 00:51:12,960
leader so maybe our local replica uh
 

2365
00:51:12,960 --> 00:51:15,589
leader so maybe our local replica uh
maybe it's never even seen, you know,

2366
00:51:15,589 --> 00:51:15,599
maybe it's never even seen, you know,
 

2367
00:51:15,599 --> 00:51:17,829
maybe it's never even seen, you know,
never saw these rights to X and Y at

2368
00:51:17,829 --> 00:51:17,839
never saw these rights to X and Y at
 

2369
00:51:17,839 --> 00:51:20,309
never saw these rights to X and Y at
all. It's still back at a version from

2370
00:51:20,309 --> 00:51:20,319
all. It's still back at a version from
 

2371
00:51:20,319 --> 00:51:24,150
all. It's still back at a version from
time, you know, five or six or seven. Um

2372
00:51:24,150 --> 00:51:24,160
time, you know, five or six or seven. Um
 

2373
00:51:24,160 --> 00:51:26,069
time, you know, five or six or seven. Um
and so if we don't do something clever

2374
00:51:26,069 --> 00:51:26,079
and so if we don't do something clever
 

2375
00:51:26,079 --> 00:51:28,549
and so if we don't do something clever
when we ask for the sort of highest

2376
00:51:28,549 --> 00:51:28,559
when we ask for the sort of highest
 

2377
00:51:28,559 --> 00:51:30,150
when we ask for the sort of highest
version

2378
00:51:30,150 --> 00:51:30,160
version
 

2379
00:51:30,160 --> 00:51:32,630
version
uh record, you know, less than time

2380
00:51:32,630 --> 00:51:32,640
uh record, you know, less than time
 

2381
00:51:32,640 --> 00:51:34,710
uh record, you know, less than time
stamp 15, we may get some much older

2382
00:51:34,710 --> 00:51:34,720
stamp 15, we may get some much older
 

2383
00:51:34,720 --> 00:51:37,030
stamp 15, we may get some much older
version that's not actually the value

2384
00:51:37,030 --> 00:51:37,040
version that's not actually the value
 

2385
00:51:37,040 --> 00:51:39,030
version that's not actually the value
produced by transaction one, which we're

2386
00:51:39,030 --> 00:51:39,040
produced by transaction one, which we're
 

2387
00:51:39,040 --> 00:51:41,589
produced by transaction one, which we're
required to see.

2388
00:51:41,589 --> 00:51:41,599
required to see.
 

2389
00:51:41,599 --> 00:51:44,630
required to see.
Um so the way Spanner deals with this is

2390
00:51:44,630 --> 00:51:44,640
Um so the way Spanner deals with this is
 

2391
00:51:44,640 --> 00:51:49,829
Um so the way Spanner deals with this is
with their notion of safe time. Um

2392
00:51:49,829 --> 00:51:49,839

 

2393
00:51:49,839 --> 00:51:51,829

and

2394
00:51:51,829 --> 00:51:51,839
and
 

2395
00:51:51,839 --> 00:51:54,630
and
uh the scoop is that each replica

2396
00:51:54,630 --> 00:51:54,640
uh the scoop is that each replica
 

2397
00:51:54,640 --> 00:51:57,670
uh the scoop is that each replica
remembers you know it's getting log

2398
00:51:57,670 --> 00:51:57,680
remembers you know it's getting log
 

2399
00:51:57,680 --> 00:52:00,150
remembers you know it's getting log
records from its Paxos's leader and the

2400
00:52:00,150 --> 00:52:00,160
records from its Paxos's leader and the
 

2401
00:52:00,160 --> 00:52:03,109
records from its Paxos's leader and the
log records um it turns out that the

2402
00:52:03,109 --> 00:52:03,119
log records um it turns out that the
 

2403
00:52:03,119 --> 00:52:04,710
log records um it turns out that the
paper arranges so that the leader sends

2404
00:52:04,710 --> 00:52:04,720
paper arranges so that the leader sends
 

2405
00:52:04,720 --> 00:52:06,630
paper arranges so that the leader sends
out log records in strictly increasing

2406
00:52:06,630 --> 00:52:06,640
out log records in strictly increasing
 

2407
00:52:06,640 --> 00:52:10,069
out log records in strictly increasing
timestamp order. So a replica can look

2408
00:52:10,069 --> 00:52:10,079
timestamp order. So a replica can look
 

2409
00:52:10,079 --> 00:52:12,309
timestamp order. So a replica can look
at the very last log record it's gotten

2410
00:52:12,309 --> 00:52:12,319
at the very last log record it's gotten
 

2411
00:52:12,319 --> 00:52:14,950
at the very last log record it's gotten
from its leader to know uh how up to

2412
00:52:14,950 --> 00:52:14,960
from its leader to know uh how up to
 

2413
00:52:14,960 --> 00:52:18,069
from its leader to know uh how up to
date it is. So um if I ask for a value

2414
00:52:18,069 --> 00:52:18,079
date it is. So um if I ask for a value
 

2415
00:52:18,079 --> 00:52:21,670
date it is. So um if I ask for a value
as of time stamp 15, but the um replica

2416
00:52:21,670 --> 00:52:21,680
as of time stamp 15, but the um replica
 

2417
00:52:21,680 --> 00:52:24,630
as of time stamp 15, but the um replica
has only gotten log entries from a paxos

2418
00:52:24,630 --> 00:52:24,640
has only gotten log entries from a paxos
 

2419
00:52:24,640 --> 00:52:26,790
has only gotten log entries from a paxos
leader up through time stamp 13, the

2420
00:52:26,790 --> 00:52:26,800
leader up through time stamp 13, the
 

2421
00:52:26,800 --> 00:52:28,470
leader up through time stamp 13, the
replica is going to make us delay. It's

2422
00:52:28,470 --> 00:52:28,480
replica is going to make us delay. It's
 

2423
00:52:28,480 --> 00:52:30,950
replica is going to make us delay. It's
not going to answer um until it's gotten

2424
00:52:30,950 --> 00:52:30,960
not going to answer um until it's gotten
 

2425
00:52:30,960 --> 00:52:33,589
not going to answer um until it's gotten
a log record with time stamp 15 from the

2426
00:52:33,589 --> 00:52:33,599
a log record with time stamp 15 from the
 

2427
00:52:33,599 --> 00:52:36,549
a log record with time stamp 15 from the
leader. Um, and this ensures that

2428
00:52:36,549 --> 00:52:36,559
leader. Um, and this ensures that
 

2429
00:52:36,559 --> 00:52:39,190
leader. Um, and this ensures that
replicas don't answer um, a request for

2430
00:52:39,190 --> 00:52:39,200
replicas don't answer um, a request for
 

2431
00:52:39,200 --> 00:52:40,549
replicas don't answer um, a request for
a given time stamp until they're

2432
00:52:40,549 --> 00:52:40,559
a given time stamp until they're
 

2433
00:52:40,559 --> 00:52:42,069
a given time stamp until they're
guaranteed to know everything from the

2434
00:52:42,069 --> 00:52:42,079
guaranteed to know everything from the
 

2435
00:52:42,079 --> 00:52:44,950
guaranteed to know everything from the
leader um, up through that time stamp.

2436
00:52:44,950 --> 00:52:44,960
leader um, up through that time stamp.
 

2437
00:52:44,960 --> 00:52:48,150
leader um, up through that time stamp.
And so this may delay um,

2438
00:52:48,150 --> 00:52:48,160
And so this may delay um,
 

2439
00:52:48,160 --> 00:52:52,790
And so this may delay um,
this may delay the reads.

2440
00:52:52,790 --> 00:52:52,800

 

2441
00:52:52,800 --> 00:52:55,910

Okay.

2442
00:52:55,910 --> 00:52:55,920

 

2443
00:52:55,920 --> 00:52:59,109

Um

2444
00:52:59,109 --> 00:52:59,119

 

2445
00:52:59,119 --> 00:53:01,510

so the next question I've been assuming

2446
00:53:01,510 --> 00:53:01,520
so the next question I've been assuming
 

2447
00:53:01,520 --> 00:53:03,589
so the next question I've been assuming
I assumed in this discussion that the

2448
00:53:03,589 --> 00:53:03,599
I assumed in this discussion that the
 

2449
00:53:03,599 --> 00:53:05,430
I assumed in this discussion that the
clocks and all the different servers are

2450
00:53:05,430 --> 00:53:05,440
clocks and all the different servers are
 

2451
00:53:05,440 --> 00:53:07,670
clocks and all the different servers are
perfectly synchronized. So everybody's

2452
00:53:07,670 --> 00:53:07,680
perfectly synchronized. So everybody's
 

2453
00:53:07,680 --> 00:53:11,109
perfectly synchronized. So everybody's
clock says you know 10:01 and 30 seconds

2454
00:53:11,109 --> 00:53:11,119
clock says you know 10:01 and 30 seconds
 

2455
00:53:11,119 --> 00:53:15,109
clock says you know 10:01 and 30 seconds
at exactly the same time. Um but it

2456
00:53:15,109 --> 00:53:15,119
at exactly the same time. Um but it
 

2457
00:53:15,119 --> 00:53:19,030
at exactly the same time. Um but it
turns out that you can't um synchronize

2458
00:53:19,030 --> 00:53:19,040
turns out that you can't um synchronize
 

2459
00:53:19,040 --> 00:53:20,630
turns out that you can't um synchronize
clocks

2460
00:53:20,630 --> 00:53:20,640
clocks
 

2461
00:53:20,640 --> 00:53:23,190
clocks
that precisely.

2462
00:53:23,190 --> 00:53:23,200
that precisely.
 

2463
00:53:23,200 --> 00:53:25,430
that precisely.
um

2464
00:53:25,430 --> 00:53:25,440
um
 

2465
00:53:25,440 --> 00:53:27,270
um
you

2466
00:53:27,270 --> 00:53:27,280
you
 

2467
00:53:27,280 --> 00:53:28,710
you
it's basically impossible to get

2468
00:53:28,710 --> 00:53:28,720
it's basically impossible to get
 

2469
00:53:28,720 --> 00:53:32,549
it's basically impossible to get
perfectly synchronized clocks. Um

2470
00:53:32,549 --> 00:53:32,559
perfectly synchronized clocks. Um
 

2471
00:53:32,559 --> 00:53:35,349
perfectly synchronized clocks. Um
and the reasons are uh reasonably

2472
00:53:35,349 --> 00:53:35,359
and the reasons are uh reasonably
 

2473
00:53:35,359 --> 00:53:38,069
and the reasons are uh reasonably
fundamental. Um

2474
00:53:38,069 --> 00:53:38,079
fundamental. Um
 

2475
00:53:38,079 --> 00:53:40,790
fundamental. Um
so the topic is time synchronization.

2476
00:53:40,790 --> 00:53:40,800
so the topic is time synchronization.
 

2477
00:53:40,800 --> 00:53:43,109
so the topic is time synchronization.
Just sort of making sure clocks say the

2478
00:53:43,109 --> 00:53:43,119
Just sort of making sure clocks say the
 

2479
00:53:43,119 --> 00:53:45,670
Just sort of making sure clocks say the
same real time value. Different clocks

2480
00:53:45,670 --> 00:53:45,680
same real time value. Different clocks
 

2481
00:53:45,680 --> 00:53:50,470
same real time value. Different clocks
read the same value. Um the

2482
00:53:50,470 --> 00:53:50,480
read the same value. Um the
 

2483
00:53:50,480 --> 00:53:54,630
read the same value. Um the
um

2484
00:53:54,630 --> 00:53:54,640

 

2485
00:53:54,640 --> 00:53:57,109

um I'll I'll the sort of fundamental

2486
00:53:57,109 --> 00:53:57,119
um I'll I'll the sort of fundamental
 

2487
00:53:57,119 --> 00:53:59,750
um I'll I'll the sort of fundamental
problem is that time is defined as

2488
00:53:59,750 --> 00:53:59,760
problem is that time is defined as
 

2489
00:53:59,760 --> 00:54:02,470
problem is that time is defined as
basically the time it says on a

2490
00:54:02,470 --> 00:54:02,480
basically the time it says on a
 

2491
00:54:02,480 --> 00:54:04,630
basically the time it says on a
collection of highly accurate expensive

2492
00:54:04,630 --> 00:54:04,640
collection of highly accurate expensive
 

2493
00:54:04,640 --> 00:54:05,990
collection of highly accurate expensive
clocks in a set of government

2494
00:54:05,990 --> 00:54:06,000
clocks in a set of government
 

2495
00:54:06,000 --> 00:54:07,990
clocks in a set of government
laboratories. So we can't directly read

2496
00:54:07,990 --> 00:54:08,000
laboratories. So we can't directly read
 

2497
00:54:08,000 --> 00:54:10,710
laboratories. So we can't directly read
them. All that we can know is that um

2498
00:54:10,710 --> 00:54:10,720
them. All that we can know is that um
 

2499
00:54:10,720 --> 00:54:12,230
them. All that we can know is that um
these government laboratories can

2500
00:54:12,230 --> 00:54:12,240
these government laboratories can
 

2501
00:54:12,240 --> 00:54:17,270
these government laboratories can
broadcast the time in various ways. Um

2502
00:54:17,270 --> 00:54:17,280
broadcast the time in various ways. Um
 

2503
00:54:17,280 --> 00:54:20,150
broadcast the time in various ways. Um
and uh the broadcasts take time and so

2504
00:54:20,150 --> 00:54:20,160
and uh the broadcasts take time and so
 

2505
00:54:20,160 --> 00:54:22,230
and uh the broadcasts take time and so
at some time later some possibly unknown

2506
00:54:22,230 --> 00:54:22,240
at some time later some possibly unknown
 

2507
00:54:22,240 --> 00:54:24,630
at some time later some possibly unknown
time later we hear these announcements

2508
00:54:24,630 --> 00:54:24,640
time later we hear these announcements
 

2509
00:54:24,640 --> 00:54:26,390
time later we hear these announcements
of what the time is and we all may all

2510
00:54:26,390 --> 00:54:26,400
of what the time is and we all may all
 

2511
00:54:26,400 --> 00:54:27,829
of what the time is and we all may all
hear these announcements at different

2512
00:54:27,829 --> 00:54:27,839
hear these announcements at different
 

2513
00:54:27,839 --> 00:54:33,750
hear these announcements at different
times due to varying delays. Um so um

2514
00:54:33,750 --> 00:54:33,760
times due to varying delays. Um so um
 

2515
00:54:33,760 --> 00:54:35,190
times due to varying delays. Um so um
actually first I want to consider the

2516
00:54:35,190 --> 00:54:35,200
actually first I want to consider the
 

2517
00:54:35,200 --> 00:54:38,470
actually first I want to consider the
problem of what the impact is if on

2518
00:54:38,470 --> 00:54:38,480
problem of what the impact is if on
 

2519
00:54:38,480 --> 00:54:42,470
problem of what the impact is if on
snapshot isolation um if the clocks are

2520
00:54:42,470 --> 00:54:42,480
snapshot isolation um if the clocks are
 

2521
00:54:42,480 --> 00:54:46,470
snapshot isolation um if the clocks are
not synchronized

2522
00:54:46,470 --> 00:54:46,480
not synchronized
 

2523
00:54:46,480 --> 00:54:53,750
not synchronized
which they won't be.

2524
00:54:53,750 --> 00:54:53,760

 

2525
00:54:53,760 --> 00:54:55,829

Okay. So what if clocks aren't synced?

2526
00:54:55,829 --> 00:54:55,839
Okay. So what if clocks aren't synced?
 

2527
00:54:55,839 --> 00:54:58,309
Okay. So what if clocks aren't synced?
Um there's actually no problem at all

2528
00:54:58,309 --> 00:54:58,319
Um there's actually no problem at all
 

2529
00:54:58,319 --> 00:55:00,630
Um there's actually no problem at all
for the spanner's readwrite transactions

2530
00:55:00,630 --> 00:55:00,640
for the spanner's readwrite transactions
 

2531
00:55:00,640 --> 00:55:02,309
for the spanner's readwrite transactions
because the readwrite transactions use

2532
00:55:02,309 --> 00:55:02,319
because the readwrite transactions use
 

2533
00:55:02,319 --> 00:55:04,390
because the readwrite transactions use
locks and two-phase commit. Um they're

2534
00:55:04,390 --> 00:55:04,400
locks and two-phase commit. Um they're
 

2535
00:55:04,400 --> 00:55:06,309
locks and two-phase commit. Um they're
not actually using snapshot isolation.

2536
00:55:06,309 --> 00:55:06,319
not actually using snapshot isolation.
 

2537
00:55:06,319 --> 00:55:07,589
not actually using snapshot isolation.
So they don't care. So the readwrite

2538
00:55:07,589 --> 00:55:07,599
So they don't care. So the readwrite
 

2539
00:55:07,599 --> 00:55:09,349
So they don't care. So the readwrite
transactions will still be serialized by

2540
00:55:09,349 --> 00:55:09,359
transactions will still be serialized by
 

2541
00:55:09,359 --> 00:55:11,109
transactions will still be serialized by
the lock the two-phase locking

2542
00:55:11,109 --> 00:55:11,119
the lock the two-phase locking
 

2543
00:55:11,119 --> 00:55:13,510
the lock the two-phase locking
mechanism. Um so we're only interested

2544
00:55:13,510 --> 00:55:13,520
mechanism. Um so we're only interested
 

2545
00:55:13,520 --> 00:55:15,829
mechanism. Um so we're only interested
in what happens for an for readonly

2546
00:55:15,829 --> 00:55:15,839
in what happens for an for readonly
 

2547
00:55:15,839 --> 00:55:19,109
in what happens for an for readonly
transaction. Um so let's suppose a

2548
00:55:19,109 --> 00:55:19,119
transaction. Um so let's suppose a
 

2549
00:55:19,119 --> 00:55:23,190
transaction. Um so let's suppose a
readonly transaction um

2550
00:55:23,190 --> 00:55:23,200
readonly transaction um
 

2551
00:55:23,200 --> 00:55:25,510
readonly transaction um
uh chooses a time stamp that is too

2552
00:55:25,510 --> 00:55:25,520
uh chooses a time stamp that is too
 

2553
00:55:25,520 --> 00:55:27,670
uh chooses a time stamp that is too
large.

2554
00:55:27,670 --> 00:55:27,680
large.
 

2555
00:55:27,680 --> 00:55:29,430
large.
So that is far in the future. You know

2556
00:55:29,430 --> 00:55:29,440
So that is far in the future. You know
 

2557
00:55:29,440 --> 00:55:31,829
So that is far in the future. You know
it's now 12:01 p.m. and it chooses a

2558
00:55:31,829 --> 00:55:31,839
it's now 12:01 p.m. and it chooses a
 

2559
00:55:31,839 --> 00:55:39,109
it's now 12:01 p.m. and it chooses a
time stamp at say 1:00 p.m. Um

2560
00:55:39,109 --> 00:55:39,119

 

2561
00:55:39,119 --> 00:55:41,670

so if a transaction's chosen time stamps

2562
00:55:41,670 --> 00:55:41,680
so if a transaction's chosen time stamps
 

2563
00:55:41,680 --> 00:55:45,510
so if a transaction's chosen time stamps
too big um that's actually not that bad.

2564
00:55:45,510 --> 00:55:45,520
too big um that's actually not that bad.
 

2565
00:55:45,520 --> 00:55:47,670
too big um that's actually not that bad.
Um what it'll mean is that it'll do read

2566
00:55:47,670 --> 00:55:47,680
Um what it'll mean is that it'll do read
 

2567
00:55:47,680 --> 00:55:49,510
Um what it'll mean is that it'll do read
requests. It'll send a read request to

2568
00:55:49,510 --> 00:55:49,520
requests. It'll send a read request to
 

2569
00:55:49,520 --> 00:55:52,150
requests. It'll send a read request to
some um replica. The replica will say,

2570
00:55:52,150 --> 00:55:52,160
some um replica. The replica will say,
 

2571
00:55:52,160 --> 00:55:53,990
some um replica. The replica will say,
"Wait a minute, your you know your clock

2572
00:55:53,990 --> 00:55:54,000
"Wait a minute, your you know your clock
 

2573
00:55:54,000 --> 00:55:56,390
"Wait a minute, your you know your clock
is far is far greater. Your time stamp

2574
00:55:56,390 --> 00:55:56,400
is far is far greater. Your time stamp
 

2575
00:55:56,400 --> 00:55:58,950
is far is far greater. Your time stamp
is far greater than the last log entry I

2576
00:55:58,950 --> 00:55:58,960
is far greater than the last log entry I
 

2577
00:55:58,960 --> 00:56:00,390
is far greater than the last log entry I
saw from my Paxos leader. So I'm going

2578
00:56:00,390 --> 00:56:00,400
saw from my Paxos leader. So I'm going
 

2579
00:56:00,400 --> 00:56:03,270
saw from my Paxos leader. So I'm going
to make you wait until the Paxos the

2580
00:56:03,270 --> 00:56:03,280
to make you wait until the Paxos the
 

2581
00:56:03,280 --> 00:56:04,870
to make you wait until the Paxos the
time and the log entry from the Paxos

2582
00:56:04,870 --> 00:56:04,880
time and the log entry from the Paxos
 

2583
00:56:04,880 --> 00:56:06,069
time and the log entry from the Paxos
leader catches up to the time you've

2584
00:56:06,069 --> 00:56:06,079
leader catches up to the time you've
 

2585
00:56:06,079 --> 00:56:08,230
leader catches up to the time you've
requested. I'm only going to respond

2586
00:56:08,230 --> 00:56:08,240
requested. I'm only going to respond
 

2587
00:56:08,240 --> 00:56:11,270
requested. I'm only going to respond
then." So this is correct but slow.

2588
00:56:11,270 --> 00:56:11,280
then." So this is correct but slow.
 

2589
00:56:11,280 --> 00:56:15,910
then." So this is correct but slow.
The reader will be forced to wait. Um

2590
00:56:15,910 --> 00:56:15,920
The reader will be forced to wait. Um
 

2591
00:56:15,920 --> 00:56:17,190
The reader will be forced to wait. Um
but that's not the worst thing in the

2592
00:56:17,190 --> 00:56:17,200
but that's not the worst thing in the
 

2593
00:56:17,200 --> 00:56:19,270
but that's not the worst thing in the
world. But what happens if we have a

2594
00:56:19,270 --> 00:56:19,280
world. But what happens if we have a
 

2595
00:56:19,280 --> 00:56:21,430
world. But what happens if we have a
readonly transaction

2596
00:56:21,430 --> 00:56:21,440
readonly transaction
 

2597
00:56:21,440 --> 00:56:25,670
readonly transaction
um and its time stamp is too small.

2598
00:56:25,670 --> 00:56:25,680
um and its time stamp is too small.
 

2599
00:56:25,680 --> 00:56:29,030
um and its time stamp is too small.
Um and this would correspond to its

2600
00:56:29,030 --> 00:56:29,040
Um and this would correspond to its
 

2601
00:56:29,040 --> 00:56:31,349
Um and this would correspond to its
clock being well either set wrong so

2602
00:56:31,349 --> 00:56:31,359
clock being well either set wrong so
 

2603
00:56:31,359 --> 00:56:33,750
clock being well either set wrong so
that it's set in the past or maybe it

2604
00:56:33,750 --> 00:56:33,760
that it's set in the past or maybe it
 

2605
00:56:33,760 --> 00:56:35,190
that it's set in the past or maybe it
was originally set correctly but the

2606
00:56:35,190 --> 00:56:35,200
was originally set correctly but the
 

2607
00:56:35,200 --> 00:56:38,549
was originally set correctly but the
clock its clock ticks too slowly. Um the

2608
00:56:38,549 --> 00:56:38,559
clock its clock ticks too slowly. Um the
 

2609
00:56:38,559 --> 00:56:40,390
clock its clock ticks too slowly. Um the
problem with this this is a obviously

2610
00:56:40,390 --> 00:56:40,400
problem with this this is a obviously
 

2611
00:56:40,400 --> 00:56:41,750
problem with this this is a obviously
causes a correctness problem. This will

2612
00:56:41,750 --> 00:56:41,760
causes a correctness problem. This will
 

2613
00:56:41,760 --> 00:56:43,109
causes a correctness problem. This will
cause a violation of external

2614
00:56:43,109 --> 00:56:43,119
cause a violation of external
 

2615
00:56:43,119 --> 00:56:46,470
cause a violation of external
consistency because um the multi-verion

2616
00:56:46,470 --> 00:56:46,480
consistency because um the multi-verion
 

2617
00:56:46,480 --> 00:56:48,150
consistency because um the multi-verion
databases you'll give it a time stamp

2618
00:56:48,150 --> 00:56:48,160
databases you'll give it a time stamp
 

2619
00:56:48,160 --> 00:56:50,710
databases you'll give it a time stamp
that's far in the past say an hour ago

2620
00:56:50,710 --> 00:56:50,720
that's far in the past say an hour ago
 

2621
00:56:50,720 --> 00:56:53,589
that's far in the past say an hour ago
and the database will read you a value

2622
00:56:53,589 --> 00:56:53,599
and the database will read you a value
 

2623
00:56:53,599 --> 00:56:55,349
and the database will read you a value
associated with it the time stamp from

2624
00:56:55,349 --> 00:56:55,359
associated with it the time stamp from
 

2625
00:56:55,359 --> 00:56:58,470
associated with it the time stamp from
an hour ago which may ignore more recent

2626
00:56:58,470 --> 00:56:58,480
an hour ago which may ignore more recent
 

2627
00:56:58,480 --> 00:57:01,349
an hour ago which may ignore more recent
writes. So using a assigning a time

2628
00:57:01,349 --> 00:57:01,359
writes. So using a assigning a time
 

2629
00:57:01,359 --> 00:57:03,349
writes. So using a assigning a time
stamp to a transaction that's too small

2630
00:57:03,349 --> 00:57:03,359
stamp to a transaction that's too small
 

2631
00:57:03,359 --> 00:57:06,150
stamp to a transaction that's too small
will cause you to miss recent committed

2632
00:57:06,150 --> 00:57:06,160
will cause you to miss recent committed
 

2633
00:57:06,160 --> 00:57:08,069
will cause you to miss recent committed
rights.

2634
00:57:08,069 --> 00:57:08,079
rights.
 

2635
00:57:08,079 --> 00:57:10,950
rights.
Um, and

2636
00:57:10,950 --> 00:57:10,960
Um, and
 

2637
00:57:10,960 --> 00:57:12,470
Um, and
that's a violation of external

2638
00:57:12,470 --> 00:57:12,480
that's a violation of external
 

2639
00:57:12,480 --> 00:57:19,829
that's a violation of external
consistency. So, not

2640
00:57:19,829 --> 00:57:19,839

 

2641
00:57:19,839 --> 00:57:23,190

not externally consistent. So, um, so we

2642
00:57:23,190 --> 00:57:23,200
not externally consistent. So, um, so we
 

2643
00:57:23,200 --> 00:57:24,950
not externally consistent. So, um, so we
actually have a problem here. Um, the

2644
00:57:24,950 --> 00:57:24,960
actually have a problem here. Um, the
 

2645
00:57:24,960 --> 00:57:26,390
actually have a problem here. Um, the
assumption that the clocks were

2646
00:57:26,390 --> 00:57:26,400
assumption that the clocks were
 

2647
00:57:26,400 --> 00:57:29,670
assumption that the clocks were
synchronized is in fact a a very serious

2648
00:57:29,670 --> 00:57:29,680
synchronized is in fact a a very serious
 

2649
00:57:29,680 --> 00:57:31,589
synchronized is in fact a a very serious
assumption. And the fact that you cannot

2650
00:57:31,589 --> 00:57:31,599
assumption. And the fact that you cannot
 

2651
00:57:31,599 --> 00:57:33,270
assumption. And the fact that you cannot
count on it means that unless we do

2652
00:57:33,270 --> 00:57:33,280
count on it means that unless we do
 

2653
00:57:33,280 --> 00:57:35,349
count on it means that unless we do
something, um, the system's going to be

2654
00:57:35,349 --> 00:57:35,359
something, um, the system's going to be
 

2655
00:57:35,359 --> 00:57:37,270
something, um, the system's going to be
incorrect.

2656
00:57:37,270 --> 00:57:37,280
incorrect.
 

2657
00:57:37,280 --> 00:57:42,470
incorrect.
All right.

2658
00:57:42,470 --> 00:57:42,480

 

2659
00:57:42,480 --> 00:57:45,190

So um so can we synchronize clocks

2660
00:57:45,190 --> 00:57:45,200
So um so can we synchronize clocks
 

2661
00:57:45,200 --> 00:57:47,109
So um so can we synchronize clocks
perfectly? Right. That would be the

2662
00:57:47,109 --> 00:57:47,119
perfectly? Right. That would be the
 

2663
00:57:47,119 --> 00:57:50,549
perfectly? Right. That would be the
ideal thing. Um and if not why not? So

2664
00:57:50,549 --> 00:57:50,559
ideal thing. Um and if not why not? So
 

2665
00:57:50,559 --> 00:57:55,670
ideal thing. Um and if not why not? So
um so what about clock synchronization?

2666
00:57:55,670 --> 00:57:55,680

 

2667
00:57:55,680 --> 00:58:00,069

the uh as I mentioned um where time

2668
00:58:00,069 --> 00:58:00,079
the uh as I mentioned um where time
 

2669
00:58:00,079 --> 00:58:01,829
the uh as I mentioned um where time
comes from is a it's actually collection

2670
00:58:01,829 --> 00:58:01,839
comes from is a it's actually collection
 

2671
00:58:01,839 --> 00:58:04,549
comes from is a it's actually collection
of the kind of median of a collection of

2672
00:58:04,549 --> 00:58:04,559
of the kind of median of a collection of
 

2673
00:58:04,559 --> 00:58:08,150
of the kind of median of a collection of
clocks in government labs um the way

2674
00:58:08,150 --> 00:58:08,160
clocks in government labs um the way
 

2675
00:58:08,160 --> 00:58:10,150
clocks in government labs um the way
that we hear about time is that it's

2676
00:58:10,150 --> 00:58:10,160
that we hear about time is that it's
 

2677
00:58:10,160 --> 00:58:12,470
that we hear about time is that it's
broadcast by various protocols sometimes

2678
00:58:12,470 --> 00:58:12,480
broadcast by various protocols sometimes
 

2679
00:58:12,480 --> 00:58:14,470
broadcast by various protocols sometimes
by radio protocols like basically what

2680
00:58:14,470 --> 00:58:14,480
by radio protocols like basically what
 

2681
00:58:14,480 --> 00:58:18,390
by radio protocols like basically what
GPS is doing for Spanner is a GPS acts

2682
00:58:18,390 --> 00:58:18,400
GPS is doing for Spanner is a GPS acts
 

2683
00:58:18,400 --> 00:58:21,109
GPS is doing for Spanner is a GPS acts
as a radio broadcast system that

2684
00:58:21,109 --> 00:58:21,119
as a radio broadcast system that
 

2685
00:58:21,119 --> 00:58:23,190
as a radio broadcast system that
broadcasts the current time from some

2686
00:58:23,190 --> 00:58:23,200
broadcasts the current time from some
 

2687
00:58:23,200 --> 00:58:25,190
broadcasts the current time from some
government lab through the GPS satellite

2688
00:58:25,190 --> 00:58:25,200
government lab through the GPS satellite
 

2689
00:58:25,200 --> 00:58:29,829
government lab through the GPS satellite
ites to GPS receivers sitting in the um

2690
00:58:29,829 --> 00:58:29,839
ites to GPS receivers sitting in the um
 

2691
00:58:29,839 --> 00:58:32,069
ites to GPS receivers sitting in the um
uh Google machine rooms. And there's a

2692
00:58:32,069 --> 00:58:32,079
uh Google machine rooms. And there's a
 

2693
00:58:32,079 --> 00:58:34,309
uh Google machine rooms. And there's a
number of other radio protocols like WWB

2694
00:58:34,309 --> 00:58:34,319
number of other radio protocols like WWB
 

2695
00:58:34,319 --> 00:58:37,430
number of other radio protocols like WWB
is another older radio protocol for

2696
00:58:37,430 --> 00:58:37,440
is another older radio protocol for
 

2697
00:58:37,440 --> 00:58:40,230
is another older radio protocol for
broadcasting the current time. And

2698
00:58:40,230 --> 00:58:40,240
broadcasting the current time. And
 

2699
00:58:40,240 --> 00:58:41,510
broadcasting the current time. And
there's newer protocols like there's

2700
00:58:41,510 --> 00:58:41,520
there's newer protocols like there's
 

2701
00:58:41,520 --> 00:58:43,829
there's newer protocols like there's
this NTP protocol that operates over the

2702
00:58:43,829 --> 00:58:43,839
this NTP protocol that operates over the
 

2703
00:58:43,839 --> 00:58:46,630
this NTP protocol that operates over the
uh um

2704
00:58:46,630 --> 00:58:46,640
uh um
 

2705
00:58:46,640 --> 00:58:49,270
uh um
uh internet that also is in charge of um

2706
00:58:49,270 --> 00:58:49,280
uh internet that also is in charge of um
 

2707
00:58:49,280 --> 00:58:51,349
uh internet that also is in charge of um
basically broadcasting time. So the sort

2708
00:58:51,349 --> 00:58:51,359
basically broadcasting time. So the sort
 

2709
00:58:51,359 --> 00:58:54,789
basically broadcasting time. So the sort
of system diagram is that um there's

2710
00:58:54,789 --> 00:58:54,799
of system diagram is that um there's
 

2711
00:58:54,799 --> 00:58:57,190
of system diagram is that um there's
some government labs and the government

2712
00:58:57,190 --> 00:58:57,200
some government labs and the government
 

2713
00:58:57,200 --> 00:58:59,190
some government labs and the government
labs uh with their accurate clocks

2714
00:58:59,190 --> 00:58:59,200
labs uh with their accurate clocks
 

2715
00:58:59,200 --> 00:59:01,990
labs uh with their accurate clocks
define a universal notion of time that's

2716
00:59:01,990 --> 00:59:02,000
define a universal notion of time that's
 

2717
00:59:02,000 --> 00:59:04,950
define a universal notion of time that's
called UTC.

2718
00:59:04,950 --> 00:59:04,960
called UTC.
 

2719
00:59:04,960 --> 00:59:07,270
called UTC.
So we have UTC coming from some clocks

2720
00:59:07,270 --> 00:59:07,280
So we have UTC coming from some clocks
 

2721
00:59:07,280 --> 00:59:09,349
So we have UTC coming from some clocks
and some labs. Then we have um some you

2722
00:59:09,349 --> 00:59:09,359
and some labs. Then we have um some you
 

2723
00:59:09,359 --> 00:59:11,510
and some labs. Then we have um some you
know radio or internet broadcast or

2724
00:59:11,510 --> 00:59:11,520
know radio or internet broadcast or
 

2725
00:59:11,520 --> 00:59:16,150
know radio or internet broadcast or
something. For the case of um

2726
00:59:16,150 --> 00:59:16,160
something. For the case of um
 

2727
00:59:16,160 --> 00:59:18,150
something. For the case of um
um

2728
00:59:18,150 --> 00:59:18,160
um
 

2729
00:59:18,160 --> 00:59:20,309
um
spanner, it's the we can think of the

2730
00:59:20,309 --> 00:59:20,319
spanner, it's the we can think of the
 

2731
00:59:20,319 --> 00:59:22,150
spanner, it's the we can think of the
government labs broadcasting to GPS

2732
00:59:22,150 --> 00:59:22,160
government labs broadcasting to GPS
 

2733
00:59:22,160 --> 00:59:24,710
government labs broadcasting to GPS
satellites.

2734
00:59:24,710 --> 00:59:24,720
satellites.
 

2735
00:59:24,720 --> 00:59:28,630
satellites.
Um the satellites in turn broadcast and

2736
00:59:28,630 --> 00:59:28,640
Um the satellites in turn broadcast and
 

2737
00:59:28,640 --> 00:59:30,470
Um the satellites in turn broadcast and
they broadcast to you know the millions

2738
00:59:30,470 --> 00:59:30,480
they broadcast to you know the millions
 

2739
00:59:30,480 --> 00:59:33,510
they broadcast to you know the millions
of GPS receivers that are out there. Um

2740
00:59:33,510 --> 00:59:33,520
of GPS receivers that are out there. Um
 

2741
00:59:33,520 --> 00:59:36,950
of GPS receivers that are out there. Um
you can uh buy GPS receivers for you

2742
00:59:36,950 --> 00:59:36,960
you can uh buy GPS receivers for you
 

2743
00:59:36,960 --> 00:59:38,150
you can uh buy GPS receivers for you
know a couple hundred bucks that will

2744
00:59:38,150 --> 00:59:38,160
know a couple hundred bucks that will
 

2745
00:59:38,160 --> 00:59:42,309
know a couple hundred bucks that will
decode the timestamps in the um

2746
00:59:42,309 --> 00:59:42,319
decode the timestamps in the um
 

2747
00:59:42,319 --> 00:59:45,589
decode the timestamps in the um
in the uh GPS signals and sort of keep

2748
00:59:45,589 --> 00:59:45,599
in the uh GPS signals and sort of keep
 

2749
00:59:45,599 --> 00:59:48,150
in the uh GPS signals and sort of keep
you up to date with exactly what uh the

2750
00:59:48,150 --> 00:59:48,160
you up to date with exactly what uh the
 

2751
00:59:48,160 --> 00:59:50,630
you up to date with exactly what uh the
time is corrected for the propagation

2752
00:59:50,630 --> 00:59:50,640
time is corrected for the propagation
 

2753
00:59:50,640 --> 00:59:52,230
time is corrected for the propagation
delay between the government labs and

2754
00:59:52,230 --> 00:59:52,240
delay between the government labs and
 

2755
00:59:52,240 --> 00:59:54,069
delay between the government labs and
the GPS satellites and also corrected

2756
00:59:54,069 --> 00:59:54,079
the GPS satellites and also corrected
 

2757
00:59:54,079 --> 00:59:56,470
the GPS satellites and also corrected
for the delay between the GPS satellites

2758
00:59:56,470 --> 00:59:56,480
for the delay between the GPS satellites
 

2759
00:59:56,480 --> 01:00:00,710
for the delay between the GPS satellites
and your current position. Um and then

2760
01:00:00,710 --> 01:00:00,720
and your current position. Um and then
 

2761
01:00:00,720 --> 01:00:04,309
and your current position. Um and then
there's um in each data center

2762
01:00:04,309 --> 01:00:04,319
there's um in each data center
 

2763
01:00:04,319 --> 01:00:09,430
there's um in each data center
there's a GPS receiver

2764
01:00:09,430 --> 01:00:09,440

 

2765
01:00:09,440 --> 01:00:12,390

um that's connected up to what the paper

2766
01:00:12,390 --> 01:00:12,400
um that's connected up to what the paper
 

2767
01:00:12,400 --> 01:00:14,710
um that's connected up to what the paper
calls a time master which is some

2768
01:00:14,710 --> 01:00:14,720
calls a time master which is some
 

2769
01:00:14,720 --> 01:00:17,030
calls a time master which is some
server. There's going to be more than

2770
01:00:17,030 --> 01:00:17,040
server. There's going to be more than
 

2771
01:00:17,040 --> 01:00:18,549
server. There's going to be more than
one of these for data center in case one

2772
01:00:18,549 --> 01:00:18,559
one of these for data center in case one
 

2773
01:00:18,559 --> 01:00:21,510
one of these for data center in case one
fails. Um and then there's all the

2774
01:00:21,510 --> 01:00:21,520
fails. Um and then there's all the
 

2775
01:00:21,520 --> 01:00:22,870
fails. Um and then there's all the
hundreds of servers in the data center

2776
01:00:22,870 --> 01:00:22,880
hundreds of servers in the data center
 

2777
01:00:22,880 --> 01:00:24,470
hundreds of servers in the data center
that are running Spanner either as

2778
01:00:24,470 --> 01:00:24,480
that are running Spanner either as
 

2779
01:00:24,480 --> 01:00:27,670
that are running Spanner either as
servers or as clients. Um each one of

2780
01:00:27,670 --> 01:00:27,680
servers or as clients. Um each one of
 

2781
01:00:27,680 --> 01:00:32,789
servers or as clients. Um each one of
them is going to um periodically send a

2782
01:00:32,789 --> 01:00:32,799
them is going to um periodically send a
 

2783
01:00:32,799 --> 01:00:34,630
them is going to um periodically send a
request saying oh what time is it to the

2784
01:00:34,630 --> 01:00:34,640
request saying oh what time is it to the
 

2785
01:00:34,640 --> 01:00:37,589
request saying oh what time is it to the
local one or more usually more than one

2786
01:00:37,589 --> 01:00:37,599
local one or more usually more than one
 

2787
01:00:37,599 --> 01:00:40,710
local one or more usually more than one
in case one fails to the time masters

2788
01:00:40,710 --> 01:00:40,720
in case one fails to the time masters
 

2789
01:00:40,720 --> 01:00:42,950
in case one fails to the time masters
and the time master will reply with oh

2790
01:00:42,950 --> 01:00:42,960
and the time master will reply with oh
 

2791
01:00:42,960 --> 01:00:44,470
and the time master will reply with oh
you know I think the current time as

2792
01:00:44,470 --> 01:00:44,480
you know I think the current time as
 

2793
01:00:44,480 --> 01:00:48,309
you know I think the current time as
received from GPS is such and such. Um

2794
01:00:48,309 --> 01:00:48,319
received from GPS is such and such. Um
 

2795
01:00:48,319 --> 01:00:50,549
received from GPS is such and such. Um
now

2796
01:00:50,549 --> 01:00:50,559
now
 

2797
01:00:50,559 --> 01:00:52,549
now
um built into this unfortunately is a

2798
01:00:52,549 --> 01:00:52,559
um built into this unfortunately is a
 

2799
01:00:52,559 --> 01:00:54,950
um built into this unfortunately is a
certain amount of uncertainty.

2800
01:00:54,950 --> 01:00:54,960
certain amount of uncertainty.
 

2801
01:00:54,960 --> 01:00:56,549
certain amount of uncertainty.
Um

2802
01:00:56,549 --> 01:00:56,559
Um
 

2803
01:00:56,559 --> 01:01:00,630
Um
and the primary sources of uncertainty I

2804
01:01:00,630 --> 01:01:00,640
and the primary sources of uncertainty I
 

2805
01:01:00,640 --> 01:01:02,870
and the primary sources of uncertainty I
think well there's there's fundamentally

2806
01:01:02,870 --> 01:01:02,880
think well there's there's fundamentally
 

2807
01:01:02,880 --> 01:01:04,230
think well there's there's fundamentally
uncertainty in that we don't actually

2808
01:01:04,230 --> 01:01:04,240
uncertainty in that we don't actually
 

2809
01:01:04,240 --> 01:01:05,990
uncertainty in that we don't actually
know how far we are for the G from the

2810
01:01:05,990 --> 01:01:06,000
know how far we are for the G from the
 

2811
01:01:06,000 --> 01:01:09,270
know how far we are for the G from the
GPS satellites exactly. Um so the you

2812
01:01:09,270 --> 01:01:09,280
GPS satellites exactly. Um so the you
 

2813
01:01:09,280 --> 01:01:10,789
GPS satellites exactly. Um so the you
know radio signals take some amount of

2814
01:01:10,789 --> 01:01:10,799
know radio signals take some amount of
 

2815
01:01:10,799 --> 01:01:13,270
know radio signals take some amount of
time even if the GPS satellite knew

2816
01:01:13,270 --> 01:01:13,280
time even if the GPS satellite knew
 

2817
01:01:13,280 --> 01:01:14,710
time even if the GPS satellite knew
exactly what time it is. The signals

2818
01:01:14,710 --> 01:01:14,720
exactly what time it is. The signals
 

2819
01:01:14,720 --> 01:01:16,230
exactly what time it is. The signals
take some time to get to our GPS

2820
01:01:16,230 --> 01:01:16,240
take some time to get to our GPS
 

2821
01:01:16,240 --> 01:01:17,910
take some time to get to our GPS
receiver. If we're not sure what that

2822
01:01:17,910 --> 01:01:17,920
receiver. If we're not sure what that
 

2823
01:01:17,920 --> 01:01:20,950
receiver. If we're not sure what that
is, that means that when the G we get a

2824
01:01:20,950 --> 01:01:20,960
is, that means that when the G we get a
 

2825
01:01:20,960 --> 01:01:22,789
is, that means that when the G we get a
a message from the radio message from

2826
01:01:22,789 --> 01:01:22,799
a message from the radio message from
 

2827
01:01:22,799 --> 01:01:26,390
a message from the radio message from
the GPS satellite saying exactly 12:00,

2828
01:01:26,390 --> 01:01:26,400
the GPS satellite saying exactly 12:00,
 

2829
01:01:26,400 --> 01:01:28,309
the GPS satellite saying exactly 12:00,
you know, if the propagation delay might

2830
01:01:28,309 --> 01:01:28,319
you know, if the propagation delay might
 

2831
01:01:28,319 --> 01:01:30,309
you know, if the propagation delay might
have been, you know, a couple of

2832
01:01:30,309 --> 01:01:30,319
have been, you know, a couple of
 

2833
01:01:30,319 --> 01:01:33,430
have been, you know, a couple of
nanconds, that means that we're uh

2834
01:01:33,430 --> 01:01:33,440
nanconds, that means that we're uh
 

2835
01:01:33,440 --> 01:01:34,710
nanconds, that means that we're uh
actually the propagation delay is much

2836
01:01:34,710 --> 01:01:34,720
actually the propagation delay is much
 

2837
01:01:34,720 --> 01:01:35,510
actually the propagation delay is much
more than that. It's really the

2838
01:01:35,510 --> 01:01:35,520
more than that. It's really the
 

2839
01:01:35,520 --> 01:01:38,309
more than that. It's really the
uncertainty in the propagation delay. Um

2840
01:01:38,309 --> 01:01:38,319
uncertainty in the propagation delay. Um
 

2841
01:01:38,319 --> 01:01:40,150
uncertainty in the propagation delay. Um
means that we're not really sure exactly

2842
01:01:40,150 --> 01:01:40,160
means that we're not really sure exactly
 

2843
01:01:40,160 --> 01:01:41,829
means that we're not really sure exactly
whether it's 12:00 or a little before, a

2844
01:01:41,829 --> 01:01:41,839
whether it's 12:00 or a little before, a
 

2845
01:01:41,839 --> 01:01:44,630
whether it's 12:00 or a little before, a
little after. In addition, um all the

2846
01:01:44,630 --> 01:01:44,640
little after. In addition, um all the
 

2847
01:01:44,640 --> 01:01:46,630
little after. In addition, um all the
times that time is communicated, there's

2848
01:01:46,630 --> 01:01:46,640
times that time is communicated, there's
 

2849
01:01:46,640 --> 01:01:49,190
times that time is communicated, there's
added uncertainty um that you have to

2850
01:01:49,190 --> 01:01:49,200
added uncertainty um that you have to
 

2851
01:01:49,200 --> 01:01:52,150
added uncertainty um that you have to
account for. And in the biggest sources

2852
01:01:52,150 --> 01:01:52,160
account for. And in the biggest sources
 

2853
01:01:52,160 --> 01:01:54,150
account for. And in the biggest sources
are that when a server sends a request

2854
01:01:54,150 --> 01:01:54,160
are that when a server sends a request
 

2855
01:01:54,160 --> 01:01:56,230
are that when a server sends a request
after a while, it gets a response. If

2856
01:01:56,230 --> 01:01:56,240
after a while, it gets a response. If
 

2857
01:01:56,240 --> 01:01:57,750
after a while, it gets a response. If
the response says it's exactly 12

2858
01:01:57,750 --> 01:01:57,760
the response says it's exactly 12
 

2859
01:01:57,760 --> 01:01:59,349
the response says it's exactly 12
o'clock,

2860
01:01:59,349 --> 01:01:59,359
o'clock,
 

2861
01:01:59,359 --> 01:02:04,630
o'clock,
but um the amount but say a second pass,

2862
01:02:04,630 --> 01:02:04,640
but um the amount but say a second pass,
 

2863
01:02:04,640 --> 01:02:06,309
but um the amount but say a second pass,
you know, between when the server sent

2864
01:02:06,309 --> 01:02:06,319
you know, between when the server sent
 

2865
01:02:06,319 --> 01:02:07,589
you know, between when the server sent
the request and when it got the

2866
01:02:07,589 --> 01:02:07,599
the request and when it got the
 

2867
01:02:07,599 --> 01:02:10,309
the request and when it got the
response, all the server knows is that

2868
01:02:10,309 --> 01:02:10,319
response, all the server knows is that
 

2869
01:02:10,319 --> 01:02:12,789
response, all the server knows is that
even if the master had the correct time,

2870
01:02:12,789 --> 01:02:12,799
even if the master had the correct time,
 

2871
01:02:12,799 --> 01:02:16,549
even if the master had the correct time,
all the server knows is that um

2872
01:02:16,549 --> 01:02:16,559
all the server knows is that um
 

2873
01:02:16,559 --> 01:02:21,670
all the server knows is that um
the time is within a second of 12:00. um

2874
01:02:21,670 --> 01:02:21,680
the time is within a second of 12:00. um
 

2875
01:02:21,680 --> 01:02:23,910
the time is within a second of 12:00. um
because maybe the maybe the request was

2876
01:02:23,910 --> 01:02:23,920
because maybe the maybe the request was
 

2877
01:02:23,920 --> 01:02:26,309
because maybe the maybe the request was
instant but the reply was delayed or

2878
01:02:26,309 --> 01:02:26,319
instant but the reply was delayed or
 

2879
01:02:26,319 --> 01:02:28,150
instant but the reply was delayed or
maybe the request was delayed by a

2880
01:02:28,150 --> 01:02:28,160
maybe the request was delayed by a
 

2881
01:02:28,160 --> 01:02:31,190
maybe the request was delayed by a
second and the response was instant. So

2882
01:02:31,190 --> 01:02:31,200
second and the response was instant. So
 

2883
01:02:31,200 --> 01:02:33,349
second and the response was instant. So
all we really know is that it's between

2884
01:02:33,349 --> 01:02:33,359
all we really know is that it's between
 

2885
01:02:33,359 --> 01:02:38,069
all we really know is that it's between
you know 12:00 and 0 seconds and 12:00

2886
01:02:38,069 --> 01:02:38,079
you know 12:00 and 0 seconds and 12:00
 

2887
01:02:38,079 --> 01:02:43,510
you know 12:00 and 0 seconds and 12:00
and 1 second. Um,

2888
01:02:43,510 --> 01:02:43,520
and 1 second. Um,
 

2889
01:02:43,520 --> 01:02:45,750
and 1 second. Um,
okay. So, um, there's always this

2890
01:02:45,750 --> 01:02:45,760
okay. So, um, there's always this
 

2891
01:02:45,760 --> 01:02:47,270
okay. So, um, there's always this
uncertainty.

2892
01:02:47,270 --> 01:02:47,280
uncertainty.
 

2893
01:02:47,280 --> 01:02:49,750
uncertainty.
Um, and in order to, which we really

2894
01:02:49,750 --> 01:02:49,760
Um, and in order to, which we really
 

2895
01:02:49,760 --> 01:02:51,030
Um, and in order to, which we really
can't ignore though, because the

2896
01:02:51,030 --> 01:02:51,040
can't ignore though, because the
 

2897
01:02:51,040 --> 01:02:52,309
can't ignore though, because the
uncertainties, we're talking about

2898
01:02:52,309 --> 01:02:52,319
uncertainties, we're talking about
 

2899
01:02:52,319 --> 01:02:55,190
uncertainties, we're talking about
milliseconds here. Um, and we're going

2900
01:02:55,190 --> 01:02:55,200
milliseconds here. Um, and we're going
 

2901
01:02:55,200 --> 01:02:56,710
milliseconds here. Um, and we're going
to find out that these that the

2902
01:02:56,710 --> 01:02:56,720
to find out that these that the
 

2903
01:02:56,720 --> 01:02:59,349
to find out that these that the
uncertainty in the time goes directly to

2904
01:02:59,349 --> 01:02:59,359
uncertainty in the time goes directly to
 

2905
01:02:59,359 --> 01:03:01,270
uncertainty in the time goes directly to
the these how long these safe weights

2906
01:03:01,270 --> 01:03:01,280
the these how long these safe weights
 

2907
01:03:01,280 --> 01:03:02,870
the these how long these safe weights
have to be and how long some other

2908
01:03:02,870 --> 01:03:02,880
have to be and how long some other
 

2909
01:03:02,880 --> 01:03:04,630
have to be and how long some other
pauses have to be, the commit weight, as

2910
01:03:04,630 --> 01:03:04,640
pauses have to be, the commit weight, as
 

2911
01:03:04,640 --> 01:03:07,589
pauses have to be, the commit weight, as
we'll see. Um

2912
01:03:07,589 --> 01:03:07,599
we'll see. Um
 

2913
01:03:07,599 --> 01:03:09,430
we'll see. Um
uh so you know uncertainty on the level

2914
01:03:09,430 --> 01:03:09,440
uh so you know uncertainty on the level
 

2915
01:03:09,440 --> 01:03:10,950
uh so you know uncertainty on the level
of milliseconds is a serious problem.

2916
01:03:10,950 --> 01:03:10,960
of milliseconds is a serious problem.
 

2917
01:03:10,960 --> 01:03:12,950
of milliseconds is a serious problem.
The other big uncertainty is that each

2918
01:03:12,950 --> 01:03:12,960
The other big uncertainty is that each
 

2919
01:03:12,960 --> 01:03:14,630
The other big uncertainty is that each
of these servers only requests the

2920
01:03:14,630 --> 01:03:14,640
of these servers only requests the
 

2921
01:03:14,640 --> 01:03:16,470
of these servers only requests the
current time from the master every once

2922
01:03:16,470 --> 01:03:16,480
current time from the master every once
 

2923
01:03:16,480 --> 01:03:19,109
current time from the master every once
in a while say every minute or however

2924
01:03:19,109 --> 01:03:19,119
in a while say every minute or however
 

2925
01:03:19,119 --> 01:03:22,150
in a while say every minute or however
often. Um and between that the each

2926
01:03:22,150 --> 01:03:22,160
often. Um and between that the each
 

2927
01:03:22,160 --> 01:03:24,230
often. Um and between that the each
server runs its own local clock that

2928
01:03:24,230 --> 01:03:24,240
server runs its own local clock that
 

2929
01:03:24,240 --> 01:03:26,470
server runs its own local clock that
sort of keeps the time starting with the

2930
01:03:26,470 --> 01:03:26,480
sort of keeps the time starting with the
 

2931
01:03:26,480 --> 01:03:28,309
sort of keeps the time starting with the
last time from the master. those local

2932
01:03:28,309 --> 01:03:28,319
last time from the master. those local
 

2933
01:03:28,319 --> 01:03:31,349
last time from the master. those local
clocks are actually pretty bad um and

2934
01:03:31,349 --> 01:03:31,359
clocks are actually pretty bad um and
 

2935
01:03:31,359 --> 01:03:33,829
clocks are actually pretty bad um and
can drift by things by milliseconds

2936
01:03:33,829 --> 01:03:33,839
can drift by things by milliseconds
 

2937
01:03:33,839 --> 01:03:35,589
can drift by things by milliseconds
between times that the server talks to

2938
01:03:35,589 --> 01:03:35,599
between times that the server talks to
 

2939
01:03:35,599 --> 01:03:38,470
between times that the server talks to
the master um and so the system has to

2940
01:03:38,470 --> 01:03:38,480
the master um and so the system has to
 

2941
01:03:38,480 --> 01:03:42,150
the master um and so the system has to
sort of add the the unknown

2942
01:03:42,150 --> 01:03:42,160
sort of add the the unknown
 

2943
01:03:42,160 --> 01:03:44,230
sort of add the the unknown
um but estimated drift of the local

2944
01:03:44,230 --> 01:03:44,240
um but estimated drift of the local
 

2945
01:03:44,240 --> 01:03:48,309
um but estimated drift of the local
clock um to the uncertainty of the time.

2946
01:03:48,309 --> 01:03:48,319
clock um to the uncertainty of the time.
 

2947
01:03:48,319 --> 01:03:50,390
clock um to the uncertainty of the time.
So um in order to capture this

2948
01:03:50,390 --> 01:03:50,400
So um in order to capture this
 

2949
01:03:50,400 --> 01:03:55,589
So um in order to capture this
uncertainty and account for it, uh

2950
01:03:55,589 --> 01:03:55,599
uncertainty and account for it, uh
 

2951
01:03:55,599 --> 01:03:59,990
uncertainty and account for it, uh
um Spanner uses this true time scheme

2952
01:03:59,990 --> 01:04:00,000
um Spanner uses this true time scheme
 

2953
01:04:00,000 --> 01:04:01,829
um Spanner uses this true time scheme
in which when you ask what time it is,

2954
01:04:01,829 --> 01:04:01,839
in which when you ask what time it is,
 

2955
01:04:01,839 --> 01:04:03,349
in which when you ask what time it is,
what you actually get back is one of

2956
01:04:03,349 --> 01:04:03,359
what you actually get back is one of
 

2957
01:04:03,359 --> 01:04:06,069
what you actually get back is one of
these TT interval things

2958
01:04:06,069 --> 01:04:06,079
these TT interval things
 

2959
01:04:06,079 --> 01:04:10,789
these TT interval things
which is a pair

2960
01:04:10,789 --> 01:04:10,799
which is a pair
 

2961
01:04:10,799 --> 01:04:16,309
which is a pair
um of an earliest time

2962
01:04:16,309 --> 01:04:16,319

 

2963
01:04:16,319 --> 01:04:19,029

and a latest earliest time is the ear

2964
01:04:19,029 --> 01:04:19,039
and a latest earliest time is the ear
 

2965
01:04:19,039 --> 01:04:20,630
and a latest earliest time is the ear
early

2966
01:04:20,630 --> 01:04:20,640
early
 

2967
01:04:20,640 --> 01:04:23,029
early
um earliest the time could possibly be

2968
01:04:23,029 --> 01:04:23,039
um earliest the time could possibly be
 

2969
01:04:23,039 --> 01:04:25,589
um earliest the time could possibly be
and the second is the latest the time

2970
01:04:25,589 --> 01:04:25,599
and the second is the latest the time
 

2971
01:04:25,599 --> 01:04:27,990
and the second is the latest the time
can possibly be. Um so when the

2972
01:04:27,990 --> 01:04:28,000
can possibly be. Um so when the
 

2973
01:04:28,000 --> 01:04:29,670
can possibly be. Um so when the
application

2974
01:04:29,670 --> 01:04:29,680
application
 

2975
01:04:29,680 --> 01:04:31,990
application
you know makes this library call that

2976
01:04:31,990 --> 01:04:32,000
you know makes this library call that
 

2977
01:04:32,000 --> 01:04:33,670
you know makes this library call that
asks for the time it gets back this pair

2978
01:04:33,670 --> 01:04:33,680
asks for the time it gets back this pair
 

2979
01:04:33,680 --> 01:04:35,349
asks for the time it gets back this pair
all it knows is that the current time is

2980
01:04:35,349 --> 01:04:35,359
all it knows is that the current time is
 

2981
01:04:35,359 --> 01:04:37,510
all it knows is that the current time is
somewhere between earliest and latest

2982
01:04:37,510 --> 01:04:37,520
somewhere between earliest and latest
 

2983
01:04:37,520 --> 01:04:39,190
somewhere between earliest and latest
and so you know earliest might be in

2984
01:04:39,190 --> 01:04:39,200
and so you know earliest might be in
 

2985
01:04:39,200 --> 01:04:41,190
and so you know earliest might be in
this case earliest might be 12:00 and

2986
01:04:41,190 --> 01:04:41,200
this case earliest might be 12:00 and
 

2987
01:04:41,200 --> 01:04:44,789
this case earliest might be 12:00 and
latest might be 12:00 and 1 second just

2988
01:04:44,789 --> 01:04:44,799
latest might be 12:00 and 1 second just
 

2989
01:04:44,799 --> 01:04:46,950
latest might be 12:00 and 1 second just
um are guaranteed that the that the

2990
01:04:46,950 --> 01:04:46,960
um are guaranteed that the that the
 

2991
01:04:46,960 --> 01:04:49,349
um are guaranteed that the that the
correct time isn't less than earliest

2992
01:04:49,349 --> 01:04:49,359
correct time isn't less than earliest
 

2993
01:04:49,359 --> 01:04:52,309
correct time isn't less than earliest
and isn't greater than latest.

2994
01:04:52,309 --> 01:04:52,319
and isn't greater than latest.
 

2995
01:04:52,319 --> 01:04:53,510
and isn't greater than latest.
Well, we don't know where between that

2996
01:04:53,510 --> 01:04:53,520
Well, we don't know where between that
 

2997
01:04:53,520 --> 01:04:57,109
Well, we don't know where between that
it lies.

2998
01:04:57,109 --> 01:04:57,119

 

2999
01:04:57,119 --> 01:05:00,470

Okay, so this is what um

3000
01:05:00,470 --> 01:05:00,480
Okay, so this is what um
 

3001
01:05:00,480 --> 01:05:02,549
Okay, so this is what um
when a transaction asks the system what

3002
01:05:02,549 --> 01:05:02,559
when a transaction asks the system what
 

3003
01:05:02,559 --> 01:05:04,470
when a transaction asks the system what
time it is, this is this is what the

3004
01:05:04,470 --> 01:05:04,480
time it is, this is this is what the
 

3005
01:05:04,480 --> 01:05:07,270
time it is, this is this is what the
transaction actually gets back from the

3006
01:05:07,270 --> 01:05:07,280
transaction actually gets back from the
 

3007
01:05:07,280 --> 01:05:12,230
transaction actually gets back from the
time system. And now um

3008
01:05:12,230 --> 01:05:12,240
time system. And now um
 

3009
01:05:12,240 --> 01:05:14,150
time system. And now um
let's return our original problem was

3010
01:05:14,150 --> 01:05:14,160
let's return our original problem was
 

3011
01:05:14,160 --> 01:05:18,630
let's return our original problem was
that if the clock was too slow that a uh

3012
01:05:18,630 --> 01:05:18,640
that if the clock was too slow that a uh
 

3013
01:05:18,640 --> 01:05:21,109
that if the clock was too slow that a uh
readonly transaction might read data too

3014
01:05:21,109 --> 01:05:21,119
readonly transaction might read data too
 

3015
01:05:21,119 --> 01:05:23,349
readonly transaction might read data too
far in the past and that it wouldn't

3016
01:05:23,349 --> 01:05:23,359
far in the past and that it wouldn't
 

3017
01:05:23,359 --> 01:05:25,270
far in the past and that it wouldn't
read data from a recent committed

3018
01:05:25,270 --> 01:05:25,280
read data from a recent committed
 

3019
01:05:25,280 --> 01:05:27,510
read data from a recent committed
transaction. So we need to know what

3020
01:05:27,510 --> 01:05:27,520
transaction. So we need to know what
 

3021
01:05:27,520 --> 01:05:29,910
transaction. So we need to know what
we're looking for is how um Spanner uses

3022
01:05:29,910 --> 01:05:29,920
we're looking for is how um Spanner uses
 

3023
01:05:29,920 --> 01:05:31,990
we're looking for is how um Spanner uses
these TT intervals and its notion of

3024
01:05:31,990 --> 01:05:32,000
these TT intervals and its notion of
 

3025
01:05:32,000 --> 01:05:33,990
these TT intervals and its notion of
true time in order to ensure that

3026
01:05:33,990 --> 01:05:34,000
true time in order to ensure that
 

3027
01:05:34,000 --> 01:05:36,630
true time in order to ensure that
despite uncertainty on what time it is

3028
01:05:36,630 --> 01:05:36,640
despite uncertainty on what time it is
 

3029
01:05:36,640 --> 01:05:38,710
despite uncertainty on what time it is
um transaction

3030
01:05:38,710 --> 01:05:38,720
um transaction
 

3031
01:05:38,720 --> 01:05:40,630
um transaction
uh obey external consistency that is a

3032
01:05:40,630 --> 01:05:40,640
uh obey external consistency that is a
 

3033
01:05:40,640 --> 01:05:43,029
uh obey external consistency that is a
read only transaction is guaranteed to

3034
01:05:43,029 --> 01:05:43,039
read only transaction is guaranteed to
 

3035
01:05:43,039 --> 01:05:46,870
read only transaction is guaranteed to
see um rights done by a transaction rate

3036
01:05:46,870 --> 01:05:46,880
see um rights done by a transaction rate
 

3037
01:05:46,880 --> 01:05:49,190
see um rights done by a transaction rate
uh transaction that completed before us.

3038
01:05:49,190 --> 01:05:49,200
uh transaction that completed before us.
 

3039
01:05:49,200 --> 01:05:51,270
uh transaction that completed before us.
And there are

3040
01:05:51,270 --> 01:05:51,280
And there are
 

3041
01:05:51,280 --> 01:05:55,029
And there are
um two rules that the paper talks about

3042
01:05:55,029 --> 01:05:55,039
um two rules that the paper talks about
 

3043
01:05:55,039 --> 01:05:59,029
um two rules that the paper talks about
that conspire to um

3044
01:05:59,029 --> 01:05:59,039
that conspire to um
 

3045
01:05:59,039 --> 01:06:02,390
that conspire to um
force this and the two rules which are

3046
01:06:02,390 --> 01:06:02,400
force this and the two rules which are
 

3047
01:06:02,400 --> 01:06:04,950
force this and the two rules which are
in section 412. One of them is the start

3048
01:06:04,950 --> 01:06:04,960
in section 412. One of them is the start
 

3049
01:06:04,960 --> 01:06:08,630
in section 412. One of them is the start
rule

3050
01:06:08,630 --> 01:06:08,640

 

3051
01:06:08,640 --> 01:06:10,390

and

3052
01:06:10,390 --> 01:06:10,400
and
 

3053
01:06:10,400 --> 01:06:17,670
and
the other is uh commit weight.

3054
01:06:17,670 --> 01:06:17,680

 

3055
01:06:17,680 --> 01:06:20,549

The sort rule tells us what um time

3056
01:06:20,549 --> 01:06:20,559
The sort rule tells us what um time
 

3057
01:06:20,559 --> 01:06:23,190
The sort rule tells us what um time
stamps transaction what time stamps

3058
01:06:23,190 --> 01:06:23,200
stamps transaction what time stamps
 

3059
01:06:23,200 --> 01:06:26,870
stamps transaction what time stamps
transactions choose. Um and basically

3060
01:06:26,870 --> 01:06:26,880
transactions choose. Um and basically
 

3061
01:06:26,880 --> 01:06:29,589
transactions choose. Um and basically
says that a transactions time stamp has

3062
01:06:29,589 --> 01:06:29,599
says that a transactions time stamp has
 

3063
01:06:29,599 --> 01:06:35,670
says that a transactions time stamp has
to be equal to the latest half of the um

3064
01:06:35,670 --> 01:06:35,680
to be equal to the latest half of the um
 

3065
01:06:35,680 --> 01:06:38,150
to be equal to the latest half of the um
true time current time. So this is

3066
01:06:38,150 --> 01:06:38,160
true time current time. So this is
 

3067
01:06:38,160 --> 01:06:40,470
true time current time. So this is
tt.now call which returns one of those

3068
01:06:40,470 --> 01:06:40,480
tt.now call which returns one of those
 

3069
01:06:40,480 --> 01:06:42,789
tt.now call which returns one of those
earliest latest pairs. That's the

3070
01:06:42,789 --> 01:06:42,799
earliest latest pairs. That's the
 

3071
01:06:42,799 --> 01:06:44,950
earliest latest pairs. That's the
current time and a transactions time

3072
01:06:44,950 --> 01:06:44,960
current time and a transactions time
 

3073
01:06:44,960 --> 01:06:47,510
current time and a transactions time
stamp has to be the latest

3074
01:06:47,510 --> 01:06:47,520
stamp has to be the latest
 

3075
01:06:47,520 --> 01:06:48,950
stamp has to be the latest
that is it's going to be a time that's

3076
01:06:48,950 --> 01:06:48,960
that is it's going to be a time that's
 

3077
01:06:48,960 --> 01:06:51,270
that is it's going to be a time that's
guaranteed not to have happened yet

3078
01:06:51,270 --> 01:06:51,280
guaranteed not to have happened yet
 

3079
01:06:51,280 --> 01:06:52,789
guaranteed not to have happened yet
because the true time is between

3080
01:06:52,789 --> 01:06:52,799
because the true time is between
 

3081
01:06:52,799 --> 01:06:55,510
because the true time is between
earliest and latest. Um and for a uh

3082
01:06:55,510 --> 01:06:55,520
earliest and latest. Um and for a uh
 

3083
01:06:55,520 --> 01:06:58,470
earliest and latest. Um and for a uh
readon transaction

3084
01:06:58,470 --> 01:06:58,480
readon transaction
 

3085
01:06:58,480 --> 01:07:02,069
readon transaction
um it's assigned the latest time as of

3086
01:07:02,069 --> 01:07:02,079
um it's assigned the latest time as of
 

3087
01:07:02,079 --> 01:07:05,190
um it's assigned the latest time as of
um it's the time it starts and for a

3088
01:07:05,190 --> 01:07:05,200
um it's the time it starts and for a
 

3089
01:07:05,200 --> 01:07:07,349
um it's the time it starts and for a
read write transaction it's assigned a

3090
01:07:07,349 --> 01:07:07,359
read write transaction it's assigned a
 

3091
01:07:07,359 --> 01:07:10,390
read write transaction it's assigned a
time stamp um this latest value as of

3092
01:07:10,390 --> 01:07:10,400
time stamp um this latest value as of
 

3093
01:07:10,400 --> 01:07:14,150
time stamp um this latest value as of
the time it starts to commit.

3094
01:07:14,150 --> 01:07:14,160
the time it starts to commit.
 

3095
01:07:14,160 --> 01:07:16,870
the time it starts to commit.
Um

3096
01:07:16,870 --> 01:07:16,880
Um
 

3097
01:07:16,880 --> 01:07:19,270
Um
okay so the start rule says this is how

3098
01:07:19,270 --> 01:07:19,280
okay so the start rule says this is how
 

3099
01:07:19,280 --> 01:07:21,190
okay so the start rule says this is how
Spanner chooses time stamps. The commit

3100
01:07:21,190 --> 01:07:21,200
Spanner chooses time stamps. The commit
 

3101
01:07:21,200 --> 01:07:24,789
Spanner chooses time stamps. The commit
weight rule um only for readwrite

3102
01:07:24,789 --> 01:07:24,799
weight rule um only for readwrite
 

3103
01:07:24,799 --> 01:07:26,630
weight rule um only for readwrite
transactions

3104
01:07:26,630 --> 01:07:26,640
transactions
 

3105
01:07:26,640 --> 01:07:29,430
transactions
uh says that

3106
01:07:29,430 --> 01:07:29,440
uh says that
 

3107
01:07:29,440 --> 01:07:31,190
uh says that
um

3108
01:07:31,190 --> 01:07:31,200
um
 

3109
01:07:31,200 --> 01:07:34,870
um
when a a transaction coordinator is uh

3110
01:07:34,870 --> 01:07:34,880
when a a transaction coordinator is uh
 

3111
01:07:34,880 --> 01:07:36,150
when a a transaction coordinator is uh
you know collects the votes and sees

3112
01:07:36,150 --> 01:07:36,160
you know collects the votes and sees
 

3113
01:07:36,160 --> 01:07:38,870
you know collects the votes and sees
that it's able to commit and and chooses

3114
01:07:38,870 --> 01:07:38,880
that it's able to commit and and chooses
 

3115
01:07:38,880 --> 01:07:41,270
that it's able to commit and and chooses
a time stamp after it chooses this time

3116
01:07:41,270 --> 01:07:41,280
a time stamp after it chooses this time
 

3117
01:07:41,280 --> 01:07:44,230
a time stamp after it chooses this time
stamp it's required to delay to wait a

3118
01:07:44,230 --> 01:07:44,240
stamp it's required to delay to wait a
 

3119
01:07:44,240 --> 01:07:45,750
stamp it's required to delay to wait a
certain amount of time before it's

3120
01:07:45,750 --> 01:07:45,760
certain amount of time before it's
 

3121
01:07:45,760 --> 01:07:47,270
certain amount of time before it's
allowed to actually commit and write the

3122
01:07:47,270 --> 01:07:47,280
allowed to actually commit and write the
 

3123
01:07:47,280 --> 01:07:50,549
allowed to actually commit and write the
values and release locks. Um

3124
01:07:50,549 --> 01:07:50,559
values and release locks. Um
 

3125
01:07:50,559 --> 01:07:53,349
values and release locks. Um
so a readwrite transaction um has to

3126
01:07:53,349 --> 01:07:53,359
so a readwrite transaction um has to
 

3127
01:07:53,359 --> 01:07:55,109
so a readwrite transaction um has to
delay

3128
01:07:55,109 --> 01:07:55,119
delay
 

3129
01:07:55,119 --> 01:07:56,950
delay
until

3130
01:07:56,950 --> 01:07:56,960
until
 

3131
01:07:56,960 --> 01:07:59,990
until
um its time stamps that it chose when it

3132
01:07:59,990 --> 01:08:00,000
um its time stamps that it chose when it
 

3133
01:08:00,000 --> 01:08:01,990
um its time stamps that it chose when it
was starting to think about commit is

3134
01:08:01,990 --> 01:08:02,000
was starting to think about commit is
 

3135
01:08:02,000 --> 01:08:05,829
was starting to think about commit is
less than the current time

3136
01:08:05,829 --> 01:08:05,839
less than the current time
 

3137
01:08:05,839 --> 01:08:09,510
less than the current time
um

3138
01:08:09,510 --> 01:08:09,520

 

3139
01:08:09,520 --> 01:08:11,910

earliest.

3140
01:08:11,910 --> 01:08:11,920
earliest.
 

3141
01:08:11,920 --> 01:08:13,670
earliest.
Sorry.

3142
01:08:13,670 --> 01:08:13,680
Sorry.
 

3143
01:08:13,680 --> 01:08:15,270
Sorry.
So what's going on here is that it sits

3144
01:08:15,270 --> 01:08:15,280
So what's going on here is that it sits
 

3145
01:08:15,280 --> 01:08:17,990
So what's going on here is that it sits
in a loop calling ts.now now and it

3146
01:08:17,990 --> 01:08:18,000
in a loop calling ts.now now and it
 

3147
01:08:18,000 --> 01:08:19,990
in a loop calling ts.now now and it
stays in that loop until the time stamp

3148
01:08:19,990 --> 01:08:20,000
stays in that loop until the time stamp
 

3149
01:08:20,000 --> 01:08:21,349
stays in that loop until the time stamp
that it had chosen at the beginning of

3150
01:08:21,349 --> 01:08:21,359
that it had chosen at the beginning of
 

3151
01:08:21,359 --> 01:08:23,349
that it had chosen at the beginning of
the commit process is less than the

3152
01:08:23,349 --> 01:08:23,359
the commit process is less than the
 

3153
01:08:23,359 --> 01:08:25,590
the commit process is less than the
current time's earliest half. And what

3154
01:08:25,590 --> 01:08:25,600
current time's earliest half. And what
 

3155
01:08:25,600 --> 01:08:29,910
current time's earliest half. And what
this guarantees is that um

3156
01:08:29,910 --> 01:08:29,920
this guarantees is that um
 

3157
01:08:29,920 --> 01:08:33,349
this guarantees is that um
since now the earliest possible

3158
01:08:33,349 --> 01:08:33,359
since now the earliest possible
 

3159
01:08:33,359 --> 01:08:35,349
since now the earliest possible
correct time is greater than the

3160
01:08:35,349 --> 01:08:35,359
correct time is greater than the
 

3161
01:08:35,359 --> 01:08:37,189
correct time is greater than the
transaction's time stamp. That means

3162
01:08:37,189 --> 01:08:37,199
transaction's time stamp. That means
 

3163
01:08:37,199 --> 01:08:39,269
transaction's time stamp. That means
that um when this loop is finished, when

3164
01:08:39,269 --> 01:08:39,279
that um when this loop is finished, when
 

3165
01:08:39,279 --> 01:08:40,950
that um when this loop is finished, when
the commit weight is finished, this time

3166
01:08:40,950 --> 01:08:40,960
the commit weight is finished, this time
 

3167
01:08:40,960 --> 01:08:43,110
the commit weight is finished, this time
stamp of the transaction is absolutely

3168
01:08:43,110 --> 01:08:43,120
stamp of the transaction is absolutely
 

3169
01:08:43,120 --> 01:08:47,110
stamp of the transaction is absolutely
guaranteed to be in the past.

3170
01:08:47,110 --> 01:08:47,120

 

3171
01:08:47,120 --> 01:08:49,910

Okay. So, um how does the system

3172
01:08:49,910 --> 01:08:49,920
Okay. So, um how does the system
 

3173
01:08:49,920 --> 01:08:53,990
Okay. So, um how does the system
actually make use of these two rules

3174
01:08:53,990 --> 01:08:54,000
actually make use of these two rules
 

3175
01:08:54,000 --> 01:08:57,349
actually make use of these two rules
um in order to enforce

3176
01:08:57,349 --> 01:08:57,359
um in order to enforce
 

3177
01:08:57,359 --> 01:09:00,149
um in order to enforce
um

3178
01:09:00,149 --> 01:09:00,159
um
 

3179
01:09:00,159 --> 01:09:01,910
um
external consistency for read only

3180
01:09:01,910 --> 01:09:01,920
external consistency for read only
 

3181
01:09:01,920 --> 01:09:03,829
external consistency for read only
transactions? I want to go back to our

3182
01:09:03,829 --> 01:09:03,839
transactions? I want to go back to our
 

3183
01:09:03,839 --> 01:09:06,709
transactions? I want to go back to our
or I want to um

3184
01:09:06,709 --> 01:09:06,719
or I want to um
 

3185
01:09:06,719 --> 01:09:09,189
or I want to um
um

3186
01:09:09,189 --> 01:09:09,199
um
 

3187
01:09:09,199 --> 01:09:12,550
um
cook up a uh somewhat simplified

3188
01:09:12,550 --> 01:09:12,560
cook up a uh somewhat simplified
 

3189
01:09:12,560 --> 01:09:16,309
cook up a uh somewhat simplified
uh scenario in order to illustrate this.

3190
01:09:16,309 --> 01:09:16,319
uh scenario in order to illustrate this.
 

3191
01:09:16,319 --> 01:09:17,910
uh scenario in order to illustrate this.
Um so I'm going to imagine that the

3192
01:09:17,910 --> 01:09:17,920
Um so I'm going to imagine that the
 

3193
01:09:17,920 --> 01:09:19,590
Um so I'm going to imagine that the
writing transactions only do one write

3194
01:09:19,590 --> 01:09:19,600
writing transactions only do one write
 

3195
01:09:19,600 --> 01:09:22,470
writing transactions only do one write
each just to reduce the complexity.

3196
01:09:22,470 --> 01:09:22,480
each just to reduce the complexity.
 

3197
01:09:22,480 --> 01:09:25,510
each just to reduce the complexity.
Let's say that there's two uh readwrite

3198
01:09:25,510 --> 01:09:25,520
Let's say that there's two uh readwrite
 

3199
01:09:25,520 --> 01:09:28,550
Let's say that there's two uh readwrite
transactions. So we have T0

3200
01:09:28,550 --> 01:09:28,560
transactions. So we have T0
 

3201
01:09:28,560 --> 01:09:33,030
transactions. So we have T0
and T1 are readwrite transactions and um

3202
01:09:33,030 --> 01:09:33,040
and T1 are readwrite transactions and um
 

3203
01:09:33,040 --> 01:09:35,669
and T1 are readwrite transactions and um
they both write X and we have a T2 which

3204
01:09:35,669 --> 01:09:35,679
they both write X and we have a T2 which
 

3205
01:09:35,679 --> 01:09:37,669
they both write X and we have a T2 which
is going to read X and we want to make

3206
01:09:37,669 --> 01:09:37,679
is going to read X and we want to make
 

3207
01:09:37,679 --> 01:09:40,630
is going to read X and we want to make
sure that T2 sees um you know it's going

3208
01:09:40,630 --> 01:09:40,640
sure that T2 sees um you know it's going
 

3209
01:09:40,640 --> 01:09:42,070
sure that T2 sees um you know it's going
to use snapshot isolation at time

3210
01:09:42,070 --> 01:09:42,080
to use snapshot isolation at time
 

3211
01:09:42,080 --> 01:09:43,189
to use snapshot isolation at time
stamps. We want to make sure that it

3212
01:09:43,189 --> 01:09:43,199
stamps. We want to make sure that it
 

3213
01:09:43,199 --> 01:09:47,349
stamps. We want to make sure that it
sees the latest written value. Um

3214
01:09:47,349 --> 01:09:47,359
sees the latest written value. Um
 

3215
01:09:47,359 --> 01:09:49,910
sees the latest written value. Um
so we're going to imagine that T2 does a

3216
01:09:49,910 --> 01:09:49,920
so we're going to imagine that T2 does a
 

3217
01:09:49,920 --> 01:09:53,910
so we're going to imagine that T2 does a
write of X and writes one to X um and

3218
01:09:53,910 --> 01:09:53,920
write of X and writes one to X um and
 

3219
01:09:53,920 --> 01:09:55,830
write of X and writes one to X um and
then commits

3220
01:09:55,830 --> 01:09:55,840
then commits
 

3221
01:09:55,840 --> 01:09:58,870
then commits
We're going to imagine that um

3222
01:09:58,870 --> 01:09:58,880
We're going to imagine that um
 

3223
01:09:58,880 --> 01:10:01,030
We're going to imagine that um
sorry T1 writes X and commit. T2 also

3224
01:10:01,030 --> 01:10:01,040
sorry T1 writes X and commit. T2 also
 

3225
01:10:01,040 --> 01:10:02,950
sorry T1 writes X and commit. T2 also
writes X

3226
01:10:02,950 --> 01:10:02,960
writes X
 

3227
01:10:02,960 --> 01:10:06,149
writes X
writes a value two to X. Um and we need

3228
01:10:06,149 --> 01:10:06,159
writes a value two to X. Um and we need
 

3229
01:10:06,159 --> 01:10:07,669
writes a value two to X. Um and we need
to distinguish between prepare and

3230
01:10:07,669 --> 01:10:07,679
to distinguish between prepare and
 

3231
01:10:07,679 --> 01:10:09,110
to distinguish between prepare and
commit. So we're going to say it it's

3232
01:10:09,110 --> 01:10:09,120
commit. So we're going to say it it's
 

3233
01:10:09,120 --> 01:10:11,430
commit. So we're going to say it it's
really a prepare that the transaction

3234
01:10:11,430 --> 01:10:11,440
really a prepare that the transaction
 

3235
01:10:11,440 --> 01:10:13,910
really a prepare that the transaction
chooses its uh

3236
01:10:13,910 --> 01:10:13,920
chooses its uh
 

3237
01:10:13,920 --> 01:10:15,110
chooses its uh
time stamp. So this is the point at

3238
01:10:15,110 --> 01:10:15,120
time stamp. So this is the point at
 

3239
01:10:15,120 --> 01:10:16,470
time stamp. So this is the point at
which it chooses its time stamp and then

3240
01:10:16,470 --> 01:10:16,480
which it chooses its time stamp and then
 

3241
01:10:16,480 --> 01:10:19,830
which it chooses its time stamp and then
it commits sometime later. Um and then

3242
01:10:19,830 --> 01:10:19,840
it commits sometime later. Um and then
 

3243
01:10:19,840 --> 01:10:21,990
it commits sometime later. Um and then
we're imagining by assumption that T2

3244
01:10:21,990 --> 01:10:22,000
we're imagining by assumption that T2
 

3245
01:10:22,000 --> 01:10:24,709
we're imagining by assumption that T2
starts after T1 finishes. So it's going

3246
01:10:24,709 --> 01:10:24,719
starts after T1 finishes. So it's going
 

3247
01:10:24,719 --> 01:10:27,270
starts after T1 finishes. So it's going
to read X

3248
01:10:27,270 --> 01:10:27,280
to read X
 

3249
01:10:27,280 --> 01:10:29,510
to read X
um afterwards and we want to make sure

3250
01:10:29,510 --> 01:10:29,520
um afterwards and we want to make sure
 

3251
01:10:29,520 --> 01:10:33,910
um afterwards and we want to make sure
it sees two. All right. So um let's

3252
01:10:33,910 --> 01:10:33,920
it sees two. All right. So um let's
 

3253
01:10:33,920 --> 01:10:37,189
it sees two. All right. So um let's
suppose that uh T0 chooses a time stamp

3254
01:10:37,189 --> 01:10:37,199
suppose that uh T0 chooses a time stamp
 

3255
01:10:37,199 --> 01:10:39,750
suppose that uh T0 chooses a time stamp
of one.

3256
01:10:39,750 --> 01:10:39,760
of one.
 

3257
01:10:39,760 --> 01:10:43,590
of one.
Um commits writes the database.

3258
01:10:43,590 --> 01:10:43,600
Um commits writes the database.
 

3259
01:10:43,600 --> 01:10:46,070
Um commits writes the database.
Let's say t1 starts

3260
01:10:46,070 --> 01:10:46,080
Let's say t1 starts
 

3261
01:10:46,080 --> 01:10:49,110
Let's say t1 starts
um at the time it chooses a time stamp

3262
01:10:49,110 --> 01:10:49,120
um at the time it chooses a time stamp
 

3263
01:10:49,120 --> 01:10:51,189
um at the time it chooses a time stamp
it it's going to get some it's not get a

3264
01:10:51,189 --> 01:10:51,199
it it's going to get some it's not get a
 

3265
01:10:51,199 --> 01:10:52,950
it it's going to get some it's not get a
single number from the two time system

3266
01:10:52,950 --> 01:10:52,960
single number from the two time system
 

3267
01:10:52,960 --> 01:10:55,669
single number from the two time system
really gets a range of numbers

3268
01:10:55,669 --> 01:10:55,679
really gets a range of numbers
 

3269
01:10:55,679 --> 01:10:57,669
really gets a range of numbers
um

3270
01:10:57,669 --> 01:10:57,679
um
 

3271
01:10:57,679 --> 01:11:00,790
um
you know an earliest and a latest

3272
01:11:00,790 --> 01:11:00,800
you know an earliest and a latest
 

3273
01:11:00,800 --> 01:11:03,030
you know an earliest and a latest
value. Let's say at the time it chooses

3274
01:11:03,030 --> 01:11:03,040
value. Let's say at the time it chooses
 

3275
01:11:03,040 --> 01:11:06,229
value. Let's say at the time it chooses
its time stamp, it um the range of

3276
01:11:06,229 --> 01:11:06,239
its time stamp, it um the range of
 

3277
01:11:06,239 --> 01:11:09,910
its time stamp, it um the range of
values, the earliest uh time it gets is

3278
01:11:09,910 --> 01:11:09,920
values, the earliest uh time it gets is
 

3279
01:11:09,920 --> 01:11:12,630
values, the earliest uh time it gets is
one and the latest field in the current

3280
01:11:12,630 --> 01:11:12,640
one and the latest field in the current
 

3281
01:11:12,640 --> 01:11:15,590
one and the latest field in the current
time is 10. Um

3282
01:11:15,590 --> 01:11:15,600
time is 10. Um
 

3283
01:11:15,600 --> 01:11:18,630
time is 10. Um
so the uh the rule says that it must

3284
01:11:18,630 --> 01:11:18,640
so the uh the rule says that it must
 

3285
01:11:18,640 --> 01:11:20,790
so the uh the rule says that it must
choose 10. The latest value is it time

3286
01:11:20,790 --> 01:11:20,800
choose 10. The latest value is it time
 

3287
01:11:20,800 --> 01:11:22,790
choose 10. The latest value is it time
stamp. So T1 is going to commit with

3288
01:11:22,790 --> 01:11:22,800
stamp. So T1 is going to commit with
 

3289
01:11:22,800 --> 01:11:25,830
stamp. So T1 is going to commit with
time stamp 10.

3290
01:11:25,830 --> 01:11:25,840
time stamp 10.
 

3291
01:11:25,840 --> 01:11:27,830
time stamp 10.
Now, it can't commit yet because the

3292
01:11:27,830 --> 01:11:27,840
Now, it can't commit yet because the
 

3293
01:11:27,840 --> 01:11:30,229
Now, it can't commit yet because the
commit wait rule says it has to wait

3294
01:11:30,229 --> 01:11:30,239
commit wait rule says it has to wait
 

3295
01:11:30,239 --> 01:11:32,950
commit wait rule says it has to wait
until its time stamp is guaranteed to be

3296
01:11:32,950 --> 01:11:32,960
until its time stamp is guaranteed to be
 

3297
01:11:32,960 --> 01:11:35,669
until its time stamp is guaranteed to be
in the past. So, uh transaction one is

3298
01:11:35,669 --> 01:11:35,679
in the past. So, uh transaction one is
 

3299
01:11:35,679 --> 01:11:37,189
in the past. So, uh transaction one is
going to sit there keep asking what time

3300
01:11:37,189 --> 01:11:37,199
going to sit there keep asking what time
 

3301
01:11:37,199 --> 01:11:38,950
going to sit there keep asking what time
is it? What time is it until it gets an

3302
01:11:38,950 --> 01:11:38,960
is it? What time is it until it gets an
 

3303
01:11:38,960 --> 01:11:43,750
is it? What time is it until it gets an
interval back um that doesn't include

3304
01:11:43,750 --> 01:11:43,760
interval back um that doesn't include
 

3305
01:11:43,760 --> 01:11:46,790
interval back um that doesn't include
time 10. So, at some point um it's going

3306
01:11:46,790 --> 01:11:46,800
time 10. So, at some point um it's going
 

3307
01:11:46,800 --> 01:11:48,229
time 10. So, at some point um it's going
to ask what time it is and it's going to

3308
01:11:48,229 --> 01:11:48,239
to ask what time it is and it's going to
 

3309
01:11:48,239 --> 01:11:49,910
to ask what time it is and it's going to
get a time that where the earliest value

3310
01:11:49,910 --> 01:11:49,920
get a time that where the earliest value
 

3311
01:11:49,920 --> 01:11:52,070
get a time that where the earliest value
is 11 and the latest is I don't know

3312
01:11:52,070 --> 01:11:52,080
is 11 and the latest is I don't know
 

3313
01:11:52,080 --> 01:11:53,910
is 11 and the latest is I don't know
what I'd say 20. And now it's going to

3314
01:11:53,910 --> 01:11:53,920
what I'd say 20. And now it's going to
 

3315
01:11:53,920 --> 01:11:56,390
what I'd say 20. And now it's going to
say aha now I know that my time stamp is

3316
01:11:56,390 --> 01:11:56,400
say aha now I know that my time stamp is
 

3317
01:11:56,400 --> 01:11:57,990
say aha now I know that my time stamp is
guaranteed to be in the past and I can

3318
01:11:57,990 --> 01:11:58,000
guaranteed to be in the past and I can
 

3319
01:11:58,000 --> 01:12:00,709
guaranteed to be in the past and I can
commit. Uh so T1 will actually this is

3320
01:12:00,709 --> 01:12:00,719
commit. Uh so T1 will actually this is
 

3321
01:12:00,719 --> 01:12:02,870
commit. Uh so T1 will actually this is
its commit weight period to sit there

3322
01:12:02,870 --> 01:12:02,880
its commit weight period to sit there
 

3323
01:12:02,880 --> 01:12:04,950
its commit weight period to sit there
and uh wait for a while before it

3324
01:12:04,950 --> 01:12:04,960
and uh wait for a while before it
 

3325
01:12:04,960 --> 01:12:06,790
and uh wait for a while before it
commits.

3326
01:12:06,790 --> 01:12:06,800
commits.
 

3327
01:12:06,800 --> 01:12:10,390
commits.
Okay. Now after commits uh transaction 2

3328
01:12:10,390 --> 01:12:10,400
Okay. Now after commits uh transaction 2
 

3329
01:12:10,400 --> 01:12:12,950
Okay. Now after commits uh transaction 2
comes along and wants to read X. It's

3330
01:12:12,950 --> 01:12:12,960
comes along and wants to read X. It's
 

3331
01:12:12,960 --> 01:12:15,510
comes along and wants to read X. It's
going to choose a time stamp. Also um

3332
01:12:15,510 --> 01:12:15,520
going to choose a time stamp. Also um
 

3333
01:12:15,520 --> 01:12:18,630
going to choose a time stamp. Also um
we're assuming that it starts after T1

3334
01:12:18,630 --> 01:12:18,640
we're assuming that it starts after T1
 

3335
01:12:18,640 --> 01:12:20,630
we're assuming that it starts after T1
finishes because that's an interesting

3336
01:12:20,630 --> 01:12:20,640
finishes because that's an interesting
 

3337
01:12:20,640 --> 01:12:22,870
finishes because that's an interesting
scenario for external consistency. So

3338
01:12:22,870 --> 01:12:22,880
scenario for external consistency. So
 

3339
01:12:22,880 --> 01:12:25,830
scenario for external consistency. So
let's say when it asks for the time

3340
01:12:25,830 --> 01:12:25,840
let's say when it asks for the time
 

3341
01:12:25,840 --> 01:12:29,669
let's say when it asks for the time
um it asks at a time after time 11. So

3342
01:12:29,669 --> 01:12:29,679
um it asks at a time after time 11. So
 

3343
01:12:29,679 --> 01:12:31,110
um it asks at a time after time 11. So
it's going to get back an interval that

3344
01:12:31,110 --> 01:12:31,120
it's going to get back an interval that
 

3345
01:12:31,120 --> 01:12:34,790
it's going to get back an interval that
includes time 11. Um so let's suppose it

3346
01:12:34,790 --> 01:12:34,800
includes time 11. Um so let's suppose it
 

3347
01:12:34,800 --> 01:12:37,910
includes time 11. Um so let's suppose it
gets back an interval that um goes from

3348
01:12:37,910 --> 01:12:37,920
gets back an interval that um goes from
 

3349
01:12:37,920 --> 01:12:43,430
gets back an interval that um goes from
time 10 the earliest and time uh 12 uh

3350
01:12:43,430 --> 01:12:43,440
time 10 the earliest and time uh 12 uh
 

3351
01:12:43,440 --> 01:12:45,030
time 10 the earliest and time uh 12 uh
to latest. And of course the time 12 has

3352
01:12:45,030 --> 01:12:45,040
to latest. And of course the time 12 has
 

3353
01:12:45,040 --> 01:12:47,350
to latest. And of course the time 12 has
to be since we know that uh must be at

3354
01:12:47,350 --> 01:12:47,360
to be since we know that uh must be at
 

3355
01:12:47,360 --> 01:12:50,310
to be since we know that uh must be at
least time 11 since transaction two

3356
01:12:50,310 --> 01:12:50,320
least time 11 since transaction two
 

3357
01:12:50,320 --> 01:12:52,709
least time 11 since transaction two
started after transaction one finished

3358
01:12:52,709 --> 01:12:52,719
started after transaction one finished
 

3359
01:12:52,719 --> 01:12:55,350
started after transaction one finished
um that means that the 11 must be less

3360
01:12:55,350 --> 01:12:55,360
um that means that the 11 must be less
 

3361
01:12:55,360 --> 01:12:58,709
um that means that the 11 must be less
than the latest value. Um transaction

3362
01:12:58,709 --> 01:12:58,719
than the latest value. Um transaction
 

3363
01:12:58,719 --> 01:13:01,590
than the latest value. Um transaction
two is going to choose its latest half

3364
01:13:01,590 --> 01:13:01,600
two is going to choose its latest half
 

3365
01:13:01,600 --> 01:13:03,350
two is going to choose its latest half
as its time stamp. So it's going to

3366
01:13:03,350 --> 01:13:03,360
as its time stamp. So it's going to
 

3367
01:13:03,360 --> 01:13:07,110
as its time stamp. So it's going to
actually choose time stamp 12.

3368
01:13:07,110 --> 01:13:07,120
actually choose time stamp 12.
 

3369
01:13:07,120 --> 01:13:09,270
actually choose time stamp 12.
Um,

3370
01:13:09,270 --> 01:13:09,280
Um,
 

3371
01:13:09,280 --> 01:13:12,630
Um,
and in this example, when it does its

3372
01:13:12,630 --> 01:13:12,640
and in this example, when it does its
 

3373
01:13:12,640 --> 01:13:14,790
and in this example, when it does its
read, it's going to ask the storage

3374
01:13:14,790 --> 01:13:14,800
read, it's going to ask the storage
 

3375
01:13:14,800 --> 01:13:16,390
read, it's going to ask the storage
system, oh, I want to read as of time

3376
01:13:16,390 --> 01:13:16,400
system, oh, I want to read as of time
 

3377
01:13:16,400 --> 01:13:19,270
system, oh, I want to read as of time
stamp 12. Um, since transaction one

3378
01:13:19,270 --> 01:13:19,280
stamp 12. Um, since transaction one
 

3379
01:13:19,280 --> 01:13:20,870
stamp 12. Um, since transaction one
wrote with time stamp 10, that means

3380
01:13:20,870 --> 01:13:20,880
wrote with time stamp 10, that means
 

3381
01:13:20,880 --> 01:13:22,470
wrote with time stamp 10, that means
that, you know, assuming the safe

3382
01:13:22,470 --> 01:13:22,480
that, you know, assuming the safe
 

3383
01:13:22,480 --> 01:13:25,030
that, you know, assuming the safe
weight, uh, the safe time machinery

3384
01:13:25,030 --> 01:13:25,040
weight, uh, the safe time machinery
 

3385
01:13:25,040 --> 01:13:27,030
weight, uh, the safe time machinery
works, we're actually going to read the

3386
01:13:27,030 --> 01:13:27,040
works, we're actually going to read the
 

3387
01:13:27,040 --> 01:13:30,310
works, we're actually going to read the
correct value. Um, and what's going on

3388
01:13:30,310 --> 01:13:30,320
correct value. Um, and what's going on
 

3389
01:13:30,320 --> 01:13:33,910
correct value. Um, and what's going on
here is that um

3390
01:13:33,910 --> 01:13:33,920
here is that um
 

3391
01:13:33,920 --> 01:13:37,910
here is that um
the so so this happened to work out, but

3392
01:13:37,910 --> 01:13:37,920
the so so this happened to work out, but
 

3393
01:13:37,920 --> 01:13:39,669
the so so this happened to work out, but
indeed it's guaranteed to work out if

3394
01:13:39,669 --> 01:13:39,679
indeed it's guaranteed to work out if
 

3395
01:13:39,679 --> 01:13:41,510
indeed it's guaranteed to work out if
transaction two as long as transaction

3396
01:13:41,510 --> 01:13:41,520
transaction two as long as transaction
 

3397
01:13:41,520 --> 01:13:43,189
transaction two as long as transaction
two starts after transaction one

3398
01:13:43,189 --> 01:13:43,199
two starts after transaction one
 

3399
01:13:43,199 --> 01:13:45,510
two starts after transaction one
commits. And the reason is that commit

3400
01:13:45,510 --> 01:13:45,520
commits. And the reason is that commit
 

3401
01:13:45,520 --> 01:13:49,110
commits. And the reason is that commit
weight causes transaction one not to

3402
01:13:49,110 --> 01:13:49,120
weight causes transaction one not to
 

3403
01:13:49,120 --> 01:13:51,030
weight causes transaction one not to
finish committing until its time stamp

3404
01:13:51,030 --> 01:13:51,040
finish committing until its time stamp
 

3405
01:13:51,040 --> 01:13:54,310
finish committing until its time stamp
is guaranteed to be in the past. Right?

3406
01:13:54,310 --> 01:13:54,320
is guaranteed to be in the past. Right?
 

3407
01:13:54,320 --> 01:13:56,630
is guaranteed to be in the past. Right?
So transaction one chooses a time stamp.

3408
01:13:56,630 --> 01:13:56,640
So transaction one chooses a time stamp.
 

3409
01:13:56,640 --> 01:13:59,270
So transaction one chooses a time stamp.
It's guaranteed to commit

3410
01:13:59,270 --> 01:13:59,280
It's guaranteed to commit
 

3411
01:13:59,280 --> 01:14:03,270
It's guaranteed to commit
um at after that timestamp.

3412
01:14:03,270 --> 01:14:03,280
um at after that timestamp.
 

3413
01:14:03,280 --> 01:14:07,590
um at after that timestamp.
Transaction two um starts

3414
01:14:07,590 --> 01:14:07,600
Transaction two um starts
 

3415
01:14:07,600 --> 01:14:11,030
Transaction two um starts
after the commit. Um it and so we don't

3416
01:14:11,030 --> 01:14:11,040
after the commit. Um it and so we don't
 

3417
01:14:11,040 --> 01:14:12,310
after the commit. Um it and so we don't
know anything about what its earliest

3418
01:14:12,310 --> 01:14:12,320
know anything about what its earliest
 

3419
01:14:12,320 --> 01:14:14,870
know anything about what its earliest
value will be, but its latest value is

3420
01:14:14,870 --> 01:14:14,880
value will be, but its latest value is
 

3421
01:14:14,880 --> 01:14:17,030
value will be, but its latest value is
guaranteed to be after the current time.

3422
01:14:17,030 --> 01:14:17,040
guaranteed to be after the current time.
 

3423
01:14:17,040 --> 01:14:18,310
guaranteed to be after the current time.
But we know that the current time is

3424
01:14:18,310 --> 01:14:18,320
But we know that the current time is
 

3425
01:14:18,320 --> 01:14:21,669
But we know that the current time is
after the commit time of T1. um and

3426
01:14:21,669 --> 01:14:21,679
after the commit time of T1. um and
 

3427
01:14:21,679 --> 01:14:24,790
after the commit time of T1. um and
therefore that T2's latest value uh the

3428
01:14:24,790 --> 01:14:24,800
therefore that T2's latest value uh the
 

3429
01:14:24,800 --> 01:14:26,870
therefore that T2's latest value uh the
time stamp it chooses is guaranteed to

3430
01:14:26,870 --> 01:14:26,880
time stamp it chooses is guaranteed to
 

3431
01:14:26,880 --> 01:14:29,910
time stamp it chooses is guaranteed to
be after um when C committed and

3432
01:14:29,910 --> 01:14:29,920
be after um when C committed and
 

3433
01:14:29,920 --> 01:14:33,430
be after um when C committed and
therefore after the uh

3434
01:14:33,430 --> 01:14:33,440
therefore after the uh
 

3435
01:14:33,440 --> 01:14:36,550
therefore after the uh
time stamp that C used um and because

3436
01:14:36,550 --> 01:14:36,560
time stamp that C used um and because
 

3437
01:14:36,560 --> 01:14:38,950
time stamp that C used um and because
transaction two if transaction 2 starts

3438
01:14:38,950 --> 01:14:38,960
transaction two if transaction 2 starts
 

3439
01:14:38,960 --> 01:14:41,910
transaction two if transaction 2 starts
after T1 finishes transaction 2 is

3440
01:14:41,910 --> 01:14:41,920
after T1 finishes transaction 2 is
 

3441
01:14:41,920 --> 01:14:45,189
after T1 finishes transaction 2 is
guaranteed to get a higher time stamp um

3442
01:14:45,189 --> 01:14:45,199
guaranteed to get a higher time stamp um
 

3443
01:14:45,199 --> 01:14:47,110
guaranteed to get a higher time stamp um
and the snapshot isolation machinery the

3444
01:14:47,110 --> 01:14:47,120
and the snapshot isolation machinery the
 

3445
01:14:47,120 --> 01:14:50,550
and the snapshot isolation machinery the
multiple versions will cause it to read

3446
01:14:50,550 --> 01:14:50,560
multiple versions will cause it to read
 

3447
01:14:50,560 --> 01:14:53,590
multiple versions will cause it to read
um to it's read to see all lower valued

3448
01:14:53,590 --> 01:14:53,600
um to it's read to see all lower valued
 

3449
01:14:53,600 --> 01:14:55,189
um to it's read to see all lower valued
rights from all lower time stamp

3450
01:14:55,189 --> 01:14:55,199
rights from all lower time stamp
 

3451
01:14:55,199 --> 01:14:57,270
rights from all lower time stamp
transactions. That means T2 is going to

3452
01:14:57,270 --> 01:14:57,280
transactions. That means T2 is going to
 

3453
01:14:57,280 --> 01:14:59,669
transactions. That means T2 is going to
see T1 and that basically means that

3454
01:14:59,669 --> 01:14:59,679
see T1 and that basically means that
 

3455
01:14:59,679 --> 01:15:03,510
see T1 and that basically means that
we're this this is how Spanner enforces

3456
01:15:03,510 --> 01:15:03,520
we're this this is how Spanner enforces
 

3457
01:15:03,520 --> 01:15:05,510
we're this this is how Spanner enforces
um external consistency for its

3458
01:15:05,510 --> 01:15:05,520
um external consistency for its
 

3459
01:15:05,520 --> 01:15:08,550
um external consistency for its
transactions.

3460
01:15:08,550 --> 01:15:08,560

 

3461
01:15:08,560 --> 01:15:16,870

So any questions about this machinery?

3462
01:15:16,870 --> 01:15:16,880

 

3463
01:15:16,880 --> 01:15:19,830

All right. Um I want to step back a

3464
01:15:19,830 --> 01:15:19,840
All right. Um I want to step back a
 

3465
01:15:19,840 --> 01:15:24,709
All right. Um I want to step back a
little bit. Um there's really um from a

3466
01:15:24,709 --> 01:15:24,719
little bit. Um there's really um from a
 

3467
01:15:24,719 --> 01:15:26,229
little bit. Um there's really um from a
my point of view sort of two big things

3468
01:15:26,229 --> 01:15:26,239
my point of view sort of two big things
 

3469
01:15:26,239 --> 01:15:28,310
my point of view sort of two big things
going on here. One is snapshot isolation

3470
01:15:28,310 --> 01:15:28,320
going on here. One is snapshot isolation
 

3471
01:15:28,320 --> 01:15:31,030
going on here. One is snapshot isolation
by itself. Um snapshot isolation by

3472
01:15:31,030 --> 01:15:31,040
by itself. Um snapshot isolation by
 

3473
01:15:31,040 --> 01:15:33,030
by itself. Um snapshot isolation by
itself is enough to give you that is

3474
01:15:33,030 --> 01:15:33,040
itself is enough to give you that is
 

3475
01:15:33,040 --> 01:15:35,350
itself is enough to give you that is
keeping the multiple versions and giving

3476
01:15:35,350 --> 01:15:35,360
keeping the multiple versions and giving
 

3477
01:15:35,360 --> 01:15:37,910
keeping the multiple versions and giving
every transaction a time stamp. Snapshot

3478
01:15:37,910 --> 01:15:37,920
every transaction a time stamp. Snapshot
 

3479
01:15:37,920 --> 01:15:39,270
every transaction a time stamp. Snapshot
isolation is guaranteed to give you

3480
01:15:39,270 --> 01:15:39,280
isolation is guaranteed to give you
 

3481
01:15:39,280 --> 01:15:41,270
isolation is guaranteed to give you
serializable readonly transactions

3482
01:15:41,270 --> 01:15:41,280
serializable readonly transactions
 

3483
01:15:41,280 --> 01:15:43,510
serializable readonly transactions
because basically what snapshot

3484
01:15:43,510 --> 01:15:43,520
because basically what snapshot
 

3485
01:15:43,520 --> 01:15:45,510
because basically what snapshot
isolation means is that we're going to

3486
01:15:45,510 --> 01:15:45,520
isolation means is that we're going to
 

3487
01:15:45,520 --> 01:15:48,149
isolation means is that we're going to
use these timestamps as the equivalent

3488
01:15:48,149 --> 01:15:48,159
use these timestamps as the equivalent
 

3489
01:15:48,159 --> 01:15:50,390
use these timestamps as the equivalent
serial order and things like the safe

3490
01:15:50,390 --> 01:15:50,400
serial order and things like the safe
 

3491
01:15:50,400 --> 01:15:54,470
serial order and things like the safe
weight the safe time um ensure that

3492
01:15:54,470 --> 01:15:54,480
weight the safe time um ensure that
 

3493
01:15:54,480 --> 01:15:57,189
weight the safe time um ensure that
readon transactions really do read as of

3494
01:15:57,189 --> 01:15:57,199
readon transactions really do read as of
 

3495
01:15:57,199 --> 01:15:59,669
readon transactions really do read as of
their time stamps see every readr

3496
01:15:59,669 --> 01:15:59,679
their time stamps see every readr
 

3497
01:15:59,679 --> 01:16:01,510
their time stamps see every readr
transaction before that and none after

3498
01:16:01,510 --> 01:16:01,520
transaction before that and none after
 

3499
01:16:01,520 --> 01:16:05,110
transaction before that and none after
that. Um so there's really two pieces.

3500
01:16:05,110 --> 01:16:05,120
that. Um so there's really two pieces.
 

3501
01:16:05,120 --> 01:16:08,310
that. Um so there's really two pieces.
Snapshot isolation um snapshot isolation

3502
01:16:08,310 --> 01:16:08,320
Snapshot isolation um snapshot isolation
 

3503
01:16:08,320 --> 01:16:10,950
Snapshot isolation um snapshot isolation
by itself though uh is actually often

3504
01:16:10,950 --> 01:16:10,960
by itself though uh is actually often
 

3505
01:16:10,960 --> 01:16:13,030
by itself though uh is actually often
used not just by Spanner but generally

3506
01:16:13,030 --> 01:16:13,040
used not just by Spanner but generally
 

3507
01:16:13,040 --> 01:16:15,990
used not just by Spanner but generally
doesn't um by itself guarantee external

3508
01:16:15,990 --> 01:16:16,000
doesn't um by itself guarantee external
 

3509
01:16:16,000 --> 01:16:18,390
doesn't um by itself guarantee external
consistency because in a distributed

3510
01:16:18,390 --> 01:16:18,400
consistency because in a distributed
 

3511
01:16:18,400 --> 01:16:20,310
consistency because in a distributed
system it's different computers choosing

3512
01:16:20,310 --> 01:16:20,320
system it's different computers choosing
 

3513
01:16:20,320 --> 01:16:22,470
system it's different computers choosing
the time stamps. So we're not sure those

3514
01:16:22,470 --> 01:16:22,480
the time stamps. So we're not sure those
 

3515
01:16:22,480 --> 01:16:24,709
the time stamps. So we're not sure those
timestamps will obey external

3516
01:16:24,709 --> 01:16:24,719
timestamps will obey external
 

3517
01:16:24,719 --> 01:16:26,149
timestamps will obey external
consistency even if though they'll

3518
01:16:26,149 --> 01:16:26,159
consistency even if though they'll
 

3519
01:16:26,159 --> 01:16:29,350
consistency even if though they'll
deliver serializability. So in addition

3520
01:16:29,350 --> 01:16:29,360
deliver serializability. So in addition
 

3521
01:16:29,360 --> 01:16:32,709
deliver serializability. So in addition
to snapshot isolation, uh Spanner also

3522
01:16:32,709 --> 01:16:32,719
to snapshot isolation, uh Spanner also
 

3523
01:16:32,719 --> 01:16:34,630
to snapshot isolation, uh Spanner also
has synchronized timestamps and it's the

3524
01:16:34,630 --> 01:16:34,640
has synchronized timestamps and it's the
 

3525
01:16:34,640 --> 01:16:37,030
has synchronized timestamps and it's the
synchronized timestamps um plus the

3526
01:16:37,030 --> 01:16:37,040
synchronized timestamps um plus the
 

3527
01:16:37,040 --> 01:16:40,870
synchronized timestamps um plus the
commit weight rule that um allow Spanner

3528
01:16:40,870 --> 01:16:40,880
commit weight rule that um allow Spanner
 

3529
01:16:40,880 --> 01:16:43,750
commit weight rule that um allow Spanner
to guarantee external consistency as

3530
01:16:43,750 --> 01:16:43,760
to guarantee external consistency as
 

3531
01:16:43,760 --> 01:16:46,149
to guarantee external consistency as
well as serializability.

3532
01:16:46,149 --> 01:16:46,159
well as serializability.
 

3533
01:16:46,159 --> 01:16:49,030
well as serializability.
Um and again the reason why all this is

3534
01:16:49,030 --> 01:16:49,040
Um and again the reason why all this is
 

3535
01:16:49,040 --> 01:16:50,870
Um and again the reason why all this is
interesting is that programmers really

3536
01:16:50,870 --> 01:16:50,880
interesting is that programmers really
 

3537
01:16:50,880 --> 01:16:52,870
interesting is that programmers really
like transactions and they really like

3538
01:16:52,870 --> 01:16:52,880
like transactions and they really like
 

3539
01:16:52,880 --> 01:16:54,550
like transactions and they really like
external consistency because it makes

3540
01:16:54,550 --> 01:16:54,560
external consistency because it makes
 

3541
01:16:54,560 --> 01:16:57,830
external consistency because it makes
applications much easier to write. um

3542
01:16:57,830 --> 01:16:57,840
applications much easier to write. um
 

3543
01:16:57,840 --> 01:16:59,830
applications much easier to write. um
they traditionally not been provided in

3544
01:16:59,830 --> 01:16:59,840
they traditionally not been provided in
 

3545
01:16:59,840 --> 01:17:01,350
they traditionally not been provided in
distributed settings because they're too

3546
01:17:01,350 --> 01:17:01,360
distributed settings because they're too
 

3547
01:17:01,360 --> 01:17:03,669
distributed settings because they're too
slow. And so the fact that Spanner

3548
01:17:03,669 --> 01:17:03,679
slow. And so the fact that Spanner
 

3549
01:17:03,679 --> 01:17:05,189
slow. And so the fact that Spanner
manages to at least make readonly

3550
01:17:05,189 --> 01:17:05,199
manages to at least make readonly
 

3551
01:17:05,199 --> 01:17:08,149
manages to at least make readonly
transactions very fast is extremely

3552
01:17:08,149 --> 01:17:08,159
transactions very fast is extremely
 

3553
01:17:08,159 --> 01:17:09,830
transactions very fast is extremely
attractive, right? No locking, no

3554
01:17:09,830 --> 01:17:09,840
attractive, right? No locking, no
 

3555
01:17:09,840 --> 01:17:12,070
attractive, right? No locking, no
two-phase commit, and not even any

3556
01:17:12,070 --> 01:17:12,080
two-phase commit, and not even any
 

3557
01:17:12,080 --> 01:17:14,229
two-phase commit, and not even any
distant reads for readonly transactions.

3558
01:17:14,229 --> 01:17:14,239
distant reads for readonly transactions.
 

3559
01:17:14,239 --> 01:17:16,390
distant reads for readonly transactions.
They operate very efficiently from the

3560
01:17:16,390 --> 01:17:16,400
They operate very efficiently from the
 

3561
01:17:16,400 --> 01:17:18,709
They operate very efficiently from the
local replicas. And again, this is

3562
01:17:18,709 --> 01:17:18,719
local replicas. And again, this is
 

3563
01:17:18,719 --> 01:17:21,030
local replicas. And again, this is
what's good for a basically a 10 factor

3564
01:17:21,030 --> 01:17:21,040
what's good for a basically a 10 factor
 

3565
01:17:21,040 --> 01:17:24,950
what's good for a basically a 10 factor
of 10 uh latency improvement

3566
01:17:24,950 --> 01:17:24,960
of 10 uh latency improvement
 

3567
01:17:24,960 --> 01:17:27,270
of 10 uh latency improvement
um as measured in tables uh three and

3568
01:17:27,270 --> 01:17:27,280
um as measured in tables uh three and
 

3569
01:17:27,280 --> 01:17:29,669
um as measured in tables uh three and
six. But just to remind you, it's it's

3570
01:17:29,669 --> 01:17:29,679
six. But just to remind you, it's it's
 

3571
01:17:29,679 --> 01:17:33,270
six. But just to remind you, it's it's
not all um it's not all fabulous. The

3572
01:17:33,270 --> 01:17:33,280
not all um it's not all fabulous. The
 

3573
01:17:33,280 --> 01:17:35,189
not all um it's not all fabulous. The
the the

3574
01:17:35,189 --> 01:17:35,199
the the
 

3575
01:17:35,199 --> 01:17:36,790
the the
all all this wonderful machine only

3576
01:17:36,790 --> 01:17:36,800
all all this wonderful machine only
 

3577
01:17:36,800 --> 01:17:38,709
all all this wonderful machine only
applies to read only transactions. Read

3578
01:17:38,709 --> 01:17:38,719
applies to read only transactions. Read
 

3579
01:17:38,719 --> 01:17:41,350
applies to read only transactions. Read
transactions still uh use two-face

3580
01:17:41,350 --> 01:17:41,360
transactions still uh use two-face
 

3581
01:17:41,360 --> 01:17:43,750
transactions still uh use two-face
commit and locks. Um and there's a

3582
01:17:43,750 --> 01:17:43,760
commit and locks. Um and there's a
 

3583
01:17:43,760 --> 01:17:45,510
commit and locks. Um and there's a
number of cases in which even spanner

3584
01:17:45,510 --> 01:17:45,520
number of cases in which even spanner
 

3585
01:17:45,520 --> 01:17:47,350
number of cases in which even spanner
will have to block like due to the safe

3586
01:17:47,350 --> 01:17:47,360
will have to block like due to the safe
 

3587
01:17:47,360 --> 01:17:50,550
will have to block like due to the safe
time and the commit weight. Um but as

3588
01:17:50,550 --> 01:17:50,560
time and the commit weight. Um but as
 

3589
01:17:50,560 --> 01:17:53,189
time and the commit weight. Um but as
long as their times are accurate enough

3590
01:17:53,189 --> 01:17:53,199
long as their times are accurate enough
 

3591
01:17:53,199 --> 01:17:55,669
long as their times are accurate enough
uh these uh commit weights are likely to

3592
01:17:55,669 --> 01:17:55,679
uh these uh commit weights are likely to
 

3593
01:17:55,679 --> 01:17:58,470
uh these uh commit weights are likely to
be um relatively small.

3594
01:17:58,470 --> 01:17:58,480
be um relatively small.
 

3595
01:17:58,480 --> 01:18:01,669
be um relatively small.
Okay, just to summarize, the um Spanner

3596
01:18:01,669 --> 01:18:01,679
Okay, just to summarize, the um Spanner
 

3597
01:18:01,679 --> 01:18:03,350
Okay, just to summarize, the um Spanner
at the time was um kind of a

3598
01:18:03,350 --> 01:18:03,360
at the time was um kind of a
 

3599
01:18:03,360 --> 01:18:05,030
at the time was um kind of a
breakthrough because it was very rare to

3600
01:18:05,030 --> 01:18:05,040
breakthrough because it was very rare to
 

3601
01:18:05,040 --> 01:18:07,669
breakthrough because it was very rare to
see deployed systems that um offer you

3602
01:18:07,669 --> 01:18:07,679
see deployed systems that um offer you
 

3603
01:18:07,679 --> 01:18:10,470
see deployed systems that um offer you
distributed transactions where the data

3604
01:18:10,470 --> 01:18:10,480
distributed transactions where the data
 

3605
01:18:10,480 --> 01:18:14,550
distributed transactions where the data
was um geographically uh in uh very

3606
01:18:14,550 --> 01:18:14,560
was um geographically uh in uh very
 

3607
01:18:14,560 --> 01:18:16,550
was um geographically uh in uh very
different data centers. Um and

3608
01:18:16,550 --> 01:18:16,560
different data centers. Um and
 

3609
01:18:16,560 --> 01:18:18,149
different data centers. Um and
surprising, you know, Spanner people

3610
01:18:18,149 --> 01:18:18,159
surprising, you know, Spanner people
 

3611
01:18:18,159 --> 01:18:20,470
surprising, you know, Spanner people
were surprised that uh somebody was

3612
01:18:20,470 --> 01:18:20,480
were surprised that uh somebody was
 

3613
01:18:20,480 --> 01:18:21,830
were surprised that uh somebody was
using a database that actually did a

3614
01:18:21,830 --> 01:18:21,840
using a database that actually did a
 

3615
01:18:21,840 --> 01:18:23,590
using a database that actually did a
good job of this um and that the

3616
01:18:23,590 --> 01:18:23,600
good job of this um and that the
 

3617
01:18:23,600 --> 01:18:26,310
good job of this um and that the
performance was tolerable. um and the

3618
01:18:26,310 --> 01:18:26,320
performance was tolerable. um and the
 

3619
01:18:26,320 --> 01:18:28,310
performance was tolerable. um and the
snapshot isolation and the timestamping

3620
01:18:28,310 --> 01:18:28,320
snapshot isolation and the timestamping
 

3621
01:18:28,320 --> 01:18:31,270
snapshot isolation and the timestamping
part of the um probably the most

3622
01:18:31,270 --> 01:18:31,280
part of the um probably the most
 

3623
01:18:31,280 --> 01:18:35,750
part of the um probably the most
interesting aspects of the paper. Um

3624
01:18:35,750 --> 01:18:35,760
interesting aspects of the paper. Um
 

3625
01:18:35,760 --> 01:18:39,350
interesting aspects of the paper. Um
and that is all I have to say for today.

3626
01:18:39,350 --> 01:18:39,360
and that is all I have to say for today.
 

3627
01:18:39,360 --> 01:18:48,149
and that is all I have to say for today.
Um any last questions?

3628
01:18:48,149 --> 01:18:48,159

 

3629
01:18:48,159 --> 01:18:50,790

Okay. Um

3630
01:18:50,790 --> 01:18:50,800
Okay. Um
 

3631
01:18:50,800 --> 01:18:52,550
Okay. Um
I think on Thursday we're gonna we're

3632
01:18:52,550 --> 01:18:52,560
I think on Thursday we're gonna we're
 

3633
01:18:52,560 --> 01:18:54,950
I think on Thursday we're gonna we're
going to see farm which is a sort of

3634
01:18:54,950 --> 01:18:54,960
going to see farm which is a sort of
 

3635
01:18:54,960 --> 01:18:58,390
going to see farm which is a sort of
very different um slice through the

3636
01:18:58,390 --> 01:18:58,400
very different um slice through the
 

3637
01:18:58,400 --> 01:19:01,110
very different um slice through the
desire to provide very high performance

3638
01:19:01,110 --> 01:19:01,120
desire to provide very high performance
 

3639
01:19:01,120 --> 01:19:02,709
desire to provide very high performance
transactions.

3640
01:19:02,709 --> 01:19:02,719
transactions.
 

3641
01:19:02,719 --> 01:19:04,470
transactions.
Um,

3642
01:19:04,470 --> 01:19:04,480
Um,
 

3643
01:19:04,480 --> 01:19:07,679
Um,
so I'll see you all on

