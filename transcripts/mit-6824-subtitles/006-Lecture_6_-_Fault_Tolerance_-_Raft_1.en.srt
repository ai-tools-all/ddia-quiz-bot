1
00:00:00,670 --> 00:00:06,960

all right well let's get started

2
00:00:06,960 --> 00:00:06,970
all right well let's get started
 

3
00:00:06,970 --> 00:00:10,480
all right well let's get started
today and indeed today and tomorrow I'm

4
00:00:10,480 --> 00:00:10,490
today and indeed today and tomorrow I'm
 

5
00:00:10,490 --> 00:00:14,319
today and indeed today and tomorrow I'm
gonna talk about raft both because I

6
00:00:14,319 --> 00:00:14,329
gonna talk about raft both because I
 

7
00:00:14,329 --> 00:00:16,230
gonna talk about raft both because I
hope it'll be helpful you for you in

8
00:00:16,230 --> 00:00:16,240
hope it'll be helpful you for you in
 

9
00:00:16,240 --> 00:00:19,330
hope it'll be helpful you for you in
implanting though the labs and also

10
00:00:19,330 --> 00:00:19,340
implanting though the labs and also
 

11
00:00:19,340 --> 00:00:21,640
implanting though the labs and also
because you know it's just a case study

12
00:00:21,640 --> 00:00:21,650
because you know it's just a case study
 

13
00:00:21,650 --> 00:00:23,200
because you know it's just a case study
in the details of how to get state

14
00:00:23,200 --> 00:00:23,210
in the details of how to get state
 

15
00:00:23,210 --> 00:00:28,540
in the details of how to get state
machine replication correct so we have

16
00:00:28,540 --> 00:00:28,550
machine replication correct so we have
 

17
00:00:28,550 --> 00:00:31,060
machine replication correct so we have
introduction to the problem you may have

18
00:00:31,060 --> 00:00:31,070
introduction to the problem you may have
 

19
00:00:31,070 --> 00:00:33,939
introduction to the problem you may have
noticed a pattern in fault-tolerant

20
00:00:33,939 --> 00:00:33,949
noticed a pattern in fault-tolerant
 

21
00:00:33,949 --> 00:00:35,790
noticed a pattern in fault-tolerant
systems that we've looked at so far

22
00:00:35,790 --> 00:00:35,800
systems that we've looked at so far
 

23
00:00:35,800 --> 00:00:40,630
systems that we've looked at so far
one is that MapReduce replicates

24
00:00:40,630 --> 00:00:40,640
one is that MapReduce replicates
 

25
00:00:40,640 --> 00:00:43,630
one is that MapReduce replicates
computation but the replication is

26
00:00:43,630 --> 00:00:43,640
computation but the replication is
 

27
00:00:43,640 --> 00:00:45,939
computation but the replication is
controlled the whole computation is

28
00:00:45,939 --> 00:00:45,949
controlled the whole computation is
 

29
00:00:45,949 --> 00:00:50,110
controlled the whole computation is
controlled by a single master another

30
00:00:50,110 --> 00:00:50,120
controlled by a single master another
 

31
00:00:50,120 --> 00:00:52,119
controlled by a single master another
example I'd like to draw your attention

32
00:00:52,119 --> 00:00:52,129
example I'd like to draw your attention
 

33
00:00:52,129 --> 00:00:55,329
example I'd like to draw your attention
to is that GFS replicates data right as

34
00:00:55,329 --> 00:00:55,339
to is that GFS replicates data right as
 

35
00:00:55,339 --> 00:00:56,770
to is that GFS replicates data right as
this primary backup scheme for

36
00:00:56,770 --> 00:00:56,780
this primary backup scheme for
 

37
00:00:56,780 --> 00:00:58,540
this primary backup scheme for
replicating the actual contents of files

38
00:00:58,540 --> 00:00:58,550
replicating the actual contents of files
 

39
00:00:58,550 --> 00:01:01,479
replicating the actual contents of files
but it relies on a single master to

40
00:01:01,479 --> 00:01:01,489
but it relies on a single master to
 

41
00:01:01,489 --> 00:01:03,700
but it relies on a single master to
choose who the primary is for every

42
00:01:03,700 --> 00:01:03,710
choose who the primary is for every
 

43
00:01:03,710 --> 00:01:07,899
choose who the primary is for every
piece of data another example vmware ft

44
00:01:07,899 --> 00:01:07,909
piece of data another example vmware ft
 

45
00:01:07,909 --> 00:01:09,700
piece of data another example vmware ft
replicates computational write on a

46
00:01:09,700 --> 00:01:09,710
replicates computational write on a
 

47
00:01:09,710 --> 00:01:11,830
replicates computational write on a
primary virtual machine and a backup

48
00:01:11,830 --> 00:01:11,840
primary virtual machine and a backup
 

49
00:01:11,840 --> 00:01:14,620
primary virtual machine and a backup
virtual machine but in order to figure

50
00:01:14,620 --> 00:01:14,630
virtual machine but in order to figure
 

51
00:01:14,630 --> 00:01:16,240
virtual machine but in order to figure
out what to do next if one of them seems

52
00:01:16,240 --> 00:01:16,250
out what to do next if one of them seems
 

53
00:01:16,250 --> 00:01:19,179
out what to do next if one of them seems
to a fail it relies on a single test and

54
00:01:19,179 --> 00:01:19,189
to a fail it relies on a single test and
 

55
00:01:19,189 --> 00:01:21,999
to a fail it relies on a single test and
set server to help the choose to help it

56
00:01:21,999 --> 00:01:22,009
set server to help the choose to help it
 

57
00:01:22,009 --> 00:01:23,709
set server to help the choose to help it
ensure that exactly one of the primary

58
00:01:23,709 --> 00:01:23,719
ensure that exactly one of the primary
 

59
00:01:23,719 --> 00:01:26,170
ensure that exactly one of the primary
of the backup takes over if there's some

60
00:01:26,170 --> 00:01:26,180
of the backup takes over if there's some
 

61
00:01:26,180 --> 00:01:29,380
of the backup takes over if there's some
kind of failure so in all three of these

62
00:01:29,380 --> 00:01:29,390
kind of failure so in all three of these
 

63
00:01:29,390 --> 00:01:31,810
kind of failure so in all three of these
cases sure there was a replication

64
00:01:31,810 --> 00:01:31,820
cases sure there was a replication
 

65
00:01:31,820 --> 00:01:34,209
cases sure there was a replication
system but sort of tucked away in a

66
00:01:34,209 --> 00:01:34,219
system but sort of tucked away in a
 

67
00:01:34,219 --> 00:01:36,069
system but sort of tucked away in a
corner in the replication system there

68
00:01:36,069 --> 00:01:36,079
corner in the replication system there
 

69
00:01:36,079 --> 00:01:37,870
corner in the replication system there
was some scheme where a single entity

70
00:01:37,870 --> 00:01:37,880
was some scheme where a single entity
 

71
00:01:37,880 --> 00:01:40,179
was some scheme where a single entity
was required to make a critical decision

72
00:01:40,179 --> 00:01:40,189
was required to make a critical decision
 

73
00:01:40,189 --> 00:01:43,539
was required to make a critical decision
about who the primary was in the cases

74
00:01:43,539 --> 00:01:43,549
about who the primary was in the cases
 

75
00:01:43,549 --> 00:01:47,200
about who the primary was in the cases
we care about so a very nice thing about

76
00:01:47,200 --> 00:01:47,210
we care about so a very nice thing about
 

77
00:01:47,210 --> 00:01:50,109
we care about so a very nice thing about
having a single entity decide who's

78
00:01:50,109 --> 00:01:50,119
having a single entity decide who's
 

79
00:01:50,119 --> 00:01:53,109
having a single entity decide who's
gonna be the primary is that it can't

80
00:01:53,109 --> 00:01:53,119
gonna be the primary is that it can't
 

81
00:01:53,119 --> 00:01:55,450
gonna be the primary is that it can't
disagree with itself right there's only

82
00:01:55,450 --> 00:01:55,460
disagree with itself right there's only
 

83
00:01:55,460 --> 00:01:57,609
disagree with itself right there's only
one of it makes some decision that's the

84
00:01:57,609 --> 00:01:57,619
one of it makes some decision that's the
 

85
00:01:57,619 --> 00:02:00,910
one of it makes some decision that's the
decision it made but the bad thing about

86
00:02:00,910 --> 00:02:00,920
decision it made but the bad thing about
 

87
00:02:00,920 --> 00:02:03,010
decision it made but the bad thing about
having a single entity decide like who

88
00:02:03,010 --> 00:02:03,020
having a single entity decide like who
 

89
00:02:03,020 --> 00:02:04,840
having a single entity decide like who
the primary is is that it itself as a

90
00:02:04,840 --> 00:02:04,850
the primary is is that it itself as a
 

91
00:02:04,850 --> 00:02:06,580
the primary is is that it itself as a
single point of failure and so you can

92
00:02:06,580 --> 00:02:06,590
single point of failure and so you can
 

93
00:02:06,590 --> 00:02:08,109
single point of failure and so you can
view these systems that we've looked at

94
00:02:08,109 --> 00:02:08,119
view these systems that we've looked at
 

95
00:02:08,119 --> 00:02:11,940
view these systems that we've looked at
it sort of pushing the real heart of the

96
00:02:11,940 --> 00:02:11,950
it sort of pushing the real heart of the
 

97
00:02:11,950 --> 00:02:13,780
it sort of pushing the real heart of the
fault tolerance

98
00:02:13,780 --> 00:02:13,790
fault tolerance
 

99
00:02:13,790 --> 00:02:16,600
fault tolerance
Machinery into a little corner that is

100
00:02:16,600 --> 00:02:16,610
Machinery into a little corner that is
 

101
00:02:16,610 --> 00:02:18,610
Machinery into a little corner that is
the single entity that decides who's

102
00:02:18,610 --> 00:02:18,620
the single entity that decides who's
 

103
00:02:18,620 --> 00:02:20,709
the single entity that decides who's
going to be the primary if there's a

104
00:02:20,709 --> 00:02:20,719
going to be the primary if there's a
 

105
00:02:20,719 --> 00:02:23,800
going to be the primary if there's a
failure now this whole thing is about

106
00:02:23,800 --> 00:02:23,810
failure now this whole thing is about
 

107
00:02:23,810 --> 00:02:25,420
failure now this whole thing is about
how to avoid split brain the reason why

108
00:02:25,420 --> 00:02:25,430
how to avoid split brain the reason why
 

109
00:02:25,430 --> 00:02:27,550
how to avoid split brain the reason why
we have to have have to be extremely

110
00:02:27,550 --> 00:02:27,560
we have to have have to be extremely
 

111
00:02:27,560 --> 00:02:29,979
we have to have have to be extremely
careful about making the decision about

112
00:02:29,979 --> 00:02:29,989
careful about making the decision about
 

113
00:02:29,989 --> 00:02:31,509
careful about making the decision about
who should be the primary if there's a

114
00:02:31,509 --> 00:02:31,519
who should be the primary if there's a
 

115
00:02:31,519 --> 00:02:33,940
who should be the primary if there's a
failure is that otherwise we risks split

116
00:02:33,940 --> 00:02:33,950
failure is that otherwise we risks split
 

117
00:02:33,950 --> 00:02:38,020
failure is that otherwise we risks split
brain and just make this point super

118
00:02:38,020 --> 00:02:38,030
brain and just make this point super
 

119
00:02:38,030 --> 00:02:45,099
brain and just make this point super
clear I'm gonna just remind you what the

120
00:02:45,099 --> 00:02:45,109
clear I'm gonna just remind you what the
 

121
00:02:45,109 --> 00:02:47,229
clear I'm gonna just remind you what the
problem is and why it's a serious

122
00:02:47,229 --> 00:02:47,239
problem is and why it's a serious
 

123
00:02:47,239 --> 00:02:49,979
problem is and why it's a serious
problem so supposing for example where

124
00:02:49,979 --> 00:02:49,989
problem so supposing for example where
 

125
00:02:49,989 --> 00:02:52,929
problem so supposing for example where
we want to build ourselves a replicated

126
00:02:52,929 --> 00:02:52,939
we want to build ourselves a replicated
 

127
00:02:52,939 --> 00:02:54,399
we want to build ourselves a replicated
test and set server that is we're

128
00:02:54,399 --> 00:02:54,409
test and set server that is we're
 

129
00:02:54,409 --> 00:02:56,379
test and set server that is we're
worried about the fact that vmware ft

130
00:02:56,379 --> 00:02:56,389
worried about the fact that vmware ft
 

131
00:02:56,389 --> 00:02:58,599
worried about the fact that vmware ft
relies on this test and set server to

132
00:02:58,599 --> 00:02:58,609
relies on this test and set server to
 

133
00:02:58,609 --> 00:03:00,550
relies on this test and set server to
choose who the primary is so let's build

134
00:03:00,550 --> 00:03:00,560
choose who the primary is so let's build
 

135
00:03:00,560 --> 00:03:02,740
choose who the primary is so let's build
a replicated testing set server i'm

136
00:03:02,740 --> 00:03:02,750
a replicated testing set server i'm
 

137
00:03:02,750 --> 00:03:04,509
a replicated testing set server i'm
gonna do this it's gonna be broken it's

138
00:03:04,509 --> 00:03:04,519
gonna do this it's gonna be broken it's
 

139
00:03:04,519 --> 00:03:08,949
gonna do this it's gonna be broken it's
just an illustration for why why it's

140
00:03:08,949 --> 00:03:08,959
just an illustration for why why it's
 

141
00:03:08,959 --> 00:03:10,599
just an illustration for why why it's
difficult to get this but brain problem

142
00:03:10,599 --> 00:03:10,609
difficult to get this but brain problem
 

143
00:03:10,609 --> 00:03:12,009
difficult to get this but brain problem
correctly so you know we're gonna

144
00:03:12,009 --> 00:03:12,019
correctly so you know we're gonna
 

145
00:03:12,019 --> 00:03:16,300
correctly so you know we're gonna
imagine we have a network and maybe two

146
00:03:16,300 --> 00:03:16,310
imagine we have a network and maybe two
 

147
00:03:16,310 --> 00:03:18,369
imagine we have a network and maybe two
servers which are supposed to be

148
00:03:18,369 --> 00:03:18,379
servers which are supposed to be
 

149
00:03:18,379 --> 00:03:21,009
servers which are supposed to be
replicas of our test and set service

150
00:03:21,009 --> 00:03:21,019
replicas of our test and set service
 

151
00:03:21,019 --> 00:03:23,170
replicas of our test and set service
connected and you know maybe two clients

152
00:03:23,170 --> 00:03:23,180
connected and you know maybe two clients
 

153
00:03:23,180 --> 00:03:24,939
connected and you know maybe two clients
they need to know who's the primary

154
00:03:24,939 --> 00:03:24,949
they need to know who's the primary
 

155
00:03:24,949 --> 00:03:26,530
they need to know who's the primary
right now or actually maybe these

156
00:03:26,530 --> 00:03:26,540
right now or actually maybe these
 

157
00:03:26,540 --> 00:03:28,930
right now or actually maybe these
clients in this case are the primary in

158
00:03:28,930 --> 00:03:28,940
clients in this case are the primary in
 

159
00:03:28,940 --> 00:03:34,659
clients in this case are the primary in
the back up in vmware ft so if it's a

160
00:03:34,659 --> 00:03:34,669
the back up in vmware ft so if it's a
 

161
00:03:34,669 --> 00:03:36,159
the back up in vmware ft so if it's a
test and set service then you know both

162
00:03:36,159 --> 00:03:36,169
test and set service then you know both
 

163
00:03:36,169 --> 00:03:38,110
test and set service then you know both
these databases mostly servers start out

164
00:03:38,110 --> 00:03:38,120
these databases mostly servers start out
 

165
00:03:38,120 --> 00:03:40,270
these databases mostly servers start out
with their state that is the state of

166
00:03:40,270 --> 00:03:40,280
with their state that is the state of
 

167
00:03:40,280 --> 00:03:42,610
with their state that is the state of
this test flight back in zero and the

168
00:03:42,610 --> 00:03:42,620
this test flight back in zero and the
 

169
00:03:42,620 --> 00:03:44,710
this test flight back in zero and the
one operation their clients can send is

170
00:03:44,710 --> 00:03:44,720
one operation their clients can send is
 

171
00:03:44,720 --> 00:03:46,240
one operation their clients can send is
the test and set operation which is

172
00:03:46,240 --> 00:03:46,250
the test and set operation which is
 

173
00:03:46,250 --> 00:03:50,740
the test and set operation which is
supposed to set the flag of the

174
00:03:50,740 --> 00:03:50,750
supposed to set the flag of the
 

175
00:03:50,750 --> 00:03:52,869
supposed to set the flag of the
replicated service to one so i should

176
00:03:52,869 --> 00:03:52,879
replicated service to one so i should
 

177
00:03:52,879 --> 00:03:55,180
replicated service to one so i should
set both copies and then return the old

178
00:03:55,180 --> 00:03:55,190
set both copies and then return the old
 

179
00:03:55,190 --> 00:03:57,490
set both copies and then return the old
value so it's essentially acts as a kind

180
00:03:57,490 --> 00:03:57,500
value so it's essentially acts as a kind
 

181
00:03:57,500 --> 00:04:02,500
value so it's essentially acts as a kind
of simplified lock server okay so the

182
00:04:02,500 --> 00:04:02,510
of simplified lock server okay so the
 

183
00:04:02,510 --> 00:04:05,589
of simplified lock server okay so the
problem situation the lowly worried

184
00:04:05,589 --> 00:04:05,599
problem situation the lowly worried
 

185
00:04:05,599 --> 00:04:08,920
problem situation the lowly worried
about split-brain arises when a client

186
00:04:08,920 --> 00:04:08,930
about split-brain arises when a client
 

187
00:04:08,930 --> 00:04:11,229
about split-brain arises when a client
can talk to one of the servers but can't

188
00:04:11,229 --> 00:04:11,239
can talk to one of the servers but can't
 

189
00:04:11,239 --> 00:04:12,759
can talk to one of the servers but can't
talk to the other so we're imagining

190
00:04:12,759 --> 00:04:12,769
talk to the other so we're imagining
 

191
00:04:12,769 --> 00:04:14,979
talk to the other so we're imagining
either that when clients send a request

192
00:04:14,979 --> 00:04:14,989
either that when clients send a request
 

193
00:04:14,989 --> 00:04:17,800
either that when clients send a request
they send it to both I'm just gonna

194
00:04:17,800 --> 00:04:17,810
they send it to both I'm just gonna
 

195
00:04:17,810 --> 00:04:19,149
they send it to both I'm just gonna
assume that now and almost doesn't

196
00:04:19,149 --> 00:04:19,159
assume that now and almost doesn't
 

197
00:04:19,159 --> 00:04:20,920
assume that now and almost doesn't
matter so let's assume that the protocol

198
00:04:20,920 --> 00:04:20,930
matter so let's assume that the protocol
 

199
00:04:20,930 --> 00:04:22,180
matter so let's assume that the protocol
is that the clients supposed to send

200
00:04:22,180 --> 00:04:22,190
is that the clients supposed to send
 

201
00:04:22,190 --> 00:04:24,370
is that the clients supposed to send
ordinarily any request to both servers

202
00:04:24,370 --> 00:04:24,380
ordinarily any request to both servers
 

203
00:04:24,380 --> 00:04:27,250
ordinarily any request to both servers
and somehow we you know we need

204
00:04:27,250 --> 00:04:27,260
and somehow we you know we need
 

205
00:04:27,260 --> 00:04:29,320
and somehow we you know we need
think through what the clients should do

206
00:04:29,320 --> 00:04:29,330
think through what the clients should do
 

207
00:04:29,330 --> 00:04:31,260
think through what the clients should do
if one of the server's doesn't respond

208
00:04:31,260 --> 00:04:31,270
if one of the server's doesn't respond
 

209
00:04:31,270 --> 00:04:33,400
if one of the server's doesn't respond
right or what the system should do if

210
00:04:33,400 --> 00:04:33,410
right or what the system should do if
 

211
00:04:33,410 --> 00:04:34,570
right or what the system should do if
one of the server seems to gotten

212
00:04:34,570 --> 00:04:34,580
one of the server seems to gotten
 

213
00:04:34,580 --> 00:04:38,290
one of the server seems to gotten
responsive so let's imagine now the

214
00:04:38,290 --> 00:04:38,300
responsive so let's imagine now the
 

215
00:04:38,300 --> 00:04:40,330
responsive so let's imagine now the
client one can contact server one but

216
00:04:40,330 --> 00:04:40,340
client one can contact server one but
 

217
00:04:40,340 --> 00:04:42,190
client one can contact server one but
not server two how should the system

218
00:04:42,190 --> 00:04:42,200
not server two how should the system
 

219
00:04:42,200 --> 00:04:46,510
not server two how should the system
react one possibility is for is that we

220
00:04:46,510 --> 00:04:46,520
react one possibility is for is that we
 

221
00:04:46,520 --> 00:04:48,370
react one possibility is for is that we
think well you know gosh we certainly

222
00:04:48,370 --> 00:04:48,380
think well you know gosh we certainly
 

223
00:04:48,380 --> 00:04:49,600
think well you know gosh we certainly
don't want to just talk to client to

224
00:04:49,600 --> 00:04:49,610
don't want to just talk to client to
 

225
00:04:49,610 --> 00:04:50,920
don't want to just talk to client to
server one because that would leave the

226
00:04:50,920 --> 00:04:50,930
server one because that would leave the
 

227
00:04:50,930 --> 00:04:53,440
server one because that would leave the
second replica inconsistent if we set

228
00:04:53,440 --> 00:04:53,450
second replica inconsistent if we set
 

229
00:04:53,450 --> 00:04:54,970
second replica inconsistent if we set
this value to one but didn't also set

230
00:04:54,970 --> 00:04:54,980
this value to one but didn't also set
 

231
00:04:54,980 --> 00:04:55,810
this value to one but didn't also set
this value to one

232
00:04:55,810 --> 00:04:55,820
this value to one
 

233
00:04:55,820 --> 00:04:57,640
this value to one
so maybe the rule should be that the

234
00:04:57,640 --> 00:04:57,650
so maybe the rule should be that the
 

235
00:04:57,650 --> 00:04:59,380
so maybe the rule should be that the
client is always required to talk to

236
00:04:59,380 --> 00:04:59,390
client is always required to talk to
 

237
00:04:59,390 --> 00:05:01,840
client is always required to talk to
both replicas to both servers for any

238
00:05:01,840 --> 00:05:01,850
both replicas to both servers for any
 

239
00:05:01,850 --> 00:05:03,250
both replicas to both servers for any
operation and shouldn't be allowed to

240
00:05:03,250 --> 00:05:03,260
operation and shouldn't be allowed to
 

241
00:05:03,260 --> 00:05:05,830
operation and shouldn't be allowed to
just talk to one of them so why is that

242
00:05:05,830 --> 00:05:05,840
just talk to one of them so why is that
 

243
00:05:05,840 --> 00:05:10,810
just talk to one of them so why is that
the wrong answer so the rule is o in our

244
00:05:10,810 --> 00:05:10,820
the wrong answer so the rule is o in our
 

245
00:05:10,820 --> 00:05:12,460
the wrong answer so the rule is o in our
replicated system the clients always

246
00:05:12,460 --> 00:05:12,470
replicated system the clients always
 

247
00:05:12,470 --> 00:05:15,280
replicated system the clients always
require to talk to both replicas in

248
00:05:15,280 --> 00:05:15,290
require to talk to both replicas in
 

249
00:05:15,290 --> 00:05:22,720
require to talk to both replicas in
order to make progress at all in fact

250
00:05:22,720 --> 00:05:22,730
order to make progress at all in fact
 

251
00:05:22,730 --> 00:05:25,480
order to make progress at all in fact
it's worse it's worse than talking to a

252
00:05:25,480 --> 00:05:25,490
it's worse it's worse than talking to a
 

253
00:05:25,490 --> 00:05:27,220
it's worse it's worse than talking to a
single server because now the system has

254
00:05:27,220 --> 00:05:27,230
single server because now the system has
 

255
00:05:27,230 --> 00:05:30,640
single server because now the system has
a problem if either of these servers is

256
00:05:30,640 --> 00:05:30,650
a problem if either of these servers is
 

257
00:05:30,650 --> 00:05:33,460
a problem if either of these servers is
crashed or or you can't talk to it at

258
00:05:33,460 --> 00:05:33,470
crashed or or you can't talk to it at
 

259
00:05:33,470 --> 00:05:34,870
crashed or or you can't talk to it at
least with a non replicated service

260
00:05:34,870 --> 00:05:34,880
least with a non replicated service
 

261
00:05:34,880 --> 00:05:36,130
least with a non replicated service
you're only depending on one server but

262
00:05:36,130 --> 00:05:36,140
you're only depending on one server but
 

263
00:05:36,140 --> 00:05:37,570
you're only depending on one server but
here we am both servers have to be a lot

264
00:05:37,570 --> 00:05:37,580
here we am both servers have to be a lot
 

265
00:05:37,580 --> 00:05:40,030
here we am both servers have to be a lot
if we require the client to talk to both

266
00:05:40,030 --> 00:05:40,040
if we require the client to talk to both
 

267
00:05:40,040 --> 00:05:41,830
if we require the client to talk to both
servers then both servers has to be live

268
00:05:41,830 --> 00:05:41,840
servers then both servers has to be live
 

269
00:05:41,840 --> 00:05:43,690
servers then both servers has to be live
so we can't possibly require the client

270
00:05:43,690 --> 00:05:43,700
so we can't possibly require the client
 

271
00:05:43,700 --> 00:05:46,840
so we can't possibly require the client
to actually you know wait for both

272
00:05:46,840 --> 00:05:46,850
to actually you know wait for both
 

273
00:05:46,850 --> 00:05:49,000
to actually you know wait for both
servers to respond if we don't have

274
00:05:49,000 --> 00:05:49,010
servers to respond if we don't have
 

275
00:05:49,010 --> 00:05:50,350
servers to respond if we don't have
fault tolerance we need it to be able to

276
00:05:50,350 --> 00:05:50,360
fault tolerance we need it to be able to
 

277
00:05:50,360 --> 00:05:52,540
fault tolerance we need it to be able to
proceed so another obvious answer is

278
00:05:52,540 --> 00:05:52,550
proceed so another obvious answer is
 

279
00:05:52,550 --> 00:05:55,060
proceed so another obvious answer is
that if the client can't talk to both

280
00:05:55,060 --> 00:05:55,070
that if the client can't talk to both
 

281
00:05:55,070 --> 00:05:56,350
that if the client can't talk to both
well it just talks to the one who can

282
00:05:56,350 --> 00:05:56,360
well it just talks to the one who can
 

283
00:05:56,360 --> 00:05:59,880
well it just talks to the one who can
talk to and figures the other ones dead

284
00:05:59,880 --> 00:05:59,890
talk to and figures the other ones dead
 

285
00:05:59,890 --> 00:06:02,620
talk to and figures the other ones dead
so what's up why is that also not the

286
00:06:02,620 --> 00:06:02,630
so what's up why is that also not the
 

287
00:06:02,630 --> 00:06:08,500
so what's up why is that also not the
right answer

288
00:06:08,500 --> 00:06:08,510

 

289
00:06:08,510 --> 00:06:10,240

the troubling scenario is if the other

290
00:06:10,240 --> 00:06:10,250
the troubling scenario is if the other
 

291
00:06:10,250 --> 00:06:12,100
the troubling scenario is if the other
server is actually alive so suppose the

292
00:06:12,100 --> 00:06:12,110
server is actually alive so suppose the
 

293
00:06:12,110 --> 00:06:13,930
server is actually alive so suppose the
actual problem or encountering is not

294
00:06:13,930 --> 00:06:13,940
actual problem or encountering is not
 

295
00:06:13,940 --> 00:06:16,750
actual problem or encountering is not
that this server crashed which would be

296
00:06:16,750 --> 00:06:16,760
that this server crashed which would be
 

297
00:06:16,760 --> 00:06:20,140
that this server crashed which would be
good for us but the much worse issue

298
00:06:20,140 --> 00:06:20,150
good for us but the much worse issue
 

299
00:06:20,150 --> 00:06:21,490
good for us but the much worse issue
that something went wrong with the

300
00:06:21,490 --> 00:06:21,500
that something went wrong with the
 

301
00:06:21,500 --> 00:06:23,890
that something went wrong with the
network cable and that this client can

302
00:06:23,890 --> 00:06:23,900
network cable and that this client can
 

303
00:06:23,900 --> 00:06:26,200
network cable and that this client can
talk to climb one can talk to server one

304
00:06:26,200 --> 00:06:26,210
talk to climb one can talk to server one
 

305
00:06:26,210 --> 00:06:27,880
talk to climb one can talk to server one
but not server two and there's maybe

306
00:06:27,880 --> 00:06:27,890
but not server two and there's maybe
 

307
00:06:27,890 --> 00:06:29,590
but not server two and there's maybe
some other client out there that conduct

308
00:06:29,590 --> 00:06:29,600
some other client out there that conduct
 

309
00:06:29,600 --> 00:06:33,040
some other client out there that conduct
a server two but not server one so if we

310
00:06:33,040 --> 00:06:33,050
a server two but not server one so if we
 

311
00:06:33,050 --> 00:06:35,590
a server two but not server one so if we
make the rule that if a client can talk

312
00:06:35,590 --> 00:06:35,600
make the rule that if a client can talk
 

313
00:06:35,600 --> 00:06:38,290
make the rule that if a client can talk
to both servers that it's okay in order

314
00:06:38,290 --> 00:06:38,300
to both servers that it's okay in order
 

315
00:06:38,300 --> 00:06:39,670
to both servers that it's okay in order
to be fault tolerant that I just talked

316
00:06:39,670 --> 00:06:39,680
to be fault tolerant that I just talked
 

317
00:06:39,680 --> 00:06:43,510
to be fault tolerant that I just talked
to one then what's just inevitably gonna

318
00:06:43,510 --> 00:06:43,520
to one then what's just inevitably gonna
 

319
00:06:43,520 --> 00:06:46,120
to one then what's just inevitably gonna
happen said this cable is gonna break

320
00:06:46,120 --> 00:06:46,130
happen said this cable is gonna break
 

321
00:06:46,130 --> 00:06:48,160
happen said this cable is gonna break
thus cutting the network in half client

322
00:06:48,160 --> 00:06:48,170
thus cutting the network in half client
 

323
00:06:48,170 --> 00:06:51,310
thus cutting the network in half client
one is gonna send a test and set request

324
00:06:51,310 --> 00:06:51,320
one is gonna send a test and set request
 

325
00:06:51,320 --> 00:06:53,740
one is gonna send a test and set request
to server one server one will you know

326
00:06:53,740 --> 00:06:53,750
to server one server one will you know
 

327
00:06:53,750 --> 00:06:56,260
to server one server one will you know
set it state to one and return the

328
00:06:56,260 --> 00:06:56,270
set it state to one and return the
 

329
00:06:56,270 --> 00:06:58,420
set it state to one and return the
previous value of zero to client one and

330
00:06:58,420 --> 00:06:58,430
previous value of zero to client one and
 

331
00:06:58,430 --> 00:06:59,650
previous value of zero to client one and
so that mean client mom will think it

332
00:06:59,650 --> 00:06:59,660
so that mean client mom will think it
 

333
00:06:59,660 --> 00:07:02,170
so that mean client mom will think it
has the lock and if it's a VMware ft

334
00:07:02,170 --> 00:07:02,180
has the lock and if it's a VMware ft
 

335
00:07:02,180 --> 00:07:04,300
has the lock and if it's a VMware ft
server will think it can be takeovers

336
00:07:04,300 --> 00:07:04,310
server will think it can be takeovers
 

337
00:07:04,310 --> 00:07:06,730
server will think it can be takeovers
primarily but this replica still of zero

338
00:07:06,730 --> 00:07:06,740
primarily but this replica still of zero
 

339
00:07:06,740 --> 00:07:08,560
primarily but this replica still of zero
in it all right so now if client to

340
00:07:08,560 --> 00:07:08,570
in it all right so now if client to
 

341
00:07:08,570 --> 00:07:10,300
in it all right so now if client to
who've also sends a test and set request

342
00:07:10,300 --> 00:07:10,310
who've also sends a test and set request
 

343
00:07:10,310 --> 00:07:12,910
who've also sends a test and set request
to you know what price to send them to

344
00:07:12,910 --> 00:07:12,920
to you know what price to send them to
 

345
00:07:12,920 --> 00:07:14,380
to you know what price to send them to
both sees that server one appears to be

346
00:07:14,380 --> 00:07:14,390
both sees that server one appears to be
 

347
00:07:14,390 --> 00:07:16,810
both sees that server one appears to be
down follows the rule that says well you

348
00:07:16,810 --> 00:07:16,820
down follows the rule that says well you
 

349
00:07:16,820 --> 00:07:17,950
down follows the rule that says well you
just send to the one server but you can

350
00:07:17,950 --> 00:07:17,960
just send to the one server but you can
 

351
00:07:17,960 --> 00:07:22,450
just send to the one server but you can
talk to then it will also think that it

352
00:07:22,450 --> 00:07:22,460
talk to then it will also think that it
 

353
00:07:22,460 --> 00:07:23,860
talk to then it will also think that it
would either quiet because client you

354
00:07:23,860 --> 00:07:23,870
would either quiet because client you
 

355
00:07:23,870 --> 00:07:25,510
would either quiet because client you
also think that it acquired the lock and

356
00:07:25,510 --> 00:07:25,520
also think that it acquired the lock and
 

357
00:07:25,520 --> 00:07:27,220
also think that it acquired the lock and
so now you know if we were imagining

358
00:07:27,220 --> 00:07:27,230
so now you know if we were imagining
 

359
00:07:27,230 --> 00:07:28,810
so now you know if we were imagining
this test and that server was going to

360
00:07:28,810 --> 00:07:28,820
this test and that server was going to
 

361
00:07:28,820 --> 00:07:29,980
this test and that server was going to
be used with the and where ft we have

362
00:07:29,980 --> 00:07:29,990
be used with the and where ft we have
 

363
00:07:29,990 --> 00:07:35,010
be used with the and where ft we have
not both replicas both of these VMware

364
00:07:35,010 --> 00:07:35,020
not both replicas both of these VMware
 

365
00:07:35,020 --> 00:07:37,960
not both replicas both of these VMware
machines I think they could be primary

366
00:07:37,960 --> 00:07:37,970
machines I think they could be primary
 

367
00:07:37,970 --> 00:07:41,170
machines I think they could be primary
by themselves without consulting the

368
00:07:41,170 --> 00:07:41,180
by themselves without consulting the
 

369
00:07:41,180 --> 00:07:42,640
by themselves without consulting the
other server so that's a complete

370
00:07:42,640 --> 00:07:42,650
other server so that's a complete
 

371
00:07:42,650 --> 00:07:45,340
other server so that's a complete
failure so with this set up and two

372
00:07:45,340 --> 00:07:45,350
failure so with this set up and two
 

373
00:07:45,350 --> 00:07:47,830
failure so with this set up and two
servers it seemed like we had this we

374
00:07:47,830 --> 00:07:47,840
servers it seemed like we had this we
 

375
00:07:47,840 --> 00:07:49,690
servers it seemed like we had this we
just had to choose either you wait for

376
00:07:49,690 --> 00:07:49,700
just had to choose either you wait for
 

377
00:07:49,700 --> 00:07:52,110
just had to choose either you wait for
both and you're not fault-tolerant or

378
00:07:52,110 --> 00:07:52,120
both and you're not fault-tolerant or
 

379
00:07:52,120 --> 00:07:54,430
both and you're not fault-tolerant or
you wait for just one and you're not

380
00:07:54,430 --> 00:07:54,440
you wait for just one and you're not
 

381
00:07:54,440 --> 00:07:57,340
you wait for just one and you're not
correct and then our correct version

382
00:07:57,340 --> 00:07:57,350
correct and then our correct version
 

383
00:07:57,350 --> 00:07:59,550
correct and then our correct version
it's often called split brain so

384
00:07:59,550 --> 00:07:59,560
it's often called split brain so
 

385
00:07:59,560 --> 00:08:09,119
it's often called split brain so
everybody see this well

386
00:08:09,119 --> 00:08:09,129

 

387
00:08:09,129 --> 00:08:12,629

so this was basically where things stood

388
00:08:12,629 --> 00:08:12,639
so this was basically where things stood
 

389
00:08:12,639 --> 00:08:16,510
so this was basically where things stood
until the late 80s and when people but

390
00:08:16,510 --> 00:08:16,520
until the late 80s and when people but
 

391
00:08:16,520 --> 00:08:18,040
until the late 80s and when people but
people did want to build replicated

392
00:08:18,040 --> 00:08:18,050
people did want to build replicated
 

393
00:08:18,050 --> 00:08:20,499
people did want to build replicated
systems you know like the computers that

394
00:08:20,499 --> 00:08:20,509
systems you know like the computers that
 

395
00:08:20,509 --> 00:08:22,689
systems you know like the computers that
control telephone switches or the

396
00:08:22,689 --> 00:08:22,699
control telephone switches or the
 

397
00:08:22,699 --> 00:08:24,909
control telephone switches or the
computers that ran banks you know there

398
00:08:24,909 --> 00:08:24,919
computers that ran banks you know there
 

399
00:08:24,919 --> 00:08:26,499
computers that ran banks you know there
was placer when we spend a huge amount

400
00:08:26,499 --> 00:08:26,509
was placer when we spend a huge amount
 

401
00:08:26,509 --> 00:08:27,820
was placer when we spend a huge amount
of money in order to have reliable

402
00:08:27,820 --> 00:08:27,830
of money in order to have reliable
 

403
00:08:27,830 --> 00:08:29,439
of money in order to have reliable
service and so they would replicate they

404
00:08:29,439 --> 00:08:29,449
service and so they would replicate they
 

405
00:08:29,449 --> 00:08:31,209
service and so they would replicate they
would build replicated systems and the

406
00:08:31,209 --> 00:08:31,219
would build replicated systems and the
 

407
00:08:31,219 --> 00:08:33,519
would build replicated systems and the
way they would deal then way would that

408
00:08:33,519 --> 00:08:33,529
way they would deal then way would that
 

409
00:08:33,529 --> 00:08:35,230
way they would deal then way would that
they would have replication but try to

410
00:08:35,230 --> 00:08:35,240
they would have replication but try to
 

411
00:08:35,240 --> 00:08:38,230
they would have replication but try to
rule out of rule out split brain it's a

412
00:08:38,230 --> 00:08:38,240
rule out of rule out split brain it's a
 

413
00:08:38,240 --> 00:08:41,079
rule out of rule out split brain it's a
couple of techniques one is they would

414
00:08:41,079 --> 00:08:41,089
couple of techniques one is they would
 

415
00:08:41,089 --> 00:08:45,069
couple of techniques one is they would
build a network that could not fail and

416
00:08:45,069 --> 00:08:45,079
build a network that could not fail and
 

417
00:08:45,079 --> 00:08:47,350
build a network that could not fail and
so usually what that means and in fact

418
00:08:47,350 --> 00:08:47,360
so usually what that means and in fact
 

419
00:08:47,360 --> 00:08:49,150
so usually what that means and in fact
you guys use networks that essentially

420
00:08:49,150 --> 00:08:49,160
you guys use networks that essentially
 

421
00:08:49,160 --> 00:08:51,249
you guys use networks that essentially
cannot fail all the time the wires

422
00:08:51,249 --> 00:08:51,259
cannot fail all the time the wires
 

423
00:08:51,259 --> 00:08:53,829
cannot fail all the time the wires
inside your laptop you know connecting

424
00:08:53,829 --> 00:08:53,839
inside your laptop you know connecting
 

425
00:08:53,839 --> 00:08:57,579
inside your laptop you know connecting
the CPU to the DRAM are effectively what

426
00:08:57,579 --> 00:08:57,589
the CPU to the DRAM are effectively what
 

427
00:08:57,589 --> 00:08:59,400
the CPU to the DRAM are effectively what
you know a network that cannot fail

428
00:08:59,400 --> 00:08:59,410
you know a network that cannot fail
 

429
00:08:59,410 --> 00:09:02,920
you know a network that cannot fail
between the between your CPU and DRAM so

430
00:09:02,920 --> 00:09:02,930
between the between your CPU and DRAM so
 

431
00:09:02,930 --> 00:09:05,139
between the between your CPU and DRAM so
you know with reasonable assumptions and

432
00:09:05,139 --> 00:09:05,149
you know with reasonable assumptions and
 

433
00:09:05,149 --> 00:09:07,300
you know with reasonable assumptions and
lots of money and you know sort of

434
00:09:07,300 --> 00:09:07,310
lots of money and you know sort of
 

435
00:09:07,310 --> 00:09:10,240
lots of money and you know sort of
carefully controlled physical situation

436
00:09:10,240 --> 00:09:10,250
carefully controlled physical situation
 

437
00:09:10,250 --> 00:09:11,170
carefully controlled physical situation
like you don't want to have a cable

438
00:09:11,170 --> 00:09:11,180
like you don't want to have a cable
 

439
00:09:11,180 --> 00:09:12,790
like you don't want to have a cable
snaking across the floor that somebody

440
00:09:12,790 --> 00:09:12,800
snaking across the floor that somebody
 

441
00:09:12,800 --> 00:09:15,030
snaking across the floor that somebody
can step on you know it's got to be

442
00:09:15,030 --> 00:09:15,040
can step on you know it's got to be
 

443
00:09:15,040 --> 00:09:17,470
can step on you know it's got to be
physically designed set up with a

444
00:09:17,470 --> 00:09:17,480
physically designed set up with a
 

445
00:09:17,480 --> 00:09:19,749
physically designed set up with a
network that cannot fail you can rule

446
00:09:19,749 --> 00:09:19,759
network that cannot fail you can rule
 

447
00:09:19,759 --> 00:09:21,129
network that cannot fail you can rule
out split brain it's bit of an

448
00:09:21,129 --> 00:09:21,139
out split brain it's bit of an
 

449
00:09:21,139 --> 00:09:22,929
out split brain it's bit of an
assumption but with enough money people

450
00:09:22,929 --> 00:09:22,939
assumption but with enough money people
 

451
00:09:22,939 --> 00:09:25,360
assumption but with enough money people
get quite close to this because if the

452
00:09:25,360 --> 00:09:25,370
get quite close to this because if the
 

453
00:09:25,370 --> 00:09:27,040
get quite close to this because if the
network cannot fail that basically means

454
00:09:27,040 --> 00:09:27,050
network cannot fail that basically means
 

455
00:09:27,050 --> 00:09:28,689
network cannot fail that basically means
that the client can't talk to a server

456
00:09:28,689 --> 00:09:28,699
that the client can't talk to a server
 

457
00:09:28,699 --> 00:09:31,300
that the client can't talk to a server
to that means server two must be down

458
00:09:31,300 --> 00:09:31,310
to that means server two must be down
 

459
00:09:31,310 --> 00:09:33,429
to that means server two must be down
because it can't have been the network

460
00:09:33,429 --> 00:09:33,439
because it can't have been the network
 

461
00:09:33,439 --> 00:09:35,439
because it can't have been the network
malfunctioning so that was one way that

462
00:09:35,439 --> 00:09:35,449
malfunctioning so that was one way that
 

463
00:09:35,449 --> 00:09:38,650
malfunctioning so that was one way that
people sort of built replication systems

464
00:09:38,650 --> 00:09:38,660
people sort of built replication systems
 

465
00:09:38,660 --> 00:09:41,999
people sort of built replication systems
it didn't suffer from split brain

466
00:09:41,999 --> 00:09:42,009

 

467
00:09:42,009 --> 00:09:44,230

another possibility would be to have

468
00:09:44,230 --> 00:09:44,240
another possibility would be to have
 

469
00:09:44,240 --> 00:09:46,120
another possibility would be to have
some human beings sort out the problem

470
00:09:46,120 --> 00:09:46,130
some human beings sort out the problem
 

471
00:09:46,130 --> 00:09:48,129
some human beings sort out the problem
that is don't automatically do anything

472
00:09:48,129 --> 00:09:48,139
that is don't automatically do anything
 

473
00:09:48,139 --> 00:09:49,960
that is don't automatically do anything
instead have the clients you know by

474
00:09:49,960 --> 00:09:49,970
instead have the clients you know by
 

475
00:09:49,970 --> 00:09:51,850
instead have the clients you know by
default clients always have to wait for

476
00:09:51,850 --> 00:09:51,860
default clients always have to wait for
 

477
00:09:51,860 --> 00:09:54,100
default clients always have to wait for
you know both replicas to respond or

478
00:09:54,100 --> 00:09:54,110
you know both replicas to respond or
 

479
00:09:54,110 --> 00:09:56,860
you know both replicas to respond or
something never allowed to proceed with

480
00:09:56,860 --> 00:09:56,870
something never allowed to proceed with
 

481
00:09:56,870 --> 00:09:58,509
something never allowed to proceed with
just one of them but you can you know

482
00:09:58,509 --> 00:09:58,519
just one of them but you can you know
 

483
00:09:58,519 --> 00:10:00,699
just one of them but you can you know
call somebody's beeper to go off some

484
00:10:00,699 --> 00:10:00,709
call somebody's beeper to go off some
 

485
00:10:00,709 --> 00:10:02,530
call somebody's beeper to go off some
human being goes to the machine room and

486
00:10:02,530 --> 00:10:02,540
human being goes to the machine room and
 

487
00:10:02,540 --> 00:10:04,240
human being goes to the machine room and
sort of looks at the two replicas and

488
00:10:04,240 --> 00:10:04,250
sort of looks at the two replicas and
 

489
00:10:04,250 --> 00:10:06,999
sort of looks at the two replicas and
either turns one off to make sure it's

490
00:10:06,999 --> 00:10:07,009
either turns one off to make sure it's
 

491
00:10:07,009 --> 00:10:07,840
either turns one off to make sure it's
definitely dead

492
00:10:07,840 --> 00:10:07,850
definitely dead
 

493
00:10:07,850 --> 00:10:10,120
definitely dead
or verifies that one of them has indeed

494
00:10:10,120 --> 00:10:10,130
or verifies that one of them has indeed
 

495
00:10:10,130 --> 00:10:13,449
or verifies that one of them has indeed
crashed and if the other is alive and so

496
00:10:13,449 --> 00:10:13,459
crashed and if the other is alive and so
 

497
00:10:13,459 --> 00:10:14,980
crashed and if the other is alive and so
you're essentially using the human as a

498
00:10:14,980 --> 00:10:14,990
you're essentially using the human as a
 

499
00:10:14,990 --> 00:10:17,590
you're essentially using the human as a
as the tie breaker and the human is a

500
00:10:17,590 --> 00:10:17,600
as the tie breaker and the human is a
 

501
00:10:17,600 --> 00:10:20,740
as the tie breaker and the human is a
you know if they were a computer it

502
00:10:20,740 --> 00:10:20,750
you know if they were a computer it
 

503
00:10:20,750 --> 00:10:21,759
you know if they were a computer it
would be a single point if you

504
00:10:21,759 --> 00:10:21,769
would be a single point if you
 

505
00:10:21,769 --> 00:10:25,660
would be a single point if you
themselves so for a long time people use

506
00:10:25,660 --> 00:10:25,670
themselves so for a long time people use
 

507
00:10:25,670 --> 00:10:27,280
themselves so for a long time people use
one of the other these schemes in order

508
00:10:27,280 --> 00:10:27,290
one of the other these schemes in order
 

509
00:10:27,290 --> 00:10:28,960
one of the other these schemes in order
to build replicated systems and it's not

510
00:10:28,960 --> 00:10:28,970
to build replicated systems and it's not
 

511
00:10:28,970 --> 00:10:30,999
to build replicated systems and it's not
you know they can be made to work the

512
00:10:30,999 --> 00:10:31,009
you know they can be made to work the
 

513
00:10:31,009 --> 00:10:32,470
you know they can be made to work the
humans don't respond very quickly and

514
00:10:32,470 --> 00:10:32,480
humans don't respond very quickly and
 

515
00:10:32,480 --> 00:10:34,449
humans don't respond very quickly and
the network that cannot fail is

516
00:10:34,449 --> 00:10:34,459
the network that cannot fail is
 

517
00:10:34,459 --> 00:10:38,859
the network that cannot fail is
expensive but it's not not doable but it

518
00:10:38,859 --> 00:10:38,869
expensive but it's not not doable but it
 

519
00:10:38,869 --> 00:10:42,009
expensive but it's not not doable but it
turned out that you can actually build

520
00:10:42,009 --> 00:10:42,019
turned out that you can actually build
 

521
00:10:42,019 --> 00:10:45,939
turned out that you can actually build
automated failover systems that can work

522
00:10:45,939 --> 00:10:45,949
automated failover systems that can work
 

523
00:10:45,949 --> 00:10:48,970
automated failover systems that can work
correctly in the face of flaky networks

524
00:10:48,970 --> 00:10:48,980
correctly in the face of flaky networks
 

525
00:10:48,980 --> 00:10:51,280
correctly in the face of flaky networks
of networks that could fail on the can

526
00:10:51,280 --> 00:10:51,290
of networks that could fail on the can
 

527
00:10:51,290 --> 00:10:53,199
of networks that could fail on the can
partition so this split of the network

528
00:10:53,199 --> 00:10:53,209
partition so this split of the network
 

529
00:10:53,209 --> 00:10:54,910
partition so this split of the network
in half where the two sides operate they

530
00:10:54,910 --> 00:10:54,920
in half where the two sides operate they
 

531
00:10:54,920 --> 00:10:56,590
in half where the two sides operate they
can't talk to each other that's usually

532
00:10:56,590 --> 00:10:56,600
can't talk to each other that's usually
 

533
00:10:56,600 --> 00:11:04,900
can't talk to each other that's usually
called a partition and the big insight

534
00:11:04,900 --> 00:11:04,910
called a partition and the big insight
 

535
00:11:04,910 --> 00:11:06,879
called a partition and the big insight
that people came up with in order to

536
00:11:06,879 --> 00:11:06,889
that people came up with in order to
 

537
00:11:06,889 --> 00:11:10,090
that people came up with in order to
build automated replication systems that

538
00:11:10,090 --> 00:11:10,100
build automated replication systems that
 

539
00:11:10,100 --> 00:11:12,579
build automated replication systems that
don't suffer from split brain is the

540
00:11:12,579 --> 00:11:12,589
don't suffer from split brain is the
 

541
00:11:12,589 --> 00:11:20,069
don't suffer from split brain is the
idea of a majority vote this is a

542
00:11:20,069 --> 00:11:20,079

 

543
00:11:20,079 --> 00:11:22,449

concept that shows up in like every

544
00:11:22,449 --> 00:11:22,459
concept that shows up in like every
 

545
00:11:22,459 --> 00:11:24,100
concept that shows up in like every
other sentence practically in the raft

546
00:11:24,100 --> 00:11:24,110
other sentence practically in the raft
 

547
00:11:24,110 --> 00:11:28,509
other sentence practically in the raft
paper sort of fundamental way of

548
00:11:28,509 --> 00:11:28,519
paper sort of fundamental way of
 

549
00:11:28,519 --> 00:11:31,449
paper sort of fundamental way of
proceeding the first step is to have an

550
00:11:31,449 --> 00:11:31,459
proceeding the first step is to have an
 

551
00:11:31,459 --> 00:11:33,730
proceeding the first step is to have an
odd number of servers instead of an even

552
00:11:33,730 --> 00:11:33,740
odd number of servers instead of an even
 

553
00:11:33,740 --> 00:11:35,769
odd number of servers instead of an even
number of servers like one flaw here is

554
00:11:35,769 --> 00:11:35,779
number of servers like one flaw here is
 

555
00:11:35,779 --> 00:11:37,929
number of servers like one flaw here is
that it's a little bit too symmetric all

556
00:11:37,929 --> 00:11:37,939
that it's a little bit too symmetric all
 

557
00:11:37,939 --> 00:11:39,369
that it's a little bit too symmetric all
right the two sides of the split here

558
00:11:39,369 --> 00:11:39,379
right the two sides of the split here
 

559
00:11:39,379 --> 00:11:41,530
right the two sides of the split here
just they just look the same so they run

560
00:11:41,530 --> 00:11:41,540
just they just look the same so they run
 

561
00:11:41,540 --> 00:11:42,579
just they just look the same so they run
the same software they're gonna do the

562
00:11:42,579 --> 00:11:42,589
the same software they're gonna do the
 

563
00:11:42,589 --> 00:11:44,289
the same software they're gonna do the
same thing and that's not good but if

564
00:11:44,289 --> 00:11:44,299
same thing and that's not good but if
 

565
00:11:44,299 --> 00:11:47,429
same thing and that's not good but if
you have an odd number of servers then

566
00:11:47,429 --> 00:11:47,439
you have an odd number of servers then
 

567
00:11:47,439 --> 00:11:50,889
you have an odd number of servers then
it's not symmetric anymore right at

568
00:11:50,889 --> 00:11:50,899
it's not symmetric anymore right at
 

569
00:11:50,899 --> 00:11:52,929
it's not symmetric anymore right at
least a single network split will be

570
00:11:52,929 --> 00:11:52,939
least a single network split will be
 

571
00:11:52,939 --> 00:11:54,730
least a single network split will be
presumably two servers on one side and

572
00:11:54,730 --> 00:11:54,740
presumably two servers on one side and
 

573
00:11:54,740 --> 00:11:56,169
presumably two servers on one side and
one server on the other side and they

574
00:11:56,169 --> 00:11:56,179
one server on the other side and they
 

575
00:11:56,179 --> 00:11:58,480
one server on the other side and they
won't be symmetric at all and that's

576
00:11:58,480 --> 00:11:58,490
won't be symmetric at all and that's
 

577
00:11:58,490 --> 00:12:00,819
won't be symmetric at all and that's
part of what majority vote majority

578
00:12:00,819 --> 00:12:00,829
part of what majority vote majority
 

579
00:12:00,829 --> 00:12:04,210
part of what majority vote majority
voting schemes are appealing to so basic

580
00:12:04,210 --> 00:12:04,220
voting schemes are appealing to so basic
 

581
00:12:04,220 --> 00:12:05,619
voting schemes are appealing to so basic
ideas you have an odd number of servers

582
00:12:05,619 --> 00:12:05,629
ideas you have an odd number of servers
 

583
00:12:05,629 --> 00:12:08,289
ideas you have an odd number of servers
in order to make progress of any kind so

584
00:12:08,289 --> 00:12:08,299
in order to make progress of any kind so
 

585
00:12:08,299 --> 00:12:10,929
in order to make progress of any kind so
in raft elect a leader or cause a log

586
00:12:10,929 --> 00:12:10,939
in raft elect a leader or cause a log
 

587
00:12:10,939 --> 00:12:12,609
in raft elect a leader or cause a log
entry to be committed in order to make

588
00:12:12,609 --> 00:12:12,619
entry to be committed in order to make
 

589
00:12:12,619 --> 00:12:15,369
entry to be committed in order to make
any progress at each step you have to

590
00:12:15,369 --> 00:12:15,379
any progress at each step you have to
 

591
00:12:15,379 --> 00:12:18,639
any progress at each step you have to
assemble a majority of the server's more

592
00:12:18,639 --> 00:12:18,649
assemble a majority of the server's more
 

593
00:12:18,649 --> 00:12:20,139
assemble a majority of the server's more
than half more than half of all the

594
00:12:20,139 --> 00:12:20,149
than half more than half of all the
 

595
00:12:20,149 --> 00:12:22,479
than half more than half of all the
servers in order to sort of approve that

596
00:12:22,479 --> 00:12:22,489
servers in order to sort of approve that
 

597
00:12:22,489 --> 00:12:25,269
servers in order to sort of approve that
step like vote for a meet or accept a

598
00:12:25,269 --> 00:12:25,279
step like vote for a meet or accept a
 

599
00:12:25,279 --> 00:12:29,049
step like vote for a meet or accept a
new log entry and commit it so you know

600
00:12:29,049 --> 00:12:29,059
new log entry and commit it so you know
 

601
00:12:29,059 --> 00:12:32,739
new log entry and commit it so you know
the most straightforward way is that two

602
00:12:32,739 --> 00:12:32,749
the most straightforward way is that two
 

603
00:12:32,749 --> 00:12:37,809
the most straightforward way is that two
or three servers required to do anything

604
00:12:37,809 --> 00:12:37,819

 

605
00:12:37,819 --> 00:12:40,239

one reason this works of course is that

606
00:12:40,239 --> 00:12:40,249
one reason this works of course is that
 

607
00:12:40,249 --> 00:12:43,489
one reason this works of course is that
if there's a partition there can't be

608
00:12:43,489 --> 00:12:43,499
if there's a partition there can't be
 

609
00:12:43,499 --> 00:12:45,559
if there's a partition there can't be
more than one partition with a majority

610
00:12:45,559 --> 00:12:45,569
more than one partition with a majority
 

611
00:12:45,569 --> 00:12:47,629
more than one partition with a majority
of the server's in it that's one way to

612
00:12:47,629 --> 00:12:47,639
of the server's in it that's one way to
 

613
00:12:47,639 --> 00:12:51,319
of the server's in it that's one way to
look at this a partition can have one

614
00:12:51,319 --> 00:12:51,329
look at this a partition can have one
 

615
00:12:51,329 --> 00:12:52,999
look at this a partition can have one
server in it which it's not a majority

616
00:12:52,999 --> 00:12:53,009
server in it which it's not a majority
 

617
00:12:53,009 --> 00:12:55,429
server in it which it's not a majority
or maybe you can have two but if one

618
00:12:55,429 --> 00:12:55,439
or maybe you can have two but if one
 

619
00:12:55,439 --> 00:12:56,540
or maybe you can have two but if one
partition has two then the other

620
00:12:56,540 --> 00:12:56,550
partition has two then the other
 

621
00:12:56,550 --> 00:12:58,400
partition has two then the other
partition has to have only one server in

622
00:12:58,400 --> 00:12:58,410
partition has to have only one server in
 

623
00:12:58,410 --> 00:13:00,679
partition has to have only one server in
it and therefore will never be able to

624
00:13:00,679 --> 00:13:00,689
it and therefore will never be able to
 

625
00:13:00,689 --> 00:13:02,269
it and therefore will never be able to
assemble a majority and won't be able to

626
00:13:02,269 --> 00:13:02,279
assemble a majority and won't be able to
 

627
00:13:02,279 --> 00:13:07,340
assemble a majority and won't be able to
make progress and just to be totally

628
00:13:07,340 --> 00:13:07,350
make progress and just to be totally
 

629
00:13:07,350 --> 00:13:09,590
make progress and just to be totally
clear when we're talking about a

630
00:13:09,590 --> 00:13:09,600
clear when we're talking about a
 

631
00:13:09,600 --> 00:13:11,600
clear when we're talking about a
majority it's always a majority out of

632
00:13:11,600 --> 00:13:11,610
majority it's always a majority out of
 

633
00:13:11,610 --> 00:13:14,030
majority it's always a majority out of
all of the server's not just a live

634
00:13:14,030 --> 00:13:14,040
all of the server's not just a live
 

635
00:13:14,040 --> 00:13:15,920
all of the server's not just a live
servers this is the point that confused

636
00:13:15,920 --> 00:13:15,930
servers this is the point that confused
 

637
00:13:15,930 --> 00:13:17,420
servers this is the point that confused
me for a long time but if you have a

638
00:13:17,420 --> 00:13:17,430
me for a long time but if you have a
 

639
00:13:17,430 --> 00:13:19,249
me for a long time but if you have a
system with three servers and maybe some

640
00:13:19,249 --> 00:13:19,259
system with three servers and maybe some
 

641
00:13:19,259 --> 00:13:20,840
system with three servers and maybe some
of them have failed or something if you

642
00:13:20,840 --> 00:13:20,850
of them have failed or something if you
 

643
00:13:20,850 --> 00:13:22,249
of them have failed or something if you
need to assemble in the majority it's

644
00:13:22,249 --> 00:13:22,259
need to assemble in the majority it's
 

645
00:13:22,259 --> 00:13:24,710
need to assemble in the majority it's
always two out of three even if you know

646
00:13:24,710 --> 00:13:24,720
always two out of three even if you know
 

647
00:13:24,720 --> 00:13:26,299
always two out of three even if you know
that one has failed the majority is

648
00:13:26,299 --> 00:13:26,309
that one has failed the majority is
 

649
00:13:26,309 --> 00:13:27,439
that one has failed the majority is
always out of the total number of

650
00:13:27,439 --> 00:13:27,449
always out of the total number of
 

651
00:13:27,449 --> 00:13:30,410
always out of the total number of
servers there's a more general

652
00:13:30,410 --> 00:13:30,420
servers there's a more general
 

653
00:13:30,420 --> 00:13:33,679
servers there's a more general
formulation of this because a majority

654
00:13:33,679 --> 00:13:33,689
formulation of this because a majority
 

655
00:13:33,689 --> 00:13:35,600
formulation of this because a majority
voting system in which two out of three

656
00:13:35,600 --> 00:13:35,610
voting system in which two out of three
 

657
00:13:35,610 --> 00:13:37,160
voting system in which two out of three
are required to make progress it can

658
00:13:37,160 --> 00:13:37,170
are required to make progress it can
 

659
00:13:37,170 --> 00:13:40,879
are required to make progress it can
survive the failure of one server right

660
00:13:40,879 --> 00:13:40,889
survive the failure of one server right
 

661
00:13:40,889 --> 00:13:42,920
survive the failure of one server right
any two servers are enough to make

662
00:13:42,920 --> 00:13:42,930
any two servers are enough to make
 

663
00:13:42,930 --> 00:13:45,170
any two servers are enough to make
progress if you need to be able to if

664
00:13:45,170 --> 00:13:45,180
progress if you need to be able to if
 

665
00:13:45,180 --> 00:13:46,730
progress if you need to be able to if
you're you know you worried about how

666
00:13:46,730 --> 00:13:46,740
you're you know you worried about how
 

667
00:13:46,740 --> 00:13:49,970
you're you know you worried about how
reliable your servers are or then you

668
00:13:49,970 --> 00:13:49,980
reliable your servers are or then you
 

669
00:13:49,980 --> 00:13:51,559
reliable your servers are or then you
can build systems that have more servers

670
00:13:51,559 --> 00:13:51,569
can build systems that have more servers
 

671
00:13:51,569 --> 00:13:53,480
can build systems that have more servers
and so the more general formulation is

672
00:13:53,480 --> 00:13:53,490
and so the more general formulation is
 

673
00:13:53,490 --> 00:13:59,480
and so the more general formulation is
if you have two F + 1 servers then you

674
00:13:59,480 --> 00:13:59,490
if you have two F + 1 servers then you
 

675
00:13:59,490 --> 00:14:06,920
if you have two F + 1 servers then you
can withstand you know so if it's three

676
00:14:06,920 --> 00:14:06,930
can withstand you know so if it's three
 

677
00:14:06,930 --> 00:14:09,769
can withstand you know so if it's three
that means F is one and the system with

678
00:14:09,769 --> 00:14:09,779
that means F is one and the system with
 

679
00:14:09,779 --> 00:14:12,799
that means F is one and the system with
three servers you can tolerate F servers

680
00:14:12,799 --> 00:14:12,809
three servers you can tolerate F servers
 

681
00:14:12,809 --> 00:14:19,759
three servers you can tolerate F servers
step one failure and still keep going

682
00:14:19,759 --> 00:14:19,769

 

683
00:14:19,769 --> 00:14:22,379

all right often these are called quorum

684
00:14:22,379 --> 00:14:22,389
all right often these are called quorum
 

685
00:14:22,389 --> 00:14:25,340
all right often these are called quorum
systems because the two out of three is

686
00:14:25,340 --> 00:14:25,350
systems because the two out of three is
 

687
00:14:25,350 --> 00:14:29,040
systems because the two out of three is
sometimes held a quorum okay so one

688
00:14:29,040 --> 00:14:29,050
sometimes held a quorum okay so one
 

689
00:14:29,050 --> 00:14:30,509
sometimes held a quorum okay so one
property I've already mentioned about

690
00:14:30,509 --> 00:14:30,519
property I've already mentioned about
 

691
00:14:30,519 --> 00:14:34,019
property I've already mentioned about
these majority voting systems is that at

692
00:14:34,019 --> 00:14:34,029
these majority voting systems is that at
 

693
00:14:34,029 --> 00:14:36,749
these majority voting systems is that at
most one partition can have a majority

694
00:14:36,749 --> 00:14:36,759
most one partition can have a majority
 

695
00:14:36,759 --> 00:14:38,100
most one partition can have a majority
and therefore if the networks

696
00:14:38,100 --> 00:14:38,110
and therefore if the networks
 

697
00:14:38,110 --> 00:14:40,559
and therefore if the networks
partitioned we can't have both halves of

698
00:14:40,559 --> 00:14:40,569
partitioned we can't have both halves of
 

699
00:14:40,569 --> 00:14:42,540
partitioned we can't have both halves of
the network making progress another more

700
00:14:42,540 --> 00:14:42,550
the network making progress another more
 

701
00:14:42,550 --> 00:14:44,489
the network making progress another more
subtle thing that's going on here is

702
00:14:44,489 --> 00:14:44,499
subtle thing that's going on here is
 

703
00:14:44,499 --> 00:14:48,960
subtle thing that's going on here is
that if you always need a majority of

704
00:14:48,960 --> 00:14:48,970
that if you always need a majority of
 

705
00:14:48,970 --> 00:14:52,619
that if you always need a majority of
the servers to proceed and you go

706
00:14:52,619 --> 00:14:52,629
the servers to proceed and you go
 

707
00:14:52,629 --> 00:14:54,239
the servers to proceed and you go
through a sort of succession of

708
00:14:54,239 --> 00:14:54,249
through a sort of succession of
 

709
00:14:54,249 --> 00:14:55,980
through a sort of succession of
operations in which reach operations

710
00:14:55,980 --> 00:14:55,990
operations in which reach operations
 

711
00:14:55,990 --> 00:14:58,079
operations in which reach operations
somebody assembled a majority like you

712
00:14:58,079 --> 00:14:58,089
somebody assembled a majority like you
 

713
00:14:58,089 --> 00:15:00,720
somebody assembled a majority like you
know votes for leaders or let's say

714
00:15:00,720 --> 00:15:00,730
know votes for leaders or let's say
 

715
00:15:00,730 --> 00:15:04,679
know votes for leaders or let's say
votes for leaders arrived then at every

716
00:15:04,679 --> 00:15:04,689
votes for leaders arrived then at every
 

717
00:15:04,689 --> 00:15:06,509
votes for leaders arrived then at every
step the majority you assemble for that

718
00:15:06,509 --> 00:15:06,519
step the majority you assemble for that
 

719
00:15:06,519 --> 00:15:09,329
step the majority you assemble for that
step must contain at least one server

720
00:15:09,329 --> 00:15:09,339
step must contain at least one server
 

721
00:15:09,339 --> 00:15:11,280
step must contain at least one server
that was in the previous majority that

722
00:15:11,280 --> 00:15:11,290
that was in the previous majority that
 

723
00:15:11,290 --> 00:15:13,889
that was in the previous majority that
is any two majorities overlap in at

724
00:15:13,889 --> 00:15:13,899
is any two majorities overlap in at
 

725
00:15:13,899 --> 00:15:17,790
is any two majorities overlap in at
least one server and it's really that

726
00:15:17,790 --> 00:15:17,800
least one server and it's really that
 

727
00:15:17,800 --> 00:15:20,999
least one server and it's really that
property more than anything else that

728
00:15:20,999 --> 00:15:21,009
property more than anything else that
 

729
00:15:21,009 --> 00:15:25,049
property more than anything else that
raft is relying on to avoid split brain

730
00:15:25,049 --> 00:15:25,059
raft is relying on to avoid split brain
 

731
00:15:25,059 --> 00:15:27,210
raft is relying on to avoid split brain
it's the fact that for example when you

732
00:15:27,210 --> 00:15:27,220
it's the fact that for example when you
 

733
00:15:27,220 --> 00:15:28,470
it's the fact that for example when you
have a leader a successful leader

734
00:15:28,470 --> 00:15:28,480
have a leader a successful leader
 

735
00:15:28,480 --> 00:15:30,329
have a leader a successful leader
election and leader assembles votes from

736
00:15:30,329 --> 00:15:30,339
election and leader assembles votes from
 

737
00:15:30,339 --> 00:15:32,970
election and leader assembles votes from
a majority its majority is guaranteed to

738
00:15:32,970 --> 00:15:32,980
a majority its majority is guaranteed to
 

739
00:15:32,980 --> 00:15:34,769
a majority its majority is guaranteed to
overlap with the previous leaders

740
00:15:34,769 --> 00:15:34,779
overlap with the previous leaders
 

741
00:15:34,779 --> 00:15:36,480
overlap with the previous leaders
majority and so for example the new

742
00:15:36,480 --> 00:15:36,490
majority and so for example the new
 

743
00:15:36,490 --> 00:15:39,210
majority and so for example the new
leader is guaranteed to know about the

744
00:15:39,210 --> 00:15:39,220
leader is guaranteed to know about the
 

745
00:15:39,220 --> 00:15:41,269
leader is guaranteed to know about the
term number used by the previous leader

746
00:15:41,269 --> 00:15:41,279
term number used by the previous leader
 

747
00:15:41,279 --> 00:15:43,350
term number used by the previous leader
because it's a majority overlaps with

748
00:15:43,350 --> 00:15:43,360
because it's a majority overlaps with
 

749
00:15:43,360 --> 00:15:45,289
because it's a majority overlaps with
the previous leaders majority and

750
00:15:45,289 --> 00:15:45,299
the previous leaders majority and
 

751
00:15:45,299 --> 00:15:47,369
the previous leaders majority and
everybody in the previous leaders

752
00:15:47,369 --> 00:15:47,379
everybody in the previous leaders
 

753
00:15:47,379 --> 00:15:49,049
everybody in the previous leaders
majority knew about the previous leaders

754
00:15:49,049 --> 00:15:49,059
majority knew about the previous leaders
 

755
00:15:49,059 --> 00:15:50,059
majority knew about the previous leaders
term number

756
00:15:50,059 --> 00:15:50,069
term number
 

757
00:15:50,069 --> 00:15:53,009
term number
similarly anything the previous leader

758
00:15:53,009 --> 00:15:53,019
similarly anything the previous leader
 

759
00:15:53,019 --> 00:15:55,559
similarly anything the previous leader
could have committed must be present in

760
00:15:55,559 --> 00:15:55,569
could have committed must be present in
 

761
00:15:55,569 --> 00:15:57,960
could have committed must be present in
a majority of the servers in raft and

762
00:15:57,960 --> 00:15:57,970
a majority of the servers in raft and
 

763
00:15:57,970 --> 00:15:59,759
a majority of the servers in raft and
therefore any new leaders majority must

764
00:15:59,759 --> 00:15:59,769
therefore any new leaders majority must
 

765
00:15:59,769 --> 00:16:01,859
therefore any new leaders majority must
overlap at at least one server with

766
00:16:01,859 --> 00:16:01,869
overlap at at least one server with
 

767
00:16:01,869 --> 00:16:04,769
overlap at at least one server with
every committed entry from the previous

768
00:16:04,769 --> 00:16:04,779
every committed entry from the previous
 

769
00:16:04,779 --> 00:16:08,519
every committed entry from the previous
leader this is a big part of why it is

770
00:16:08,519 --> 00:16:08,529
leader this is a big part of why it is
 

771
00:16:08,529 --> 00:16:14,430
leader this is a big part of why it is
that wrapped is correct

772
00:16:14,430 --> 00:16:14,440

 

773
00:16:14,440 --> 00:16:18,060

any questions about the general concept

774
00:16:18,060 --> 00:16:18,070
any questions about the general concept
 

775
00:16:18,070 --> 00:16:27,930
any questions about the general concept
of majority voting systems

776
00:16:27,930 --> 00:16:27,940

 

777
00:16:27,940 --> 00:16:31,750

these muscle ad servers

778
00:16:31,750 --> 00:16:31,760

 

779
00:16:31,760 --> 00:16:34,060

it's possible intersection something

780
00:16:34,060 --> 00:16:34,070
it's possible intersection something
 

781
00:16:34,070 --> 00:16:36,700
it's possible intersection something
maybe six in the paper explains how to

782
00:16:36,700 --> 00:16:36,710
maybe six in the paper explains how to
 

783
00:16:36,710 --> 00:16:41,100
maybe six in the paper explains how to
add it or change the set of servers and

784
00:16:41,100 --> 00:16:41,110
add it or change the set of servers and
 

785
00:16:41,110 --> 00:16:44,590
add it or change the set of servers and
it's possible you need to do it in a

786
00:16:44,590 --> 00:16:44,600
it's possible you need to do it in a
 

787
00:16:44,600 --> 00:16:45,910
it's possible you need to do it in a
long-running system if you're running

788
00:16:45,910 --> 00:16:45,920
long-running system if you're running
 

789
00:16:45,920 --> 00:16:48,790
long-running system if you're running
your system for five ten years you know

790
00:16:48,790 --> 00:16:48,800
your system for five ten years you know
 

791
00:16:48,800 --> 00:16:50,470
your system for five ten years you know
you're gonna need to replace the servers

792
00:16:50,470 --> 00:16:50,480
you're gonna need to replace the servers
 

793
00:16:50,480 --> 00:16:52,480
you're gonna need to replace the servers
after a while you know one of them fails

794
00:16:52,480 --> 00:16:52,490
after a while you know one of them fails
 

795
00:16:52,490 --> 00:16:55,270
after a while you know one of them fails
permanently or you upgrade or you move

796
00:16:55,270 --> 00:16:55,280
permanently or you upgrade or you move
 

797
00:16:55,280 --> 00:16:56,380
permanently or you upgrade or you move
machine rooms to a different machine

798
00:16:56,380 --> 00:16:56,390
machine rooms to a different machine
 

799
00:16:56,390 --> 00:16:58,240
machine rooms to a different machine
room you really do need to be able to

800
00:16:58,240 --> 00:16:58,250
room you really do need to be able to
 

801
00:16:58,250 --> 00:17:00,190
room you really do need to be able to
support changing sets of servers so

802
00:17:00,190 --> 00:17:00,200
support changing sets of servers so
 

803
00:17:00,200 --> 00:17:01,630
support changing sets of servers so
that's a it certainly doesn't happen

804
00:17:01,630 --> 00:17:01,640
that's a it certainly doesn't happen
 

805
00:17:01,640 --> 00:17:03,220
that's a it certainly doesn't happen
every day but it's a critical part of

806
00:17:03,220 --> 00:17:03,230
every day but it's a critical part of
 

807
00:17:03,230 --> 00:17:05,380
every day but it's a critical part of
this or a long-term maintainability of

808
00:17:05,380 --> 00:17:05,390
this or a long-term maintainability of
 

809
00:17:05,390 --> 00:17:08,470
this or a long-term maintainability of
these systems and you know the RAF

810
00:17:08,470 --> 00:17:08,480
these systems and you know the RAF
 

811
00:17:08,480 --> 00:17:10,510
these systems and you know the RAF
authors sort of pat themselves on the

812
00:17:10,510 --> 00:17:10,520
authors sort of pat themselves on the
 

813
00:17:10,520 --> 00:17:13,090
authors sort of pat themselves on the
back that they have a scheme that deals

814
00:17:13,090 --> 00:17:13,100
back that they have a scheme that deals
 

815
00:17:13,100 --> 00:17:14,350
back that they have a scheme that deals
with this which as well they might

816
00:17:14,350 --> 00:17:14,360
with this which as well they might
 

817
00:17:14,360 --> 00:17:21,850
with this which as well they might
because it's complex all right so using

818
00:17:21,850 --> 00:17:21,860
because it's complex all right so using
 

819
00:17:21,860 --> 00:17:25,439
because it's complex all right so using
this idea in about 1990 or so there were

820
00:17:25,439 --> 00:17:25,449
this idea in about 1990 or so there were
 

821
00:17:25,449 --> 00:17:28,030
this idea in about 1990 or so there were
two systems proposed at about the same

822
00:17:28,030 --> 00:17:28,040
two systems proposed at about the same
 

823
00:17:28,040 --> 00:17:31,540
two systems proposed at about the same
time that realized that you could use

824
00:17:31,540 --> 00:17:31,550
time that realized that you could use
 

825
00:17:31,550 --> 00:17:34,200
time that realized that you could use
this majority voting system to kind of

826
00:17:34,200 --> 00:17:34,210
this majority voting system to kind of
 

827
00:17:34,210 --> 00:17:38,010
this majority voting system to kind of
get around the apparent impossibility of

828
00:17:38,010 --> 00:17:38,020
get around the apparent impossibility of
 

829
00:17:38,020 --> 00:17:41,140
get around the apparent impossibility of
avoiding split brain by using basically

830
00:17:41,140 --> 00:17:41,150
avoiding split brain by using basically
 

831
00:17:41,150 --> 00:17:43,060
avoiding split brain by using basically
by using three servers instead of two

832
00:17:43,060 --> 00:17:43,070
by using three servers instead of two
 

833
00:17:43,070 --> 00:17:46,510
by using three servers instead of two
and taking majority votes and in one of

834
00:17:46,510 --> 00:17:46,520
and taking majority votes and in one of
 

835
00:17:46,520 --> 00:17:48,370
and taking majority votes and in one of
these very early systems was called

836
00:17:48,370 --> 00:17:48,380
these very early systems was called
 

837
00:17:48,380 --> 00:17:51,850
these very early systems was called
Paxos the RAF paper talks about this a

838
00:17:51,850 --> 00:17:51,860
Paxos the RAF paper talks about this a
 

839
00:17:51,860 --> 00:17:54,850
Paxos the RAF paper talks about this a
lot and another of these very early

840
00:17:54,850 --> 00:17:54,860
lot and another of these very early
 

841
00:17:54,860 --> 00:17:56,410
lot and another of these very early
systems was called view stamp

842
00:17:56,410 --> 00:17:56,420
systems was called view stamp
 

843
00:17:56,420 --> 00:18:00,160
systems was called view stamp
replication a previa des vs r4 view

844
00:18:00,160 --> 00:18:00,170
replication a previa des vs r4 view
 

845
00:18:00,170 --> 00:18:02,830
replication a previa des vs r4 view
stamp replication and even though Paxos

846
00:18:02,830 --> 00:18:02,840
stamp replication and even though Paxos
 

847
00:18:02,840 --> 00:18:05,010
stamp replication and even though Paxos
pod is by far the more widely known

848
00:18:05,010 --> 00:18:05,020
pod is by far the more widely known
 

849
00:18:05,020 --> 00:18:07,300
pod is by far the more widely known
system in this department raft is

850
00:18:07,300 --> 00:18:07,310
system in this department raft is
 

851
00:18:07,310 --> 00:18:09,580
system in this department raft is
actually closer to design in design to

852
00:18:09,580 --> 00:18:09,590
actually closer to design in design to
 

853
00:18:09,590 --> 00:18:11,640
actually closer to design in design to
view statment few stamp application

854
00:18:11,640 --> 00:18:11,650
view statment few stamp application
 

855
00:18:11,650 --> 00:18:16,960
view statment few stamp application
which was invented by people at MIT and

856
00:18:16,960 --> 00:18:16,970
which was invented by people at MIT and
 

857
00:18:16,970 --> 00:18:19,270
which was invented by people at MIT and
so there's a sort of a law many decade

858
00:18:19,270 --> 00:18:19,280
so there's a sort of a law many decade
 

859
00:18:19,280 --> 00:18:21,610
so there's a sort of a law many decade
history of these systems and they only

860
00:18:21,610 --> 00:18:21,620
history of these systems and they only
 

861
00:18:21,620 --> 00:18:24,790
history of these systems and they only
really came to the forefront and started

862
00:18:24,790 --> 00:18:24,800
really came to the forefront and started
 

863
00:18:24,800 --> 00:18:27,190
really came to the forefront and started
being used a lot in deployed big

864
00:18:27,190 --> 00:18:27,200
being used a lot in deployed big
 

865
00:18:27,200 --> 00:18:29,260
being used a lot in deployed big
distributed sisty systems about 15 years

866
00:18:29,260 --> 00:18:29,270
distributed sisty systems about 15 years
 

867
00:18:29,270 --> 00:18:31,960
distributed sisty systems about 15 years
ago a good 15 years after they were

868
00:18:31,960 --> 00:18:31,970
ago a good 15 years after they were
 

869
00:18:31,970 --> 00:18:39,670
ago a good 15 years after they were
originally invented okay so let me talk

870
00:18:39,670 --> 00:18:39,680
originally invented okay so let me talk
 

871
00:18:39,680 --> 00:18:42,760
originally invented okay so let me talk
about Rath now

872
00:18:42,760 --> 00:18:42,770

 

873
00:18:42,770 --> 00:18:46,159

raft is a takes the form of a library

874
00:18:46,159 --> 00:18:46,169
raft is a takes the form of a library
 

875
00:18:46,169 --> 00:18:49,039
raft is a takes the form of a library
intended to be included in some service

876
00:18:49,039 --> 00:18:49,049
intended to be included in some service
 

877
00:18:49,049 --> 00:18:51,350
intended to be included in some service
application so if you have a replicated

878
00:18:51,350 --> 00:18:51,360
application so if you have a replicated
 

879
00:18:51,360 --> 00:18:53,570
application so if you have a replicated
service that each of the replicas in the

880
00:18:53,570 --> 00:18:53,580
service that each of the replicas in the
 

881
00:18:53,580 --> 00:18:55,010
service that each of the replicas in the
service is gonna be some application

882
00:18:55,010 --> 00:18:55,020
service is gonna be some application
 

883
00:18:55,020 --> 00:18:57,140
service is gonna be some application
code which you know receives rpcs or

884
00:18:57,140 --> 00:18:57,150
code which you know receives rpcs or
 

885
00:18:57,150 --> 00:19:00,020
code which you know receives rpcs or
something plus a raft library and the

886
00:19:00,020 --> 00:19:00,030
something plus a raft library and the
 

887
00:19:00,030 --> 00:19:01,730
something plus a raft library and the
raft libraries cooperate with each other

888
00:19:01,730 --> 00:19:01,740
raft libraries cooperate with each other
 

889
00:19:01,740 --> 00:19:06,020
raft libraries cooperate with each other
to mean replication maintain replication

890
00:19:06,020 --> 00:19:06,030
to mean replication maintain replication
 

891
00:19:06,030 --> 00:19:10,250
to mean replication maintain replication
so sort of software overview of a single

892
00:19:10,250 --> 00:19:10,260
so sort of software overview of a single
 

893
00:19:10,260 --> 00:19:13,909
so sort of software overview of a single
raft replica is that at the top we can

894
00:19:13,909 --> 00:19:13,919
raft replica is that at the top we can
 

895
00:19:13,919 --> 00:19:15,529
raft replica is that at the top we can
think of the replicas having the

896
00:19:15,529 --> 00:19:15,539
think of the replicas having the
 

897
00:19:15,539 --> 00:19:17,840
think of the replicas having the
application code so it might be for lab

898
00:19:17,840 --> 00:19:17,850
application code so it might be for lab
 

899
00:19:17,850 --> 00:19:20,779
application code so it might be for lab
3 a key-value server so maybe we have

900
00:19:20,779 --> 00:19:20,789
3 a key-value server so maybe we have
 

901
00:19:20,789 --> 00:19:24,380
3 a key-value server so maybe we have
some key value server and in a state the

902
00:19:24,380 --> 00:19:24,390
some key value server and in a state the
 

903
00:19:24,390 --> 00:19:26,870
some key value server and in a state the
application has state that raft is

904
00:19:26,870 --> 00:19:26,880
application has state that raft is
 

905
00:19:26,880 --> 00:19:28,700
application has state that raft is
helping it manage replicated state and

906
00:19:28,700 --> 00:19:28,710
helping it manage replicated state and
 

907
00:19:28,710 --> 00:19:30,289
helping it manage replicated state and
for a key value server it's going to be

908
00:19:30,289 --> 00:19:30,299
for a key value server it's going to be
 

909
00:19:30,299 --> 00:19:39,169
for a key value server it's going to be
a table of keys and values the next

910
00:19:39,169 --> 00:19:39,179
a table of keys and values the next
 

911
00:19:39,179 --> 00:19:44,330
a table of keys and values the next
layer down is a raft layer so the key

912
00:19:44,330 --> 00:19:44,340
layer down is a raft layer so the key
 

913
00:19:44,340 --> 00:19:45,760
layer down is a raft layer so the key
value server is gonna sort of make

914
00:19:45,760 --> 00:19:45,770
value server is gonna sort of make
 

915
00:19:45,770 --> 00:19:47,750
value server is gonna sort of make
function calls into raft and they're

916
00:19:47,750 --> 00:19:47,760
function calls into raft and they're
 

917
00:19:47,760 --> 00:19:49,070
function calls into raft and they're
gonna chitchat back and forth a little

918
00:19:49,070 --> 00:19:49,080
gonna chitchat back and forth a little
 

919
00:19:49,080 --> 00:19:52,060
gonna chitchat back and forth a little
bit and raft keeps a little bit of state

920
00:19:52,060 --> 00:19:52,070
bit and raft keeps a little bit of state
 

921
00:19:52,070 --> 00:19:54,830
bit and raft keeps a little bit of state
you can see it in Figure 2 and for our

922
00:19:54,830 --> 00:19:54,840
you can see it in Figure 2 and for our
 

923
00:19:54,840 --> 00:19:56,270
you can see it in Figure 2 and for our
purposes really the most critical piece

924
00:19:56,270 --> 00:19:56,280
purposes really the most critical piece
 

925
00:19:56,280 --> 00:19:59,409
purposes really the most critical piece
of state is that raft has a log of

926
00:19:59,409 --> 00:19:59,419
of state is that raft has a log of
 

927
00:19:59,419 --> 00:20:08,360
of state is that raft has a log of
operations and a system with 3 breath

928
00:20:08,360 --> 00:20:08,370
operations and a system with 3 breath
 

929
00:20:08,370 --> 00:20:09,500
operations and a system with 3 breath
will cause we're actually gonna have you

930
00:20:09,500 --> 00:20:09,510
will cause we're actually gonna have you
 

931
00:20:09,510 --> 00:20:12,020
will cause we're actually gonna have you
know 3 servers that have exactly the

932
00:20:12,020 --> 00:20:12,030
know 3 servers that have exactly the
 

933
00:20:12,030 --> 00:20:14,450
know 3 servers that have exactly the
same identical structure and hopefully

934
00:20:14,450 --> 00:20:14,460
same identical structure and hopefully
 

935
00:20:14,460 --> 00:20:19,940
same identical structure and hopefully
the very same data sitting in sitting at

936
00:20:19,940 --> 00:20:19,950
the very same data sitting in sitting at
 

937
00:20:19,950 --> 00:20:32,370
the very same data sitting in sitting at
both layers

938
00:20:32,370 --> 00:20:32,380

 

939
00:20:32,380 --> 00:20:35,710

right outside of this there's gonna be

940
00:20:35,710 --> 00:20:35,720
right outside of this there's gonna be
 

941
00:20:35,720 --> 00:20:38,860
right outside of this there's gonna be
clients and the game is that so we have

942
00:20:38,860 --> 00:20:38,870
clients and the game is that so we have
 

943
00:20:38,870 --> 00:20:40,630
clients and the game is that so we have
you know client 1 and client two whole

944
00:20:40,630 --> 00:20:40,640
you know client 1 and client two whole
 

945
00:20:40,640 --> 00:20:42,759
you know client 1 and client two whole
bunch of clients the clients don't

946
00:20:42,759 --> 00:20:42,769
bunch of clients the clients don't
 

947
00:20:42,769 --> 00:20:44,110
bunch of clients the clients don't
really know the clients are you know

948
00:20:44,110 --> 00:20:44,120
really know the clients are you know
 

949
00:20:44,120 --> 00:20:46,779
really know the clients are you know
just external code that needs to be able

950
00:20:46,779 --> 00:20:46,789
just external code that needs to be able
 

951
00:20:46,789 --> 00:20:49,570
just external code that needs to be able
to use the service and the hope is the

952
00:20:49,570 --> 00:20:49,580
to use the service and the hope is the
 

953
00:20:49,580 --> 00:20:50,950
to use the service and the hope is the
clients won't really need to be aware

954
00:20:50,950 --> 00:20:50,960
clients won't really need to be aware
 

955
00:20:50,960 --> 00:20:52,299
clients won't really need to be aware
that they're talking to a replicated

956
00:20:52,299 --> 00:20:52,309
that they're talking to a replicated
 

957
00:20:52,309 --> 00:20:53,680
that they're talking to a replicated
service that to the clients that are

958
00:20:53,680 --> 00:20:53,690
service that to the clients that are
 

959
00:20:53,690 --> 00:20:55,930
service that to the clients that are
looking almost like it's just one server

960
00:20:55,930 --> 00:20:55,940
looking almost like it's just one server
 

961
00:20:55,940 --> 00:20:59,019
looking almost like it's just one server
and they talked with one server and so

962
00:20:59,019 --> 00:20:59,029
and they talked with one server and so
 

963
00:20:59,029 --> 00:21:00,730
and they talked with one server and so
the clients actually send client

964
00:21:00,730 --> 00:21:00,740
the clients actually send client
 

965
00:21:00,740 --> 00:21:04,210
the clients actually send client
requests to the key to the application

966
00:21:04,210 --> 00:21:04,220
requests to the key to the application
 

967
00:21:04,220 --> 00:21:08,080
requests to the key to the application
layer of the current leader the replica

968
00:21:08,080 --> 00:21:08,090
layer of the current leader the replica
 

969
00:21:08,090 --> 00:21:11,710
layer of the current leader the replica
that's the current leader in raft and so

970
00:21:11,710 --> 00:21:11,720
that's the current leader in raft and so
 

971
00:21:11,720 --> 00:21:13,960
that's the current leader in raft and so
these are gonna be you know application

972
00:21:13,960 --> 00:21:13,970
these are gonna be you know application
 

973
00:21:13,970 --> 00:21:15,730
these are gonna be you know application
level requests for a database for a key

974
00:21:15,730 --> 00:21:15,740
level requests for a database for a key
 

975
00:21:15,740 --> 00:21:17,409
level requests for a database for a key
value server these might be put in get

976
00:21:17,409 --> 00:21:17,419
value server these might be put in get
 

977
00:21:17,419 --> 00:21:20,560
value server these might be put in get
requests you know put takes a key and a

978
00:21:20,560 --> 00:21:20,570
requests you know put takes a key and a
 

979
00:21:20,570 --> 00:21:26,460
requests you know put takes a key and a
value and updates the table and get

980
00:21:26,460 --> 00:21:26,470
value and updates the table and get
 

981
00:21:26,470 --> 00:21:29,519
value and updates the table and get
asked the service to get the current key

982
00:21:29,519 --> 00:21:29,529
asked the service to get the current key
 

983
00:21:29,529 --> 00:21:34,139
asked the service to get the current key
current value corresponding to some key

984
00:21:34,139 --> 00:21:34,149
current value corresponding to some key
 

985
00:21:34,149 --> 00:21:36,070
current value corresponding to some key
so this like has nothing about to do

986
00:21:36,070 --> 00:21:36,080
so this like has nothing about to do
 

987
00:21:36,080 --> 00:21:37,060
so this like has nothing about to do
with raft it's just sort of

988
00:21:37,060 --> 00:21:37,070
with raft it's just sort of
 

989
00:21:37,070 --> 00:21:38,500
with raft it's just sort of
client-server interaction for whatever

990
00:21:38,500 --> 00:21:38,510
client-server interaction for whatever
 

991
00:21:38,510 --> 00:21:41,980
client-server interaction for whatever
service we're building but once one of

992
00:21:41,980 --> 00:21:41,990
service we're building but once one of
 

993
00:21:41,990 --> 00:21:43,570
service we're building but once one of
these commands gets sent from the

994
00:21:43,570 --> 00:21:43,580
these commands gets sent from the
 

995
00:21:43,580 --> 00:21:44,980
these commands gets sent from the
requests get sent from the clients of

996
00:21:44,980 --> 00:21:44,990
requests get sent from the clients of
 

997
00:21:44,990 --> 00:21:48,279
requests get sent from the clients of
the server what actually happens is you

998
00:21:48,279 --> 00:21:48,289
the server what actually happens is you
 

999
00:21:48,289 --> 00:21:50,759
the server what actually happens is you
know on a non replicated server the

1000
00:21:50,759 --> 00:21:50,769
know on a non replicated server the
 

1001
00:21:50,769 --> 00:21:52,990
know on a non replicated server the
application code would like execute this

1002
00:21:52,990 --> 00:21:53,000
application code would like execute this
 

1003
00:21:53,000 --> 00:21:54,820
application code would like execute this
request and say update the table and

1004
00:21:54,820 --> 00:21:54,830
request and say update the table and
 

1005
00:21:54,830 --> 00:21:56,680
request and say update the table and
response to a book but not in a raft

1006
00:21:56,680 --> 00:21:56,690
response to a book but not in a raft
 

1007
00:21:56,690 --> 00:21:59,139
response to a book but not in a raft
replicated service instead if assuming

1008
00:21:59,139 --> 00:21:59,149
replicated service instead if assuming
 

1009
00:21:59,149 --> 00:22:00,730
replicated service instead if assuming
the client sends a request to leader

1010
00:22:00,730 --> 00:22:00,740
the client sends a request to leader
 

1011
00:22:00,740 --> 00:22:04,180
the client sends a request to leader
what really happens is the application

1012
00:22:04,180 --> 00:22:04,190
what really happens is the application
 

1013
00:22:04,190 --> 00:22:06,549
what really happens is the application
layer simply sends the request the

1014
00:22:06,549 --> 00:22:06,559
layer simply sends the request the
 

1015
00:22:06,559 --> 00:22:08,470
layer simply sends the request the
clients request down into the raft layer

1016
00:22:08,470 --> 00:22:08,480
clients request down into the raft layer
 

1017
00:22:08,480 --> 00:22:09,899
clients request down into the raft layer
to say look you know here's a request

1018
00:22:09,899 --> 00:22:09,909
to say look you know here's a request
 

1019
00:22:09,909 --> 00:22:13,120
to say look you know here's a request
please get it committed into the

1020
00:22:13,120 --> 00:22:13,130
please get it committed into the
 

1021
00:22:13,130 --> 00:22:15,430
please get it committed into the
replicated log and tell me when you're

1022
00:22:15,430 --> 00:22:15,440
replicated log and tell me when you're
 

1023
00:22:15,440 --> 00:22:17,590
replicated log and tell me when you're
done and so at this point the rafts

1024
00:22:17,590 --> 00:22:17,600
done and so at this point the rafts
 

1025
00:22:17,600 --> 00:22:23,830
done and so at this point the rafts
chitchat with each other until all the

1026
00:22:23,830 --> 00:22:23,840
chitchat with each other until all the
 

1027
00:22:23,840 --> 00:22:25,810
chitchat with each other until all the
replicas are a majority the replicas get

1028
00:22:25,810 --> 00:22:25,820
replicas are a majority the replicas get
 

1029
00:22:25,820 --> 00:22:28,990
replicas are a majority the replicas get
this new operation into their logs said

1030
00:22:28,990 --> 00:22:29,000
this new operation into their logs said
 

1031
00:22:29,000 --> 00:22:31,169
this new operation into their logs said
it is replicated and then when its

1032
00:22:31,169 --> 00:22:31,179
it is replicated and then when its
 

1033
00:22:31,179 --> 00:22:34,899
it is replicated and then when its
leader knows that all of the replicas of

1034
00:22:34,899 --> 00:22:34,909
leader knows that all of the replicas of
 

1035
00:22:34,909 --> 00:22:38,019
leader knows that all of the replicas of
a copy of this only then as a raft sent

1036
00:22:38,019 --> 00:22:38,029
a copy of this only then as a raft sent
 

1037
00:22:38,029 --> 00:22:40,330
a copy of this only then as a raft sent
a notification up back up to the key

1038
00:22:40,330 --> 00:22:40,340
a notification up back up to the key
 

1039
00:22:40,340 --> 00:22:42,970
a notification up back up to the key
value they are saying aha that operation

1040
00:22:42,970 --> 00:22:42,980
value they are saying aha that operation
 

1041
00:22:42,980 --> 00:22:44,379
value they are saying aha that operation
you sent me I mean

1042
00:22:44,379 --> 00:22:44,389
you sent me I mean
 

1043
00:22:44,389 --> 00:22:46,119
you sent me I mean
it's been now committed into all the

1044
00:22:46,119 --> 00:22:46,129
it's been now committed into all the
 

1045
00:22:46,129 --> 00:22:49,299
it's been now committed into all the
replicas and so it's safely replicated

1046
00:22:49,299 --> 00:22:49,309
replicas and so it's safely replicated
 

1047
00:22:49,309 --> 00:22:51,909
replicas and so it's safely replicated
and at this point it's okay to execute

1048
00:22:51,909 --> 00:22:51,919
and at this point it's okay to execute
 

1049
00:22:51,919 --> 00:22:55,079
and at this point it's okay to execute
that operation a raft you know the

1050
00:22:55,079 --> 00:22:55,089
that operation a raft you know the
 

1051
00:22:55,089 --> 00:22:57,069
that operation a raft you know the
client sends a request with the key

1052
00:22:57,069 --> 00:22:57,079
client sends a request with the key
 

1053
00:22:57,079 --> 00:22:59,109
client sends a request with the key
value layer Q value layer does not

1054
00:22:59,109 --> 00:22:59,119
value layer Q value layer does not
 

1055
00:22:59,119 --> 00:23:01,989
value layer Q value layer does not
execute it yet so we're not sure because

1056
00:23:01,989 --> 00:23:01,999
execute it yet so we're not sure because
 

1057
00:23:01,999 --> 00:23:04,569
execute it yet so we're not sure because
it hasn't been replicated only when it's

1058
00:23:04,569 --> 00:23:04,579
it hasn't been replicated only when it's
 

1059
00:23:04,579 --> 00:23:09,389
it hasn't been replicated only when it's
in out and the logs of all the replicas

1060
00:23:09,389 --> 00:23:09,399
in out and the logs of all the replicas
 

1061
00:23:09,399 --> 00:23:11,769
in out and the logs of all the replicas
then raft notifies the leader now the

1062
00:23:11,769 --> 00:23:11,779
then raft notifies the leader now the
 

1063
00:23:11,779 --> 00:23:13,419
then raft notifies the leader now the
leader actually execute the operation

1064
00:23:13,419 --> 00:23:13,429
leader actually execute the operation
 

1065
00:23:13,429 --> 00:23:15,430
leader actually execute the operation
which corresponds to you know for a put

1066
00:23:15,430 --> 00:23:15,440
which corresponds to you know for a put
 

1067
00:23:15,440 --> 00:23:20,349
which corresponds to you know for a put
updating the value yet reading correct

1068
00:23:20,349 --> 00:23:20,359
updating the value yet reading correct
 

1069
00:23:20,359 --> 00:23:22,029
updating the value yet reading correct
value out of the table and then finally

1070
00:23:22,029 --> 00:23:22,039
value out of the table and then finally
 

1071
00:23:22,039 --> 00:23:26,649
value out of the table and then finally
sends the reply back to the client so

1072
00:23:26,649 --> 00:23:26,659
sends the reply back to the client so
 

1073
00:23:26,659 --> 00:23:34,749
sends the reply back to the client so
that's the ordinary operation of it

1074
00:23:34,749 --> 00:23:34,759
that's the ordinary operation of it
 

1075
00:23:34,759 --> 00:23:36,309
that's the ordinary operation of it
submitted if it's in a majority and

1076
00:23:36,309 --> 00:23:36,319
submitted if it's in a majority and
 

1077
00:23:36,319 --> 00:23:38,469
submitted if it's in a majority and
again the reason why I can't be all is

1078
00:23:38,469 --> 00:23:38,479
again the reason why I can't be all is
 

1079
00:23:38,479 --> 00:23:39,579
again the reason why I can't be all is
that if we want to build a

1080
00:23:39,579 --> 00:23:39,589
that if we want to build a
 

1081
00:23:39,589 --> 00:23:41,289
that if we want to build a
fault-tolerant system it has to be able

1082
00:23:41,289 --> 00:23:41,299
fault-tolerant system it has to be able
 

1083
00:23:41,299 --> 00:23:43,509
fault-tolerant system it has to be able
to make progress even if some of the

1084
00:23:43,509 --> 00:23:43,519
to make progress even if some of the
 

1085
00:23:43,519 --> 00:23:49,439
to make progress even if some of the
server's have failed so yeah so ever

1086
00:23:49,439 --> 00:23:49,449
server's have failed so yeah so ever
 

1087
00:23:49,449 --> 00:23:54,710
server's have failed so yeah so ever
it's committed when it's in a majority

1088
00:23:54,710 --> 00:23:54,720

 

1089
00:23:54,720 --> 00:24:08,160

[Music]

1090
00:24:08,160 --> 00:24:08,170

 

1091
00:24:08,170 --> 00:24:12,700

yeah and so in addition when operations

1092
00:24:12,700 --> 00:24:12,710
yeah and so in addition when operations
 

1093
00:24:12,710 --> 00:24:14,760
yeah and so in addition when operations
finally committed each of the replicas

1094
00:24:14,760 --> 00:24:14,770
finally committed each of the replicas
 

1095
00:24:14,770 --> 00:24:17,650
finally committed each of the replicas
sends the operation up each of the raft

1096
00:24:17,650 --> 00:24:17,660
sends the operation up each of the raft
 

1097
00:24:17,660 --> 00:24:20,770
sends the operation up each of the raft
library layer sends the operation up to

1098
00:24:20,770 --> 00:24:20,780
library layer sends the operation up to
 

1099
00:24:20,780 --> 00:24:22,900
library layer sends the operation up to
the local application layer in the local

1100
00:24:22,900 --> 00:24:22,910
the local application layer in the local
 

1101
00:24:22,910 --> 00:24:24,580
the local application layer in the local
application layer applies that operation

1102
00:24:24,580 --> 00:24:24,590
application layer applies that operation
 

1103
00:24:24,590 --> 00:24:27,040
application layer applies that operation
to its state its state and so they all

1104
00:24:27,040 --> 00:24:27,050
to its state its state and so they all
 

1105
00:24:27,050 --> 00:24:29,290
to its state its state and so they all
so hopefully all the replicas seem the

1106
00:24:29,290 --> 00:24:29,300
so hopefully all the replicas seem the
 

1107
00:24:29,300 --> 00:24:32,770
so hopefully all the replicas seem the
same stream of operations they show up

1108
00:24:32,770 --> 00:24:32,780
same stream of operations they show up
 

1109
00:24:32,780 --> 00:24:34,750
same stream of operations they show up
in these up calls in the same order they

1110
00:24:34,750 --> 00:24:34,760
in these up calls in the same order they
 

1111
00:24:34,760 --> 00:24:36,340
in these up calls in the same order they
get applied to the state in the same

1112
00:24:36,340 --> 00:24:36,350
get applied to the state in the same
 

1113
00:24:36,350 --> 00:24:38,950
get applied to the state in the same
order and you know assuming the

1114
00:24:38,950 --> 00:24:38,960
order and you know assuming the
 

1115
00:24:38,960 --> 00:24:40,990
order and you know assuming the
operations are deterministic which they

1116
00:24:40,990 --> 00:24:41,000
operations are deterministic which they
 

1117
00:24:41,000 --> 00:24:45,910
operations are deterministic which they
better be the state of the replicas

1118
00:24:45,910 --> 00:24:45,920
better be the state of the replicas
 

1119
00:24:45,920 --> 00:24:48,180
better be the state of the replicas
replicated State will evolve in

1120
00:24:48,180 --> 00:24:48,190
replicated State will evolve in
 

1121
00:24:48,190 --> 00:24:50,350
replicated State will evolve in
identically on all the replicas so

1122
00:24:50,350 --> 00:24:50,360
identically on all the replicas so
 

1123
00:24:50,360 --> 00:24:52,390
identically on all the replicas so
typically this this table is what the

1124
00:24:52,390 --> 00:24:52,400
typically this this table is what the
 

1125
00:24:52,400 --> 00:24:55,770
typically this this table is what the
paper is talking about when it talks

1126
00:24:55,770 --> 00:24:55,780
paper is talking about when it talks
 

1127
00:24:55,780 --> 00:25:02,080
paper is talking about when it talks
about state a different way of viewing

1128
00:25:02,080 --> 00:25:02,090
about state a different way of viewing
 

1129
00:25:02,090 --> 00:25:05,470
about state a different way of viewing
this interaction and one that'll sort of

1130
00:25:05,470 --> 00:25:05,480
this interaction and one that'll sort of
 

1131
00:25:05,480 --> 00:25:07,090
this interaction and one that'll sort of
notation that will come up a lot in this

1132
00:25:07,090 --> 00:25:07,100
notation that will come up a lot in this
 

1133
00:25:07,100 --> 00:25:10,210
notation that will come up a lot in this
course is that a sort of time diagram

1134
00:25:10,210 --> 00:25:10,220
course is that a sort of time diagram
 

1135
00:25:10,220 --> 00:25:11,770
course is that a sort of time diagram
I'll draw you a time diagram of how the

1136
00:25:11,770 --> 00:25:11,780
I'll draw you a time diagram of how the
 

1137
00:25:11,780 --> 00:25:13,840
I'll draw you a time diagram of how the
messages work so let's imagine we have a

1138
00:25:13,840 --> 00:25:13,850
messages work so let's imagine we have a
 

1139
00:25:13,850 --> 00:25:18,580
messages work so let's imagine we have a
client and server one is the leader that

1140
00:25:18,580 --> 00:25:18,590
client and server one is the leader that
 

1141
00:25:18,590 --> 00:25:23,740
client and server one is the leader that
we also have server to server three and

1142
00:25:23,740 --> 00:25:23,750
we also have server to server three and
 

1143
00:25:23,750 --> 00:25:25,810
we also have server to server three and
time flows downward on this diagram we

1144
00:25:25,810 --> 00:25:25,820
time flows downward on this diagram we
 

1145
00:25:25,820 --> 00:25:27,460
time flows downward on this diagram we
imagine the client sending the original

1146
00:25:27,460 --> 00:25:27,470
imagine the client sending the original
 

1147
00:25:27,470 --> 00:25:31,930
imagine the client sending the original
request to server one after that server

1148
00:25:31,930 --> 00:25:31,940
request to server one after that server
 

1149
00:25:31,940 --> 00:25:35,320
request to server one after that server
ones raft layer sends an append entries

1150
00:25:35,320 --> 00:25:35,330
ones raft layer sends an append entries
 

1151
00:25:35,330 --> 00:25:42,790
ones raft layer sends an append entries
RPC to each of the two replicas this is

1152
00:25:42,790 --> 00:25:42,800
RPC to each of the two replicas this is
 

1153
00:25:42,800 --> 00:25:44,520
RPC to each of the two replicas this is
just an ordinary I'll say a put request

1154
00:25:44,520 --> 00:25:44,530
just an ordinary I'll say a put request
 

1155
00:25:44,530 --> 00:25:49,360
just an ordinary I'll say a put request
this is append entries requests the

1156
00:25:49,360 --> 00:25:49,370
this is append entries requests the
 

1157
00:25:49,370 --> 00:25:51,970
this is append entries requests the
server is now waiting for replies and

1158
00:25:51,970 --> 00:25:51,980
server is now waiting for replies and
 

1159
00:25:51,980 --> 00:25:55,000
server is now waiting for replies and
the server's from other replicas as soon

1160
00:25:55,000 --> 00:25:55,010
the server's from other replicas as soon
 

1161
00:25:55,010 --> 00:25:58,270
the server's from other replicas as soon
as replies from a majority arrive back

1162
00:25:58,270 --> 00:25:58,280
as replies from a majority arrive back
 

1163
00:25:58,280 --> 00:26:00,790
as replies from a majority arrive back
including the leader itself so in a

1164
00:26:00,790 --> 00:26:00,800
including the leader itself so in a
 

1165
00:26:00,800 --> 00:26:02,080
including the leader itself so in a
system with only three about because the

1166
00:26:02,080 --> 00:26:02,090
system with only three about because the
 

1167
00:26:02,090 --> 00:26:03,760
system with only three about because the
leader only has to wait for one other

1168
00:26:03,760 --> 00:26:03,770
leader only has to wait for one other
 

1169
00:26:03,770 --> 00:26:06,669
leader only has to wait for one other
replica to respond positively to an

1170
00:26:06,669 --> 00:26:06,679
replica to respond positively to an
 

1171
00:26:06,679 --> 00:26:09,299
replica to respond positively to an
append entries as soon as it assembles

1172
00:26:09,299 --> 00:26:09,309
append entries as soon as it assembles
 

1173
00:26:09,309 --> 00:26:14,370
append entries as soon as it assembles
positive responses from a majority the

1174
00:26:14,370 --> 00:26:14,380
positive responses from a majority the
 

1175
00:26:14,380 --> 00:26:15,520
positive responses from a majority the
leader

1176
00:26:15,520 --> 00:26:15,530
leader
 

1177
00:26:15,530 --> 00:26:18,220
leader
execute a command figures out what the

1178
00:26:18,220 --> 00:26:18,230
execute a command figures out what the
 

1179
00:26:18,230 --> 00:26:20,370
execute a command figures out what the
answer is like forget

1180
00:26:20,370 --> 00:26:20,380
answer is like forget
 

1181
00:26:20,380 --> 00:26:25,410
answer is like forget
and sends the reply back to the client

1182
00:26:25,410 --> 00:26:25,420
and sends the reply back to the client
 

1183
00:26:25,420 --> 00:26:27,240
and sends the reply back to the client
I mean why of course you know if s who's

1184
00:26:27,240 --> 00:26:27,250
I mean why of course you know if s who's
 

1185
00:26:27,250 --> 00:26:30,690
I mean why of course you know if s who's
actually awry alive it'll send back its

1186
00:26:30,690 --> 00:26:30,700
actually awry alive it'll send back its
 

1187
00:26:30,700 --> 00:26:32,190
actually awry alive it'll send back its
response too but we're not waiting for

1188
00:26:32,190 --> 00:26:32,200
response too but we're not waiting for
 

1189
00:26:32,200 --> 00:26:35,460
response too but we're not waiting for
it although it's useful to know and

1190
00:26:35,460 --> 00:26:35,470
it although it's useful to know and
 

1191
00:26:35,470 --> 00:26:40,880
it although it's useful to know and
figure - all right everybody see this

1192
00:26:40,880 --> 00:26:40,890
figure - all right everybody see this
 

1193
00:26:40,890 --> 00:26:43,110
figure - all right everybody see this
this is the sort of ordinary operation

1194
00:26:43,110 --> 00:26:43,120
this is the sort of ordinary operation
 

1195
00:26:43,120 --> 00:26:51,190
this is the sort of ordinary operation
of the system no no failures

1196
00:26:51,190 --> 00:26:51,200

 

1197
00:26:51,200 --> 00:26:55,450

oh gosh yeah I like I left out important

1198
00:26:55,450 --> 00:26:55,460
oh gosh yeah I like I left out important
 

1199
00:26:55,460 --> 00:26:57,550
oh gosh yeah I like I left out important
steps so you know this point the leader

1200
00:26:57,550 --> 00:26:57,560
steps so you know this point the leader
 

1201
00:26:57,560 --> 00:26:59,740
steps so you know this point the leader
knows oh I got you know I'm adora t have

1202
00:26:59,740 --> 00:26:59,750
knows oh I got you know I'm adora t have
 

1203
00:26:59,750 --> 00:27:01,510
knows oh I got you know I'm adora t have
put it in no log I can go ahead and

1204
00:27:01,510 --> 00:27:01,520
put it in no log I can go ahead and
 

1205
00:27:01,520 --> 00:27:03,220
put it in no log I can go ahead and
execute it and reply yes to the client

1206
00:27:03,220 --> 00:27:03,230
execute it and reply yes to the client
 

1207
00:27:03,230 --> 00:27:05,140
execute it and reply yes to the client
because it's committed but server two

1208
00:27:05,140 --> 00:27:05,150
because it's committed but server two
 

1209
00:27:05,150 --> 00:27:06,370
because it's committed but server two
doesn't know anything yet it just knows

1210
00:27:06,370 --> 00:27:06,380
doesn't know anything yet it just knows
 

1211
00:27:06,380 --> 00:27:07,630
doesn't know anything yet it just knows
well you know I got this request from

1212
00:27:07,630 --> 00:27:07,640
well you know I got this request from
 

1213
00:27:07,640 --> 00:27:09,580
well you know I got this request from
the leader but I don't know if it's

1214
00:27:09,580 --> 00:27:09,590
the leader but I don't know if it's
 

1215
00:27:09,590 --> 00:27:11,770
the leader but I don't know if it's
committed yet depends on for example

1216
00:27:11,770 --> 00:27:11,780
committed yet depends on for example
 

1217
00:27:11,780 --> 00:27:13,510
committed yet depends on for example
whether my reply got back to the leader

1218
00:27:13,510 --> 00:27:13,520
whether my reply got back to the leader
 

1219
00:27:13,520 --> 00:27:15,250
whether my reply got back to the leader
for all server to knows it's reply was

1220
00:27:15,250 --> 00:27:15,260
for all server to knows it's reply was
 

1221
00:27:15,260 --> 00:27:16,930
for all server to knows it's reply was
brought by the network maybe the leader

1222
00:27:16,930 --> 00:27:16,940
brought by the network maybe the leader
 

1223
00:27:16,940 --> 00:27:18,700
brought by the network maybe the leader
never heard the reply and never decided

1224
00:27:18,700 --> 00:27:18,710
never heard the reply and never decided
 

1225
00:27:18,710 --> 00:27:20,350
never heard the reply and never decided
to commit this request so there's

1226
00:27:20,350 --> 00:27:20,360
to commit this request so there's
 

1227
00:27:20,360 --> 00:27:24,000
to commit this request so there's
actually another stage once the server

1228
00:27:24,000 --> 00:27:24,010
actually another stage once the server
 

1229
00:27:24,010 --> 00:27:28,330
actually another stage once the server
realizes that a request is committed it

1230
00:27:28,330 --> 00:27:28,340
realizes that a request is committed it
 

1231
00:27:28,340 --> 00:27:31,060
realizes that a request is committed it
then needs to tell the other replicas

1232
00:27:31,060 --> 00:27:31,070
then needs to tell the other replicas
 

1233
00:27:31,070 --> 00:27:38,310
then needs to tell the other replicas
that fact and so there are there's

1234
00:27:38,310 --> 00:27:38,320

 

1235
00:27:38,320 --> 00:27:40,720

there's an extra message here exactly

1236
00:27:40,720 --> 00:27:40,730
there's an extra message here exactly
 

1237
00:27:40,730 --> 00:27:42,190
there's an extra message here exactly
what that message is depends a little

1238
00:27:42,190 --> 00:27:42,200
what that message is depends a little
 

1239
00:27:42,200 --> 00:27:45,850
what that message is depends a little
bit on what what else is going on it's

1240
00:27:45,850 --> 00:27:45,860
bit on what what else is going on it's
 

1241
00:27:45,860 --> 00:27:49,510
bit on what what else is going on it's
at least in raft there's not an explicit

1242
00:27:49,510 --> 00:27:49,520
at least in raft there's not an explicit
 

1243
00:27:49,520 --> 00:27:51,310
at least in raft there's not an explicit
commit message instead the information

1244
00:27:51,310 --> 00:27:51,320
commit message instead the information
 

1245
00:27:51,320 --> 00:27:53,710
commit message instead the information
is piggybacked inside the next append

1246
00:27:53,710 --> 00:27:53,720
is piggybacked inside the next append
 

1247
00:27:53,720 --> 00:27:55,630
is piggybacked inside the next append
entries that leader sends out the next

1248
00:27:55,630 --> 00:27:55,640
entries that leader sends out the next
 

1249
00:27:55,640 --> 00:27:57,610
entries that leader sends out the next
append entries RPC it sends out for

1250
00:27:57,610 --> 00:27:57,620
append entries RPC it sends out for
 

1251
00:27:57,620 --> 00:28:00,250
append entries RPC it sends out for
whatever reason like there's a commit

1252
00:28:00,250 --> 00:28:00,260
whatever reason like there's a commit
 

1253
00:28:00,260 --> 00:28:01,810
whatever reason like there's a commit
meter commit or something filled in that

1254
00:28:01,810 --> 00:28:01,820
meter commit or something filled in that
 

1255
00:28:01,820 --> 00:28:05,770
meter commit or something filled in that
RPC and the next time the leader needs

1256
00:28:05,770 --> 00:28:05,780
RPC and the next time the leader needs
 

1257
00:28:05,780 --> 00:28:07,870
RPC and the next time the leader needs
have to send a heartbeat heartbeat or

1258
00:28:07,870 --> 00:28:07,880
have to send a heartbeat heartbeat or
 

1259
00:28:07,880 --> 00:28:10,090
have to send a heartbeat heartbeat or
needs to send out a new client request

1260
00:28:10,090 --> 00:28:10,100
needs to send out a new client request
 

1261
00:28:10,100 --> 00:28:13,360
needs to send out a new client request
because some different client requests

1262
00:28:13,360 --> 00:28:13,370
because some different client requests
 

1263
00:28:13,370 --> 00:28:16,560
because some different client requests
or something it'll send out the new hire

1264
00:28:16,560 --> 00:28:16,570
or something it'll send out the new hire
 

1265
00:28:16,570 --> 00:28:19,270
or something it'll send out the new hire
leader commit value and at that point

1266
00:28:19,270 --> 00:28:19,280
leader commit value and at that point
 

1267
00:28:19,280 --> 00:28:25,240
leader commit value and at that point
the replicas will execute the operation

1268
00:28:25,240 --> 00:28:25,250
the replicas will execute the operation
 

1269
00:28:25,250 --> 00:28:39,690
the replicas will execute the operation
and apply it to their state yes

1270
00:28:39,690 --> 00:28:39,700

 

1271
00:28:39,700 --> 00:28:43,380

oh yes so this is a this is a protocol

1272
00:28:43,380 --> 00:28:43,390
oh yes so this is a this is a protocol
 

1273
00:28:43,390 --> 00:28:45,260
oh yes so this is a this is a protocol
that has a quite a bit of chitchat in it

1274
00:28:45,260 --> 00:28:45,270
that has a quite a bit of chitchat in it
 

1275
00:28:45,270 --> 00:28:51,120
that has a quite a bit of chitchat in it
and it's not super fast indeed you know

1276
00:28:51,120 --> 00:28:51,130
and it's not super fast indeed you know
 

1277
00:28:51,130 --> 00:28:53,040
and it's not super fast indeed you know
yeah client sends in request request has

1278
00:28:53,040 --> 00:28:53,050
yeah client sends in request request has
 

1279
00:28:53,050 --> 00:28:54,720
yeah client sends in request request has
to get to the server the server talks to

1280
00:28:54,720 --> 00:28:54,730
to get to the server the server talks to
 

1281
00:28:54,730 --> 00:28:57,450
to get to the server the server talks to
at least you know another instance that

1282
00:28:57,450 --> 00:28:57,460
at least you know another instance that
 

1283
00:28:57,460 --> 00:28:58,800
at least you know another instance that
multiple messages has to wait for the

1284
00:28:58,800 --> 00:28:58,810
multiple messages has to wait for the
 

1285
00:28:58,810 --> 00:29:00,540
multiple messages has to wait for the
responses send something back so there's

1286
00:29:00,540 --> 00:29:00,550
responses send something back so there's
 

1287
00:29:00,550 --> 00:29:02,190
responses send something back so there's
a bunch of message round-trip times kind

1288
00:29:02,190 --> 00:29:02,200
a bunch of message round-trip times kind
 

1289
00:29:02,200 --> 00:29:10,750
a bunch of message round-trip times kind
of embedded here

1290
00:29:10,750 --> 00:29:10,760

 

1291
00:29:10,760 --> 00:29:15,250

yes if so this is up to you as the

1292
00:29:15,250 --> 00:29:15,260
yes if so this is up to you as the
 

1293
00:29:15,260 --> 00:29:17,919
yes if so this is up to you as the
implementer actually exactly when the

1294
00:29:17,919 --> 00:29:17,929
implementer actually exactly when the
 

1295
00:29:17,929 --> 00:29:21,159
implementer actually exactly when the
leader sends out the updated commit

1296
00:29:21,159 --> 00:29:21,169
leader sends out the updated commit
 

1297
00:29:21,169 --> 00:29:26,590
leader sends out the updated commit
index if client requests a comeback only

1298
00:29:26,590 --> 00:29:26,600
index if client requests a comeback only
 

1299
00:29:26,600 --> 00:29:29,080
index if client requests a comeback only
very occasionally then you know the

1300
00:29:29,080 --> 00:29:29,090
very occasionally then you know the
 

1301
00:29:29,090 --> 00:29:30,730
very occasionally then you know the
leader may want to send out a heartbeat

1302
00:29:30,730 --> 00:29:30,740
leader may want to send out a heartbeat
 

1303
00:29:30,740 --> 00:29:33,310
leader may want to send out a heartbeat
or send out a special append entries

1304
00:29:33,310 --> 00:29:33,320
or send out a special append entries
 

1305
00:29:33,320 --> 00:29:37,539
or send out a special append entries
message if client requests come quite

1306
00:29:37,539 --> 00:29:37,549
message if client requests come quite
 

1307
00:29:37,549 --> 00:29:38,530
message if client requests come quite
frequently then it doesn't matter

1308
00:29:38,530 --> 00:29:38,540
frequently then it doesn't matter
 

1309
00:29:38,540 --> 00:29:40,270
frequently then it doesn't matter
because if they come you know there's

1310
00:29:40,270 --> 00:29:40,280
because if they come you know there's
 

1311
00:29:40,280 --> 00:29:42,070
because if they come you know there's
thousand arrive per second and gee so

1312
00:29:42,070 --> 00:29:42,080
thousand arrive per second and gee so
 

1313
00:29:42,080 --> 00:29:43,510
thousand arrive per second and gee so
it'll be another one along very soon and

1314
00:29:43,510 --> 00:29:43,520
it'll be another one along very soon and
 

1315
00:29:43,520 --> 00:29:45,220
it'll be another one along very soon and
so you can piggyback so without

1316
00:29:45,220 --> 00:29:45,230
so you can piggyback so without
 

1317
00:29:45,230 --> 00:29:46,659
so you can piggyback so without
generating an extra message which is

1318
00:29:46,659 --> 00:29:46,669
generating an extra message which is
 

1319
00:29:46,669 --> 00:29:48,400
generating an extra message which is
somewhat expensive you can get the

1320
00:29:48,400 --> 00:29:48,410
somewhat expensive you can get the
 

1321
00:29:48,410 --> 00:29:50,049
somewhat expensive you can get the
information out on the next message you

1322
00:29:50,049 --> 00:29:50,059
information out on the next message you
 

1323
00:29:50,059 --> 00:29:53,440
information out on the next message you
were gonna send anyway in fact I I don't

1324
00:29:53,440 --> 00:29:53,450
were gonna send anyway in fact I I don't
 

1325
00:29:53,450 --> 00:29:58,810
were gonna send anyway in fact I I don't
think the time at which the replicas

1326
00:29:58,810 --> 00:29:58,820
think the time at which the replicas
 

1327
00:29:58,820 --> 00:30:02,010
think the time at which the replicas
execute the request is critical because

1328
00:30:02,010 --> 00:30:02,020
execute the request is critical because
 

1329
00:30:02,020 --> 00:30:04,630
execute the request is critical because
nobody's waiting for it at least if

1330
00:30:04,630 --> 00:30:04,640
nobody's waiting for it at least if
 

1331
00:30:04,640 --> 00:30:06,490
nobody's waiting for it at least if
there's no failures if there's no

1332
00:30:06,490 --> 00:30:06,500
there's no failures if there's no
 

1333
00:30:06,500 --> 00:30:10,690
there's no failures if there's no
failures replicas executing the request

1334
00:30:10,690 --> 00:30:10,700
failures replicas executing the request
 

1335
00:30:10,700 --> 00:30:12,669
failures replicas executing the request
isn't really on the critical path like

1336
00:30:12,669 --> 00:30:12,679
isn't really on the critical path like
 

1337
00:30:12,679 --> 00:30:13,960
isn't really on the critical path like
the client isn't waiting for them the

1338
00:30:13,960 --> 00:30:13,970
the client isn't waiting for them the
 

1339
00:30:13,970 --> 00:30:15,190
the client isn't waiting for them the
client saw me waiting for the leader to

1340
00:30:15,190 --> 00:30:15,200
client saw me waiting for the leader to
 

1341
00:30:15,200 --> 00:30:20,530
client saw me waiting for the leader to
execute so it may not be that it may not

1342
00:30:20,530 --> 00:30:20,540
execute so it may not be that it may not
 

1343
00:30:20,540 --> 00:30:23,590
execute so it may not be that it may not
affect client perceived latency sort of

1344
00:30:23,590 --> 00:30:23,600
affect client perceived latency sort of
 

1345
00:30:23,600 --> 00:30:37,510
affect client perceived latency sort of
exactly how this gets staged

1346
00:30:37,510 --> 00:30:37,520

 

1347
00:30:37,520 --> 00:30:45,890

all right one question you should ask is

1348
00:30:45,890 --> 00:30:45,900
all right one question you should ask is
 

1349
00:30:45,900 --> 00:30:48,740
all right one question you should ask is
why does the system why is the system so

1350
00:30:48,740 --> 00:30:48,750
why does the system why is the system so
 

1351
00:30:48,750 --> 00:30:52,630
why does the system why is the system so
focused on blogs what are the logs doing

1352
00:30:52,630 --> 00:30:52,640
focused on blogs what are the logs doing
 

1353
00:30:52,640 --> 00:30:54,920
focused on blogs what are the logs doing
and it's sort of worth trying to come up

1354
00:30:54,920 --> 00:30:54,930
and it's sort of worth trying to come up
 

1355
00:30:54,930 --> 00:30:56,620
and it's sort of worth trying to come up
with an explicit answers to that one

1356
00:30:56,620 --> 00:30:56,630
with an explicit answers to that one
 

1357
00:30:56,630 --> 00:31:00,200
with an explicit answers to that one
answer to why the system is totally

1358
00:31:00,200 --> 00:31:00,210
answer to why the system is totally
 

1359
00:31:00,210 --> 00:31:04,190
answer to why the system is totally
focused on logs is that the log is the

1360
00:31:04,190 --> 00:31:04,200
focused on logs is that the log is the
 

1361
00:31:04,200 --> 00:31:05,690
focused on logs is that the log is the
kind of mechanism by which the leader

1362
00:31:05,690 --> 00:31:05,700
kind of mechanism by which the leader
 

1363
00:31:05,700 --> 00:31:08,720
kind of mechanism by which the leader
orders operations it's vital for these

1364
00:31:08,720 --> 00:31:08,730
orders operations it's vital for these
 

1365
00:31:08,730 --> 00:31:10,820
orders operations it's vital for these
replicated state machines that all the

1366
00:31:10,820 --> 00:31:10,830
replicated state machines that all the
 

1367
00:31:10,830 --> 00:31:13,880
replicated state machines that all the
replicas apply not just the same client

1368
00:31:13,880 --> 00:31:13,890
replicas apply not just the same client
 

1369
00:31:13,890 --> 00:31:15,710
replicas apply not just the same client
operations to their start but the same

1370
00:31:15,710 --> 00:31:15,720
operations to their start but the same
 

1371
00:31:15,720 --> 00:31:18,680
operations to their start but the same
operations in the same order but they

1372
00:31:18,680 --> 00:31:18,690
operations in the same order but they
 

1373
00:31:18,690 --> 00:31:20,600
operations in the same order but they
all have to apply that these operations

1374
00:31:20,600 --> 00:31:20,610
all have to apply that these operations
 

1375
00:31:20,610 --> 00:31:22,250
all have to apply that these operations
coming from the clients in the same

1376
00:31:22,250 --> 00:31:22,260
coming from the clients in the same
 

1377
00:31:22,260 --> 00:31:24,230
coming from the clients in the same
order and the log among many other

1378
00:31:24,230 --> 00:31:24,240
order and the log among many other
 

1379
00:31:24,240 --> 00:31:26,570
order and the log among many other
things is part of the machinery by which

1380
00:31:26,570 --> 00:31:26,580
things is part of the machinery by which
 

1381
00:31:26,580 --> 00:31:30,680
things is part of the machinery by which
the or the leader assigns an order to

1382
00:31:30,680 --> 00:31:30,690
the or the leader assigns an order to
 

1383
00:31:30,690 --> 00:31:32,420
the or the leader assigns an order to
the incoming client operations I give

1384
00:31:32,420 --> 00:31:32,430
the incoming client operations I give
 

1385
00:31:32,430 --> 00:31:34,610
the incoming client operations I give
you know ten clients send operations to

1386
00:31:34,610 --> 00:31:34,620
you know ten clients send operations to
 

1387
00:31:34,620 --> 00:31:36,080
you know ten clients send operations to
the leader at the same time the client

1388
00:31:36,080 --> 00:31:36,090
the leader at the same time the client
 

1389
00:31:36,090 --> 00:31:37,940
the leader at the same time the client
the leader has to pick pick an order

1390
00:31:37,940 --> 00:31:37,950
the leader has to pick pick an order
 

1391
00:31:37,950 --> 00:31:39,290
the leader has to pick pick an order
make sure everybody all the replicas

1392
00:31:39,290 --> 00:31:39,300
make sure everybody all the replicas
 

1393
00:31:39,300 --> 00:31:41,870
make sure everybody all the replicas
obey that order and the log is you know

1394
00:31:41,870 --> 00:31:41,880
obey that order and the log is you know
 

1395
00:31:41,880 --> 00:31:44,080
obey that order and the log is you know
the fact that the log has numbered slots

1396
00:31:44,080 --> 00:31:44,090
the fact that the log has numbered slots
 

1397
00:31:44,090 --> 00:31:46,730
the fact that the log has numbered slots
as part of half a meter expresses the

1398
00:31:46,730 --> 00:31:46,740
as part of half a meter expresses the
 

1399
00:31:46,740 --> 00:31:52,670
as part of half a meter expresses the
order it's chosen another use of the log

1400
00:31:52,670 --> 00:31:52,680
order it's chosen another use of the log
 

1401
00:31:52,680 --> 00:31:56,690
order it's chosen another use of the log
is that between this point and this

1402
00:31:56,690 --> 00:31:56,700
is that between this point and this
 

1403
00:31:56,700 --> 00:32:00,320
is that between this point and this
point server 3 has received an operation

1404
00:32:00,320 --> 00:32:00,330
point server 3 has received an operation
 

1405
00:32:00,330 --> 00:32:02,510
point server 3 has received an operation
that it is not yet sure is committed and

1406
00:32:02,510 --> 00:32:02,520
that it is not yet sure is committed and
 

1407
00:32:02,520 --> 00:32:04,550
that it is not yet sure is committed and
it cannot execute it yet it has to put

1408
00:32:04,550 --> 00:32:04,560
it cannot execute it yet it has to put
 

1409
00:32:04,560 --> 00:32:07,430
it cannot execute it yet it has to put
the this operation aside somewhere until

1410
00:32:07,430 --> 00:32:07,440
the this operation aside somewhere until
 

1411
00:32:07,440 --> 00:32:11,330
the this operation aside somewhere until
the increment to the leader commit value

1412
00:32:11,330 --> 00:32:11,340
the increment to the leader commit value
 

1413
00:32:11,340 --> 00:32:13,490
the increment to the leader commit value
comes in and so another thing that the

1414
00:32:13,490 --> 00:32:13,500
comes in and so another thing that the
 

1415
00:32:13,500 --> 00:32:15,080
comes in and so another thing that the
log is doing is that on the followers

1416
00:32:15,080 --> 00:32:15,090
log is doing is that on the followers
 

1417
00:32:15,090 --> 00:32:17,120
log is doing is that on the followers
the log is the place where the follower

1418
00:32:17,120 --> 00:32:17,130
the log is the place where the follower
 

1419
00:32:17,130 --> 00:32:18,650
the log is the place where the follower
sort of sets aside operations that are

1420
00:32:18,650 --> 00:32:18,660
sort of sets aside operations that are
 

1421
00:32:18,660 --> 00:32:20,480
sort of sets aside operations that are
still tentative that have arrived but

1422
00:32:20,480 --> 00:32:20,490
still tentative that have arrived but
 

1423
00:32:20,490 --> 00:32:21,980
still tentative that have arrived but
are not yet known to be committed and

1424
00:32:21,980 --> 00:32:21,990
are not yet known to be committed and
 

1425
00:32:21,990 --> 00:32:23,330
are not yet known to be committed and
they may have to be thrown away as we'll

1426
00:32:23,330 --> 00:32:23,340
they may have to be thrown away as we'll
 

1427
00:32:23,340 --> 00:32:27,020
they may have to be thrown away as we'll
see so that's another use I'm the I sort

1428
00:32:27,020 --> 00:32:27,030
see so that's another use I'm the I sort
 

1429
00:32:27,030 --> 00:32:29,720
see so that's another use I'm the I sort
of do love that use on the leader side

1430
00:32:29,720 --> 00:32:29,730
of do love that use on the leader side
 

1431
00:32:29,730 --> 00:32:33,490
of do love that use on the leader side
is that the leader needs to remember

1432
00:32:33,490 --> 00:32:33,500
is that the leader needs to remember
 

1433
00:32:33,500 --> 00:32:36,290
is that the leader needs to remember
operations in its log because it may

1434
00:32:36,290 --> 00:32:36,300
operations in its log because it may
 

1435
00:32:36,300 --> 00:32:38,960
operations in its log because it may
need to retransmit them to followers if

1436
00:32:38,960 --> 00:32:38,970
need to retransmit them to followers if
 

1437
00:32:38,970 --> 00:32:40,760
need to retransmit them to followers if
some followers offline maybe it's

1438
00:32:40,760 --> 00:32:40,770
some followers offline maybe it's
 

1439
00:32:40,770 --> 00:32:41,870
some followers offline maybe it's
something briefly happened to its

1440
00:32:41,870 --> 00:32:41,880
something briefly happened to its
 

1441
00:32:41,880 --> 00:32:42,259
something briefly happened to its
network

1442
00:32:42,259 --> 00:32:42,269
network
 

1443
00:32:42,269 --> 00:32:44,139
network
action or something misses some messages

1444
00:32:44,139 --> 00:32:44,149
action or something misses some messages
 

1445
00:32:44,149 --> 00:32:46,430
action or something misses some messages
the leader needs to be able to resend

1446
00:32:46,430 --> 00:32:46,440
the leader needs to be able to resend
 

1447
00:32:46,440 --> 00:32:49,099
the leader needs to be able to resend
log messages that any followers missed

1448
00:32:49,099 --> 00:32:49,109
log messages that any followers missed
 

1449
00:32:49,109 --> 00:32:50,690
log messages that any followers missed
and so the leader needs a place where

1450
00:32:50,690 --> 00:32:50,700
and so the leader needs a place where
 

1451
00:32:50,700 --> 00:32:52,849
and so the leader needs a place where
can set aside copies of messages of

1452
00:32:52,849 --> 00:32:52,859
can set aside copies of messages of
 

1453
00:32:52,859 --> 00:32:54,560
can set aside copies of messages of
client requests even ones that it's

1454
00:32:54,560 --> 00:32:54,570
client requests even ones that it's
 

1455
00:32:54,570 --> 00:32:56,959
client requests even ones that it's
already executed in order to be able to

1456
00:32:56,959 --> 00:32:56,969
already executed in order to be able to
 

1457
00:32:56,969 --> 00:33:00,529
already executed in order to be able to
resend them to the client I mean we send

1458
00:33:00,529 --> 00:33:00,539
resend them to the client I mean we send
 

1459
00:33:00,539 --> 00:33:04,009
resend them to the client I mean we send
them to replicas that missed missed that

1460
00:33:04,009 --> 00:33:04,019
them to replicas that missed missed that
 

1461
00:33:04,019 --> 00:33:05,869
them to replicas that missed missed that
operation and a final reason for all of

1462
00:33:05,869 --> 00:33:05,879
operation and a final reason for all of
 

1463
00:33:05,879 --> 00:33:07,940
operation and a final reason for all of
them to keep the log is that at least in

1464
00:33:07,940 --> 00:33:07,950
them to keep the log is that at least in
 

1465
00:33:07,950 --> 00:33:10,999
them to keep the log is that at least in
the world of figure 2 if a server

1466
00:33:10,999 --> 00:33:11,009
the world of figure 2 if a server
 

1467
00:33:11,009 --> 00:33:15,249
the world of figure 2 if a server
crashes and restarts and wants to rejoin

1468
00:33:15,249 --> 00:33:15,259
crashes and restarts and wants to rejoin
 

1469
00:33:15,259 --> 00:33:17,749
crashes and restarts and wants to rejoin
and you really need if it you really

1470
00:33:17,749 --> 00:33:17,759
and you really need if it you really
 

1471
00:33:17,759 --> 00:33:19,459
and you really need if it you really
want a server that crashes - in fact we

1472
00:33:19,459 --> 00:33:19,469
want a server that crashes - in fact we
 

1473
00:33:19,469 --> 00:33:21,589
want a server that crashes - in fact we
start and rejoin the raft cluster

1474
00:33:21,589 --> 00:33:21,599
start and rejoin the raft cluster
 

1475
00:33:21,599 --> 00:33:23,239
start and rejoin the raft cluster
otherwise you're now operating with only

1476
00:33:23,239 --> 00:33:23,249
otherwise you're now operating with only
 

1477
00:33:23,249 --> 00:33:24,799
otherwise you're now operating with only
two out of three servers and you can't

1478
00:33:24,799 --> 00:33:24,809
two out of three servers and you can't
 

1479
00:33:24,809 --> 00:33:26,810
two out of three servers and you can't
survive any more failures we need to

1480
00:33:26,810 --> 00:33:26,820
survive any more failures we need to
 

1481
00:33:26,820 --> 00:33:29,389
survive any more failures we need to
reincorporate failed and rebooted

1482
00:33:29,389 --> 00:33:29,399
reincorporate failed and rebooted
 

1483
00:33:29,399 --> 00:33:31,940
reincorporate failed and rebooted
servers and the log is sort of where or

1484
00:33:31,940 --> 00:33:31,950
servers and the log is sort of where or
 

1485
00:33:31,950 --> 00:33:34,430
servers and the log is sort of where or
what a server rebooted server uses the

1486
00:33:34,430 --> 00:33:34,440
what a server rebooted server uses the
 

1487
00:33:34,440 --> 00:33:37,159
what a server rebooted server uses the
log persisted to its disk because one of

1488
00:33:37,159 --> 00:33:37,169
log persisted to its disk because one of
 

1489
00:33:37,169 --> 00:33:39,560
log persisted to its disk because one of
the rules is that each raft server needs

1490
00:33:39,560 --> 00:33:39,570
the rules is that each raft server needs
 

1491
00:33:39,570 --> 00:33:41,149
the rules is that each raft server needs
to write its log to its disk where it

1492
00:33:41,149 --> 00:33:41,159
to write its log to its disk where it
 

1493
00:33:41,159 --> 00:33:42,529
to write its log to its disk where it
will still be after it crashes and

1494
00:33:42,529 --> 00:33:42,539
will still be after it crashes and
 

1495
00:33:42,539 --> 00:33:44,449
will still be after it crashes and
restarts that log is what the server

1496
00:33:44,449 --> 00:33:44,459
restarts that log is what the server
 

1497
00:33:44,459 --> 00:33:48,229
restarts that log is what the server
uses or replays the operations in that

1498
00:33:48,229 --> 00:33:48,239
uses or replays the operations in that
 

1499
00:33:48,239 --> 00:33:50,359
uses or replays the operations in that
log from the beginning to sort of create

1500
00:33:50,359 --> 00:33:50,369
log from the beginning to sort of create
 

1501
00:33:50,369 --> 00:33:52,699
log from the beginning to sort of create
its state as of when it crashed and then

1502
00:33:52,699 --> 00:33:52,709
its state as of when it crashed and then
 

1503
00:33:52,709 --> 00:33:54,799
its state as of when it crashed and then
then it carries on from there so the log

1504
00:33:54,799 --> 00:33:54,809
then it carries on from there so the log
 

1505
00:33:54,809 --> 00:33:56,329
then it carries on from there so the log
is also used as part of the persistence

1506
00:33:56,329 --> 00:33:56,339
is also used as part of the persistence
 

1507
00:33:56,339 --> 00:33:58,489
is also used as part of the persistence
plan as a sequence of commands to

1508
00:33:58,489 --> 00:33:58,499
plan as a sequence of commands to
 

1509
00:33:58,499 --> 00:34:16,270
plan as a sequence of commands to
rebuild the state

1510
00:34:16,270 --> 00:34:16,280

 

1511
00:34:16,280 --> 00:34:20,260

well ultimately okay so the question is

1512
00:34:20,260 --> 00:34:20,270
well ultimately okay so the question is
 

1513
00:34:20,270 --> 00:34:23,329
well ultimately okay so the question is
suppose the leader is capable of

1514
00:34:23,329 --> 00:34:23,339
suppose the leader is capable of
 

1515
00:34:23,339 --> 00:34:25,190
suppose the leader is capable of
executing a thousand client commands a

1516
00:34:25,190 --> 00:34:25,200
executing a thousand client commands a
 

1517
00:34:25,200 --> 00:34:26,869
executing a thousand client commands a
second and the followers are only

1518
00:34:26,869 --> 00:34:26,879
second and the followers are only
 

1519
00:34:26,879 --> 00:34:28,700
second and the followers are only
incapable of executing a hundred client

1520
00:34:28,700 --> 00:34:28,710
incapable of executing a hundred client
 

1521
00:34:28,710 --> 00:34:30,169
incapable of executing a hundred client
commands per second that's sort of

1522
00:34:30,169 --> 00:34:30,179
commands per second that's sort of
 

1523
00:34:30,179 --> 00:34:36,050
commands per second that's sort of
sustained rate you know full speed v so

1524
00:34:36,050 --> 00:34:36,060
sustained rate you know full speed v so
 

1525
00:34:36,060 --> 00:34:41,589
sustained rate you know full speed v so
one thing to note is that the the

1526
00:34:41,589 --> 00:34:41,599
one thing to note is that the the
 

1527
00:34:41,599 --> 00:34:43,790
one thing to note is that the the
replicas the followers acknowledge

1528
00:34:43,790 --> 00:34:43,800
replicas the followers acknowledge
 

1529
00:34:43,800 --> 00:34:45,619
replicas the followers acknowledge
commands before they execute them so

1530
00:34:45,619 --> 00:34:45,629
commands before they execute them so
 

1531
00:34:45,629 --> 00:34:47,180
commands before they execute them so
they mate rate at which they acknowledge

1532
00:34:47,180 --> 00:34:47,190
they mate rate at which they acknowledge
 

1533
00:34:47,190 --> 00:34:48,740
they mate rate at which they acknowledge
and accumulate stuff in their logs is

1534
00:34:48,740 --> 00:34:48,750
and accumulate stuff in their logs is
 

1535
00:34:48,750 --> 00:34:51,050
and accumulate stuff in their logs is
not limited so you know maybe they can

1536
00:34:51,050 --> 00:34:51,060
not limited so you know maybe they can
 

1537
00:34:51,060 --> 00:34:52,460
not limited so you know maybe they can
acknowledge that a thousand requests per

1538
00:34:52,460 --> 00:34:52,470
acknowledge that a thousand requests per
 

1539
00:34:52,470 --> 00:34:55,520
acknowledge that a thousand requests per
second if they do that forever then they

1540
00:34:55,520 --> 00:34:55,530
second if they do that forever then they
 

1541
00:34:55,530 --> 00:34:57,680
second if they do that forever then they
will build up unbounded size logs

1542
00:34:57,680 --> 00:34:57,690
will build up unbounded size logs
 

1543
00:34:57,690 --> 00:35:00,290
will build up unbounded size logs
because their execution rate falls it

1544
00:35:00,290 --> 00:35:00,300
because their execution rate falls it
 

1545
00:35:00,300 --> 00:35:02,359
because their execution rate falls it
will fall on an unbounded amount behind

1546
00:35:02,359 --> 00:35:02,369
will fall on an unbounded amount behind
 

1547
00:35:02,369 --> 00:35:04,700
will fall on an unbounded amount behind
the rate at which the leader has given

1548
00:35:04,700 --> 00:35:04,710
the rate at which the leader has given
 

1549
00:35:04,710 --> 00:35:06,200
the rate at which the leader has given
the messages sort of under the rules of

1550
00:35:06,200 --> 00:35:06,210
the messages sort of under the rules of
 

1551
00:35:06,210 --> 00:35:08,810
the messages sort of under the rules of
our game and so what that means they

1552
00:35:08,810 --> 00:35:08,820
our game and so what that means they
 

1553
00:35:08,820 --> 00:35:11,240
our game and so what that means they
will eventually run out of memory at

1554
00:35:11,240 --> 00:35:11,250
will eventually run out of memory at
 

1555
00:35:11,250 --> 00:35:13,430
will eventually run out of memory at
some point so after they have a billion

1556
00:35:13,430 --> 00:35:13,440
some point so after they have a billion
 

1557
00:35:13,440 --> 00:35:15,380
some point so after they have a billion
after they fall a billion log entries

1558
00:35:15,380 --> 00:35:15,390
after they fall a billion log entries
 

1559
00:35:15,390 --> 00:35:16,760
after they fall a billion log entries
behind those just like they'll call the

1560
00:35:16,760 --> 00:35:16,770
behind those just like they'll call the
 

1561
00:35:16,770 --> 00:35:18,500
behind those just like they'll call the
memory allocator for space for a new

1562
00:35:18,500 --> 00:35:18,510
memory allocator for space for a new
 

1563
00:35:18,510 --> 00:35:22,820
memory allocator for space for a new
blog entry and it will fail so yeah and

1564
00:35:22,820 --> 00:35:22,830
blog entry and it will fail so yeah and
 

1565
00:35:22,830 --> 00:35:27,410
blog entry and it will fail so yeah and
Raph doesn't Raph doesn't have the flow

1566
00:35:27,410 --> 00:35:27,420
Raph doesn't Raph doesn't have the flow
 

1567
00:35:27,420 --> 00:35:30,349
Raph doesn't Raph doesn't have the flow
controls that's required to cope with

1568
00:35:30,349 --> 00:35:30,359
controls that's required to cope with
 

1569
00:35:30,359 --> 00:35:34,339
controls that's required to cope with
this so I think in a real system you

1570
00:35:34,339 --> 00:35:34,349
this so I think in a real system you
 

1571
00:35:34,349 --> 00:35:36,170
this so I think in a real system you
would actually need you know probably

1572
00:35:36,170 --> 00:35:36,180
would actually need you know probably
 

1573
00:35:36,180 --> 00:35:37,760
would actually need you know probably
piggybacked and doesn't need to be

1574
00:35:37,760 --> 00:35:37,770
piggybacked and doesn't need to be
 

1575
00:35:37,770 --> 00:35:39,910
piggybacked and doesn't need to be
real-time but you probably need some

1576
00:35:39,910 --> 00:35:39,920
real-time but you probably need some
 

1577
00:35:39,920 --> 00:35:43,910
real-time but you probably need some
kind of additional communication here

1578
00:35:43,910 --> 00:35:43,920
kind of additional communication here
 

1579
00:35:43,920 --> 00:35:45,560
kind of additional communication here
that says well here's how far I've

1580
00:35:45,560 --> 00:35:45,570
that says well here's how far I've
 

1581
00:35:45,570 --> 00:35:48,140
that says well here's how far I've
gotten in execution so that the leader

1582
00:35:48,140 --> 00:35:48,150
gotten in execution so that the leader
 

1583
00:35:48,150 --> 00:35:50,510
gotten in execution so that the leader
can say well you know too many thousands

1584
00:35:50,510 --> 00:35:50,520
can say well you know too many thousands
 

1585
00:35:50,520 --> 00:35:53,089
can say well you know too many thousands
of requests ahead of the point in which

1586
00:35:53,089 --> 00:35:53,099
of requests ahead of the point in which
 

1587
00:35:53,099 --> 00:35:55,040
of requests ahead of the point in which
the followers have executed yes I think

1588
00:35:55,040 --> 00:35:55,050
the followers have executed yes I think
 

1589
00:35:55,050 --> 00:35:56,620
the followers have executed yes I think
there's probably you know in a

1590
00:35:56,620 --> 00:35:56,630
there's probably you know in a
 

1591
00:35:56,630 --> 00:35:58,849
there's probably you know in a
production system that you're trying to

1592
00:35:58,849 --> 00:35:58,859
production system that you're trying to
 

1593
00:35:58,859 --> 00:36:01,640
production system that you're trying to
push to the absolute max you would you

1594
00:36:01,640 --> 00:36:01,650
push to the absolute max you would you
 

1595
00:36:01,650 --> 00:36:03,290
push to the absolute max you would you
might well need an extra message to

1596
00:36:03,290 --> 00:36:03,300
might well need an extra message to
 

1597
00:36:03,300 --> 00:36:05,240
might well need an extra message to
throttle the leader if it got too far

1598
00:36:05,240 --> 00:36:05,250
throttle the leader if it got too far
 

1599
00:36:05,250 --> 00:36:31,690
throttle the leader if it got too far
ahead

1600
00:36:31,690 --> 00:36:31,700

 

1601
00:36:31,700 --> 00:36:36,069

okay so the question is if if one of

1602
00:36:36,069 --> 00:36:36,079
okay so the question is if if one of
 

1603
00:36:36,079 --> 00:36:38,289
okay so the question is if if one of
these servers crashes it has this log

1604
00:36:38,289 --> 00:36:38,299
these servers crashes it has this log
 

1605
00:36:38,299 --> 00:36:39,910
these servers crashes it has this log
that it persisted to disk because that's

1606
00:36:39,910 --> 00:36:39,920
that it persisted to disk because that's
 

1607
00:36:39,920 --> 00:36:42,880
that it persisted to disk because that's
one of the rules of figure two so the

1608
00:36:42,880 --> 00:36:42,890
one of the rules of figure two so the
 

1609
00:36:42,890 --> 00:36:43,930
one of the rules of figure two so the
server will be able to be just logged

1610
00:36:43,930 --> 00:36:43,940
server will be able to be just logged
 

1611
00:36:43,940 --> 00:36:47,020
server will be able to be just logged
back from disk but of course that server

1612
00:36:47,020 --> 00:36:47,030
back from disk but of course that server
 

1613
00:36:47,030 --> 00:36:49,809
back from disk but of course that server
doesn't know how far it got in executing

1614
00:36:49,809 --> 00:36:49,819
doesn't know how far it got in executing
 

1615
00:36:49,819 --> 00:36:52,539
doesn't know how far it got in executing
the log and also it doesn't know at

1616
00:36:52,539 --> 00:36:52,549
the log and also it doesn't know at
 

1617
00:36:52,549 --> 00:36:54,700
the log and also it doesn't know at
least when it first reboots by the rule

1618
00:36:54,700 --> 00:36:54,710
least when it first reboots by the rule
 

1619
00:36:54,710 --> 00:36:56,589
least when it first reboots by the rule
that figure two it doesn't even know how

1620
00:36:56,589 --> 00:36:56,599
that figure two it doesn't even know how
 

1621
00:36:56,599 --> 00:36:59,319
that figure two it doesn't even know how
much of the log is committed so the

1622
00:36:59,319 --> 00:36:59,329
much of the log is committed so the
 

1623
00:36:59,329 --> 00:37:00,609
much of the log is committed so the
first answer to your question is that

1624
00:37:00,609 --> 00:37:00,619
first answer to your question is that
 

1625
00:37:00,619 --> 00:37:03,910
first answer to your question is that
immediately after a restart you know

1626
00:37:03,910 --> 00:37:03,920
immediately after a restart you know
 

1627
00:37:03,920 --> 00:37:05,589
immediately after a restart you know
after a server crashes and restarts and

1628
00:37:05,589 --> 00:37:05,599
after a server crashes and restarts and
 

1629
00:37:05,599 --> 00:37:07,480
after a server crashes and restarts and
reads its log it is not allowed to do

1630
00:37:07,480 --> 00:37:07,490
reads its log it is not allowed to do
 

1631
00:37:07,490 --> 00:37:10,210
reads its log it is not allowed to do
anything with the log because it does

1632
00:37:10,210 --> 00:37:10,220
anything with the log because it does
 

1633
00:37:10,220 --> 00:37:11,859
anything with the log because it does
not know how far the system has

1634
00:37:11,859 --> 00:37:11,869
not know how far the system has
 

1635
00:37:11,869 --> 00:37:14,770
not know how far the system has
committed in its log maybe as long as

1636
00:37:14,770 --> 00:37:14,780
committed in its log maybe as long as
 

1637
00:37:14,780 --> 00:37:16,539
committed in its log maybe as long as
has a thousand uncommitted entries and

1638
00:37:16,539 --> 00:37:16,549
has a thousand uncommitted entries and
 

1639
00:37:16,549 --> 00:37:18,220
has a thousand uncommitted entries and
zero committed entries for all it notes

1640
00:37:18,220 --> 00:37:18,230
zero committed entries for all it notes
 

1641
00:37:18,230 --> 00:37:24,800
zero committed entries for all it notes
so

1642
00:37:24,800 --> 00:37:24,810

 

1643
00:37:24,810 --> 00:37:26,970

it's a leader dye support that doesn't

1644
00:37:26,970 --> 00:37:26,980
it's a leader dye support that doesn't
 

1645
00:37:26,980 --> 00:37:28,740
it's a leader dye support that doesn't
help either but let's suppose they've

1646
00:37:28,740 --> 00:37:28,750
help either but let's suppose they've
 

1647
00:37:28,750 --> 00:37:32,579
help either but let's suppose they've
all crashed this is getting ahead of its

1648
00:37:32,579 --> 00:37:32,589
all crashed this is getting ahead of its
 

1649
00:37:32,589 --> 00:37:33,660
all crashed this is getting ahead of its
getting a bit ahead of me but well

1650
00:37:33,660 --> 00:37:33,670
getting a bit ahead of me but well
 

1651
00:37:33,670 --> 00:37:34,800
getting a bit ahead of me but well
suppose they've all crashed and so all

1652
00:37:34,800 --> 00:37:34,810
suppose they've all crashed and so all
 

1653
00:37:34,810 --> 00:37:37,410
suppose they've all crashed and so all
they have is the state that was marked

1654
00:37:37,410 --> 00:37:37,420
they have is the state that was marked
 

1655
00:37:37,420 --> 00:37:40,170
they have is the state that was marked
as non-volatile in figure 2 which

1656
00:37:40,170 --> 00:37:40,180
as non-volatile in figure 2 which
 

1657
00:37:40,180 --> 00:37:42,060
as non-volatile in figure 2 which
includes the log and maybe the latest

1658
00:37:42,060 --> 00:37:42,070
includes the log and maybe the latest
 

1659
00:37:42,070 --> 00:37:45,300
includes the log and maybe the latest
term and so they don't know some if

1660
00:37:45,300 --> 00:37:45,310
term and so they don't know some if
 

1661
00:37:45,310 --> 00:37:46,859
term and so they don't know some if
there's a crash but they all crash and

1662
00:37:46,859 --> 00:37:46,869
there's a crash but they all crash and
 

1663
00:37:46,869 --> 00:37:48,680
there's a crash but they all crash and
they always start none of them knows

1664
00:37:48,680 --> 00:37:48,690
they always start none of them knows
 

1665
00:37:48,690 --> 00:37:52,859
they always start none of them knows
initially how far they had been have

1666
00:37:52,859 --> 00:37:52,869
initially how far they had been have
 

1667
00:37:52,869 --> 00:37:55,260
initially how far they had been have
executed before the crash so what

1668
00:37:55,260 --> 00:37:55,270
executed before the crash so what
 

1669
00:37:55,270 --> 00:37:57,420
executed before the crash so what
happens is that you leader election one

1670
00:37:57,420 --> 00:37:57,430
happens is that you leader election one
 

1671
00:37:57,430 --> 00:38:00,329
happens is that you leader election one
of them gets picked as a leader and that

1672
00:38:00,329 --> 00:38:00,339
of them gets picked as a leader and that
 

1673
00:38:00,339 --> 00:38:03,810
of them gets picked as a leader and that
leader if you sort of track through what

1674
00:38:03,810 --> 00:38:03,820
leader if you sort of track through what
 

1675
00:38:03,820 --> 00:38:06,510
leader if you sort of track through what
figure 2 says about how a pendant Rees

1676
00:38:06,510 --> 00:38:06,520
figure 2 says about how a pendant Rees
 

1677
00:38:06,520 --> 00:38:08,460
figure 2 says about how a pendant Rees
is supposed to work the leader will

1678
00:38:08,460 --> 00:38:08,470
is supposed to work the leader will
 

1679
00:38:08,470 --> 00:38:10,670
is supposed to work the leader will
actually figure out as a byproduct of

1680
00:38:10,670 --> 00:38:10,680
actually figure out as a byproduct of
 

1681
00:38:10,680 --> 00:38:12,810
actually figure out as a byproduct of
sending out a pendant or sending out the

1682
00:38:12,810 --> 00:38:12,820
sending out a pendant or sending out the
 

1683
00:38:12,820 --> 00:38:15,990
sending out a pendant or sending out the
first heartbeat really it'll fake it'll

1684
00:38:15,990 --> 00:38:16,000
first heartbeat really it'll fake it'll
 

1685
00:38:16,000 --> 00:38:19,680
first heartbeat really it'll fake it'll
figure out what the latest point is

1686
00:38:19,680 --> 00:38:19,690
figure out what the latest point is
 

1687
00:38:19,690 --> 00:38:28,290
figure out what the latest point is
basically that that all of the that a

1688
00:38:28,290 --> 00:38:28,300
basically that that all of the that a
 

1689
00:38:28,300 --> 00:38:30,930
basically that that all of the that a
majority of the replicas agree on their

1690
00:38:30,930 --> 00:38:30,940
majority of the replicas agree on their
 

1691
00:38:30,940 --> 00:38:33,680
majority of the replicas agree on their
laws because that's the commit point

1692
00:38:33,680 --> 00:38:33,690
laws because that's the commit point
 

1693
00:38:33,690 --> 00:38:35,640
laws because that's the commit point
another way of looking at it is that

1694
00:38:35,640 --> 00:38:35,650
another way of looking at it is that
 

1695
00:38:35,650 --> 00:38:37,740
another way of looking at it is that
once you choose a leader through the

1696
00:38:37,740 --> 00:38:37,750
once you choose a leader through the
 

1697
00:38:37,750 --> 00:38:39,480
once you choose a leader through the
append entries mechanism the leader

1698
00:38:39,480 --> 00:38:39,490
append entries mechanism the leader
 

1699
00:38:39,490 --> 00:38:41,550
append entries mechanism the leader
forces all of the other replicas to have

1700
00:38:41,550 --> 00:38:41,560
forces all of the other replicas to have
 

1701
00:38:41,560 --> 00:38:44,040
forces all of the other replicas to have
identical logs to the leader and at that

1702
00:38:44,040 --> 00:38:44,050
identical logs to the leader and at that
 

1703
00:38:44,050 --> 00:38:46,470
identical logs to the leader and at that
point plus a little bit of extra the

1704
00:38:46,470 --> 00:38:46,480
point plus a little bit of extra the
 

1705
00:38:46,480 --> 00:38:48,810
point plus a little bit of extra the
paper explains at that point since the

1706
00:38:48,810 --> 00:38:48,820
paper explains at that point since the
 

1707
00:38:48,820 --> 00:38:50,579
paper explains at that point since the
leader knows that it's forced all the

1708
00:38:50,579 --> 00:38:50,589
leader knows that it's forced all the
 

1709
00:38:50,589 --> 00:38:52,560
leader knows that it's forced all the
replicas to have it I didn't have logs

1710
00:38:52,560 --> 00:38:52,570
replicas to have it I didn't have logs
 

1711
00:38:52,570 --> 00:38:54,930
replicas to have it I didn't have logs
that are identicals to it then it knows

1712
00:38:54,930 --> 00:38:54,940
that are identicals to it then it knows
 

1713
00:38:54,940 --> 00:38:57,109
that are identicals to it then it knows
that all the replicas must also have a

1714
00:38:57,109 --> 00:38:57,119
that all the replicas must also have a
 

1715
00:38:57,119 --> 00:39:00,780
that all the replicas must also have a
there must be a majority of replicas

1716
00:39:00,780 --> 00:39:00,790
there must be a majority of replicas
 

1717
00:39:00,790 --> 00:39:03,150
there must be a majority of replicas
with that all those log injuries in that

1718
00:39:03,150 --> 00:39:03,160
with that all those log injuries in that
 

1719
00:39:03,160 --> 00:39:04,890
with that all those log injuries in that
logs which are now are identical must

1720
00:39:04,890 --> 00:39:04,900
logs which are now are identical must
 

1721
00:39:04,900 --> 00:39:06,060
logs which are now are identical must
also be committed because they're held

1722
00:39:06,060 --> 00:39:06,070
also be committed because they're held
 

1723
00:39:06,070 --> 00:39:09,870
also be committed because they're held
on a majority of replicas and at that

1724
00:39:09,870 --> 00:39:09,880
on a majority of replicas and at that
 

1725
00:39:09,880 --> 00:39:13,710
on a majority of replicas and at that
point a leader you know the append

1726
00:39:13,710 --> 00:39:13,720
point a leader you know the append
 

1727
00:39:13,720 --> 00:39:15,810
point a leader you know the append
entries code described in Figure 2 for

1728
00:39:15,810 --> 00:39:15,820
entries code described in Figure 2 for
 

1729
00:39:15,820 --> 00:39:17,790
entries code described in Figure 2 for
the leader will increment the leaders

1730
00:39:17,790 --> 00:39:17,800
the leader will increment the leaders
 

1731
00:39:17,800 --> 00:39:19,920
the leader will increment the leaders
commit point and everybody can now

1732
00:39:19,920 --> 00:39:19,930
commit point and everybody can now
 

1733
00:39:19,930 --> 00:39:21,810
commit point and everybody can now
execute the entire log from the

1734
00:39:21,810 --> 00:39:21,820
execute the entire log from the
 

1735
00:39:21,820 --> 00:39:24,390
execute the entire log from the
beginning and recreate their state from

1736
00:39:24,390 --> 00:39:24,400
beginning and recreate their state from
 

1737
00:39:24,400 --> 00:39:29,870
beginning and recreate their state from
scratch possibly extremely laborious Lee

1738
00:39:29,870 --> 00:39:29,880

 

1739
00:39:29,880 --> 00:39:32,640

so that's what figure two says it's

1740
00:39:32,640 --> 00:39:32,650
so that's what figure two says it's
 

1741
00:39:32,650 --> 00:39:34,920
so that's what figure two says it's
obviously this be executing from scratch

1742
00:39:34,920 --> 00:39:34,930
obviously this be executing from scratch
 

1743
00:39:34,930 --> 00:39:37,770
obviously this be executing from scratch
is not very attractive but it's where

1744
00:39:37,770 --> 00:39:37,780
is not very attractive but it's where
 

1745
00:39:37,780 --> 00:39:39,990
is not very attractive but it's where
the basic protocol does and we'll see

1746
00:39:39,990 --> 00:39:40,000
the basic protocol does and we'll see
 

1747
00:39:40,000 --> 00:39:42,960
the basic protocol does and we'll see
tomorrow that the the sort of version of

1748
00:39:42,960 --> 00:39:42,970
tomorrow that the the sort of version of
 

1749
00:39:42,970 --> 00:39:44,100
tomorrow that the the sort of version of
this is more efficient to use as

1750
00:39:44,100 --> 00:39:44,110
this is more efficient to use as
 

1751
00:39:44,110 --> 00:39:45,720
this is more efficient to use as
checkpoints and we'll talk about

1752
00:39:45,720 --> 00:39:45,730
checkpoints and we'll talk about
 

1753
00:39:45,730 --> 00:39:50,880
checkpoints and we'll talk about
tomorrow okay so this was a sequence in

1754
00:39:50,880 --> 00:39:50,890
tomorrow okay so this was a sequence in
 

1755
00:39:50,890 --> 00:39:55,370
tomorrow okay so this was a sequence in
sort of ordinary non failure operation

1756
00:39:55,370 --> 00:39:55,380

 

1757
00:39:55,380 --> 00:39:57,240

another thing I want to briefly mention

1758
00:39:57,240 --> 00:39:57,250
another thing I want to briefly mention
 

1759
00:39:57,250 --> 00:40:00,750
another thing I want to briefly mention
is what this interface looks like you've

1760
00:40:00,750 --> 00:40:00,760
is what this interface looks like you've
 

1761
00:40:00,760 --> 00:40:03,210
is what this interface looks like you've
probably all seen a little bit of it due

1762
00:40:03,210 --> 00:40:03,220
probably all seen a little bit of it due
 

1763
00:40:03,220 --> 00:40:05,400
probably all seen a little bit of it due
to working on the labs but roughly

1764
00:40:05,400 --> 00:40:05,410
to working on the labs but roughly
 

1765
00:40:05,410 --> 00:40:07,410
to working on the labs but roughly
speaking if you have let's say that this

1766
00:40:07,410 --> 00:40:07,420
speaking if you have let's say that this
 

1767
00:40:07,420 --> 00:40:12,390
speaking if you have let's say that this
key value layer with its state and the

1768
00:40:12,390 --> 00:40:12,400
key value layer with its state and the
 

1769
00:40:12,400 --> 00:40:15,990
key value layer with its state and the
raft layer underneath it there's on each

1770
00:40:15,990 --> 00:40:16,000
raft layer underneath it there's on each
 

1771
00:40:16,000 --> 00:40:18,320
raft layer underneath it there's on each
replica there's really two main pieces

1772
00:40:18,320 --> 00:40:18,330
replica there's really two main pieces
 

1773
00:40:18,330 --> 00:40:20,910
replica there's really two main pieces
of the interface between them there's

1774
00:40:20,910 --> 00:40:20,920
of the interface between them there's
 

1775
00:40:20,920 --> 00:40:24,000
of the interface between them there's
this method by which the key value layer

1776
00:40:24,000 --> 00:40:24,010
this method by which the key value layer
 

1777
00:40:24,010 --> 00:40:26,220
this method by which the key value layer
can relay if a client sends in a request

1778
00:40:26,220 --> 00:40:26,230
can relay if a client sends in a request
 

1779
00:40:26,230 --> 00:40:27,900
can relay if a client sends in a request
the key value layer has to give it to

1780
00:40:27,900 --> 00:40:27,910
the key value layer has to give it to
 

1781
00:40:27,910 --> 00:40:29,880
the key value layer has to give it to
wrap and say please you know fit this

1782
00:40:29,880 --> 00:40:29,890
wrap and say please you know fit this
 

1783
00:40:29,890 --> 00:40:31,410
wrap and say please you know fit this
request into the log somewhere and

1784
00:40:31,410 --> 00:40:31,420
request into the log somewhere and
 

1785
00:40:31,420 --> 00:40:36,750
request into the log somewhere and
that's the start function that you'll

1786
00:40:36,750 --> 00:40:36,760
that's the start function that you'll
 

1787
00:40:36,760 --> 00:40:40,410
that's the start function that you'll
see in Raph go and really just takes one

1788
00:40:40,410 --> 00:40:40,420
see in Raph go and really just takes one
 

1789
00:40:40,420 --> 00:40:44,340
see in Raph go and really just takes one
argument the client command the key

1790
00:40:44,340 --> 00:40:44,350
argument the client command the key
 

1791
00:40:44,350 --> 00:40:45,540
argument the client command the key
value they're saying please I got this

1792
00:40:45,540 --> 00:40:45,550
value they're saying please I got this
 

1793
00:40:45,550 --> 00:40:47,100
value they're saying please I got this
command to get into the log and tell me

1794
00:40:47,100 --> 00:40:47,110
command to get into the log and tell me
 

1795
00:40:47,110 --> 00:40:50,310
command to get into the log and tell me
when it's committed and the other piece

1796
00:40:50,310 --> 00:40:50,320
when it's committed and the other piece
 

1797
00:40:50,320 --> 00:40:54,300
when it's committed and the other piece
of the interface is that by and by the

1798
00:40:54,300 --> 00:40:54,310
of the interface is that by and by the
 

1799
00:40:54,310 --> 00:40:55,920
of the interface is that by and by the
raft layer will notify the key value

1800
00:40:55,920 --> 00:40:55,930
raft layer will notify the key value
 

1801
00:40:55,930 --> 00:40:58,170
raft layer will notify the key value
layer that AHA that operation that you

1802
00:40:58,170 --> 00:40:58,180
layer that AHA that operation that you
 

1803
00:40:58,180 --> 00:40:59,730
layer that AHA that operation that you
sent to me in a start command a while

1804
00:40:59,730 --> 00:40:59,740
sent to me in a start command a while
 

1805
00:40:59,740 --> 00:41:01,380
sent to me in a start command a while
ago which may well not be the most

1806
00:41:01,380 --> 00:41:01,390
ago which may well not be the most
 

1807
00:41:01,390 --> 00:41:03,420
ago which may well not be the most
recent start right there you know a

1808
00:41:03,420 --> 00:41:03,430
recent start right there you know a
 

1809
00:41:03,430 --> 00:41:05,310
recent start right there you know a
hundred client commands could come in

1810
00:41:05,310 --> 00:41:05,320
hundred client commands could come in
 

1811
00:41:05,320 --> 00:41:07,590
hundred client commands could come in
and cause calls to start before any of

1812
00:41:07,590 --> 00:41:07,600
and cause calls to start before any of
 

1813
00:41:07,600 --> 00:41:11,280
and cause calls to start before any of
them are committed so by and by this

1814
00:41:11,280 --> 00:41:11,290
them are committed so by and by this
 

1815
00:41:11,290 --> 00:41:14,250
them are committed so by and by this
upward communication is takes the form

1816
00:41:14,250 --> 00:41:14,260
upward communication is takes the form
 

1817
00:41:14,260 --> 00:41:16,620
upward communication is takes the form
of a message on a go channel that the

1818
00:41:16,620 --> 00:41:16,630
of a message on a go channel that the
 

1819
00:41:16,630 --> 00:41:20,160
of a message on a go channel that the
raft library sends on and key value

1820
00:41:20,160 --> 00:41:20,170
raft library sends on and key value
 

1821
00:41:20,170 --> 00:41:23,910
raft library sends on and key value
layer is supposed to read from so

1822
00:41:23,910 --> 00:41:23,920
layer is supposed to read from so
 

1823
00:41:23,920 --> 00:41:28,110
layer is supposed to read from so
there's this apply called the apply

1824
00:41:28,110 --> 00:41:28,120
there's this apply called the apply
 

1825
00:41:28,120 --> 00:41:31,350
there's this apply called the apply
channel and on it on it you send apply

1826
00:41:31,350 --> 00:41:31,360
channel and on it on it you send apply
 

1827
00:41:31,360 --> 00:41:37,430
channel and on it on it you send apply
message

1828
00:41:37,430 --> 00:41:37,440

 

1829
00:41:37,440 --> 00:41:39,630

this start and of course you need the

1830
00:41:39,630 --> 00:41:39,640
this start and of course you need the
 

1831
00:41:39,640 --> 00:41:42,300
this start and of course you need the
the key value layer needs to be able to

1832
00:41:42,300 --> 00:41:42,310
the key value layer needs to be able to
 

1833
00:41:42,310 --> 00:41:44,550
the key value layer needs to be able to
match up message that receives an apply

1834
00:41:44,550 --> 00:41:44,560
match up message that receives an apply
 

1835
00:41:44,560 --> 00:41:47,420
match up message that receives an apply
channel with calls to start that it made

1836
00:41:47,420 --> 00:41:47,430
channel with calls to start that it made
 

1837
00:41:47,430 --> 00:41:49,920
channel with calls to start that it made
and so the start command actually

1838
00:41:49,920 --> 00:41:49,930
and so the start command actually
 

1839
00:41:49,930 --> 00:41:52,589
and so the start command actually
returns enough information for that

1840
00:41:52,589 --> 00:41:52,599
returns enough information for that
 

1841
00:41:52,599 --> 00:41:54,240
returns enough information for that
matchup to happen it returns the index

1842
00:41:54,240 --> 00:41:54,250
matchup to happen it returns the index
 

1843
00:41:54,250 --> 00:41:58,530
matchup to happen it returns the index
that start functions basically returns

1844
00:41:58,530 --> 00:41:58,540
that start functions basically returns
 

1845
00:41:58,540 --> 00:42:00,450
that start functions basically returns
the index in the log where if this

1846
00:42:00,450 --> 00:42:00,460
the index in the log where if this
 

1847
00:42:00,460 --> 00:42:02,160
the index in the log where if this
command is committed which it might not

1848
00:42:02,160 --> 00:42:02,170
command is committed which it might not
 

1849
00:42:02,170 --> 00:42:05,670
command is committed which it might not
be it'll be committed at this index and

1850
00:42:05,670 --> 00:42:05,680
be it'll be committed at this index and
 

1851
00:42:05,680 --> 00:42:07,140
be it'll be committed at this index and
I think it also returns the current term

1852
00:42:07,140 --> 00:42:07,150
I think it also returns the current term
 

1853
00:42:07,150 --> 00:42:08,370
I think it also returns the current term
and some other stuff we don't care about

1854
00:42:08,370 --> 00:42:08,380
and some other stuff we don't care about
 

1855
00:42:08,380 --> 00:42:11,579
and some other stuff we don't care about
very much and then this apply message is

1856
00:42:11,579 --> 00:42:11,589
very much and then this apply message is
 

1857
00:42:11,589 --> 00:42:26,520
very much and then this apply message is
going to contain the index command and

1858
00:42:26,520 --> 00:42:26,530
going to contain the index command and
 

1859
00:42:26,530 --> 00:42:27,960
going to contain the index command and
all the replicas will get these apply

1860
00:42:27,960 --> 00:42:27,970
all the replicas will get these apply
 

1861
00:42:27,970 --> 00:42:29,760
all the replicas will get these apply
messages so they'll all know though I

1862
00:42:29,760 --> 00:42:29,770
messages so they'll all know though I
 

1863
00:42:29,770 --> 00:42:33,510
messages so they'll all know though I
should apply this command figure out

1864
00:42:33,510 --> 00:42:33,520
should apply this command figure out
 

1865
00:42:33,520 --> 00:42:35,160
should apply this command figure out
what this command means and apply it to

1866
00:42:35,160 --> 00:42:35,170
what this command means and apply it to
 

1867
00:42:35,170 --> 00:42:37,500
what this command means and apply it to
my local State and they also get the

1868
00:42:37,500 --> 00:42:37,510
my local State and they also get the
 

1869
00:42:37,510 --> 00:42:38,970
my local State and they also get the
index the index is really only useful

1870
00:42:38,970 --> 00:42:38,980
index the index is really only useful
 

1871
00:42:38,980 --> 00:42:42,270
index the index is really only useful
I'm the leader so it can figure out what

1872
00:42:42,270 --> 00:42:42,280
I'm the leader so it can figure out what
 

1873
00:42:42,280 --> 00:42:43,740
I'm the leader so it can figure out what
client would what client requests were

1874
00:42:43,740 --> 00:42:43,750
client would what client requests were
 

1875
00:42:43,750 --> 00:43:00,880
client would what client requests were
talking about

1876
00:43:00,880 --> 00:43:00,890

 

1877
00:43:00,890 --> 00:43:14,400

by

1878
00:43:14,400 --> 00:43:14,410

 

1879
00:43:14,410 --> 00:43:16,560

the answer a slightly different question

1880
00:43:16,560 --> 00:43:16,570
the answer a slightly different question
 

1881
00:43:16,570 --> 00:43:18,900
the answer a slightly different question
let's suppose the client sends any

1882
00:43:18,900 --> 00:43:18,910
let's suppose the client sends any
 

1883
00:43:18,910 --> 00:43:21,720
let's suppose the client sends any
request in let's say it's a put or a get

1884
00:43:21,720 --> 00:43:21,730
request in let's say it's a put or a get
 

1885
00:43:21,730 --> 00:43:23,400
request in let's say it's a put or a get
could be put or again it doesn't really

1886
00:43:23,400 --> 00:43:23,410
could be put or again it doesn't really
 

1887
00:43:23,410 --> 00:43:29,940
could be put or again it doesn't really
matter I'd say it to get the point in

1888
00:43:29,940 --> 00:43:29,950
matter I'd say it to get the point in
 

1889
00:43:29,950 --> 00:43:32,490
matter I'd say it to get the point in
which the it's a client sense and again

1890
00:43:32,490 --> 00:43:32,500
which the it's a client sense and again
 

1891
00:43:32,500 --> 00:43:33,900
which the it's a client sense and again
and waits for a response the point at

1892
00:43:33,900 --> 00:43:33,910
and waits for a response the point at
 

1893
00:43:33,910 --> 00:43:36,990
and waits for a response the point at
which the leader will send a response at

1894
00:43:36,990 --> 00:43:37,000
which the leader will send a response at
 

1895
00:43:37,000 --> 00:43:39,630
which the leader will send a response at
all is after the leader knows that

1896
00:43:39,630 --> 00:43:39,640
all is after the leader knows that
 

1897
00:43:39,640 --> 00:43:41,670
all is after the leader knows that
command is committed so this is going to

1898
00:43:41,670 --> 00:43:41,680
command is committed so this is going to
 

1899
00:43:41,680 --> 00:43:48,960
command is committed so this is going to
be a sort of get reply so the client

1900
00:43:48,960 --> 00:43:48,970
be a sort of get reply so the client
 

1901
00:43:48,970 --> 00:43:52,220
be a sort of get reply so the client
doesn't see anything back I mean and so

1902
00:43:52,220 --> 00:43:52,230
doesn't see anything back I mean and so
 

1903
00:43:52,230 --> 00:43:54,240
doesn't see anything back I mean and so
that means in terms of the actual

1904
00:43:54,240 --> 00:43:54,250
that means in terms of the actual
 

1905
00:43:54,250 --> 00:43:56,820
that means in terms of the actual
software stack that means that the key

1906
00:43:56,820 --> 00:43:56,830
software stack that means that the key
 

1907
00:43:56,830 --> 00:43:59,430
software stack that means that the key
value the RPC will arrive the key value

1908
00:43:59,430 --> 00:43:59,440
value the RPC will arrive the key value
 

1909
00:43:59,440 --> 00:44:02,010
value the RPC will arrive the key value
layer will call the start function the

1910
00:44:02,010 --> 00:44:02,020
layer will call the start function the
 

1911
00:44:02,020 --> 00:44:03,810
layer will call the start function the
start function will return to the key

1912
00:44:03,810 --> 00:44:03,820
start function will return to the key
 

1913
00:44:03,820 --> 00:44:06,690
start function will return to the key
value layer but the key value layer will

1914
00:44:06,690 --> 00:44:06,700
value layer but the key value layer will
 

1915
00:44:06,700 --> 00:44:08,640
value layer but the key value layer will
not yet reply to the client because it

1916
00:44:08,640 --> 00:44:08,650
not yet reply to the client because it
 

1917
00:44:08,650 --> 00:44:10,830
not yet reply to the client because it
does not know if it's good actually it

1918
00:44:10,830 --> 00:44:10,840
does not know if it's good actually it
 

1919
00:44:10,840 --> 00:44:12,540
does not know if it's good actually it
hasn't executed the clients request now

1920
00:44:12,540 --> 00:44:12,550
hasn't executed the clients request now
 

1921
00:44:12,550 --> 00:44:13,830
hasn't executed the clients request now
it doesn't even know if it ever will

1922
00:44:13,830 --> 00:44:13,840
it doesn't even know if it ever will
 

1923
00:44:13,840 --> 00:44:16,560
it doesn't even know if it ever will
because it's not sure if the request is

1924
00:44:16,560 --> 00:44:16,570
because it's not sure if the request is
 

1925
00:44:16,570 --> 00:44:18,810
because it's not sure if the request is
going to be committed right in the

1926
00:44:18,810 --> 00:44:18,820
going to be committed right in the
 

1927
00:44:18,820 --> 00:44:20,490
going to be committed right in the
situation which may not be committed is

1928
00:44:20,490 --> 00:44:20,500
situation which may not be committed is
 

1929
00:44:20,500 --> 00:44:23,580
situation which may not be committed is
if the key value layer you know guess

1930
00:44:23,580 --> 00:44:23,590
if the key value layer you know guess
 

1931
00:44:23,590 --> 00:44:25,260
if the key value layer you know guess
the request calls start and immediately

1932
00:44:25,260 --> 00:44:25,270
the request calls start and immediately
 

1933
00:44:25,270 --> 00:44:27,150
the request calls start and immediately
after starboard turn two crashes right

1934
00:44:27,150 --> 00:44:27,160
after starboard turn two crashes right
 

1935
00:44:27,160 --> 00:44:28,950
after starboard turn two crashes right
certainly hasn't sent out its apply what

1936
00:44:28,950 --> 00:44:28,960
certainly hasn't sent out its apply what
 

1937
00:44:28,960 --> 00:44:30,210
certainly hasn't sent out its apply what
append messages or whatever

1938
00:44:30,210 --> 00:44:30,220
append messages or whatever
 

1939
00:44:30,220 --> 00:44:33,510
append messages or whatever
nothing's be committed yep so so the

1940
00:44:33,510 --> 00:44:33,520
nothing's be committed yep so so the
 

1941
00:44:33,520 --> 00:44:36,590
nothing's be committed yep so so the
game is start returns time passes the

1942
00:44:36,590 --> 00:44:36,600
game is start returns time passes the
 

1943
00:44:36,600 --> 00:44:40,710
game is start returns time passes the
relevant apply message corresponding to

1944
00:44:40,710 --> 00:44:40,720
relevant apply message corresponding to
 

1945
00:44:40,720 --> 00:44:42,480
relevant apply message corresponding to
that client request appears to the key

1946
00:44:42,480 --> 00:44:42,490
that client request appears to the key
 

1947
00:44:42,490 --> 00:44:44,190
that client request appears to the key
value server on the apply channel and

1948
00:44:44,190 --> 00:44:44,200
value server on the apply channel and
 

1949
00:44:44,200 --> 00:44:47,430
value server on the apply channel and
only then and that causes the key value

1950
00:44:47,430 --> 00:44:47,440
only then and that causes the key value
 

1951
00:44:47,440 --> 00:44:50,640
only then and that causes the key value
server to execute the request and send

1952
00:44:50,640 --> 00:44:50,650
server to execute the request and send
 

1953
00:44:50,650 --> 00:44:58,220
server to execute the request and send
her a plot

1954
00:44:58,220 --> 00:44:58,230

 

1955
00:44:58,230 --> 00:45:00,150

and that's like all this is very

1956
00:45:00,150 --> 00:45:00,160
and that's like all this is very
 

1957
00:45:00,160 --> 00:45:02,160
and that's like all this is very
important when it doesn't really matter

1958
00:45:02,160 --> 00:45:02,170
important when it doesn't really matter
 

1959
00:45:02,170 --> 00:45:04,350
important when it doesn't really matter
if all everything goes well but if

1960
00:45:04,350 --> 00:45:04,360
if all everything goes well but if
 

1961
00:45:04,360 --> 00:45:06,630
if all everything goes well but if
there's a failure we're now at the point

1962
00:45:06,630 --> 00:45:06,640
there's a failure we're now at the point
 

1963
00:45:06,640 --> 00:45:07,770
there's a failure we're now at the point
where we start worrying about theatres I

1964
00:45:07,770 --> 00:45:07,780
where we start worrying about theatres I
 

1965
00:45:07,780 --> 00:45:09,750
where we start worrying about theatres I
mean extremely interested in if there

1966
00:45:09,750 --> 00:45:09,760
mean extremely interested in if there
 

1967
00:45:09,760 --> 00:45:13,940
mean extremely interested in if there
was a failure what did the client see

1968
00:45:13,940 --> 00:45:13,950

 

1969
00:45:13,950 --> 00:45:18,540

all right and so one thing that does

1970
00:45:18,540 --> 00:45:18,550
all right and so one thing that does
 

1971
00:45:18,550 --> 00:45:23,700
all right and so one thing that does
come up is that all of you should be

1972
00:45:23,700 --> 00:45:23,710
come up is that all of you should be
 

1973
00:45:23,710 --> 00:45:24,930
come up is that all of you should be
familiar with this that at least

1974
00:45:24,930 --> 00:45:24,940
familiar with this that at least
 

1975
00:45:24,940 --> 00:45:26,700
familiar with this that at least
initially one interesting thing about

1976
00:45:26,700 --> 00:45:26,710
initially one interesting thing about
 

1977
00:45:26,710 --> 00:45:28,530
initially one interesting thing about
the logs is that they may not be

1978
00:45:28,530 --> 00:45:28,540
the logs is that they may not be
 

1979
00:45:28,540 --> 00:45:30,750
the logs is that they may not be
identical there are a whole bunch of

1980
00:45:30,750 --> 00:45:30,760
identical there are a whole bunch of
 

1981
00:45:30,760 --> 00:45:33,810
identical there are a whole bunch of
situations in which at least for brief

1982
00:45:33,810 --> 00:45:33,820
situations in which at least for brief
 

1983
00:45:33,820 --> 00:45:36,359
situations in which at least for brief
periods of time the ends of the

1984
00:45:36,359 --> 00:45:36,369
periods of time the ends of the
 

1985
00:45:36,369 --> 00:45:39,150
periods of time the ends of the
different replicas logs may diverge like

1986
00:45:39,150 --> 00:45:39,160
different replicas logs may diverge like
 

1987
00:45:39,160 --> 00:45:41,700
different replicas logs may diverge like
for example if a leader starts to send

1988
00:45:41,700 --> 00:45:41,710
for example if a leader starts to send
 

1989
00:45:41,710 --> 00:45:43,380
for example if a leader starts to send
out a round of append messages but

1990
00:45:43,380 --> 00:45:43,390
out a round of append messages but
 

1991
00:45:43,390 --> 00:45:45,150
out a round of append messages but
crashes before it's able to send all

1992
00:45:45,150 --> 00:45:45,160
crashes before it's able to send all
 

1993
00:45:45,160 --> 00:45:46,890
crashes before it's able to send all
them out you know that'll mean that some

1994
00:45:46,890 --> 00:45:46,900
them out you know that'll mean that some
 

1995
00:45:46,900 --> 00:45:48,090
them out you know that'll mean that some
of the replicas that got the append

1996
00:45:48,090 --> 00:45:48,100
of the replicas that got the append
 

1997
00:45:48,100 --> 00:45:50,490
of the replicas that got the append
message will append you know that new

1998
00:45:50,490 --> 00:45:50,500
message will append you know that new
 

1999
00:45:50,500 --> 00:45:51,930
message will append you know that new
log entry and the ones that didn't get

2000
00:45:51,930 --> 00:45:51,940
log entry and the ones that didn't get
 

2001
00:45:51,940 --> 00:45:54,390
log entry and the ones that didn't get
that append messages RPC won't have

2002
00:45:54,390 --> 00:45:54,400
that append messages RPC won't have
 

2003
00:45:54,400 --> 00:45:56,430
that append messages RPC won't have
appended them so it's easy to see that

2004
00:45:56,430 --> 00:45:56,440
appended them so it's easy to see that
 

2005
00:45:56,440 --> 00:45:58,970
appended them so it's easy to see that
the logs are I'm gonna diverge sometimes

2006
00:45:58,970 --> 00:45:58,980
the logs are I'm gonna diverge sometimes
 

2007
00:45:58,980 --> 00:46:02,849
the logs are I'm gonna diverge sometimes
the good news is that the the way a raft

2008
00:46:02,849 --> 00:46:02,859
the good news is that the the way a raft
 

2009
00:46:02,859 --> 00:46:05,370
the good news is that the the way a raft
works actually ends up forcing the logs

2010
00:46:05,370 --> 00:46:05,380
works actually ends up forcing the logs
 

2011
00:46:05,380 --> 00:46:08,220
works actually ends up forcing the logs
to be identical after a while there may

2012
00:46:08,220 --> 00:46:08,230
to be identical after a while there may
 

2013
00:46:08,230 --> 00:46:10,470
to be identical after a while there may
be transient differences but in the long

2014
00:46:10,470 --> 00:46:10,480
be transient differences but in the long
 

2015
00:46:10,480 --> 00:46:13,230
be transient differences but in the long
run all the logs will sort of be

2016
00:46:13,230 --> 00:46:13,240
run all the logs will sort of be
 

2017
00:46:13,240 --> 00:46:15,330
run all the logs will sort of be
modified by the leader until the leader

2018
00:46:15,330 --> 00:46:15,340
modified by the leader until the leader
 

2019
00:46:15,340 --> 00:46:17,130
modified by the leader until the leader
insurers are all identical and only then

2020
00:46:17,130 --> 00:46:17,140
insurers are all identical and only then
 

2021
00:46:17,140 --> 00:46:24,480
insurers are all identical and only then
are they executed okay so I think the

2022
00:46:24,480 --> 00:46:24,490
are they executed okay so I think the
 

2023
00:46:24,490 --> 00:46:27,180
are they executed okay so I think the
next there's really two big topics to

2024
00:46:27,180 --> 00:46:27,190
next there's really two big topics to
 

2025
00:46:27,190 --> 00:46:29,280
next there's really two big topics to
talk about here for raft one is how

2026
00:46:29,280 --> 00:46:29,290
talk about here for raft one is how
 

2027
00:46:29,290 --> 00:46:31,440
talk about here for raft one is how
leader election works which is lab two

2028
00:46:31,440 --> 00:46:31,450
leader election works which is lab two
 

2029
00:46:31,450 --> 00:46:35,160
leader election works which is lab two
and the other is how the leader deals

2030
00:46:35,160 --> 00:46:35,170
and the other is how the leader deals
 

2031
00:46:35,170 --> 00:46:37,260
and the other is how the leader deals
with the different replicas logs

2032
00:46:37,260 --> 00:46:37,270
with the different replicas logs
 

2033
00:46:37,270 --> 00:46:39,690
with the different replicas logs
particularly after failure so first I

2034
00:46:39,690 --> 00:46:39,700
particularly after failure so first I
 

2035
00:46:39,700 --> 00:46:44,930
particularly after failure so first I
want to talk about leader election

2036
00:46:44,930 --> 00:46:44,940

 

2037
00:46:44,940 --> 00:46:47,370

question to ask is how come the system

2038
00:46:47,370 --> 00:46:47,380
question to ask is how come the system
 

2039
00:46:47,380 --> 00:46:48,870
question to ask is how come the system
even has a leader why do we need a

2040
00:46:48,870 --> 00:46:48,880
even has a leader why do we need a
 

2041
00:46:48,880 --> 00:46:51,810
even has a leader why do we need a
leader the part of the answer is you do

2042
00:46:51,810 --> 00:46:51,820
leader the part of the answer is you do
 

2043
00:46:51,820 --> 00:46:53,700
leader the part of the answer is you do
not need a leader to build a system like

2044
00:46:53,700 --> 00:46:53,710
not need a leader to build a system like
 

2045
00:46:53,710 --> 00:46:56,880
not need a leader to build a system like
this you it is possible to build an

2046
00:46:56,880 --> 00:46:56,890
this you it is possible to build an
 

2047
00:46:56,890 --> 00:46:59,130
this you it is possible to build an
agreement system by which a cluster of

2048
00:46:59,130 --> 00:46:59,140
agreement system by which a cluster of
 

2049
00:46:59,140 --> 00:47:02,130
agreement system by which a cluster of
servers agrees you know the sequence of

2050
00:47:02,130 --> 00:47:02,140
servers agrees you know the sequence of
 

2051
00:47:02,140 --> 00:47:04,200
servers agrees you know the sequence of
entries in a log without having any kind

2052
00:47:04,200 --> 00:47:04,210
entries in a log without having any kind
 

2053
00:47:04,210 --> 00:47:05,730
entries in a log without having any kind
of designated leader

2054
00:47:05,730 --> 00:47:05,740
of designated leader
 

2055
00:47:05,740 --> 00:47:07,950
of designated leader
and indeed the original pack so system

2056
00:47:07,950 --> 00:47:07,960
and indeed the original pack so system
 

2057
00:47:07,960 --> 00:47:09,900
and indeed the original pack so system
which the paper refers to original Paxos

2058
00:47:09,900 --> 00:47:09,910
which the paper refers to original Paxos
 

2059
00:47:09,910 --> 00:47:13,140
which the paper refers to original Paxos
did not have a leader so it's possible

2060
00:47:13,140 --> 00:47:13,150
did not have a leader so it's possible
 

2061
00:47:13,150 --> 00:47:15,450
did not have a leader so it's possible
the reason why raft has a leader is

2062
00:47:15,450 --> 00:47:15,460
the reason why raft has a leader is
 

2063
00:47:15,460 --> 00:47:18,780
the reason why raft has a leader is
basically that there's probably a lot of

2064
00:47:18,780 --> 00:47:18,790
basically that there's probably a lot of
 

2065
00:47:18,790 --> 00:47:20,370
basically that there's probably a lot of
reasons but one of the foremost reasons

2066
00:47:20,370 --> 00:47:20,380
reasons but one of the foremost reasons
 

2067
00:47:20,380 --> 00:47:22,140
reasons but one of the foremost reasons
is that you can build a more efficient

2068
00:47:22,140 --> 00:47:22,150
is that you can build a more efficient
 

2069
00:47:22,150 --> 00:47:24,390
is that you can build a more efficient
in the common case in which the server's

2070
00:47:24,390 --> 00:47:24,400
in the common case in which the server's
 

2071
00:47:24,400 --> 00:47:27,120
in the common case in which the server's
don't fail it's possible to build a more

2072
00:47:27,120 --> 00:47:27,130
don't fail it's possible to build a more
 

2073
00:47:27,130 --> 00:47:28,650
don't fail it's possible to build a more
efficient system if you have a leader

2074
00:47:28,650 --> 00:47:28,660
efficient system if you have a leader
 

2075
00:47:28,660 --> 00:47:30,630
efficient system if you have a leader
because with a designated leader

2076
00:47:30,630 --> 00:47:30,640
because with a designated leader
 

2077
00:47:30,640 --> 00:47:33,300
because with a designated leader
everybody knows who the leader is you

2078
00:47:33,300 --> 00:47:33,310
everybody knows who the leader is you
 

2079
00:47:33,310 --> 00:47:37,530
everybody knows who the leader is you
can basically get agreement on requests

2080
00:47:37,530 --> 00:47:37,540
can basically get agreement on requests
 

2081
00:47:37,540 --> 00:47:39,270
can basically get agreement on requests
that with one round of messages per

2082
00:47:39,270 --> 00:47:39,280
that with one round of messages per
 

2083
00:47:39,280 --> 00:47:41,460
that with one round of messages per
request where as leader of this systems

2084
00:47:41,460 --> 00:47:41,470
request where as leader of this systems
 

2085
00:47:41,470 --> 00:47:43,470
request where as leader of this systems
have more of the flavor of well you need

2086
00:47:43,470 --> 00:47:43,480
have more of the flavor of well you need
 

2087
00:47:43,480 --> 00:47:45,570
have more of the flavor of well you need
a first round to kind of agree on a

2088
00:47:45,570 --> 00:47:45,580
a first round to kind of agree on a
 

2089
00:47:45,580 --> 00:47:47,609
a first round to kind of agree on a
temporary leader and then a second round

2090
00:47:47,609 --> 00:47:47,619
temporary leader and then a second round
 

2091
00:47:47,619 --> 00:47:50,609
temporary leader and then a second round
actually send out the requests so it's

2092
00:47:50,609 --> 00:47:50,619
actually send out the requests so it's
 

2093
00:47:50,619 --> 00:47:53,450
actually send out the requests so it's
probably the case that use of a leader

2094
00:47:53,450 --> 00:47:53,460
probably the case that use of a leader
 

2095
00:47:53,460 --> 00:47:56,600
probably the case that use of a leader
now speeds up the system by a factor two

2096
00:47:56,600 --> 00:47:56,610
now speeds up the system by a factor two
 

2097
00:47:56,610 --> 00:47:58,740
now speeds up the system by a factor two
and it also makes it sort of easier to

2098
00:47:58,740 --> 00:47:58,750
and it also makes it sort of easier to
 

2099
00:47:58,750 --> 00:48:04,200
and it also makes it sort of easier to
think about what's going on raft goes

2100
00:48:04,200 --> 00:48:04,210
think about what's going on raft goes
 

2101
00:48:04,210 --> 00:48:08,670
think about what's going on raft goes
through a sequence of leaders and it

2102
00:48:08,670 --> 00:48:08,680
through a sequence of leaders and it
 

2103
00:48:08,680 --> 00:48:11,160
through a sequence of leaders and it
uses these term numbers in order to sort

2104
00:48:11,160 --> 00:48:11,170
uses these term numbers in order to sort
 

2105
00:48:11,170 --> 00:48:13,230
uses these term numbers in order to sort
of disambiguate which leader we're

2106
00:48:13,230 --> 00:48:13,240
of disambiguate which leader we're
 

2107
00:48:13,240 --> 00:48:14,340
of disambiguate which leader we're
talking about it turns out that

2108
00:48:14,340 --> 00:48:14,350
talking about it turns out that
 

2109
00:48:14,350 --> 00:48:15,599
talking about it turns out that
followers don't really need to know the

2110
00:48:15,599 --> 00:48:15,609
followers don't really need to know the
 

2111
00:48:15,609 --> 00:48:17,370
followers don't really need to know the
identity of the leader they really just

2112
00:48:17,370 --> 00:48:17,380
identity of the leader they really just
 

2113
00:48:17,380 --> 00:48:18,510
identity of the leader they really just
need to know what the current term

2114
00:48:18,510 --> 00:48:18,520
need to know what the current term
 

2115
00:48:18,520 --> 00:48:23,190
need to know what the current term
number is each term has at most one

2116
00:48:23,190 --> 00:48:23,200
number is each term has at most one
 

2117
00:48:23,200 --> 00:48:25,980
number is each term has at most one
leader that's a critical property you

2118
00:48:25,980 --> 00:48:25,990
leader that's a critical property you
 

2119
00:48:25,990 --> 00:48:27,359
leader that's a critical property you
know for every term there might be no

2120
00:48:27,359 --> 00:48:27,369
know for every term there might be no
 

2121
00:48:27,369 --> 00:48:29,010
know for every term there might be no
leader during that term or there might

2122
00:48:29,010 --> 00:48:29,020
leader during that term or there might
 

2123
00:48:29,020 --> 00:48:31,349
leader during that term or there might
be one leader but there cannot be two

2124
00:48:31,349 --> 00:48:31,359
be one leader but there cannot be two
 

2125
00:48:31,359 --> 00:48:34,170
be one leader but there cannot be two
leaders during the same term every term

2126
00:48:34,170 --> 00:48:34,180
leaders during the same term every term
 

2127
00:48:34,180 --> 00:48:42,180
leaders during the same term every term
has it must most one leader how do the

2128
00:48:42,180 --> 00:48:42,190
has it must most one leader how do the
 

2129
00:48:42,190 --> 00:48:44,480
has it must most one leader how do the
leaders get created in the first place

2130
00:48:44,480 --> 00:48:44,490
leaders get created in the first place
 

2131
00:48:44,490 --> 00:48:48,090
leaders get created in the first place
every raft server keeps this election

2132
00:48:48,090 --> 00:48:48,100
every raft server keeps this election
 

2133
00:48:48,100 --> 00:48:50,190
every raft server keeps this election
timer which is just a it's basically

2134
00:48:50,190 --> 00:48:50,200
timer which is just a it's basically
 

2135
00:48:50,200 --> 00:48:52,020
timer which is just a it's basically
just out of time that it has recorded

2136
00:48:52,020 --> 00:48:52,030
just out of time that it has recorded
 

2137
00:48:52,030 --> 00:48:54,120
just out of time that it has recorded
that says well if that time occurs I'm

2138
00:48:54,120 --> 00:48:54,130
that says well if that time occurs I'm
 

2139
00:48:54,130 --> 00:48:56,310
that says well if that time occurs I'm
going to do something and the something

2140
00:48:56,310 --> 00:48:56,320
going to do something and the something
 

2141
00:48:56,320 --> 00:48:59,190
going to do something and the something
that it does is that if an entire leader

2142
00:48:59,190 --> 00:48:59,200
that it does is that if an entire leader
 

2143
00:48:59,200 --> 00:49:02,460
that it does is that if an entire leader
election period expires without the

2144
00:49:02,460 --> 00:49:02,470
election period expires without the
 

2145
00:49:02,470 --> 00:49:04,470
election period expires without the
server having heard any message from the

2146
00:49:04,470 --> 00:49:04,480
server having heard any message from the
 

2147
00:49:04,480 --> 00:49:08,130
server having heard any message from the
current leader then the server sort of

2148
00:49:08,130 --> 00:49:08,140
current leader then the server sort of
 

2149
00:49:08,140 --> 00:49:10,020
current leader then the server sort of
assumes probably that the current leader

2150
00:49:10,020 --> 00:49:10,030
assumes probably that the current leader
 

2151
00:49:10,030 --> 00:49:12,570
assumes probably that the current leader
is dead and starts an election so we

2152
00:49:12,570 --> 00:49:12,580
is dead and starts an election so we
 

2153
00:49:12,580 --> 00:49:17,859
is dead and starts an election so we
have this election timer

2154
00:49:17,859 --> 00:49:17,869

 

2155
00:49:17,869 --> 00:49:28,450

and if it expires we start an election

2156
00:49:28,450 --> 00:49:28,460

 

2157
00:49:28,460 --> 00:49:30,680

and what it means to start an election

2158
00:49:30,680 --> 00:49:30,690
and what it means to start an election
 

2159
00:49:30,690 --> 00:49:35,560
and what it means to start an election
is basically that you increment the term

2160
00:49:35,560 --> 00:49:35,570
is basically that you increment the term
 

2161
00:49:35,570 --> 00:49:38,480
is basically that you increment the term
the the candidate the server that's

2162
00:49:38,480 --> 00:49:38,490
the the candidate the server that's
 

2163
00:49:38,490 --> 00:49:39,920
the the candidate the server that's
decided it's going to be a candidate and

2164
00:49:39,920 --> 00:49:39,930
decided it's going to be a candidate and
 

2165
00:49:39,930 --> 00:49:41,510
decided it's going to be a candidate and
sort of force a new election first

2166
00:49:41,510 --> 00:49:41,520
sort of force a new election first
 

2167
00:49:41,520 --> 00:49:43,940
sort of force a new election first
increments this term because it wants

2168
00:49:43,940 --> 00:49:43,950
increments this term because it wants
 

2169
00:49:43,950 --> 00:49:45,440
increments this term because it wants
them to be a new leader namely itself

2170
00:49:45,440 --> 00:49:45,450
them to be a new leader namely itself
 

2171
00:49:45,450 --> 00:49:47,870
them to be a new leader namely itself
and you know leader a term can't have

2172
00:49:47,870 --> 00:49:47,880
and you know leader a term can't have
 

2173
00:49:47,880 --> 00:49:49,160
and you know leader a term can't have
more than one leader so we got to start

2174
00:49:49,160 --> 00:49:49,170
more than one leader so we got to start
 

2175
00:49:49,170 --> 00:49:51,760
more than one leader so we got to start
a new term in order to have a new leader

2176
00:49:51,760 --> 00:49:51,770
a new term in order to have a new leader
 

2177
00:49:51,770 --> 00:49:54,560
a new term in order to have a new leader
and then it sends out these requests

2178
00:49:54,560 --> 00:49:54,570
and then it sends out these requests
 

2179
00:49:54,570 --> 00:50:00,830
and then it sends out these requests
boats are pea seeds I'm going to send

2180
00:50:00,830 --> 00:50:00,840
boats are pea seeds I'm going to send
 

2181
00:50:00,840 --> 00:50:02,810
boats are pea seeds I'm going to send
out a full round of request votes and

2182
00:50:02,810 --> 00:50:02,820
out a full round of request votes and
 

2183
00:50:02,820 --> 00:50:05,120
out a full round of request votes and
you may only have to send out n minus

2184
00:50:05,120 --> 00:50:05,130
you may only have to send out n minus
 

2185
00:50:05,130 --> 00:50:06,440
you may only have to send out n minus
one requests votes because one of the

2186
00:50:06,440 --> 00:50:06,450
one requests votes because one of the
 

2187
00:50:06,450 --> 00:50:08,330
one requests votes because one of the
rules is that a new candidate always

2188
00:50:08,330 --> 00:50:08,340
rules is that a new candidate always
 

2189
00:50:08,340 --> 00:50:13,520
rules is that a new candidate always
votes for itself in the election so one

2190
00:50:13,520 --> 00:50:13,530
votes for itself in the election so one
 

2191
00:50:13,530 --> 00:50:16,460
votes for itself in the election so one
thing to note about this is that it's

2192
00:50:16,460 --> 00:50:16,470
thing to note about this is that it's
 

2193
00:50:16,470 --> 00:50:17,960
thing to note about this is that it's
not quite the case that if the leader

2194
00:50:17,960 --> 00:50:17,970
not quite the case that if the leader
 

2195
00:50:17,970 --> 00:50:19,370
not quite the case that if the leader
didn't fail we won't have an election

2196
00:50:19,370 --> 00:50:19,380
didn't fail we won't have an election
 

2197
00:50:19,380 --> 00:50:22,340
didn't fail we won't have an election
but if the leader does fail then we will

2198
00:50:22,340 --> 00:50:22,350
but if the leader does fail then we will
 

2199
00:50:22,350 --> 00:50:24,470
but if the leader does fail then we will
have election an election assuming any

2200
00:50:24,470 --> 00:50:24,480
have election an election assuming any
 

2201
00:50:24,480 --> 00:50:26,390
have election an election assuming any
other server is up because some day the

2202
00:50:26,390 --> 00:50:26,400
other server is up because some day the
 

2203
00:50:26,400 --> 00:50:28,220
other server is up because some day the
other servers election timers go will go

2204
00:50:28,220 --> 00:50:28,230
other servers election timers go will go
 

2205
00:50:28,230 --> 00:50:30,230
other servers election timers go will go
off but as leader didn't fail we might

2206
00:50:30,230 --> 00:50:30,240
off but as leader didn't fail we might
 

2207
00:50:30,240 --> 00:50:32,390
off but as leader didn't fail we might
still unfortunately get an election so

2208
00:50:32,390 --> 00:50:32,400
still unfortunately get an election so
 

2209
00:50:32,400 --> 00:50:34,910
still unfortunately get an election so
if the network is slow or drops a few

2210
00:50:34,910 --> 00:50:34,920
if the network is slow or drops a few
 

2211
00:50:34,920 --> 00:50:37,040
if the network is slow or drops a few
heartbeats or something we may end up

2212
00:50:37,040 --> 00:50:37,050
heartbeats or something we may end up
 

2213
00:50:37,050 --> 00:50:38,810
heartbeats or something we may end up
having election timers go off and even

2214
00:50:38,810 --> 00:50:38,820
having election timers go off and even
 

2215
00:50:38,820 --> 00:50:40,430
having election timers go off and even
though there was a perfectly good leader

2216
00:50:40,430 --> 00:50:40,440
though there was a perfectly good leader
 

2217
00:50:40,440 --> 00:50:42,380
though there was a perfectly good leader
we may nevertheless have a new election

2218
00:50:42,380 --> 00:50:42,390
we may nevertheless have a new election
 

2219
00:50:42,390 --> 00:50:43,730
we may nevertheless have a new election
so we have to sort of keep that in mind

2220
00:50:43,730 --> 00:50:43,740
so we have to sort of keep that in mind
 

2221
00:50:43,740 --> 00:50:44,630
so we have to sort of keep that in mind
when we're thinking about the

2222
00:50:44,630 --> 00:50:44,640
when we're thinking about the
 

2223
00:50:44,640 --> 00:50:48,500
when we're thinking about the
correctness and what that in turn means

2224
00:50:48,500 --> 00:50:48,510
correctness and what that in turn means
 

2225
00:50:48,510 --> 00:50:50,359
correctness and what that in turn means
is that if there's a new election it

2226
00:50:50,359 --> 00:50:50,369
is that if there's a new election it
 

2227
00:50:50,369 --> 00:50:52,400
is that if there's a new election it
could easily be the case that the old

2228
00:50:52,400 --> 00:50:52,410
could easily be the case that the old
 

2229
00:50:52,410 --> 00:50:54,349
could easily be the case that the old
leader is still hanging around and still

2230
00:50:54,349 --> 00:50:54,359
leader is still hanging around and still
 

2231
00:50:54,359 --> 00:50:56,180
leader is still hanging around and still
thinks it's the leader like if there's a

2232
00:50:56,180 --> 00:50:56,190
thinks it's the leader like if there's a
 

2233
00:50:56,190 --> 00:50:58,700
thinks it's the leader like if there's a
network partition for example and the

2234
00:50:58,700 --> 00:50:58,710
network partition for example and the
 

2235
00:50:58,710 --> 00:51:00,859
network partition for example and the
old leader is still alive and well in a

2236
00:51:00,859 --> 00:51:00,869
old leader is still alive and well in a
 

2237
00:51:00,869 --> 00:51:03,349
old leader is still alive and well in a
minority partition the majority

2238
00:51:03,349 --> 00:51:03,359
minority partition the majority
 

2239
00:51:03,359 --> 00:51:05,270
minority partition the majority
partition may run an election and indeed

2240
00:51:05,270 --> 00:51:05,280
partition may run an election and indeed
 

2241
00:51:05,280 --> 00:51:06,859
partition may run an election and indeed
a successful election and choose a new

2242
00:51:06,859 --> 00:51:06,869
a successful election and choose a new
 

2243
00:51:06,869 --> 00:51:09,980
a successful election and choose a new
leader all totally unknown to the

2244
00:51:09,980 --> 00:51:09,990
leader all totally unknown to the
 

2245
00:51:09,990 --> 00:51:11,870
leader all totally unknown to the
previous leader so we also have to worry

2246
00:51:11,870 --> 00:51:11,880
previous leader so we also have to worry
 

2247
00:51:11,880 --> 00:51:13,520
previous leader so we also have to worry
about you know what's that previous

2248
00:51:13,520 --> 00:51:13,530
about you know what's that previous
 

2249
00:51:13,530 --> 00:51:15,410
about you know what's that previous
leader gonna do since it does not know

2250
00:51:15,410 --> 00:51:15,420
leader gonna do since it does not know
 

2251
00:51:15,420 --> 00:51:42,120
leader gonna do since it does not know
there was a new election yes

2252
00:51:42,120 --> 00:51:42,130

 

2253
00:51:42,130 --> 00:51:44,859

okay so the question is are there can

2254
00:51:44,859 --> 00:51:44,869
okay so the question is are there can
 

2255
00:51:44,869 --> 00:51:46,930
okay so the question is are there can
there be pathological cases in which for

2256
00:51:46,930 --> 00:51:46,940
there be pathological cases in which for
 

2257
00:51:46,940 --> 00:51:50,440
there be pathological cases in which for
example one-way network communication

2258
00:51:50,440 --> 00:51:50,450
example one-way network communication
 

2259
00:51:50,450 --> 00:51:52,329
example one-way network communication
can prevent the system from making

2260
00:51:52,329 --> 00:51:52,339
can prevent the system from making
 

2261
00:51:52,339 --> 00:51:54,540
can prevent the system from making
progress I believe the answer is yes

2262
00:51:54,540 --> 00:51:54,550
progress I believe the answer is yes
 

2263
00:51:54,550 --> 00:51:56,920
progress I believe the answer is yes
certainly so for example if the current

2264
00:51:56,920 --> 00:51:56,930
certainly so for example if the current
 

2265
00:51:56,930 --> 00:52:00,970
certainly so for example if the current
leader if its network somehow half fails

2266
00:52:00,970 --> 00:52:00,980
leader if its network somehow half fails
 

2267
00:52:00,980 --> 00:52:02,829
leader if its network somehow half fails
in a way the current leader can send out

2268
00:52:02,829 --> 00:52:02,839
in a way the current leader can send out
 

2269
00:52:02,839 --> 00:52:03,990
in a way the current leader can send out
heartbeats

2270
00:52:03,990 --> 00:52:04,000
heartbeats
 

2271
00:52:04,000 --> 00:52:07,270
heartbeats
but can't receive any client requests

2272
00:52:07,270 --> 00:52:07,280
but can't receive any client requests
 

2273
00:52:07,280 --> 00:52:09,940
but can't receive any client requests
then the heartbeats that it sends out

2274
00:52:09,940 --> 00:52:09,950
then the heartbeats that it sends out
 

2275
00:52:09,950 --> 00:52:11,859
then the heartbeats that it sends out
which are delivered because it's

2276
00:52:11,859 --> 00:52:11,869
which are delivered because it's
 

2277
00:52:11,869 --> 00:52:13,900
which are delivered because it's
outgoing network connection works its

2278
00:52:13,900 --> 00:52:13,910
outgoing network connection works its
 

2279
00:52:13,910 --> 00:52:18,099
outgoing network connection works its
outgoing heartbeats will suppress any

2280
00:52:18,099 --> 00:52:18,109
outgoing heartbeats will suppress any
 

2281
00:52:18,109 --> 00:52:20,290
outgoing heartbeats will suppress any
other server from starting an election

2282
00:52:20,290 --> 00:52:20,300
other server from starting an election
 

2283
00:52:20,300 --> 00:52:22,270
other server from starting an election
but the fact that it's incoming Network

2284
00:52:22,270 --> 00:52:22,280
but the fact that it's incoming Network
 

2285
00:52:22,280 --> 00:52:24,790
but the fact that it's incoming Network
why or apparently is broken will prevent

2286
00:52:24,790 --> 00:52:24,800
why or apparently is broken will prevent
 

2287
00:52:24,800 --> 00:52:26,710
why or apparently is broken will prevent
it from hearing and executing any client

2288
00:52:26,710 --> 00:52:26,720
it from hearing and executing any client
 

2289
00:52:26,720 --> 00:52:29,200
it from hearing and executing any client
commands it's absolutely the case that

2290
00:52:29,200 --> 00:52:29,210
commands it's absolutely the case that
 

2291
00:52:29,210 --> 00:52:35,349
commands it's absolutely the case that
raft is not proof against all sort of

2292
00:52:35,349 --> 00:52:35,359
raft is not proof against all sort of
 

2293
00:52:35,359 --> 00:52:37,180
raft is not proof against all sort of
all crazy Network problems that can come

2294
00:52:37,180 --> 00:52:37,190
all crazy Network problems that can come
 

2295
00:52:37,190 --> 00:52:38,890
all crazy Network problems that can come
up I believe the ones I've thought about

2296
00:52:38,890 --> 00:52:38,900
up I believe the ones I've thought about
 

2297
00:52:38,900 --> 00:52:42,250
up I believe the ones I've thought about
I believe are fixable in the sense that

2298
00:52:42,250 --> 00:52:42,260
I believe are fixable in the sense that
 

2299
00:52:42,260 --> 00:52:46,960
I believe are fixable in the sense that
the we could solve this one by having a

2300
00:52:46,960 --> 00:52:46,970
the we could solve this one by having a
 

2301
00:52:46,970 --> 00:52:49,329
the we could solve this one by having a
sort of requiring a two-way heartbeat in

2302
00:52:49,329 --> 00:52:49,339
sort of requiring a two-way heartbeat in
 

2303
00:52:49,339 --> 00:52:51,760
sort of requiring a two-way heartbeat in
which if the leader sends out heartbeats

2304
00:52:51,760 --> 00:52:51,770
which if the leader sends out heartbeats
 

2305
00:52:51,770 --> 00:52:53,440
which if the leader sends out heartbeats
but you know there were in which

2306
00:52:53,440 --> 00:52:53,450
but you know there were in which
 

2307
00:52:53,450 --> 00:52:55,690
but you know there were in which
followers are required to reply in some

2308
00:52:55,690 --> 00:52:55,700
followers are required to reply in some
 

2309
00:52:55,700 --> 00:52:56,980
followers are required to reply in some
way to heartbeats I guess they are

2310
00:52:56,980 --> 00:52:56,990
way to heartbeats I guess they are
 

2311
00:52:56,990 --> 00:52:59,230
way to heartbeats I guess they are
already required to apply if the leader

2312
00:52:59,230 --> 00:52:59,240
already required to apply if the leader
 

2313
00:52:59,240 --> 00:53:01,859
already required to apply if the leader
stop seeing replies to its heartbeats

2314
00:53:01,859 --> 00:53:01,869
stop seeing replies to its heartbeats
 

2315
00:53:01,869 --> 00:53:04,450
stop seeing replies to its heartbeats
then after some amount of time and which

2316
00:53:04,450 --> 00:53:04,460
then after some amount of time and which
 

2317
00:53:04,460 --> 00:53:06,220
then after some amount of time and which
is seasonals replies the leader decides

2318
00:53:06,220 --> 00:53:06,230
is seasonals replies the leader decides
 

2319
00:53:06,230 --> 00:53:09,220
is seasonals replies the leader decides
to step down I feel like that specific

2320
00:53:09,220 --> 00:53:09,230
to step down I feel like that specific
 

2321
00:53:09,230 --> 00:53:12,520
to step down I feel like that specific
issue can be fixed and many others can

2322
00:53:12,520 --> 00:53:12,530
issue can be fixed and many others can
 

2323
00:53:12,530 --> 00:53:16,059
issue can be fixed and many others can
too but I but you know you're absolutely

2324
00:53:16,059 --> 00:53:16,069
too but I but you know you're absolutely
 

2325
00:53:16,069 --> 00:53:17,890
too but I but you know you're absolutely
right that very strange things can

2326
00:53:17,890 --> 00:53:17,900
right that very strange things can
 

2327
00:53:17,900 --> 00:53:19,589
right that very strange things can
happen to networks including some that

2328
00:53:19,589 --> 00:53:19,599
happen to networks including some that
 

2329
00:53:19,599 --> 00:53:28,730
happen to networks including some that
the protocol is not prepared for

2330
00:53:28,730 --> 00:53:28,740

 

2331
00:53:28,740 --> 00:53:32,250

okay so we got these meter elections we

2332
00:53:32,250 --> 00:53:32,260
okay so we got these meter elections we
 

2333
00:53:32,260 --> 00:53:33,839
okay so we got these meter elections we
need to ensure that there is at most at

2334
00:53:33,839 --> 00:53:33,849
need to ensure that there is at most at
 

2335
00:53:33,849 --> 00:53:35,430
need to ensure that there is at most at
most one meter per term

2336
00:53:35,430 --> 00:53:35,440
most one meter per term
 

2337
00:53:35,440 --> 00:53:38,070
most one meter per term
how does Rath do that well Rath requires

2338
00:53:38,070 --> 00:53:38,080
how does Rath do that well Rath requires
 

2339
00:53:38,080 --> 00:53:40,230
how does Rath do that well Rath requires
in order to be elected for a term Raft

2340
00:53:40,230 --> 00:53:40,240
in order to be elected for a term Raft
 

2341
00:53:40,240 --> 00:53:42,690
in order to be elected for a term Raft
requires a candidate to get yes votes

2342
00:53:42,690 --> 00:53:42,700
requires a candidate to get yes votes
 

2343
00:53:42,700 --> 00:53:46,020
requires a candidate to get yes votes
from a majority of the server's the

2344
00:53:46,020 --> 00:53:46,030
from a majority of the server's the
 

2345
00:53:46,030 --> 00:53:47,970
from a majority of the server's the
servers and each server will only cast

2346
00:53:47,970 --> 00:53:47,980
servers and each server will only cast
 

2347
00:53:47,980 --> 00:53:52,380
servers and each server will only cast
one yes vote per term so in any given

2348
00:53:52,380 --> 00:53:52,390
one yes vote per term so in any given
 

2349
00:53:52,390 --> 00:53:55,680
one yes vote per term so in any given
term you know it basically means that in

2350
00:53:55,680 --> 00:53:55,690
term you know it basically means that in
 

2351
00:53:55,690 --> 00:53:58,170
term you know it basically means that in
any given term Easter votes only once

2352
00:53:58,170 --> 00:53:58,180
any given term Easter votes only once
 

2353
00:53:58,180 --> 00:54:01,050
any given term Easter votes only once
for only one candidate you can't have

2354
00:54:01,050 --> 00:54:01,060
for only one candidate you can't have
 

2355
00:54:01,060 --> 00:54:03,270
for only one candidate you can't have
two candidates both get a majority of

2356
00:54:03,270 --> 00:54:03,280
two candidates both get a majority of
 

2357
00:54:03,280 --> 00:54:06,560
two candidates both get a majority of
votes because everybody votes only once

2358
00:54:06,560 --> 00:54:06,570
votes because everybody votes only once
 

2359
00:54:06,570 --> 00:54:09,660
votes because everybody votes only once
so the majorities majority rule causes

2360
00:54:09,660 --> 00:54:09,670
so the majorities majority rule causes
 

2361
00:54:09,670 --> 00:54:11,520
so the majorities majority rule causes
there to be at most one winning

2362
00:54:11,520 --> 00:54:11,530
there to be at most one winning
 

2363
00:54:11,530 --> 00:54:17,390
there to be at most one winning
candidate and so then we get at most one

2364
00:54:17,390 --> 00:54:17,400
candidate and so then we get at most one
 

2365
00:54:17,400 --> 00:54:24,440
candidate and so then we get at most one
candidate elected per turn

2366
00:54:24,440 --> 00:54:24,450

 

2367
00:54:24,450 --> 00:54:28,620

and in addition critically the majority

2368
00:54:28,620 --> 00:54:28,630
and in addition critically the majority
 

2369
00:54:28,630 --> 00:54:31,920
and in addition critically the majority
rule means that you can get elected even

2370
00:54:31,920 --> 00:54:31,930
rule means that you can get elected even
 

2371
00:54:31,930 --> 00:54:34,440
rule means that you can get elected even
if some servers have crashed right if a

2372
00:54:34,440 --> 00:54:34,450
if some servers have crashed right if a
 

2373
00:54:34,450 --> 00:54:36,000
if some servers have crashed right if a
minority of servers are crashed aren't

2374
00:54:36,000 --> 00:54:36,010
minority of servers are crashed aren't
 

2375
00:54:36,010 --> 00:54:37,680
minority of servers are crashed aren't
available and network problems we can

2376
00:54:37,680 --> 00:54:37,690
available and network problems we can
 

2377
00:54:37,690 --> 00:54:39,690
available and network problems we can
still elect a leader if more than half a

2378
00:54:39,690 --> 00:54:39,700
still elect a leader if more than half a
 

2379
00:54:39,700 --> 00:54:41,520
still elect a leader if more than half a
crash or not available or in another

2380
00:54:41,520 --> 00:54:41,530
crash or not available or in another
 

2381
00:54:41,530 --> 00:54:43,380
crash or not available or in another
partition or something then actually the

2382
00:54:43,380 --> 00:54:43,390
partition or something then actually the
 

2383
00:54:43,390 --> 00:54:44,820
partition or something then actually the
system will just sit there trying again

2384
00:54:44,820 --> 00:54:44,830
system will just sit there trying again
 

2385
00:54:44,830 --> 00:54:47,070
system will just sit there trying again
and again to elect a leader and never

2386
00:54:47,070 --> 00:54:47,080
and again to elect a leader and never
 

2387
00:54:47,080 --> 00:54:49,470
and again to elect a leader and never
elect one if it cannot in fact they're

2388
00:54:49,470 --> 00:54:49,480
elect one if it cannot in fact they're
 

2389
00:54:49,480 --> 00:54:54,720
elect one if it cannot in fact they're
not a majority of live servers if an

2390
00:54:54,720 --> 00:54:54,730
not a majority of live servers if an
 

2391
00:54:54,730 --> 00:54:57,390
not a majority of live servers if an
election succeeds everybody would be

2392
00:54:57,390 --> 00:54:57,400
election succeeds everybody would be
 

2393
00:54:57,400 --> 00:54:58,950
election succeeds everybody would be
great if everybody learned about it I

2394
00:54:58,950 --> 00:54:58,960
great if everybody learned about it I
 

2395
00:54:58,960 --> 00:55:01,349
great if everybody learned about it I
mean need to ask ourselves how do all

2396
00:55:01,349 --> 00:55:01,359
mean need to ask ourselves how do all
 

2397
00:55:01,359 --> 00:55:02,970
mean need to ask ourselves how do all
the parties learn learn what happened

2398
00:55:02,970 --> 00:55:02,980
the parties learn learn what happened
 

2399
00:55:02,980 --> 00:55:04,740
the parties learn learn what happened
the server that wins an election

2400
00:55:04,740 --> 00:55:04,750
the server that wins an election
 

2401
00:55:04,750 --> 00:55:07,290
the server that wins an election
assuming it doesn't crash the server

2402
00:55:07,290 --> 00:55:07,300
assuming it doesn't crash the server
 

2403
00:55:07,300 --> 00:55:09,540
assuming it doesn't crash the server
that wins election will actually see a

2404
00:55:09,540 --> 00:55:09,550
that wins election will actually see a
 

2405
00:55:09,550 --> 00:55:12,720
that wins election will actually see a
majority or positive votes for its

2406
00:55:12,720 --> 00:55:12,730
majority or positive votes for its
 

2407
00:55:12,730 --> 00:55:15,390
majority or positive votes for its
request vote from a majority of the

2408
00:55:15,390 --> 00:55:15,400
request vote from a majority of the
 

2409
00:55:15,400 --> 00:55:17,730
request vote from a majority of the
other servers so the candidates running

2410
00:55:17,730 --> 00:55:17,740
other servers so the candidates running
 

2411
00:55:17,740 --> 00:55:19,530
other servers so the candidates running
the election that wins it the Kennedy

2412
00:55:19,530 --> 00:55:19,540
the election that wins it the Kennedy
 

2413
00:55:19,540 --> 00:55:20,700
the election that wins it the Kennedy
that wins the election will actually

2414
00:55:20,700 --> 00:55:20,710
that wins the election will actually
 

2415
00:55:20,710 --> 00:55:22,950
that wins the election will actually
know directly uh I got a majority of

2416
00:55:22,950 --> 00:55:22,960
know directly uh I got a majority of
 

2417
00:55:22,960 --> 00:55:26,010
know directly uh I got a majority of
votes but nobody else directly knows who

2418
00:55:26,010 --> 00:55:26,020
votes but nobody else directly knows who
 

2419
00:55:26,020 --> 00:55:28,890
votes but nobody else directly knows who
the winner was or whether anybody one so

2420
00:55:28,890 --> 00:55:28,900
the winner was or whether anybody one so
 

2421
00:55:28,900 --> 00:55:30,780
the winner was or whether anybody one so
the way that the candidate informs other

2422
00:55:30,780 --> 00:55:30,790
the way that the candidate informs other
 

2423
00:55:30,790 --> 00:55:33,660
the way that the candidate informs other
servers is that heartbeat the rules and

2424
00:55:33,660 --> 00:55:33,670
servers is that heartbeat the rules and
 

2425
00:55:33,670 --> 00:55:34,859
servers is that heartbeat the rules and
figure to say oh if you're in an

2426
00:55:34,859 --> 00:55:34,869
figure to say oh if you're in an
 

2427
00:55:34,869 --> 00:55:36,270
figure to say oh if you're in an
election your immediately required to

2428
00:55:36,270 --> 00:55:36,280
election your immediately required to
 

2429
00:55:36,280 --> 00:55:37,349
election your immediately required to
send out an independent

2430
00:55:37,349 --> 00:55:37,359
send out an independent
 

2431
00:55:37,359 --> 00:55:39,930
send out an independent
trees to all the other servers now the

2432
00:55:39,930 --> 00:55:39,940
trees to all the other servers now the
 

2433
00:55:39,940 --> 00:55:41,910
trees to all the other servers now the
append entries that heartbeat append

2434
00:55:41,910 --> 00:55:41,920
append entries that heartbeat append
 

2435
00:55:41,920 --> 00:55:45,150
append entries that heartbeat append
entries doesn't explicitly say I won the

2436
00:55:45,150 --> 00:55:45,160
entries doesn't explicitly say I won the
 

2437
00:55:45,160 --> 00:55:47,819
entries doesn't explicitly say I won the
election you know I'm a leader for term

2438
00:55:47,819 --> 00:55:47,829
election you know I'm a leader for term
 

2439
00:55:47,829 --> 00:55:50,999
election you know I'm a leader for term
23 it's a little more subtle than that

2440
00:55:50,999 --> 00:55:51,009
23 it's a little more subtle than that
 

2441
00:55:51,009 --> 00:55:53,700
23 it's a little more subtle than that
the the way the information is

2442
00:55:53,700 --> 00:55:53,710
the the way the information is
 

2443
00:55:53,710 --> 00:55:57,539
the the way the information is
communicated is that no one is allowed

2444
00:55:57,539 --> 00:55:57,549
communicated is that no one is allowed
 

2445
00:55:57,549 --> 00:56:00,239
communicated is that no one is allowed
to send out an append entries unless

2446
00:56:00,239 --> 00:56:00,249
to send out an append entries unless
 

2447
00:56:00,249 --> 00:56:02,789
to send out an append entries unless
they're a leader for that term so the

2448
00:56:02,789 --> 00:56:02,799
they're a leader for that term so the
 

2449
00:56:02,799 --> 00:56:05,549
they're a leader for that term so the
fact that I I'm a you know I'm a server

2450
00:56:05,549 --> 00:56:05,559
fact that I I'm a you know I'm a server
 

2451
00:56:05,559 --> 00:56:07,019
fact that I I'm a you know I'm a server
and I saw oh there's an election for

2452
00:56:07,019 --> 00:56:07,029
and I saw oh there's an election for
 

2453
00:56:07,029 --> 00:56:09,569
and I saw oh there's an election for
term 19 and then by-and-by I sent an

2454
00:56:09,569 --> 00:56:09,579
term 19 and then by-and-by I sent an
 

2455
00:56:09,579 --> 00:56:12,720
term 19 and then by-and-by I sent an
append entries whose term is 19 that

2456
00:56:12,720 --> 00:56:12,730
append entries whose term is 19 that
 

2457
00:56:12,730 --> 00:56:14,999
append entries whose term is 19 that
tells me that somebody I don't know who

2458
00:56:14,999 --> 00:56:15,009
tells me that somebody I don't know who
 

2459
00:56:15,009 --> 00:56:18,089
tells me that somebody I don't know who
but somebody won the election so that's

2460
00:56:18,089 --> 00:56:18,099
but somebody won the election so that's
 

2461
00:56:18,099 --> 00:56:19,380
but somebody won the election so that's
how the other servers knows they were

2462
00:56:19,380 --> 00:56:19,390
how the other servers knows they were
 

2463
00:56:19,390 --> 00:56:21,349
how the other servers knows they were
receiving append entries for that term

2464
00:56:21,349 --> 00:56:21,359
receiving append entries for that term
 

2465
00:56:21,359 --> 00:56:24,660
receiving append entries for that term
and that append entries also has the

2466
00:56:24,660 --> 00:56:24,670
and that append entries also has the
 

2467
00:56:24,670 --> 00:56:27,359
and that append entries also has the
effect of resetting everybody's election

2468
00:56:27,359 --> 00:56:27,369
effect of resetting everybody's election
 

2469
00:56:27,369 --> 00:56:30,269
effect of resetting everybody's election
time timer so as long as the leader is

2470
00:56:30,269 --> 00:56:30,279
time timer so as long as the leader is
 

2471
00:56:30,279 --> 00:56:32,099
time timer so as long as the leader is
up and it sends out heartbeat messages

2472
00:56:32,099 --> 00:56:32,109
up and it sends out heartbeat messages
 

2473
00:56:32,109 --> 00:56:34,589
up and it sends out heartbeat messages
or append entries at least you know at

2474
00:56:34,589 --> 00:56:34,599
or append entries at least you know at
 

2475
00:56:34,599 --> 00:56:36,900
or append entries at least you know at
the rate that's supposed to every time a

2476
00:56:36,900 --> 00:56:36,910
the rate that's supposed to every time a
 

2477
00:56:36,910 --> 00:56:38,640
the rate that's supposed to every time a
server receives an append entries it'll

2478
00:56:38,640 --> 00:56:38,650
server receives an append entries it'll
 

2479
00:56:38,650 --> 00:56:42,559
server receives an append entries it'll
reset its selection timer and sort of

2480
00:56:42,559 --> 00:56:42,569
reset its selection timer and sort of
 

2481
00:56:42,569 --> 00:56:45,239
reset its selection timer and sort of
suppress anybody from being a new

2482
00:56:45,239 --> 00:56:45,249
suppress anybody from being a new
 

2483
00:56:45,249 --> 00:56:47,279
suppress anybody from being a new
candidate so as long as everything's

2484
00:56:47,279 --> 00:56:47,289
candidate so as long as everything's
 

2485
00:56:47,289 --> 00:56:49,529
candidate so as long as everything's
functioning the repeated heartbeats will

2486
00:56:49,529 --> 00:56:49,539
functioning the repeated heartbeats will
 

2487
00:56:49,539 --> 00:56:52,289
functioning the repeated heartbeats will
prevent any further elections of course

2488
00:56:52,289 --> 00:56:52,299
prevent any further elections of course
 

2489
00:56:52,299 --> 00:56:53,849
prevent any further elections of course
it the network fails or packets are

2490
00:56:53,849 --> 00:56:53,859
it the network fails or packets are
 

2491
00:56:53,859 --> 00:56:55,559
it the network fails or packets are
dropped there may nevertheless be an

2492
00:56:55,559 --> 00:56:55,569
dropped there may nevertheless be an
 

2493
00:56:55,569 --> 00:56:57,870
dropped there may nevertheless be an
election but if all goes well we're sort

2494
00:56:57,870 --> 00:56:57,880
election but if all goes well we're sort
 

2495
00:56:57,880 --> 00:57:03,479
election but if all goes well we're sort
of unlikely to get an election this

2496
00:57:03,479 --> 00:57:03,489
of unlikely to get an election this
 

2497
00:57:03,489 --> 00:57:05,729
of unlikely to get an election this
scheme could fail in the sense that it

2498
00:57:05,729 --> 00:57:05,739
scheme could fail in the sense that it
 

2499
00:57:05,739 --> 00:57:07,319
scheme could fail in the sense that it
can't fail in the sense of electing to

2500
00:57:07,319 --> 00:57:07,329
can't fail in the sense of electing to
 

2501
00:57:07,329 --> 00:57:09,839
can't fail in the sense of electing to
leaders fair term but it can fail in the

2502
00:57:09,839 --> 00:57:09,849
leaders fair term but it can fail in the
 

2503
00:57:09,849 --> 00:57:11,370
leaders fair term but it can fail in the
sense of electing zero leaders for a

2504
00:57:11,370 --> 00:57:11,380
sense of electing zero leaders for a
 

2505
00:57:11,380 --> 00:57:14,309
sense of electing zero leaders for a
term that's sort of morningway it may

2506
00:57:14,309 --> 00:57:14,319
term that's sort of morningway it may
 

2507
00:57:14,319 --> 00:57:16,200
term that's sort of morningway it may
fail is that if too many servers are

2508
00:57:16,200 --> 00:57:16,210
fail is that if too many servers are
 

2509
00:57:16,210 --> 00:57:18,269
fail is that if too many servers are
dead or unavailable or a bad network

2510
00:57:18,269 --> 00:57:18,279
dead or unavailable or a bad network
 

2511
00:57:18,279 --> 00:57:19,680
dead or unavailable or a bad network
connection so if you can't assemble a

2512
00:57:19,680 --> 00:57:19,690
connection so if you can't assemble a
 

2513
00:57:19,690 --> 00:57:21,870
connection so if you can't assemble a
majority you can't be elected nothing

2514
00:57:21,870 --> 00:57:21,880
majority you can't be elected nothing
 

2515
00:57:21,880 --> 00:57:24,479
majority you can't be elected nothing
happens the more interesting way in

2516
00:57:24,479 --> 00:57:24,489
happens the more interesting way in
 

2517
00:57:24,489 --> 00:57:27,140
happens the more interesting way in
which an election can fail is if

2518
00:57:27,140 --> 00:57:27,150
which an election can fail is if
 

2519
00:57:27,150 --> 00:57:30,059
which an election can fail is if
everybody's up you know there's no

2520
00:57:30,059 --> 00:57:30,069
everybody's up you know there's no
 

2521
00:57:30,069 --> 00:57:33,120
everybody's up you know there's no
failures no packets are dropped but two

2522
00:57:33,120 --> 00:57:33,130
failures no packets are dropped but two
 

2523
00:57:33,130 --> 00:57:35,789
failures no packets are dropped but two
leaders become candidate close together

2524
00:57:35,789 --> 00:57:35,799
leaders become candidate close together
 

2525
00:57:35,799 --> 00:57:38,489
leaders become candidate close together
enough in time that they split the vote

2526
00:57:38,489 --> 00:57:38,499
enough in time that they split the vote
 

2527
00:57:38,499 --> 00:57:45,010
enough in time that they split the vote
between them or say three leaders

2528
00:57:45,010 --> 00:57:45,020

 

2529
00:57:45,020 --> 00:57:46,359

so supposing we have three liters

2530
00:57:46,359 --> 00:57:46,369
so supposing we have three liters
 

2531
00:57:46,369 --> 00:57:49,170
so supposing we have three liters
supposing we have a three replica system

2532
00:57:49,170 --> 00:57:49,180
supposing we have a three replica system
 

2533
00:57:49,180 --> 00:57:51,850
supposing we have a three replica system
all their election timers go off at the

2534
00:57:51,850 --> 00:57:51,860
all their election timers go off at the
 

2535
00:57:51,860 --> 00:57:54,750
all their election timers go off at the
same time every server both for itself

2536
00:57:54,750 --> 00:57:54,760
same time every server both for itself
 

2537
00:57:54,760 --> 00:57:57,640
same time every server both for itself
and then when each of them receives a

2538
00:57:57,640 --> 00:57:57,650
and then when each of them receives a
 

2539
00:57:57,650 --> 00:57:59,050
and then when each of them receives a
request vote from another server well

2540
00:57:59,050 --> 00:57:59,060
request vote from another server well
 

2541
00:57:59,060 --> 00:58:00,700
request vote from another server well
it's already cast its vote for itself

2542
00:58:00,700 --> 00:58:00,710
it's already cast its vote for itself
 

2543
00:58:00,710 --> 00:58:02,770
it's already cast its vote for itself
and so it says no so that means that it

2544
00:58:02,770 --> 00:58:02,780
and so it says no so that means that it
 

2545
00:58:02,780 --> 00:58:04,090
and so it says no so that means that it
all three of the server's needs to get

2546
00:58:04,090 --> 00:58:04,100
all three of the server's needs to get
 

2547
00:58:04,100 --> 00:58:05,920
all three of the server's needs to get
one vote each nobody gets a majority and

2548
00:58:05,920 --> 00:58:05,930
one vote each nobody gets a majority and
 

2549
00:58:05,930 --> 00:58:09,790
one vote each nobody gets a majority and
nobody's elected so then their election

2550
00:58:09,790 --> 00:58:09,800
nobody's elected so then their election
 

2551
00:58:09,800 --> 00:58:11,440
nobody's elected so then their election
timers will go off again because the

2552
00:58:11,440 --> 00:58:11,450
timers will go off again because the
 

2553
00:58:11,450 --> 00:58:12,880
timers will go off again because the
election timers only be said if it gets

2554
00:58:12,880 --> 00:58:12,890
election timers only be said if it gets
 

2555
00:58:12,890 --> 00:58:14,350
election timers only be said if it gets
an append entries but there's no leader

2556
00:58:14,350 --> 00:58:14,360
an append entries but there's no leader
 

2557
00:58:14,360 --> 00:58:16,450
an append entries but there's no leader
so no append entries they'll all have

2558
00:58:16,450 --> 00:58:16,460
so no append entries they'll all have
 

2559
00:58:16,460 --> 00:58:17,920
so no append entries they'll all have
their election timers go off again and

2560
00:58:17,920 --> 00:58:17,930
their election timers go off again and
 

2561
00:58:17,930 --> 00:58:19,090
their election timers go off again and
if we're unlucky

2562
00:58:19,090 --> 00:58:19,100
if we're unlucky
 

2563
00:58:19,100 --> 00:58:20,260
if we're unlucky
they'll all go off at the same time

2564
00:58:20,260 --> 00:58:20,270
they'll all go off at the same time
 

2565
00:58:20,270 --> 00:58:22,150
they'll all go off at the same time
they'll all go for themselves nobody

2566
00:58:22,150 --> 00:58:22,160
they'll all go for themselves nobody
 

2567
00:58:22,160 --> 00:58:27,130
they'll all go for themselves nobody
will get a majority so so clearly I'm

2568
00:58:27,130 --> 00:58:27,140
will get a majority so so clearly I'm
 

2569
00:58:27,140 --> 00:58:28,350
will get a majority so so clearly I'm
sure you're all aware at this point

2570
00:58:28,350 --> 00:58:28,360
sure you're all aware at this point
 

2571
00:58:28,360 --> 00:58:31,510
sure you're all aware at this point
there's more to this story and the way

2572
00:58:31,510 --> 00:58:31,520
there's more to this story and the way
 

2573
00:58:31,520 --> 00:58:35,620
there's more to this story and the way
Raft makes this possibility of split

2574
00:58:35,620 --> 00:58:35,630
Raft makes this possibility of split
 

2575
00:58:35,630 --> 00:58:38,710
Raft makes this possibility of split
votes unlikely but not impossible

2576
00:58:38,710 --> 00:58:38,720
votes unlikely but not impossible
 

2577
00:58:38,720 --> 00:58:41,050
votes unlikely but not impossible
is by randomizing these election timers

2578
00:58:41,050 --> 00:58:41,060
is by randomizing these election timers
 

2579
00:58:41,060 --> 00:58:44,200
is by randomizing these election timers
so the way to think of it and the

2580
00:58:44,200 --> 00:58:44,210
so the way to think of it and the
 

2581
00:58:44,210 --> 00:58:46,390
so the way to think of it and the
randomization the way to think of it is

2582
00:58:46,390 --> 00:58:46,400
randomization the way to think of it is
 

2583
00:58:46,400 --> 00:58:47,890
randomization the way to think of it is
that supposing you have some time line

2584
00:58:47,890 --> 00:58:47,900
that supposing you have some time line
 

2585
00:58:47,900 --> 00:58:52,120
that supposing you have some time line
I'm gonna draw a vents on there's some

2586
00:58:52,120 --> 00:58:52,130
I'm gonna draw a vents on there's some
 

2587
00:58:52,130 --> 00:58:54,160
I'm gonna draw a vents on there's some
point at which everybody received the

2588
00:58:54,160 --> 00:58:54,170
point at which everybody received the
 

2589
00:58:54,170 --> 00:58:57,430
point at which everybody received the
last append entries right and then maybe

2590
00:58:57,430 --> 00:58:57,440
last append entries right and then maybe
 

2591
00:58:57,440 --> 00:58:58,780
last append entries right and then maybe
the server died let's just assume the

2592
00:58:58,780 --> 00:58:58,790
the server died let's just assume the
 

2593
00:58:58,790 --> 00:59:01,090
the server died let's just assume the
server send out a last heartbeat and

2594
00:59:01,090 --> 00:59:01,100
server send out a last heartbeat and
 

2595
00:59:01,100 --> 00:59:08,099
server send out a last heartbeat and
then died well all of the followers have

2596
00:59:08,099 --> 00:59:08,109

 

2597
00:59:08,109 --> 00:59:11,109

this we set their election timers when

2598
00:59:11,109 --> 00:59:11,119
this we set their election timers when
 

2599
00:59:11,119 --> 00:59:13,150
this we set their election timers when
they received at the same time because

2600
00:59:13,150 --> 00:59:13,160
they received at the same time because
 

2601
00:59:13,160 --> 00:59:14,560
they received at the same time because
they probably all receive this append

2602
00:59:14,560 --> 00:59:14,570
they probably all receive this append
 

2603
00:59:14,570 --> 00:59:16,030
they probably all receive this append
enters at the same time they all reset

2604
00:59:16,030 --> 00:59:16,040
enters at the same time they all reset
 

2605
00:59:16,040 --> 00:59:18,280
enters at the same time they all reset
their election timers for some point in

2606
00:59:18,280 --> 00:59:18,290
their election timers for some point in
 

2607
00:59:18,290 --> 00:59:21,520
their election timers for some point in
the future the future but they chose

2608
00:59:21,520 --> 00:59:21,530
the future the future but they chose
 

2609
00:59:21,530 --> 00:59:23,620
the future the future but they chose
different random times in the future

2610
00:59:23,620 --> 00:59:23,630
different random times in the future
 

2611
00:59:23,630 --> 00:59:25,359
different random times in the future
which then we're gonna go off

2612
00:59:25,359 --> 00:59:25,369
which then we're gonna go off
 

2613
00:59:25,369 --> 00:59:27,040
which then we're gonna go off
so it's suppose the dead leader server

2614
00:59:27,040 --> 00:59:27,050
so it's suppose the dead leader server
 

2615
00:59:27,050 --> 00:59:30,220
so it's suppose the dead leader server
one so now server two and server 3 at

2616
00:59:30,220 --> 00:59:30,230
one so now server two and server 3 at
 

2617
00:59:30,230 --> 00:59:32,349
one so now server two and server 3 at
this point set their election timers for

2618
00:59:32,349 --> 00:59:32,359
this point set their election timers for
 

2619
00:59:32,359 --> 00:59:34,000
this point set their election timers for
a random point in the future let's say

2620
00:59:34,000 --> 00:59:34,010
a random point in the future let's say
 

2621
00:59:34,010 --> 00:59:37,960
a random point in the future let's say
server to set their I like some timer to

2622
00:59:37,960 --> 00:59:37,970
server to set their I like some timer to
 

2623
00:59:37,970 --> 00:59:41,020
server to set their I like some timer to
go off here and server 3 set its

2624
00:59:41,020 --> 00:59:41,030
go off here and server 3 set its
 

2625
00:59:41,030 --> 00:59:43,870
go off here and server 3 set its
election timer to go off there and the

2626
00:59:43,870 --> 00:59:43,880
election timer to go off there and the
 

2627
00:59:43,880 --> 00:59:46,200
election timer to go off there and the
crucial point about this picture is that

2628
00:59:46,200 --> 00:59:46,210
crucial point about this picture is that
 

2629
00:59:46,210 --> 00:59:48,070
crucial point about this picture is that
assuming they picked different random

2630
00:59:48,070 --> 00:59:48,080
assuming they picked different random
 

2631
00:59:48,080 --> 00:59:51,250
assuming they picked different random
numbers one of them is first and the

2632
00:59:51,250 --> 00:59:51,260
numbers one of them is first and the
 

2633
00:59:51,260 --> 00:59:54,550
numbers one of them is first and the
other one is second right that's what's

2634
00:59:54,550 --> 00:59:54,560
other one is second right that's what's
 

2635
00:59:54,560 --> 00:59:56,590
other one is second right that's what's
going on here and the one that's first

2636
00:59:56,590 --> 00:59:56,600
going on here and the one that's first
 

2637
00:59:56,600 --> 00:59:58,059
going on here and the one that's first
assuming

2638
00:59:58,059 --> 00:59:58,069
assuming
 

2639
00:59:58,069 --> 01:00:00,069
assuming
this gap is big enough the one that's

2640
01:00:00,069 --> 01:00:00,079
this gap is big enough the one that's
 

2641
01:00:00,079 --> 01:00:01,390
this gap is big enough the one that's
first it's election time will go off

2642
01:00:01,390 --> 01:00:01,400
first it's election time will go off
 

2643
01:00:01,400 --> 01:00:02,859
first it's election time will go off
first before the other ones election

2644
01:00:02,859 --> 01:00:02,869
first before the other ones election
 

2645
01:00:02,869 --> 01:00:05,920
first before the other ones election
timer and if we're close were not

2646
01:00:05,920 --> 01:00:05,930
timer and if we're close were not
 

2647
01:00:05,930 --> 01:00:06,400
timer and if we're close were not
unlucky

2648
01:00:06,400 --> 01:00:06,410
unlucky
 

2649
01:00:06,410 --> 01:00:08,410
unlucky
it'll have time to send out a full round

2650
01:00:08,410 --> 01:00:08,420
it'll have time to send out a full round
 

2651
01:00:08,420 --> 01:00:11,740
it'll have time to send out a full round
of vote requests and get answers from

2652
01:00:11,740 --> 01:00:11,750
of vote requests and get answers from
 

2653
01:00:11,750 --> 01:00:13,620
of vote requests and get answers from
everybody who everybody's alive before

2654
01:00:13,620 --> 01:00:13,630
everybody who everybody's alive before
 

2655
01:00:13,630 --> 01:00:16,809
everybody who everybody's alive before
the second election timer goes off from

2656
01:00:16,809 --> 01:00:16,819
the second election timer goes off from
 

2657
01:00:16,819 --> 01:00:22,559
the second election timer goes off from
any other server so does everybody see

2658
01:00:22,559 --> 01:00:22,569
any other server so does everybody see
 

2659
01:00:22,569 --> 01:00:26,130
any other server so does everybody see
how the randomization D synchronizes

2660
01:00:26,130 --> 01:00:26,140
how the randomization D synchronizes
 

2661
01:00:26,140 --> 01:00:30,700
how the randomization D synchronizes
these candidates unfortunately there's a

2662
01:00:30,700 --> 01:00:30,710
these candidates unfortunately there's a
 

2663
01:00:30,710 --> 01:00:33,220
these candidates unfortunately there's a
bit of art in setting the contents

2664
01:00:33,220 --> 01:00:33,230
bit of art in setting the contents
 

2665
01:00:33,230 --> 01:00:34,960
bit of art in setting the contents
constants for these election timers

2666
01:00:34,960 --> 01:00:34,970
constants for these election timers
 

2667
01:00:34,970 --> 01:00:36,480
constants for these election timers
there's some sort of competing

2668
01:00:36,480 --> 01:00:36,490
there's some sort of competing
 

2669
01:00:36,490 --> 01:00:40,200
there's some sort of competing
requirements you might want to fulfill

2670
01:00:40,200 --> 01:00:40,210
requirements you might want to fulfill
 

2671
01:00:40,210 --> 01:00:43,299
requirements you might want to fulfill
so one obvious requirement is that the

2672
01:00:43,299 --> 01:00:43,309
so one obvious requirement is that the
 

2673
01:00:43,309 --> 01:00:45,220
so one obvious requirement is that the
election timer has to be at least as

2674
01:00:45,220 --> 01:00:45,230
election timer has to be at least as
 

2675
01:00:45,230 --> 01:00:47,020
election timer has to be at least as
long as the expected interval between

2676
01:00:47,020 --> 01:00:47,030
long as the expected interval between
 

2677
01:00:47,030 --> 01:00:47,799
long as the expected interval between
heartbeats

2678
01:00:47,799 --> 01:00:47,809
heartbeats
 

2679
01:00:47,809 --> 01:00:49,780
heartbeats
you know this is pretty obvious that the

2680
01:00:49,780 --> 01:00:49,790
you know this is pretty obvious that the
 

2681
01:00:49,790 --> 01:00:51,400
you know this is pretty obvious that the
leader sends out heartbeats every

2682
01:00:51,400 --> 01:00:51,410
leader sends out heartbeats every
 

2683
01:00:51,410 --> 01:00:53,680
leader sends out heartbeats every
hundred milliseconds you better make

2684
01:00:53,680 --> 01:00:53,690
hundred milliseconds you better make
 

2685
01:00:53,690 --> 01:00:55,510
hundred milliseconds you better make
sure there's no point in having the

2686
01:00:55,510 --> 01:00:55,520
sure there's no point in having the
 

2687
01:00:55,520 --> 01:00:57,309
sure there's no point in having the
election time or anybody's election time

2688
01:00:57,309 --> 01:00:57,319
election time or anybody's election time
 

2689
01:00:57,319 --> 01:00:58,839
election time or anybody's election time
or ever go off Borja for 100

2690
01:00:58,839 --> 01:00:58,849
or ever go off Borja for 100
 

2691
01:00:58,849 --> 01:01:00,520
or ever go off Borja for 100
milliseconds because then it will go off

2692
01:01:00,520 --> 01:01:00,530
milliseconds because then it will go off
 

2693
01:01:00,530 --> 01:01:06,789
milliseconds because then it will go off
before the lower limit is certainly the

2694
01:01:06,789 --> 01:01:06,799
before the lower limit is certainly the
 

2695
01:01:06,799 --> 01:01:08,559
before the lower limit is certainly the
lower limit is one heartbeat interval in

2696
01:01:08,559 --> 01:01:08,569
lower limit is one heartbeat interval in
 

2697
01:01:08,569 --> 01:01:10,930
lower limit is one heartbeat interval in
fact because the network may drop

2698
01:01:10,930 --> 01:01:10,940
fact because the network may drop
 

2699
01:01:10,940 --> 01:01:13,690
fact because the network may drop
packets you probably want to have the

2700
01:01:13,690 --> 01:01:13,700
packets you probably want to have the
 

2701
01:01:13,700 --> 01:01:16,299
packets you probably want to have the
minimum election timer value be a couple

2702
01:01:16,299 --> 01:01:16,309
minimum election timer value be a couple
 

2703
01:01:16,309 --> 01:01:18,819
minimum election timer value be a couple
of times the heartbeat interval so 400

2704
01:01:18,819 --> 01:01:18,829
of times the heartbeat interval so 400
 

2705
01:01:18,829 --> 01:01:20,079
of times the heartbeat interval so 400
millisecond heartbeats you probably want

2706
01:01:20,079 --> 01:01:20,089
millisecond heartbeats you probably want
 

2707
01:01:20,089 --> 01:01:21,430
millisecond heartbeats you probably want
to have the very shortest possible

2708
01:01:21,430 --> 01:01:21,440
to have the very shortest possible
 

2709
01:01:21,440 --> 01:01:24,309
to have the very shortest possible
election time or be you know say 300

2710
01:01:24,309 --> 01:01:24,319
election time or be you know say 300
 

2711
01:01:24,319 --> 01:01:26,109
election time or be you know say 300
milliseconds you know three times the

2712
01:01:26,109 --> 01:01:26,119
milliseconds you know three times the
 

2713
01:01:26,119 --> 01:01:29,440
milliseconds you know three times the
heartbeat interval so that's the sort of

2714
01:01:29,440 --> 01:01:29,450
heartbeat interval so that's the sort of
 

2715
01:01:29,450 --> 01:01:33,700
heartbeat interval so that's the sort of
minimum is the heart heartbeat so this

2716
01:01:33,700 --> 01:01:33,710
minimum is the heart heartbeat so this
 

2717
01:01:33,710 --> 01:01:35,559
minimum is the heart heartbeat so this
frequent you want the minimum to be you

2718
01:01:35,559 --> 01:01:35,569
frequent you want the minimum to be you
 

2719
01:01:35,569 --> 01:01:39,460
frequent you want the minimum to be you
know a couple of times that or here so

2720
01:01:39,460 --> 01:01:39,470
know a couple of times that or here so
 

2721
01:01:39,470 --> 01:01:40,630
know a couple of times that or here so
what about the maximum you know you're

2722
01:01:40,630 --> 01:01:40,640
what about the maximum you know you're
 

2723
01:01:40,640 --> 01:01:43,000
what about the maximum you know you're
gonna presumably randomize uniformly

2724
01:01:43,000 --> 01:01:43,010
gonna presumably randomize uniformly
 

2725
01:01:43,010 --> 01:01:45,700
gonna presumably randomize uniformly
over some range of times you know where

2726
01:01:45,700 --> 01:01:45,710
over some range of times you know where
 

2727
01:01:45,710 --> 01:01:50,950
over some range of times you know where
should we set the kind of maximum time

2728
01:01:50,950 --> 01:01:50,960
should we set the kind of maximum time
 

2729
01:01:50,960 --> 01:01:54,700
should we set the kind of maximum time
that we're randomizing over there's a

2730
01:01:54,700 --> 01:01:54,710
that we're randomizing over there's a
 

2731
01:01:54,710 --> 01:01:57,730
that we're randomizing over there's a
couple of considerations here in a real

2732
01:01:57,730 --> 01:01:57,740
couple of considerations here in a real
 

2733
01:01:57,740 --> 01:02:04,400
couple of considerations here in a real
system you know this maximum time effect

2734
01:02:04,400 --> 01:02:04,410
system you know this maximum time effect
 

2735
01:02:04,410 --> 01:02:06,230
system you know this maximum time effect
how quickly the system can recover from

2736
01:02:06,230 --> 01:02:06,240
how quickly the system can recover from
 

2737
01:02:06,240 --> 01:02:09,410
how quickly the system can recover from
failure because remember from the time

2738
01:02:09,410 --> 01:02:09,420
failure because remember from the time
 

2739
01:02:09,420 --> 01:02:11,900
failure because remember from the time
at which the server fails until the

2740
01:02:11,900 --> 01:02:11,910
at which the server fails until the
 

2741
01:02:11,910 --> 01:02:14,720
at which the server fails until the
first election timer goes off the whole

2742
01:02:14,720 --> 01:02:14,730
first election timer goes off the whole
 

2743
01:02:14,730 --> 01:02:17,420
first election timer goes off the whole
system is frozen there's no leader you

2744
01:02:17,420 --> 01:02:17,430
system is frozen there's no leader you
 

2745
01:02:17,430 --> 01:02:18,860
system is frozen there's no leader you
know the clients requests are being

2746
01:02:18,860 --> 01:02:18,870
know the clients requests are being
 

2747
01:02:18,870 --> 01:02:20,180
know the clients requests are being
thrown away because there's no leader

2748
01:02:20,180 --> 01:02:20,190
thrown away because there's no leader
 

2749
01:02:20,190 --> 01:02:22,310
thrown away because there's no leader
and we're not assigning a new leader

2750
01:02:22,310 --> 01:02:22,320
and we're not assigning a new leader
 

2751
01:02:22,320 --> 01:02:24,860
and we're not assigning a new leader
even though you know presumably these

2752
01:02:24,860 --> 01:02:24,870
even though you know presumably these
 

2753
01:02:24,870 --> 01:02:27,380
even though you know presumably these
other servers are up so the beer we

2754
01:02:27,380 --> 01:02:27,390
other servers are up so the beer we
 

2755
01:02:27,390 --> 01:02:29,660
other servers are up so the beer we
choose this maximum the long or delay

2756
01:02:29,660 --> 01:02:29,670
choose this maximum the long or delay
 

2757
01:02:29,670 --> 01:02:32,030
choose this maximum the long or delay
we're imposing on clients before

2758
01:02:32,030 --> 01:02:32,040
we're imposing on clients before
 

2759
01:02:32,040 --> 01:02:34,760
we're imposing on clients before
recovery occurs you know whether that's

2760
01:02:34,760 --> 01:02:34,770
recovery occurs you know whether that's
 

2761
01:02:34,770 --> 01:02:38,210
recovery occurs you know whether that's
important depends on sort of how high

2762
01:02:38,210 --> 01:02:38,220
important depends on sort of how high
 

2763
01:02:38,220 --> 01:02:40,190
important depends on sort of how high
performance we need this to be and how

2764
01:02:40,190 --> 01:02:40,200
performance we need this to be and how
 

2765
01:02:40,200 --> 01:02:42,860
performance we need this to be and how
often we think there will be failures

2766
01:02:42,860 --> 01:02:42,870
often we think there will be failures
 

2767
01:02:42,870 --> 01:02:44,900
often we think there will be failures
failures happen once a year then who

2768
01:02:44,900 --> 01:02:44,910
failures happen once a year then who
 

2769
01:02:44,910 --> 01:02:46,300
failures happen once a year then who
cares

2770
01:02:46,300 --> 01:02:46,310
cares
 

2771
01:02:46,310 --> 01:02:48,590
cares
we're expecting failures frequently we

2772
01:02:48,590 --> 01:02:48,600
we're expecting failures frequently we
 

2773
01:02:48,600 --> 01:02:51,320
we're expecting failures frequently we
may care very much how long it takes to

2774
01:02:51,320 --> 01:02:51,330
may care very much how long it takes to
 

2775
01:02:51,330 --> 01:02:53,660
may care very much how long it takes to
recover okay so that's one consideration

2776
01:02:53,660 --> 01:02:53,670
recover okay so that's one consideration
 

2777
01:02:53,670 --> 01:02:56,320
recover okay so that's one consideration
the other consideration is that this gap

2778
01:02:56,320 --> 01:02:56,330
the other consideration is that this gap
 

2779
01:02:56,330 --> 01:02:59,390
the other consideration is that this gap
that is the expected gap in time between

2780
01:02:59,390 --> 01:02:59,400
that is the expected gap in time between
 

2781
01:02:59,400 --> 01:03:01,400
that is the expected gap in time between
the first time are going off and the

2782
01:03:01,400 --> 01:03:01,410
the first time are going off and the
 

2783
01:03:01,410 --> 01:03:04,880
the first time are going off and the
second timer going off this gap really

2784
01:03:04,880 --> 01:03:04,890
second timer going off this gap really
 

2785
01:03:04,890 --> 01:03:07,880
second timer going off this gap really
in order to be useful has to be longer

2786
01:03:07,880 --> 01:03:07,890
in order to be useful has to be longer
 

2787
01:03:07,890 --> 01:03:09,920
in order to be useful has to be longer
than the time it takes for the candidate

2788
01:03:09,920 --> 01:03:09,930
than the time it takes for the candidate
 

2789
01:03:09,930 --> 01:03:12,320
than the time it takes for the candidate
to assemble votes from everybody that is

2790
01:03:12,320 --> 01:03:12,330
to assemble votes from everybody that is
 

2791
01:03:12,330 --> 01:03:15,050
to assemble votes from everybody that is
longer than the expected round-trip time

2792
01:03:15,050 --> 01:03:15,060
longer than the expected round-trip time
 

2793
01:03:15,060 --> 01:03:16,580
longer than the expected round-trip time
the amount of time it takes to send an

2794
01:03:16,580 --> 01:03:16,590
the amount of time it takes to send an
 

2795
01:03:16,590 --> 01:03:19,040
the amount of time it takes to send an
RPC and get the response and so maybe it

2796
01:03:19,040 --> 01:03:19,050
RPC and get the response and so maybe it
 

2797
01:03:19,050 --> 01:03:21,830
RPC and get the response and so maybe it
takes 10 milliseconds to send an RPC and

2798
01:03:21,830 --> 01:03:21,840
takes 10 milliseconds to send an RPC and
 

2799
01:03:21,840 --> 01:03:25,850
takes 10 milliseconds to send an RPC and
get a response a response from all the

2800
01:03:25,850 --> 01:03:25,860
get a response a response from all the
 

2801
01:03:25,860 --> 01:03:27,800
get a response a response from all the
other servers and if that's the case we

2802
01:03:27,800 --> 01:03:27,810
other servers and if that's the case we
 

2803
01:03:27,810 --> 01:03:28,970
other servers and if that's the case we
need to make maximum at least long

2804
01:03:28,970 --> 01:03:28,980
need to make maximum at least long
 

2805
01:03:28,980 --> 01:03:30,560
need to make maximum at least long
enough that there's pretty likely to be

2806
01:03:30,560 --> 01:03:30,570
enough that there's pretty likely to be
 

2807
01:03:30,570 --> 01:03:32,210
enough that there's pretty likely to be
10 milliseconds difference between the

2808
01:03:32,210 --> 01:03:32,220
10 milliseconds difference between the
 

2809
01:03:32,220 --> 01:03:34,100
10 milliseconds difference between the
smallest random number and the next

2810
01:03:34,100 --> 01:03:34,110
smallest random number and the next
 

2811
01:03:34,110 --> 01:03:40,540
smallest random number and the next
smallest random number

2812
01:03:40,540 --> 01:03:40,550

 

2813
01:03:40,550 --> 01:03:46,460

and for you the test code will get upset

2814
01:03:46,460 --> 01:03:46,470
and for you the test code will get upset
 

2815
01:03:46,470 --> 01:03:54,349
and for you the test code will get upset
if you if you don't recover from a

2816
01:03:54,349 --> 01:03:54,359
if you if you don't recover from a
 

2817
01:03:54,359 --> 01:03:56,840
if you if you don't recover from a
leader failure in a couple seconds and

2818
01:03:56,840 --> 01:03:56,850
leader failure in a couple seconds and
 

2819
01:03:56,850 --> 01:03:58,910
leader failure in a couple seconds and
so just pragmatically you need to tune

2820
01:03:58,910 --> 01:03:58,920
so just pragmatically you need to tune
 

2821
01:03:58,920 --> 01:04:00,980
so just pragmatically you need to tune
this maximum down so that it's highly

2822
01:04:00,980 --> 01:04:00,990
this maximum down so that it's highly
 

2823
01:04:00,990 --> 01:04:03,710
this maximum down so that it's highly
likely that you'll be able to complete a

2824
01:04:03,710 --> 01:04:03,720
likely that you'll be able to complete a
 

2825
01:04:03,720 --> 01:04:05,930
likely that you'll be able to complete a
leader election within a few seconds but

2826
01:04:05,930 --> 01:04:05,940
leader election within a few seconds but
 

2827
01:04:05,940 --> 01:04:09,530
leader election within a few seconds but
that's not a very tight constraint any

2828
01:04:09,530 --> 01:04:09,540
that's not a very tight constraint any
 

2829
01:04:09,540 --> 01:04:13,660
that's not a very tight constraint any
questions about the election time outs

2830
01:04:13,660 --> 01:04:13,670
questions about the election time outs
 

2831
01:04:13,670 --> 01:04:19,900
questions about the election time outs
one tiny point is that you want to

2832
01:04:19,900 --> 01:04:19,910
one tiny point is that you want to
 

2833
01:04:19,910 --> 01:04:23,180
one tiny point is that you want to
choose new random time outs every time

2834
01:04:23,180 --> 01:04:23,190
choose new random time outs every time
 

2835
01:04:23,190 --> 01:04:26,690
choose new random time outs every time
there's every time you every time I node

2836
01:04:26,690 --> 01:04:26,700
there's every time you every time I node
 

2837
01:04:26,700 --> 01:04:28,730
there's every time you every time I node
sets it to like me sets its election

2838
01:04:28,730 --> 01:04:28,740
sets it to like me sets its election
 

2839
01:04:28,740 --> 01:04:31,220
sets it to like me sets its election
timer that is don't choose a random

2840
01:04:31,220 --> 01:04:31,230
timer that is don't choose a random
 

2841
01:04:31,230 --> 01:04:34,820
timer that is don't choose a random
number when the server is first created

2842
01:04:34,820 --> 01:04:34,830
number when the server is first created
 

2843
01:04:34,830 --> 01:04:36,080
number when the server is first created
and then we use that same number over

2844
01:04:36,080 --> 01:04:36,090
and then we use that same number over
 

2845
01:04:36,090 --> 01:04:37,460
and then we use that same number over
and over again because you make an

2846
01:04:37,460 --> 01:04:37,470
and over again because you make an
 

2847
01:04:37,470 --> 01:04:39,710
and over again because you make an
unlucky choice that is you choose this

2848
01:04:39,710 --> 01:04:39,720
unlucky choice that is you choose this
 

2849
01:04:39,720 --> 01:04:42,260
unlucky choice that is you choose this
one server happens by ill chance to

2850
01:04:42,260 --> 01:04:42,270
one server happens by ill chance to
 

2851
01:04:42,270 --> 01:04:44,150
one server happens by ill chance to
choose the same random number as another

2852
01:04:44,150 --> 01:04:44,160
choose the same random number as another
 

2853
01:04:44,160 --> 01:04:46,040
choose the same random number as another
server that means that you're gonna have

2854
01:04:46,040 --> 01:04:46,050
server that means that you're gonna have
 

2855
01:04:46,050 --> 01:04:48,820
server that means that you're gonna have
split votes over and over again forever

2856
01:04:48,820 --> 01:04:48,830
split votes over and over again forever
 

2857
01:04:48,830 --> 01:04:51,290
split votes over and over again forever
that's why you want to almost certainly

2858
01:04:51,290 --> 01:04:51,300
that's why you want to almost certainly
 

2859
01:04:51,300 --> 01:04:53,330
that's why you want to almost certainly
choose a different a new fresh random

2860
01:04:53,330 --> 01:04:53,340
choose a different a new fresh random
 

2861
01:04:53,340 --> 01:04:56,120
choose a different a new fresh random
number for the election time out value

2862
01:04:56,120 --> 01:04:56,130
number for the election time out value
 

2863
01:04:56,130 --> 01:05:02,930
number for the election time out value
every time you reset the timer all right

2864
01:05:02,930 --> 01:05:02,940
every time you reset the timer all right
 

2865
01:05:02,940 --> 01:05:06,790
every time you reset the timer all right
so the final issue about leader election

2866
01:05:06,790 --> 01:05:06,800
so the final issue about leader election
 

2867
01:05:06,800 --> 01:05:09,020
so the final issue about leader election
suppose we are in this situation where

2868
01:05:09,020 --> 01:05:09,030
suppose we are in this situation where
 

2869
01:05:09,030 --> 01:05:11,180
suppose we are in this situation where
the old leaders partition you know the

2870
01:05:11,180 --> 01:05:11,190
the old leaders partition you know the
 

2871
01:05:11,190 --> 01:05:12,950
the old leaders partition you know the
network cable is broken and the old

2872
01:05:12,950 --> 01:05:12,960
network cable is broken and the old
 

2873
01:05:12,960 --> 01:05:14,780
network cable is broken and the old
leader is sort of out there with a

2874
01:05:14,780 --> 01:05:14,790
leader is sort of out there with a
 

2875
01:05:14,790 --> 01:05:17,210
leader is sort of out there with a
couple clients and a minority of servers

2876
01:05:17,210 --> 01:05:17,220
couple clients and a minority of servers
 

2877
01:05:17,220 --> 01:05:20,510
couple clients and a minority of servers
and there's a majority in the other half

2878
01:05:20,510 --> 01:05:20,520
and there's a majority in the other half
 

2879
01:05:20,520 --> 01:05:21,620
and there's a majority in the other half
of the network and the majority of the

2880
01:05:21,620 --> 01:05:21,630
of the network and the majority of the
 

2881
01:05:21,630 --> 01:05:22,700
of the network and the majority of the
new half of the network elects a new

2882
01:05:22,700 --> 01:05:22,710
new half of the network elects a new
 

2883
01:05:22,710 --> 01:05:28,190
new half of the network elects a new
leader what about the old leader why why

2884
01:05:28,190 --> 01:05:28,200
leader what about the old leader why why
 

2885
01:05:28,200 --> 01:05:32,780
leader what about the old leader why why
won't the old leader cause incorrect

2886
01:05:32,780 --> 01:05:32,790
won't the old leader cause incorrect
 

2887
01:05:32,790 --> 01:06:06,300
won't the old leader cause incorrect
execution

2888
01:06:06,300 --> 01:06:06,310

 

2889
01:06:06,310 --> 01:06:09,970

yes to two potential problems one is or

2890
01:06:09,970 --> 01:06:09,980
yes to two potential problems one is or
 

2891
01:06:09,980 --> 01:06:12,850
yes to two potential problems one is or
one some non problem is that if there's

2892
01:06:12,850 --> 01:06:12,860
one some non problem is that if there's
 

2893
01:06:12,860 --> 01:06:14,500
one some non problem is that if there's
a leader off in another partition and it

2894
01:06:14,500 --> 01:06:14,510
a leader off in another partition and it
 

2895
01:06:14,510 --> 01:06:17,020
a leader off in another partition and it
doesn't have a majority then the next

2896
01:06:17,020 --> 01:06:17,030
doesn't have a majority then the next
 

2897
01:06:17,030 --> 01:06:20,920
doesn't have a majority then the next
time a client sends it a request that

2898
01:06:20,920 --> 01:06:20,930
time a client sends it a request that
 

2899
01:06:20,930 --> 01:06:24,250
time a client sends it a request that
that leader that you know in a partition

2900
01:06:24,250 --> 01:06:24,260
that leader that you know in a partition
 

2901
01:06:24,260 --> 01:06:25,390
that leader that you know in a partition
with a minority yeah it'll send out

2902
01:06:25,390 --> 01:06:25,400
with a minority yeah it'll send out
 

2903
01:06:25,400 --> 01:06:27,490
with a minority yeah it'll send out
append entries but because it's in the

2904
01:06:27,490 --> 01:06:27,500
append entries but because it's in the
 

2905
01:06:27,500 --> 01:06:29,920
append entries but because it's in the
minority partition it won't be able to

2906
01:06:29,920 --> 01:06:29,930
minority partition it won't be able to
 

2907
01:06:29,930 --> 01:06:31,930
minority partition it won't be able to
get responses back from a majority of

2908
01:06:31,930 --> 01:06:31,940
get responses back from a majority of
 

2909
01:06:31,940 --> 01:06:33,850
get responses back from a majority of
the server's including itself and so it

2910
01:06:33,850 --> 01:06:33,860
the server's including itself and so it
 

2911
01:06:33,860 --> 01:06:36,100
the server's including itself and so it
will never commit the operation it will

2912
01:06:36,100 --> 01:06:36,110
will never commit the operation it will
 

2913
01:06:36,110 --> 01:06:37,090
will never commit the operation it will
never execute it

2914
01:06:37,090 --> 01:06:37,100
never execute it
 

2915
01:06:37,100 --> 01:06:39,820
never execute it
it'll never respond to the client saying

2916
01:06:39,820 --> 01:06:39,830
it'll never respond to the client saying
 

2917
01:06:39,830 --> 01:06:42,460
it'll never respond to the client saying
that it executed it either and so that

2918
01:06:42,460 --> 01:06:42,470
that it executed it either and so that
 

2919
01:06:42,470 --> 01:06:45,850
that it executed it either and so that
means that yeah an old server often a

2920
01:06:45,850 --> 01:06:45,860
means that yeah an old server often a
 

2921
01:06:45,860 --> 01:06:47,920
means that yeah an old server often a
different partition people many clients

2922
01:06:47,920 --> 01:06:47,930
different partition people many clients
 

2923
01:06:47,930 --> 01:06:49,660
different partition people many clients
may send a request but they'll never get

2924
01:06:49,660 --> 01:06:49,670
may send a request but they'll never get
 

2925
01:06:49,670 --> 01:06:54,010
may send a request but they'll never get
responses so no client will be fooled

2926
01:06:54,010 --> 01:06:54,020
responses so no client will be fooled
 

2927
01:06:54,020 --> 01:06:56,620
responses so no client will be fooled
into thinking that that old server

2928
01:06:56,620 --> 01:06:56,630
into thinking that that old server
 

2929
01:06:56,630 --> 01:07:01,990
into thinking that that old server
executed anything for it the other sort

2930
01:07:01,990 --> 01:07:02,000
executed anything for it the other sort
 

2931
01:07:02,000 --> 01:07:05,440
executed anything for it the other sort
of more tricky issue which actually I'll

2932
01:07:05,440 --> 01:07:05,450
of more tricky issue which actually I'll
 

2933
01:07:05,450 --> 01:07:07,030
of more tricky issue which actually I'll
talk about in a few minutes is the

2934
01:07:07,030 --> 01:07:07,040
talk about in a few minutes is the
 

2935
01:07:07,040 --> 01:07:10,660
talk about in a few minutes is the
possibility that before server fails it

2936
01:07:10,660 --> 01:07:10,670
possibility that before server fails it
 

2937
01:07:10,670 --> 01:07:14,070
possibility that before server fails it
sends out append entries to a subset of

2938
01:07:14,070 --> 01:07:14,080
sends out append entries to a subset of
 

2939
01:07:14,080 --> 01:07:17,650
sends out append entries to a subset of
the servers and then crashes before

2940
01:07:17,650 --> 01:07:17,660
the servers and then crashes before
 

2941
01:07:17,660 --> 01:07:21,040
the servers and then crashes before
making a commission and as a very

2942
01:07:21,040 --> 01:07:21,050
making a commission and as a very
 

2943
01:07:21,050 --> 01:07:24,820
making a commission and as a very
interesting question which I'll probably

2944
01:07:24,820 --> 01:07:24,830
interesting question which I'll probably
 

2945
01:07:24,830 --> 01:07:27,750
interesting question which I'll probably
spend a good 45 minutes talking about

2946
01:07:27,750 --> 01:07:27,760
spend a good 45 minutes talking about
 

2947
01:07:27,760 --> 01:07:30,040
spend a good 45 minutes talking about
and so actually before I turn to the

2948
01:07:30,040 --> 01:07:30,050
and so actually before I turn to the
 

2949
01:07:30,050 --> 01:07:33,250
and so actually before I turn to the
back topic in general any more questions

2950
01:07:33,250 --> 01:07:33,260
back topic in general any more questions
 

2951
01:07:33,260 --> 01:07:42,210
back topic in general any more questions
about in leader election okay

2952
01:07:42,210 --> 01:07:42,220

 

2953
01:07:42,220 --> 01:07:44,920

okay so how about the contents of the

2954
01:07:44,920 --> 01:07:44,930
okay so how about the contents of the
 

2955
01:07:44,930 --> 01:07:49,150
okay so how about the contents of the
logs and how in particular how a newly

2956
01:07:49,150 --> 01:07:49,160
logs and how in particular how a newly
 

2957
01:07:49,160 --> 01:07:51,730
logs and how in particular how a newly
elected leader possibly picking up the

2958
01:07:51,730 --> 01:07:51,740
elected leader possibly picking up the
 

2959
01:07:51,740 --> 01:07:54,430
elected leader possibly picking up the
pieces after an awkward crash of the

2960
01:07:54,430 --> 01:07:54,440
pieces after an awkward crash of the
 

2961
01:07:54,440 --> 01:07:56,740
pieces after an awkward crash of the
previous leader how does a newly elected

2962
01:07:56,740 --> 01:07:56,750
previous leader how does a newly elected
 

2963
01:07:56,750 --> 01:07:59,620
previous leader how does a newly elected
leader sort out the possibly divergent

2964
01:07:59,620 --> 01:07:59,630
leader sort out the possibly divergent
 

2965
01:07:59,630 --> 01:08:02,290
leader sort out the possibly divergent
logs on the different replicas in order

2966
01:08:02,290 --> 01:08:02,300
logs on the different replicas in order
 

2967
01:08:02,300 --> 01:08:06,130
logs on the different replicas in order
to restore sort of consistent state in

2968
01:08:06,130 --> 01:08:06,140
to restore sort of consistent state in
 

2969
01:08:06,140 --> 01:08:14,650
to restore sort of consistent state in
the system all right so the first

2970
01:08:14,650 --> 01:08:14,660
the system all right so the first
 

2971
01:08:14,660 --> 01:08:17,860
the system all right so the first
question is what can think this is this

2972
01:08:17,860 --> 01:08:17,870
question is what can think this is this
 

2973
01:08:17,870 --> 01:08:19,660
question is what can think this is this
whole topic it's really only interesting

2974
01:08:19,660 --> 01:08:19,670
whole topic it's really only interesting
 

2975
01:08:19,670 --> 01:08:21,910
whole topic it's really only interesting
after a server crashes right if the

2976
01:08:21,910 --> 01:08:21,920
after a server crashes right if the
 

2977
01:08:21,920 --> 01:08:25,450
after a server crashes right if the
server stays up then relatively few

2978
01:08:25,450 --> 01:08:25,460
server stays up then relatively few
 

2979
01:08:25,460 --> 01:08:26,920
server stays up then relatively few
things can go wrong if we have a server

2980
01:08:26,920 --> 01:08:26,930
things can go wrong if we have a server
 

2981
01:08:26,930 --> 01:08:28,630
things can go wrong if we have a server
that's up and has a majority you know

2982
01:08:28,630 --> 01:08:28,640
that's up and has a majority you know
 

2983
01:08:28,640 --> 01:08:29,860
that's up and has a majority you know
during the period of time when it's up

2984
01:08:29,860 --> 01:08:29,870
during the period of time when it's up
 

2985
01:08:29,870 --> 01:08:34,059
during the period of time when it's up
and has a majority it just tells the

2986
01:08:34,059 --> 01:08:34,069
and has a majority it just tells the
 

2987
01:08:34,069 --> 01:08:35,890
and has a majority it just tells the
followers what the logs should look like

2988
01:08:35,890 --> 01:08:35,900
followers what the logs should look like
 

2989
01:08:35,900 --> 01:08:37,749
followers what the logs should look like
and the followers are not allowed to

2990
01:08:37,749 --> 01:08:37,759
and the followers are not allowed to
 

2991
01:08:37,759 --> 01:08:39,640
and the followers are not allowed to
disagree they're required to accept they

2992
01:08:39,640 --> 01:08:39,650
disagree they're required to accept they
 

2993
01:08:39,650 --> 01:08:41,410
disagree they're required to accept they
just do by the rules of figure two if

2994
01:08:41,410 --> 01:08:41,420
just do by the rules of figure two if
 

2995
01:08:41,420 --> 01:08:43,090
just do by the rules of figure two if
they've been more or less keeping up you

2996
01:08:43,090 --> 01:08:43,100
they've been more or less keeping up you
 

2997
01:08:43,100 --> 01:08:44,650
they've been more or less keeping up you
know they just take whatever the leader

2998
01:08:44,650 --> 01:08:44,660
know they just take whatever the leader
 

2999
01:08:44,660 --> 01:08:46,209
know they just take whatever the leader
sends them independent reason appended

3000
01:08:46,209 --> 01:08:46,219
sends them independent reason appended
 

3001
01:08:46,219 --> 01:08:48,490
sends them independent reason appended
to the log and obey commit messages and

3002
01:08:48,490 --> 01:08:48,500
to the log and obey commit messages and
 

3003
01:08:48,500 --> 01:08:50,289
to the log and obey commit messages and
execute there's hardly anything to go

3004
01:08:50,289 --> 01:08:50,299
execute there's hardly anything to go
 

3005
01:08:50,299 --> 01:08:52,059
execute there's hardly anything to go
wrong the things that go wrong in Rapp

3006
01:08:52,059 --> 01:08:52,069
wrong the things that go wrong in Rapp
 

3007
01:08:52,069 --> 01:08:55,599
wrong the things that go wrong in Rapp
go wrong when a the old leader crashes

3008
01:08:55,599 --> 01:08:55,609
go wrong when a the old leader crashes
 

3009
01:08:55,609 --> 01:08:58,510
go wrong when a the old leader crashes
sort of midway through you know sending

3010
01:08:58,510 --> 01:08:58,520
sort of midway through you know sending
 

3011
01:08:58,520 --> 01:09:01,930
sort of midway through you know sending
out messages or a new leader crashes you

3012
01:09:01,930 --> 01:09:01,940
out messages or a new leader crashes you
 

3013
01:09:01,940 --> 01:09:03,220
out messages or a new leader crashes you
know sort of just after it's been

3014
01:09:03,220 --> 01:09:03,230
know sort of just after it's been
 

3015
01:09:03,230 --> 01:09:06,940
know sort of just after it's been
elected but before it's done anything

3016
01:09:06,940 --> 01:09:06,950
elected but before it's done anything
 

3017
01:09:06,950 --> 01:09:10,120
elected but before it's done anything
very useful so one thing we're very

3018
01:09:10,120 --> 01:09:10,130
very useful so one thing we're very
 

3019
01:09:10,130 --> 01:09:11,769
very useful so one thing we're very
interested in is what can the logs look

3020
01:09:11,769 --> 01:09:11,779
interested in is what can the logs look
 

3021
01:09:11,779 --> 01:09:16,660
interested in is what can the logs look
like after some sequence of crashes okay

3022
01:09:16,660 --> 01:09:16,670
like after some sequence of crashes okay
 

3023
01:09:16,670 --> 01:09:19,510
like after some sequence of crashes okay
so here's an example supposing we have

3024
01:09:19,510 --> 01:09:19,520
so here's an example supposing we have
 

3025
01:09:19,520 --> 01:09:26,170
so here's an example supposing we have
two servers and the way I'm gonna draw

3026
01:09:26,170 --> 01:09:26,180
two servers and the way I'm gonna draw
 

3027
01:09:26,180 --> 01:09:27,579
two servers and the way I'm gonna draw
out these diagrams because we're gonna

3028
01:09:27,579 --> 01:09:27,589
out these diagrams because we're gonna
 

3029
01:09:27,589 --> 01:09:30,870
out these diagrams because we're gonna
be looking a lot at a lot of sort of

3030
01:09:30,870 --> 01:09:30,880
be looking a lot at a lot of sort of
 

3031
01:09:30,880 --> 01:09:32,979
be looking a lot at a lot of sort of
situations where the logs look like this

3032
01:09:32,979 --> 01:09:32,989
situations where the logs look like this
 

3033
01:09:32,989 --> 01:09:34,780
situations where the logs look like this
and we're gonna be wondering is that

3034
01:09:34,780 --> 01:09:34,790
and we're gonna be wondering is that
 

3035
01:09:34,790 --> 01:09:36,640
and we're gonna be wondering is that
possible and what happens if they do

3036
01:09:36,640 --> 01:09:36,650
possible and what happens if they do
 

3037
01:09:36,650 --> 01:09:38,470
possible and what happens if they do
look like that so my notation is going

3038
01:09:38,470 --> 01:09:38,480
look like that so my notation is going
 

3039
01:09:38,480 --> 01:09:40,360
look like that so my notation is going
to be I'm gonna write out log entries

3040
01:09:40,360 --> 01:09:40,370
to be I'm gonna write out log entries
 

3041
01:09:40,370 --> 01:09:44,860
to be I'm gonna write out log entries
for each of the servers sort of aligned

3042
01:09:44,860 --> 01:09:44,870
for each of the servers sort of aligned
 

3043
01:09:44,870 --> 01:09:47,829
for each of the servers sort of aligned
to indicate slots corresponding slots in

3044
01:09:47,829 --> 01:09:47,839
to indicate slots corresponding slots in
 

3045
01:09:47,839 --> 01:09:50,260
to indicate slots corresponding slots in
the log and the values I'm going to

3046
01:09:50,260 --> 01:09:50,270
the log and the values I'm going to
 

3047
01:09:50,270 --> 01:09:53,320
the log and the values I'm going to
write here are the term numbers rather

3048
01:09:53,320 --> 01:09:53,330
write here are the term numbers rather
 

3049
01:09:53,330 --> 01:09:54,330
write here are the term numbers rather
than

3050
01:09:54,330 --> 01:09:54,340
than
 

3051
01:09:54,340 --> 01:09:56,879
than
client operations I'm going to you know

3052
01:09:56,879 --> 01:09:56,889
client operations I'm going to you know
 

3053
01:09:56,889 --> 01:09:59,209
client operations I'm going to you know
this is slot one this is thought to

3054
01:09:59,209 --> 01:09:59,219
this is slot one this is thought to
 

3055
01:09:59,219 --> 01:10:02,370
this is slot one this is thought to
everybody saw a command from term three

3056
01:10:02,370 --> 01:10:02,380
everybody saw a command from term three
 

3057
01:10:02,380 --> 01:10:05,220
everybody saw a command from term three
in slot 1 and server tuned server three

3058
01:10:05,220 --> 01:10:05,230
in slot 1 and server tuned server three
 

3059
01:10:05,230 --> 01:10:08,310
in slot 1 and server tuned server three
saw command from also term three and the

3060
01:10:08,310 --> 01:10:08,320
saw command from also term three and the
 

3061
01:10:08,320 --> 01:10:10,229
saw command from also term three and the
second slot the server one has nothing

3062
01:10:10,229 --> 01:10:10,239
second slot the server one has nothing
 

3063
01:10:10,239 --> 01:10:14,790
second slot the server one has nothing
there at all and so question for this

3064
01:10:14,790 --> 01:10:14,800
there at all and so question for this
 

3065
01:10:14,800 --> 01:10:16,470
there at all and so question for this
like the very first question is can this

3066
01:10:16,470 --> 01:10:16,480
like the very first question is can this
 

3067
01:10:16,480 --> 01:10:21,649
like the very first question is can this
arrive could this setup arise and how

3068
01:10:21,649 --> 01:10:21,659
arrive could this setup arise and how
 

3069
01:10:21,659 --> 01:11:02,120
arrive could this setup arise and how
yes

3070
01:11:02,120 --> 01:11:02,130

 

3071
01:11:02,130 --> 01:11:04,830

so you know maybe server 3 was the

3072
01:11:04,830 --> 01:11:04,840
so you know maybe server 3 was the
 

3073
01:11:04,840 --> 01:11:06,270
so you know maybe server 3 was the
leader for just repeating what you said

3074
01:11:06,270 --> 01:11:06,280
leader for just repeating what you said
 

3075
01:11:06,280 --> 01:11:08,310
leader for just repeating what you said
maybe server 3 is the leader for term 3

3076
01:11:08,310 --> 01:11:08,320
maybe server 3 is the leader for term 3
 

3077
01:11:08,320 --> 01:11:09,960
maybe server 3 is the leader for term 3
he got a command that sent out to

3078
01:11:09,960 --> 01:11:09,970
he got a command that sent out to
 

3079
01:11:09,970 --> 01:11:11,370
he got a command that sent out to
everybody everybody received a dependent

3080
01:11:11,370 --> 01:11:11,380
everybody everybody received a dependent
 

3081
01:11:11,380 --> 01:11:14,340
everybody everybody received a dependent
at the log and then I got a server 3 got

3082
01:11:14,340 --> 01:11:14,350
at the log and then I got a server 3 got
 

3083
01:11:14,350 --> 01:11:18,150
at the log and then I got a server 3 got
a second request from a client and maybe

3084
01:11:18,150 --> 01:11:18,160
a second request from a client and maybe
 

3085
01:11:18,160 --> 01:11:19,800
a second request from a client and maybe
it sent it to all three servers but the

3086
01:11:19,800 --> 01:11:19,810
it sent it to all three servers but the
 

3087
01:11:19,810 --> 01:11:21,120
it sent it to all three servers but the
message got lost on the way to server

3088
01:11:21,120 --> 01:11:21,130
message got lost on the way to server
 

3089
01:11:21,130 --> 01:11:23,010
message got lost on the way to server
one or maybe server was down at the time

3090
01:11:23,010 --> 01:11:23,020
one or maybe server was down at the time
 

3091
01:11:23,020 --> 01:11:25,020
one or maybe server was down at the time
or something and so only server to the

3092
01:11:25,020 --> 01:11:25,030
or something and so only server to the
 

3093
01:11:25,030 --> 01:11:28,140
or something and so only server to the
leader always append new commands to its

3094
01:11:28,140 --> 01:11:28,150
leader always append new commands to its
 

3095
01:11:28,150 --> 01:11:29,820
leader always append new commands to its
log before it sends out append entries

3096
01:11:29,820 --> 01:11:29,830
log before it sends out append entries
 

3097
01:11:29,830 --> 01:11:32,370
log before it sends out append entries
and maybe the append entry RPC only got

3098
01:11:32,370 --> 01:11:32,380
and maybe the append entry RPC only got
 

3099
01:11:32,380 --> 01:11:34,380
and maybe the append entry RPC only got
to server 2 so this situation you know

3100
01:11:34,380 --> 01:11:34,390
to server 2 so this situation you know
 

3101
01:11:34,390 --> 01:11:36,150
to server 2 so this situation you know
it's like the simplest situation and was

3102
01:11:36,150 --> 01:11:36,160
it's like the simplest situation and was
 

3103
01:11:36,160 --> 01:11:38,450
it's like the simplest situation and was
actually the logs are not different and

3104
01:11:38,450 --> 01:11:38,460
actually the logs are not different and
 

3105
01:11:38,460 --> 01:11:43,470
actually the logs are not different and
we know how it could possibly arise and

3106
01:11:43,470 --> 01:11:43,480
we know how it could possibly arise and
 

3107
01:11:43,480 --> 01:11:45,240
we know how it could possibly arise and
so if server 3 which is a leadership

3108
01:11:45,240 --> 01:11:45,250
so if server 3 which is a leadership
 

3109
01:11:45,250 --> 01:11:46,470
so if server 3 which is a leadership
crash now you know the next server

3110
01:11:46,470 --> 01:11:46,480
crash now you know the next server
 

3111
01:11:46,480 --> 01:11:49,290
crash now you know the next server
they're gonna need to make sure server 1

3112
01:11:49,290 --> 01:11:49,300
they're gonna need to make sure server 1
 

3113
01:11:49,300 --> 01:11:54,810
they're gonna need to make sure server 1
well first of all if server 3 crashes or

3114
01:11:54,810 --> 01:11:54,820
well first of all if server 3 crashes or
 

3115
01:11:54,820 --> 01:11:56,130
well first of all if server 3 crashes or
we'll be at an election and some of the

3116
01:11:56,130 --> 01:11:56,140
we'll be at an election and some of the
 

3117
01:11:56,140 --> 01:11:57,780
we'll be at an election and some of the
leader is chosen you know two things

3118
01:11:57,780 --> 01:11:57,790
leader is chosen you know two things
 

3119
01:11:57,790 --> 01:12:00,150
leader is chosen you know two things
have to happen the new leader has got to

3120
01:12:00,150 --> 01:12:00,160
have to happen the new leader has got to
 

3121
01:12:00,160 --> 01:12:04,980
have to happen the new leader has got to
recognize that this command could have

3122
01:12:04,980 --> 01:12:04,990
recognize that this command could have
 

3123
01:12:04,990 --> 01:12:06,900
recognize that this command could have
committed it's not allowed to throw it

3124
01:12:06,900 --> 01:12:06,910
committed it's not allowed to throw it
 

3125
01:12:06,910 --> 01:12:07,740
committed it's not allowed to throw it
away

3126
01:12:07,740 --> 01:12:07,750
away
 

3127
01:12:07,750 --> 01:12:09,930
away
and it needs to make sure server one

3128
01:12:09,930 --> 01:12:09,940
and it needs to make sure server one
 

3129
01:12:09,940 --> 01:12:12,060
and it needs to make sure server one
fills in this blank here with indeed

3130
01:12:12,060 --> 01:12:12,070
fills in this blank here with indeed
 

3131
01:12:12,070 --> 01:12:13,590
fills in this blank here with indeed
this very same command that everybody

3132
01:12:13,590 --> 01:12:13,600
this very same command that everybody
 

3133
01:12:13,600 --> 01:12:17,940
this very same command that everybody
else had in that slot all right so after

3134
01:12:17,940 --> 01:12:17,950
else had in that slot all right so after
 

3135
01:12:17,950 --> 01:12:20,430
else had in that slot all right so after
a crash somebody you know server 3

3136
01:12:20,430 --> 01:12:20,440
a crash somebody you know server 3
 

3137
01:12:20,440 --> 01:12:22,410
a crash somebody you know server 3
suppose another way this can come up is

3138
01:12:22,410 --> 01:12:22,420
suppose another way this can come up is
 

3139
01:12:22,420 --> 01:12:24,150
suppose another way this can come up is
server 3 might have sent out the append

3140
01:12:24,150 --> 01:12:24,160
server 3 might have sent out the append
 

3141
01:12:24,160 --> 01:12:26,130
server 3 might have sent out the append
entries the server 2 but then crashed

3142
01:12:26,130 --> 01:12:26,140
entries the server 2 but then crashed
 

3143
01:12:26,140 --> 01:12:27,690
entries the server 2 but then crashed
before sending the append entries to

3144
01:12:27,690 --> 01:12:27,700
before sending the append entries to
 

3145
01:12:27,700 --> 01:12:30,390
before sending the append entries to
server 3 so if were you know electing a

3146
01:12:30,390 --> 01:12:30,400
server 3 so if were you know electing a
 

3147
01:12:30,400 --> 01:12:32,400
server 3 so if were you know electing a
new leader it could because we got a

3148
01:12:32,400 --> 01:12:32,410
new leader it could because we got a
 

3149
01:12:32,410 --> 01:12:34,520
new leader it could because we got a
crash before the message was sent

3150
01:12:34,520 --> 01:12:34,530
crash before the message was sent
 

3151
01:12:34,530 --> 01:12:37,070
crash before the message was sent
here's another scenario to think about

3152
01:12:37,070 --> 01:12:37,080
here's another scenario to think about
 

3153
01:12:37,080 --> 01:12:44,820
here's another scenario to think about
three servers again no I mean a number

3154
01:12:44,820 --> 01:12:44,830
three servers again no I mean a number
 

3155
01:12:44,830 --> 01:12:48,180
three servers again no I mean a number
the slots in the law and so we can refer

3156
01:12:48,180 --> 01:12:48,190
the slots in the law and so we can refer
 

3157
01:12:48,190 --> 01:12:55,720
the slots in the law and so we can refer
to them got slot 10 11 12 13

3158
01:12:55,720 --> 01:12:55,730

 

3159
01:12:55,730 --> 01:12:57,140

[Music]

3160
01:12:57,140 --> 01:12:57,150
[Music]
 

3161
01:12:57,150 --> 01:13:04,350
[Music]
again it's same setup except now we have

3162
01:13:04,350 --> 01:13:04,360
again it's same setup except now we have
 

3163
01:13:04,360 --> 01:13:07,770
again it's same setup except now we have
in slide 12 we have server 2 as a

3164
01:13:07,770 --> 01:13:07,780
in slide 12 we have server 2 as a
 

3165
01:13:07,780 --> 01:13:11,160
in slide 12 we have server 2 as a
command from term for and server 3 has a

3166
01:13:11,160 --> 01:13:11,170
command from term for and server 3 has a
 

3167
01:13:11,170 --> 01:13:15,780
command from term for and server 3 has a
term command from term 5

3168
01:13:15,780 --> 01:13:15,790

 

3169
01:13:15,790 --> 01:13:19,600

so you know before we analyze these to

3170
01:13:19,600 --> 01:13:19,610
so you know before we analyze these to
 

3171
01:13:19,610 --> 01:13:21,460
so you know before we analyze these to
figure out what would happen and what

3172
01:13:21,460 --> 01:13:21,470
figure out what would happen and what
 

3173
01:13:21,470 --> 01:13:22,960
figure out what would happen and what
would a server do if it saw this we need

3174
01:13:22,960 --> 01:13:22,970
would a server do if it saw this we need
 

3175
01:13:22,970 --> 01:13:24,970
would a server do if it saw this we need
to ask could this even occur because

3176
01:13:24,970 --> 01:13:24,980
to ask could this even occur because
 

3177
01:13:24,980 --> 01:13:27,040
to ask could this even occur because
sometimes the answer to the question oh

3178
01:13:27,040 --> 01:13:27,050
sometimes the answer to the question oh
 

3179
01:13:27,050 --> 01:13:28,510
sometimes the answer to the question oh
jeez what would happen if this

3180
01:13:28,510 --> 01:13:28,520
jeez what would happen if this
 

3181
01:13:28,520 --> 01:13:30,610
jeez what would happen if this
configuration arose sometimes the answer

3182
01:13:30,610 --> 01:13:30,620
configuration arose sometimes the answer
 

3183
01:13:30,620 --> 01:13:32,890
configuration arose sometimes the answer
is it cannot arise so we do not have to

3184
01:13:32,890 --> 01:13:32,900
is it cannot arise so we do not have to
 

3185
01:13:32,900 --> 01:13:37,120
is it cannot arise so we do not have to
worry about it the question is could

3186
01:13:37,120 --> 01:13:37,130
worry about it the question is could
 

3187
01:13:37,130 --> 01:13:57,890
worry about it the question is could
this arise and how

3188
01:13:57,890 --> 01:13:57,900

 

3189
01:13:57,900 --> 01:14:12,810

all right so any

3190
01:14:12,810 --> 01:14:12,820

 

3191
01:14:12,820 --> 01:14:52,649

[Music]

3192
01:14:52,649 --> 01:14:52,659

 

3193
01:14:52,659 --> 01:14:59,050

yeah

3194
01:14:59,050 --> 01:14:59,060

 

3195
01:14:59,060 --> 01:15:02,420

in brief we know this configuration can

3196
01:15:02,420 --> 01:15:02,430
in brief we know this configuration can
 

3197
01:15:02,430 --> 01:15:05,660
in brief we know this configuration can
arise and so the way we can then get the

3198
01:15:05,660 --> 01:15:05,670
arise and so the way we can then get the
 

3199
01:15:05,670 --> 01:15:07,520
arise and so the way we can then get the
four and a five here is let's suppose in

3200
01:15:07,520 --> 01:15:07,530
four and a five here is let's suppose in
 

3201
01:15:07,530 --> 01:15:08,900
four and a five here is let's suppose in
the next leader election server twos

3202
01:15:08,900 --> 01:15:08,910
the next leader election server twos
 

3203
01:15:08,910 --> 01:15:11,690
the next leader election server twos
elected leader now for term for its

3204
01:15:11,690 --> 01:15:11,700
elected leader now for term for its
 

3205
01:15:11,700 --> 01:15:13,430
elected leader now for term for its
elected leader because a request from a

3206
01:15:13,430 --> 01:15:13,440
elected leader because a request from a
 

3207
01:15:13,440 --> 01:15:15,890
elected leader because a request from a
client it appends it to its own log and

3208
01:15:15,890 --> 01:15:15,900
client it appends it to its own log and
 

3209
01:15:15,900 --> 01:15:20,030
client it appends it to its own log and
crashes so now we have this right we

3210
01:15:20,030 --> 01:15:20,040
crashes so now we have this right we
 

3211
01:15:20,040 --> 01:15:21,470
crashes so now we have this right we
need a new election because the leader

3212
01:15:21,470 --> 01:15:21,480
need a new election because the leader
 

3213
01:15:21,480 --> 01:15:25,400
need a new election because the leader
just crashed now in this election and

3214
01:15:25,400 --> 01:15:25,410
just crashed now in this election and
 

3215
01:15:25,410 --> 01:15:27,500
just crashed now in this election and
then so now we have to ask whether who

3216
01:15:27,500 --> 01:15:27,510
then so now we have to ask whether who
 

3217
01:15:27,510 --> 01:15:29,360
then so now we have to ask whether who
could be elected or we have to give him

3218
01:15:29,360 --> 01:15:29,370
could be elected or we have to give him
 

3219
01:15:29,370 --> 01:15:30,710
could be elected or we have to give him
back of our heads oh gosh what could be

3220
01:15:30,710 --> 01:15:30,720
back of our heads oh gosh what could be
 

3221
01:15:30,720 --> 01:15:32,720
back of our heads oh gosh what could be
elected so we're gonna claim server

3222
01:15:32,720 --> 01:15:32,730
elected so we're gonna claim server
 

3223
01:15:32,730 --> 01:15:34,460
elected so we're gonna claim server
three could be elected the reason why I

3224
01:15:34,460 --> 01:15:34,470
three could be elected the reason why I
 

3225
01:15:34,470 --> 01:15:35,750
three could be elected the reason why I
could be elected is because it only

3226
01:15:35,750 --> 01:15:35,760
could be elected is because it only
 

3227
01:15:35,760 --> 01:15:38,120
could be elected is because it only
needs request vote responses from

3228
01:15:38,120 --> 01:15:38,130
needs request vote responses from
 

3229
01:15:38,130 --> 01:15:40,490
needs request vote responses from
majority that majority is server one and

3230
01:15:40,490 --> 01:15:40,500
majority that majority is server one and
 

3231
01:15:40,500 --> 01:15:42,770
majority that majority is server one and
server three you know there's no no

3232
01:15:42,770 --> 01:15:42,780
server three you know there's no no
 

3233
01:15:42,780 --> 01:15:44,360
server three you know there's no no
problem no conflict between these two

3234
01:15:44,360 --> 01:15:44,370
problem no conflict between these two
 

3235
01:15:44,370 --> 01:15:46,550
problem no conflict between these two
logs so server three can be elected for

3236
01:15:46,550 --> 01:15:46,560
logs so server three can be elected for
 

3237
01:15:46,560 --> 01:15:48,760
logs so server three can be elected for
term five get a request from a client

3238
01:15:48,760 --> 01:15:48,770
term five get a request from a client
 

3239
01:15:48,770 --> 01:15:51,800
term five get a request from a client
append it to its own log and crash and

3240
01:15:51,800 --> 01:15:51,810
append it to its own log and crash and
 

3241
01:15:51,810 --> 01:15:54,170
append it to its own log and crash and
that's how you get this this

3242
01:15:54,170 --> 01:15:54,180
that's how you get this this
 

3243
01:15:54,180 --> 01:15:57,140
that's how you get this this
configuration so you know you need to be

3244
01:15:57,140 --> 01:15:57,150
configuration so you know you need to be
 

3245
01:15:57,150 --> 01:16:04,130
configuration so you know you need to be
able to to work through these things in

3246
01:16:04,130 --> 01:16:04,140
able to to work through these things in
 

3247
01:16:04,140 --> 01:16:05,780
able to to work through these things in
order to get to the stage of saying yes

3248
01:16:05,780 --> 01:16:05,790
order to get to the stage of saying yes
 

3249
01:16:05,790 --> 01:16:07,130
order to get to the stage of saying yes
this could happen and therefore raft

3250
01:16:07,130 --> 01:16:07,140
this could happen and therefore raft
 

3251
01:16:07,140 --> 01:16:09,380
this could happen and therefore raft
must do something sensible as opposed to

3252
01:16:09,380 --> 01:16:09,390
must do something sensible as opposed to
 

3253
01:16:09,390 --> 01:16:11,300
must do something sensible as opposed to
it cannot happen because some things

3254
01:16:11,300 --> 01:16:11,310
it cannot happen because some things
 

3255
01:16:11,310 --> 01:16:17,529
it cannot happen because some things
can't happen

3256
01:16:17,529 --> 01:16:17,539

 

3257
01:16:17,539 --> 01:16:23,919

all right so so what can happen now we

3258
01:16:23,919 --> 01:16:23,929
all right so so what can happen now we
 

3259
01:16:23,929 --> 01:16:27,040
all right so so what can happen now we
know this can occur so hopefully we can

3260
01:16:27,040 --> 01:16:27,050
know this can occur so hopefully we can
 

3261
01:16:27,050 --> 01:16:29,100
know this can occur so hopefully we can
convince ourselves that raft actually

3262
01:16:29,100 --> 01:16:29,110
convince ourselves that raft actually
 

3263
01:16:29,110 --> 01:16:34,540
convince ourselves that raft actually
does something sensible now as for the

3264
01:16:34,540 --> 01:16:34,550
does something sensible now as for the
 

3265
01:16:34,550 --> 01:16:36,759
does something sensible now as for the
range of things before we talk about

3266
01:16:36,759 --> 01:16:36,769
range of things before we talk about
 

3267
01:16:36,769 --> 01:16:39,850
range of things before we talk about
what RAF would actually would actually

3268
01:16:39,850 --> 01:16:39,860
what RAF would actually would actually
 

3269
01:16:39,860 --> 01:16:43,600
what RAF would actually would actually
do we need to have some sense of what

3270
01:16:43,600 --> 01:16:43,610
do we need to have some sense of what
 

3271
01:16:43,610 --> 01:16:48,479
do we need to have some sense of what
would be an acceptable outcome right and

3272
01:16:48,479 --> 01:16:48,489
would be an acceptable outcome right and
 

3273
01:16:48,489 --> 01:16:53,439
would be an acceptable outcome right and
just eyeballing this we know that the

3274
01:16:53,439 --> 01:16:53,449
just eyeballing this we know that the
 

3275
01:16:53,449 --> 01:16:55,180
just eyeballing this we know that the
command in slot 10 since it's known by

3276
01:16:55,180 --> 01:16:55,190
command in slot 10 since it's known by
 

3277
01:16:55,190 --> 01:16:59,020
command in slot 10 since it's known by
all all the replicas it could have been

3278
01:16:59,020 --> 01:16:59,030
all all the replicas it could have been
 

3279
01:16:59,030 --> 01:17:01,600
all all the replicas it could have been
committed so we cannot throw it away

3280
01:17:01,600 --> 01:17:01,610
committed so we cannot throw it away
 

3281
01:17:01,610 --> 01:17:04,060
committed so we cannot throw it away
similarly the command in slot 11 since

3282
01:17:04,060 --> 01:17:04,070
similarly the command in slot 11 since
 

3283
01:17:04,070 --> 01:17:05,649
similarly the command in slot 11 since
it's in a majority of the replicas it

3284
01:17:05,649 --> 01:17:05,659
it's in a majority of the replicas it
 

3285
01:17:05,659 --> 01:17:06,939
it's in a majority of the replicas it
could for all we know have been

3286
01:17:06,939 --> 01:17:06,949
could for all we know have been
 

3287
01:17:06,949 --> 01:17:09,370
could for all we know have been
committed so we can't throw it away the

3288
01:17:09,370 --> 01:17:09,380
committed so we can't throw it away the
 

3289
01:17:09,380 --> 01:17:11,290
committed so we can't throw it away the
command in slot 12 however neither of

3290
01:17:11,290 --> 01:17:11,300
command in slot 12 however neither of
 

3291
01:17:11,300 --> 01:17:13,180
command in slot 12 however neither of
them could possibly have been committed

3292
01:17:13,180 --> 01:17:13,190
them could possibly have been committed
 

3293
01:17:13,190 --> 01:17:16,140
them could possibly have been committed
so we're entitled we don't know haven't

3294
01:17:16,140 --> 01:17:16,150
so we're entitled we don't know haven't
 

3295
01:17:16,150 --> 01:17:18,729
so we're entitled we don't know haven't
we'll actually do but raft is entitled

3296
01:17:18,729 --> 01:17:18,739
we'll actually do but raft is entitled
 

3297
01:17:18,739 --> 01:17:21,669
we'll actually do but raft is entitled
to drop both of these even though it is

3298
01:17:21,669 --> 01:17:21,679
to drop both of these even though it is
 

3299
01:17:21,679 --> 01:17:23,470
to drop both of these even though it is
not entitled to drop it and either of

3300
01:17:23,470 --> 01:17:23,480
not entitled to drop it and either of
 

3301
01:17:23,480 --> 01:17:26,879
not entitled to drop it and either of
the commands in a 10 or 11

3302
01:17:26,879 --> 01:17:26,889
the commands in a 10 or 11
 

3303
01:17:26,889 --> 01:17:28,839
the commands in a 10 or 11
this is entitled dropped it's not

3304
01:17:28,839 --> 01:17:28,849
this is entitled dropped it's not
 

3305
01:17:28,849 --> 01:17:31,569
this is entitled dropped it's not
required to drop either one of them but

3306
01:17:31,569 --> 01:17:31,579
required to drop either one of them but
 

3307
01:17:31,579 --> 01:17:33,370
required to drop either one of them but
I mean oh it certainly must drop one at

3308
01:17:33,370 --> 01:17:33,380
I mean oh it certainly must drop one at
 

3309
01:17:33,380 --> 01:17:35,319
I mean oh it certainly must drop one at
least one because you have to have

3310
01:17:35,319 --> 01:17:35,329
least one because you have to have
 

3311
01:17:35,329 --> 01:17:43,280
least one because you have to have
identical log contents in the end

3312
01:17:43,280 --> 01:17:43,290

 

3313
01:17:43,290 --> 01:17:47,550

this could have been committed it the we

3314
01:17:47,550 --> 01:17:47,560
this could have been committed it the we
 

3315
01:17:47,560 --> 01:17:50,090
this could have been committed it the we
can't tell by looking at the laws

3316
01:17:50,090 --> 01:17:50,100
can't tell by looking at the laws
 

3317
01:17:50,100 --> 01:17:52,320
can't tell by looking at the laws
exactly how far the leader got before

3318
01:17:52,320 --> 01:17:52,330
exactly how far the leader got before
 

3319
01:17:52,330 --> 01:17:55,500
exactly how far the leader got before
crashing so one possibility is that for

3320
01:17:55,500 --> 01:17:55,510
crashing so one possibility is that for
 

3321
01:17:55,510 --> 01:17:59,130
crashing so one possibility is that for
this command or even this command one

3322
01:17:59,130 --> 01:17:59,140
this command or even this command one
 

3323
01:17:59,140 --> 01:18:00,780
this command or even this command one
possibility is that leaders send out the

3324
01:18:00,780 --> 01:18:00,790
possibility is that leaders send out the
 

3325
01:18:00,790 --> 01:18:02,820
possibility is that leaders send out the
append messages with a new command and

3326
01:18:02,820 --> 01:18:02,830
append messages with a new command and
 

3327
01:18:02,830 --> 01:18:05,610
append messages with a new command and
then immediately crashed so it never got

3328
01:18:05,610 --> 01:18:05,620
then immediately crashed so it never got
 

3329
01:18:05,620 --> 01:18:08,100
then immediately crashed so it never got
any response back because it crashed so

3330
01:18:08,100 --> 01:18:08,110
any response back because it crashed so
 

3331
01:18:08,110 --> 01:18:09,630
any response back because it crashed so
the old leader did not know if it was

3332
01:18:09,630 --> 01:18:09,640
the old leader did not know if it was
 

3333
01:18:09,640 --> 01:18:12,330
the old leader did not know if it was
committed and if it didn't get a

3334
01:18:12,330 --> 01:18:12,340
committed and if it didn't get a
 

3335
01:18:12,340 --> 01:18:14,400
committed and if it didn't get a
response back that means it didn't

3336
01:18:14,400 --> 01:18:14,410
response back that means it didn't
 

3337
01:18:14,410 --> 01:18:17,580
response back that means it didn't
execute it and it didn't send out but

3338
01:18:17,580 --> 01:18:17,590
execute it and it didn't send out but
 

3339
01:18:17,590 --> 01:18:18,930
execute it and it didn't send out but
you know it didn't send out that

3340
01:18:18,930 --> 01:18:18,940
you know it didn't send out that
 

3341
01:18:18,940 --> 01:18:22,229
you know it didn't send out that
incremented commit index and so maybe

3342
01:18:22,229 --> 01:18:22,239
incremented commit index and so maybe
 

3343
01:18:22,239 --> 01:18:24,600
incremented commit index and so maybe
the replicas didn't execute it either so

3344
01:18:24,600 --> 01:18:24,610
the replicas didn't execute it either so
 

3345
01:18:24,610 --> 01:18:26,939
the replicas didn't execute it either so
it's actually possible that this wasn't

3346
01:18:26,939 --> 01:18:26,949
it's actually possible that this wasn't
 

3347
01:18:26,949 --> 01:18:29,970
it's actually possible that this wasn't
committed so even though RAF doesn't

3348
01:18:29,970 --> 01:18:29,980
committed so even though RAF doesn't
 

3349
01:18:29,980 --> 01:18:35,600
committed so even though RAF doesn't
know it could be legal for raft

3350
01:18:35,600 --> 01:18:35,610
know it could be legal for raft
 

3351
01:18:35,610 --> 01:18:40,770
know it could be legal for raft
if raft knew more than it does know it

3352
01:18:40,770 --> 01:18:40,780
if raft knew more than it does know it
 

3353
01:18:40,780 --> 01:18:43,590
if raft knew more than it does know it
might be legal to drop this log entry

3354
01:18:43,590 --> 01:18:43,600
might be legal to drop this log entry
 

3355
01:18:43,600 --> 01:18:45,030
might be legal to drop this log entry
because it might not have been committed

3356
01:18:45,030 --> 01:18:45,040
because it might not have been committed
 

3357
01:18:45,040 --> 01:18:48,300
because it might not have been committed
but because on the evidence there's no

3358
01:18:48,300 --> 01:18:48,310
but because on the evidence there's no
 

3359
01:18:48,310 --> 01:18:51,000
but because on the evidence there's no
way to disprove it was committed based

3360
01:18:51,000 --> 01:18:51,010
way to disprove it was committed based
 

3361
01:18:51,010 --> 01:18:52,979
way to disprove it was committed based
on this evidence it could have been

3362
01:18:52,979 --> 01:18:52,989
on this evidence it could have been
 

3363
01:18:52,989 --> 01:18:55,290
on this evidence it could have been
committed and raft can't prove it wasn't

3364
01:18:55,290 --> 01:18:55,300
committed and raft can't prove it wasn't
 

3365
01:18:55,300 --> 01:18:58,439
committed and raft can't prove it wasn't
so it must treat it as committed because

3366
01:18:58,439 --> 01:18:58,449
so it must treat it as committed because
 

3367
01:18:58,449 --> 01:19:01,050
so it must treat it as committed because
the leader might have received it might

3368
01:19:01,050 --> 01:19:01,060
the leader might have received it might
 

3369
01:19:01,060 --> 01:19:03,300
the leader might have received it might
have crashed just after receiving the

3370
01:19:03,300 --> 01:19:03,310
have crashed just after receiving the
 

3371
01:19:03,310 --> 01:19:05,610
have crashed just after receiving the
append entry replies and replying to the

3372
01:19:05,610 --> 01:19:05,620
append entry replies and replying to the
 

3373
01:19:05,620 --> 01:19:08,250
append entry replies and replying to the
client so just looking at this we can't

3374
01:19:08,250 --> 01:19:08,260
client so just looking at this we can't
 

3375
01:19:08,260 --> 01:19:10,590
client so just looking at this we can't
rule out the possibility that either

3376
01:19:10,590 --> 01:19:10,600
rule out the possibility that either
 

3377
01:19:10,600 --> 01:19:14,130
rule out the possibility that either
possibility that the leader responded to

3378
01:19:14,130 --> 01:19:14,140
possibility that the leader responded to
 

3379
01:19:14,140 --> 01:19:15,780
possibility that the leader responded to
the client in which case we cannot throw

3380
01:19:15,780 --> 01:19:15,790
the client in which case we cannot throw
 

3381
01:19:15,790 --> 01:19:17,220
the client in which case we cannot throw
away this entry because a client knows

3382
01:19:17,220 --> 01:19:17,230
away this entry because a client knows
 

3383
01:19:17,230 --> 01:19:18,959
away this entry because a client knows
about it or the possibility the leader

3384
01:19:18,959 --> 01:19:18,969
about it or the possibility the leader
 

3385
01:19:18,969 --> 01:19:23,070
about it or the possibility the leader
never did and yeah we could you know if

3386
01:19:23,070 --> 01:19:23,080
never did and yeah we could you know if
 

3387
01:19:23,080 --> 01:19:33,380
never did and yeah we could you know if
we have to assume that it was committed

3388
01:19:33,380 --> 01:19:33,390

 

3389
01:19:33,390 --> 01:19:46,479

yeah

3390
01:19:46,479 --> 01:19:46,489

 

3391
01:19:46,489 --> 01:19:51,580

no there's no maana server crash before

3392
01:19:51,580 --> 01:19:51,590
no there's no maana server crash before
 

3393
01:19:51,590 --> 01:19:53,620
no there's no maana server crash before
getting the response it's alright well

3394
01:19:53,620 --> 01:19:53,630
getting the response it's alright well
 

3395
01:19:53,630 --> 01:19:58,360
getting the response it's alright well
let's continue this on Thursday

